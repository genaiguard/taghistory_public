import{c as Rr,r as K,a as Or,d as At,q as Wi,w as Ys,o as Qi,b as di,e as en,f as $s,j as T,M as Xs,T as Js,u as tn,g as gi,s as Ir,h as Zs,l as We,i as St,k as Ws}from"./index-B0pEKSo-.js";var rn={},nn;function Qs(){return nn||(nn=1,(()=>{var re=Object.create,ue=Object.defineProperty,Ee=Object.getOwnPropertyDescriptor,oe=Object.getOwnPropertyNames,_t=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty,F=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Re=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of oe(t))!Ne.call(e,n)&&n!==r&&ue(e,n,{get:()=>t[n],enumerable:!(i=Ee(t,n))||i.enumerable});return e},Be=(e,t,r)=>(r=e!=null?re(_t(e)):{},Re(t||!e||!e.__esModule?ue(r,"default",{value:e,enumerable:!0}):r,e)),ze=F((e,t)=>{function r(){this.__data__=[],this.size=0}t.exports=r}),pe=F((e,t)=>{function r(i,n){return i===n||i!==i&&n!==n}t.exports=r}),le=F((e,t)=>{var r=pe();function i(n,a){for(var s=n.length;s--;)if(r(n[s][0],a))return s;return-1}t.exports=i}),he=F((e,t)=>{var r=le(),i=Array.prototype,n=i.splice;function a(s){var o=this.__data__,l=r(o,s);if(l<0)return!1;var h=o.length-1;return l==h?o.pop():n.call(o,l,1),--this.size,!0}t.exports=a}),ge=F((e,t)=>{var r=le();function i(n){var a=this.__data__,s=r(a,n);return s<0?void 0:a[s][1]}t.exports=i}),Qe=F((e,t)=>{var r=le();function i(n){return r(this.__data__,n)>-1}t.exports=i}),_e=F((e,t)=>{var r=le();function i(n,a){var s=this.__data__,o=r(s,n);return o<0?(++this.size,s.push([n,a])):s[o][1]=a,this}t.exports=i}),Le=F((e,t)=>{var r=ze(),i=he(),n=ge(),a=Qe(),s=_e();function o(l){var h=-1,y=l==null?0:l.length;for(this.clear();++h<y;){var m=l[h];this.set(m[0],m[1])}}o.prototype.clear=r,o.prototype.delete=i,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),ne=F((e,t)=>{var r=Le();function i(){this.__data__=new r,this.size=0}t.exports=i}),yt=F((e,t)=>{function r(i){var n=this.__data__,a=n.delete(i);return this.size=n.size,a}t.exports=r}),Tt=F((e,t)=>{function r(i){return this.__data__.get(i)}t.exports=r}),Gr=F((e,t)=>{function r(i){return this.__data__.has(i)}t.exports=r}),bt=F((e,t)=>{var r=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr;t.exports=r}),Ue=F((e,t)=>{var r=bt(),i=typeof self=="object"&&self&&self.Object===Object&&self,n=r||i||Function("return this")();t.exports=n}),Ft=F((e,t)=>{var r=Ue(),i=r.Symbol;t.exports=i}),$t=F((e,t)=>{var r=Ft(),i=Object.prototype,n=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;function o(l){var h=n.call(l,s),y=l[s];try{l[s]=void 0;var m=!0}catch{}var w=a.call(l);return m&&(h?l[s]=y:delete l[s]),w}t.exports=o}),Xt=F((e,t)=>{var r=Object.prototype,i=r.toString;function n(a){return i.call(a)}t.exports=n}),Oe=F((e,t)=>{var r=Ft(),i=$t(),n=Xt(),a="[object Null]",s="[object Undefined]",o=r?r.toStringTag:void 0;function l(h){return h==null?h===void 0?s:a:o&&o in Object(h)?i(h):n(h)}t.exports=l}),et=F((e,t)=>{function r(i){var n=typeof i;return i!=null&&(n=="object"||n=="function")}t.exports=r}),De=F((e,t)=>{var r=Oe(),i=et(),n="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",o="[object Proxy]";function l(h){if(!i(h))return!1;var y=r(h);return y==a||y==s||y==n||y==o}t.exports=l}),Nr=F((e,t)=>{var r=Ue(),i=r["__core-js_shared__"];t.exports=i}),ot=F((e,t)=>{var r=Nr(),i=function(){var a=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}();function n(a){return!!i&&i in a}t.exports=n}),Rt=F((e,t)=>{var r=Function.prototype,i=r.toString;function n(a){if(a!=null){try{return i.call(a)}catch{}try{return a+""}catch{}}return""}t.exports=n}),Ot=F((e,t)=>{var r=De(),i=ot(),n=et(),a=Rt(),s=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,l=Function.prototype,h=Object.prototype,y=l.toString,m=h.hasOwnProperty,w=RegExp("^"+y.call(m).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function A(O){if(!n(O)||i(O))return!1;var I=r(O)?w:o;return I.test(a(O))}t.exports=A}),Jt=F((e,t)=>{function r(i,n){return i?.[n]}t.exports=r}),Lt=F((e,t)=>{var r=Ot(),i=Jt();function n(a,s){var o=i(a,s);return r(o)?o:void 0}t.exports=n}),cr=F((e,t)=>{var r=Lt(),i=Ue(),n=r(i,"Map");t.exports=n}),ut=F((e,t)=>{var r=Lt(),i=r(Object,"create");t.exports=i}),It=F((e,t)=>{var r=ut();function i(){this.__data__=r?r(null):{},this.size=0}t.exports=i}),Pe=F((e,t)=>{function r(i){var n=this.has(i)&&delete this.__data__[i];return this.size-=n?1:0,n}t.exports=r}),vt=F((e,t)=>{var r=ut(),i="__lodash_hash_undefined__",n=Object.prototype,a=n.hasOwnProperty;function s(o){var l=this.__data__;if(r){var h=l[o];return h===i?void 0:h}return a.call(l,o)?l[o]:void 0}t.exports=s}),Ct=F((e,t)=>{var r=ut(),i=Object.prototype,n=i.hasOwnProperty;function a(s){var o=this.__data__;return r?o[s]!==void 0:n.call(o,s)}t.exports=a}),xt=F((e,t)=>{var r=ut(),i="__lodash_hash_undefined__";function n(a,s){var o=this.__data__;return this.size+=this.has(a)?0:1,o[a]=r&&s===void 0?i:s,this}t.exports=n}),Ie=F((e,t)=>{var r=It(),i=Pe(),n=vt(),a=Ct(),s=xt();function o(l){var h=-1,y=l==null?0:l.length;for(this.clear();++h<y;){var m=l[h];this.set(m[0],m[1])}}o.prototype.clear=r,o.prototype.delete=i,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),Ve=F((e,t)=>{var r=Ie(),i=Le(),n=cr();function a(){this.size=0,this.__data__={hash:new r,map:new(n||i),string:new r}}t.exports=a}),Ke=F((e,t)=>{function r(i){var n=typeof i;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?i!=="__proto__":i===null}t.exports=r}),qe=F((e,t)=>{var r=Ke();function i(n,a){var s=n.__data__;return r(a)?s[typeof a=="string"?"string":"hash"]:s.map}t.exports=i}),we=F((e,t)=>{var r=qe();function i(n){var a=r(this,n).delete(n);return this.size-=a?1:0,a}t.exports=i}),kt=F((e,t)=>{var r=qe();function i(n){return r(this,n).get(n)}t.exports=i}),ye=F((e,t)=>{var r=qe();function i(n){return r(this,n).has(n)}t.exports=i}),Mt=F((e,t)=>{var r=qe();function i(n,a){var s=r(this,n),o=s.size;return s.set(n,a),this.size+=s.size==o?0:1,this}t.exports=i}),jt=F((e,t)=>{var r=Ve(),i=we(),n=kt(),a=ye(),s=Mt();function o(l){var h=-1,y=l==null?0:l.length;for(this.clear();++h<y;){var m=l[h];this.set(m[0],m[1])}}o.prototype.clear=r,o.prototype.delete=i,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),Zt=F((e,t)=>{var r=Le(),i=cr(),n=jt(),a=200;function s(o,l){var h=this.__data__;if(h instanceof r){var y=h.__data__;if(!i||y.length<a-1)return y.push([o,l]),this.size=++h.size,this;h=this.__data__=new n(y)}return h.set(o,l),this.size=h.size,this}t.exports=s}),Wt=F((e,t)=>{var r=Le(),i=ne(),n=yt(),a=Tt(),s=Gr(),o=Zt();function l(h){var y=this.__data__=new r(h);this.size=y.size}l.prototype.clear=i,l.prototype.delete=n,l.prototype.get=a,l.prototype.has=s,l.prototype.set=o,t.exports=l}),Gt=F((e,t)=>{var r=Lt(),i=function(){try{var n=r(Object,"defineProperty");return n({},"",{}),n}catch{}}();t.exports=i}),lt=F((e,t)=>{var r=Gt();function i(n,a,s){a=="__proto__"&&r?r(n,a,{configurable:!0,enumerable:!0,value:s,writable:!0}):n[a]=s}t.exports=i}),ht=F((e,t)=>{var r=lt(),i=pe();function n(a,s,o){(o!==void 0&&!i(a[s],o)||o===void 0&&!(s in a))&&r(a,s,o)}t.exports=n}),Qt=F((e,t)=>{function r(i){return function(n,a,s){for(var o=-1,l=Object(n),h=s(n),y=h.length;y--;){var m=h[i?y:++o];if(a(l[m],m,l)===!1)break}return n}}t.exports=r}),Nt=F((e,t)=>{var r=Qt(),i=r();t.exports=i}),de=F((e,t)=>{var r=Ue(),i=typeof e=="object"&&e&&!e.nodeType&&e,n=i&&typeof t=="object"&&t&&!t.nodeType&&t,a=n&&n.exports===i,s=a?r.Buffer:void 0,o=s?s.allocUnsafe:void 0;function l(h,y){if(y)return h.slice();var m=h.length,w=o?o(m):new h.constructor(m);return h.copy(w),w}t.exports=l}),zr=F((e,t)=>{var r=Ue(),i=r.Uint8Array;t.exports=i}),tt=F((e,t)=>{var r=zr();function i(n){var a=new n.constructor(n.byteLength);return new r(a).set(new r(n)),a}t.exports=i}),pr=F((e,t)=>{var r=tt();function i(n,a){var s=a?r(n.buffer):n.buffer;return new n.constructor(s,n.byteOffset,n.length)}t.exports=i}),ve=F((e,t)=>{function r(i,n){var a=-1,s=i.length;for(n||(n=Array(s));++a<s;)n[a]=i[a];return n}t.exports=r}),zt=F((e,t)=>{var r=et(),i=Object.create,n=function(){function a(){}return function(s){if(!r(s))return{};if(i)return i(s);a.prototype=s;var o=new a;return a.prototype=void 0,o}}();t.exports=n}),Ur=F((e,t)=>{function r(i,n){return function(a){return i(n(a))}}t.exports=r}),rt=F((e,t)=>{var r=Ur(),i=r(Object.getPrototypeOf,Object);t.exports=i}),it=F((e,t)=>{var r=Object.prototype;function i(n){var a=n&&n.constructor,s=typeof a=="function"&&a.prototype||r;return n===s}t.exports=i}),He=F((e,t)=>{var r=zt(),i=rt(),n=it();function a(s){return typeof s.constructor=="function"&&!n(s)?r(i(s)):{}}t.exports=a}),ct=F((e,t)=>{function r(i){return i!=null&&typeof i=="object"}t.exports=r}),Vr=F((e,t)=>{var r=Oe(),i=ct(),n="[object Arguments]";function a(s){return i(s)&&r(s)==n}t.exports=a}),dr=F((e,t)=>{var r=Vr(),i=ct(),n=Object.prototype,a=n.hasOwnProperty,s=n.propertyIsEnumerable,o=r(function(){return arguments}())?r:function(l){return i(l)&&a.call(l,"callee")&&!s.call(l,"callee")};t.exports=o}),Et=F((e,t)=>{var r=Array.isArray;t.exports=r}),gr=F((e,t)=>{var r=9007199254740991;function i(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=r}t.exports=i}),er=F((e,t)=>{var r=De(),i=gr();function n(a){return a!=null&&i(a.length)&&!r(a)}t.exports=n}),Kr=F((e,t)=>{var r=er(),i=ct();function n(a){return i(a)&&r(a)}t.exports=n}),D=F((e,t)=>{function r(){return!1}t.exports=r}),q=F((e,t)=>{var r=Ue(),i=D(),n=typeof e=="object"&&e&&!e.nodeType&&e,a=n&&typeof t=="object"&&t&&!t.nodeType&&t,s=a&&a.exports===n,o=s?r.Buffer:void 0,l=o?o.isBuffer:void 0,h=l||i;t.exports=h}),z=F((e,t)=>{var r=Oe(),i=rt(),n=ct(),a="[object Object]",s=Function.prototype,o=Object.prototype,l=s.toString,h=o.hasOwnProperty,y=l.call(Object);function m(w){if(!n(w)||r(w)!=a)return!1;var A=i(w);if(A===null)return!0;var O=h.call(A,"constructor")&&A.constructor;return typeof O=="function"&&O instanceof O&&l.call(O)==y}t.exports=m}),U=F((e,t)=>{var r=Oe(),i=gr(),n=ct(),a="[object Arguments]",s="[object Array]",o="[object Boolean]",l="[object Date]",h="[object Error]",y="[object Function]",m="[object Map]",w="[object Number]",A="[object Object]",O="[object RegExp]",I="[object Set]",G="[object String]",J="[object WeakMap]",_="[object ArrayBuffer]",b="[object DataView]",k="[object Float32Array]",S="[object Float64Array]",M="[object Int8Array]",P="[object Int16Array]",u="[object Int32Array]",c="[object Uint8Array]",d="[object Uint8ClampedArray]",p="[object Uint16Array]",g="[object Uint32Array]",f={};f[k]=f[S]=f[M]=f[P]=f[u]=f[c]=f[d]=f[p]=f[g]=!0,f[a]=f[s]=f[_]=f[o]=f[b]=f[l]=f[h]=f[y]=f[m]=f[w]=f[A]=f[O]=f[I]=f[G]=f[J]=!1;function C(v){return n(v)&&i(v.length)&&!!f[r(v)]}t.exports=C}),Y=F((e,t)=>{function r(i){return function(n){return i(n)}}t.exports=r}),$=F((e,t)=>{var r=bt(),i=typeof e=="object"&&e&&!e.nodeType&&e,n=i&&typeof t=="object"&&t&&!t.nodeType&&t,a=n&&n.exports===i,s=a&&r.process,o=function(){try{var l=n&&n.require&&n.require("util").types;return l||s&&s.binding&&s.binding("util")}catch{}}();t.exports=o}),ie=F((e,t)=>{var r=U(),i=Y(),n=$(),a=n&&n.isTypedArray,s=a?i(a):r;t.exports=s}),ce=F((e,t)=>{function r(i,n){if(!(n==="constructor"&&typeof i[n]=="function")&&n!="__proto__")return i[n]}t.exports=r}),X=F((e,t)=>{var r=lt(),i=pe(),n=Object.prototype,a=n.hasOwnProperty;function s(o,l,h){var y=o[l];(!(a.call(o,l)&&i(y,h))||h===void 0&&!(l in o))&&r(o,l,h)}t.exports=s}),nt=F((e,t)=>{var r=X(),i=lt();function n(a,s,o,l){var h=!o;o||(o={});for(var y=-1,m=s.length;++y<m;){var w=s[y],A=l?l(o[w],a[w],w,o,a):void 0;A===void 0&&(A=a[w]),h?i(o,w,A):r(o,w,A)}return o}t.exports=n}),tr=F((e,t)=>{function r(i,n){for(var a=-1,s=Array(i);++a<i;)s[a]=n(a);return s}t.exports=r}),fr=F((e,t)=>{var r=9007199254740991,i=/^(?:0|[1-9]\d*)$/;function n(a,s){var o=typeof a;return s=s??r,!!s&&(o=="number"||o!="symbol"&&i.test(a))&&a>-1&&a%1==0&&a<s}t.exports=n}),Bt=F((e,t)=>{var r=tr(),i=dr(),n=Et(),a=q(),s=fr(),o=ie(),l=Object.prototype,h=l.hasOwnProperty;function y(m,w){var A=n(m),O=!A&&i(m),I=!A&&!O&&a(m),G=!A&&!O&&!I&&o(m),J=A||O||I||G,_=J?r(m.length,String):[],b=_.length;for(var k in m)(w||h.call(m,k))&&!(J&&(k=="length"||I&&(k=="offset"||k=="parent")||G&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||s(k,b)))&&_.push(k);return _}t.exports=y}),qr=F((e,t)=>{function r(i){var n=[];if(i!=null)for(var a in Object(i))n.push(a);return n}t.exports=r}),pt=F((e,t)=>{var r=et(),i=it(),n=qr(),a=Object.prototype,s=a.hasOwnProperty;function o(l){if(!r(l))return n(l);var h=i(l),y=[];for(var m in l)m=="constructor"&&(h||!s.call(l,m))||y.push(m);return y}t.exports=o}),Ut=F((e,t)=>{var r=Bt(),i=pt(),n=er();function a(s){return n(s)?r(s,!0):i(s)}t.exports=a}),mr=F((e,t)=>{var r=nt(),i=Ut();function n(a){return r(a,i(a))}t.exports=n}),on=F((e,t)=>{var r=ht(),i=de(),n=pr(),a=ve(),s=He(),o=dr(),l=Et(),h=Kr(),y=q(),m=De(),w=et(),A=z(),O=ie(),I=ce(),G=mr();function J(_,b,k,S,M,P,u){var c=I(_,k),d=I(b,k),p=u.get(d);if(p){r(_,k,p);return}var g=P?P(c,d,k+"",_,b,u):void 0,f=g===void 0;if(f){var C=l(d),v=!C&&y(d),x=!C&&!v&&O(d);g=d,C||v||x?l(c)?g=c:h(c)?g=a(c):v?(f=!1,g=i(d,!0)):x?(f=!1,g=n(d,!0)):g=[]:A(d)||o(d)?(g=c,o(c)?g=G(c):(!w(c)||m(c))&&(g=s(d))):f=!1}f&&(u.set(d,g),M(g,d,S,P,u),u.delete(d)),r(_,k,g)}t.exports=J}),un=F((e,t)=>{var r=Wt(),i=ht(),n=Nt(),a=on(),s=et(),o=Ut(),l=ce();function h(y,m,w,A,O){y!==m&&n(m,function(I,G){if(O||(O=new r),s(I))a(y,m,G,w,h,A,O);else{var J=A?A(l(y,G),I,G+"",y,m,O):void 0;J===void 0&&(J=I),i(y,G,J)}},o)}t.exports=h}),mi=F((e,t)=>{function r(i){return i}t.exports=r}),ln=F((e,t)=>{function r(i,n,a){switch(a.length){case 0:return i.call(n);case 1:return i.call(n,a[0]);case 2:return i.call(n,a[0],a[1]);case 3:return i.call(n,a[0],a[1],a[2])}return i.apply(n,a)}t.exports=r}),hn=F((e,t)=>{var r=ln(),i=Math.max;function n(a,s,o){return s=i(s===void 0?a.length-1:s,0),function(){for(var l=arguments,h=-1,y=i(l.length-s,0),m=Array(y);++h<y;)m[h]=l[s+h];h=-1;for(var w=Array(s+1);++h<s;)w[h]=l[h];return w[s]=o(m),r(a,this,w)}}t.exports=n}),cn=F((e,t)=>{function r(i){return function(){return i}}t.exports=r}),pn=F((e,t)=>{var r=cn(),i=Gt(),n=mi(),a=i?function(s,o){return i(s,"toString",{configurable:!0,enumerable:!1,value:r(o),writable:!0})}:n;t.exports=a}),dn=F((e,t)=>{var r=800,i=16,n=Date.now;function a(s){var o=0,l=0;return function(){var h=n(),y=i-(h-l);if(l=h,y>0){if(++o>=r)return arguments[0]}else o=0;return s.apply(void 0,arguments)}}t.exports=a}),gn=F((e,t)=>{var r=pn(),i=dn(),n=i(r);t.exports=n}),fn=F((e,t)=>{var r=mi(),i=hn(),n=gn();function a(s,o){return n(i(s,o,r),s+"")}t.exports=a}),mn=F((e,t)=>{var r=pe(),i=er(),n=fr(),a=et();function s(o,l,h){if(!a(h))return!1;var y=typeof l;return(y=="number"?i(h)&&n(l,h.length):y=="string"&&l in h)?r(h[l],o):!1}t.exports=s}),_n=F((e,t)=>{var r=fn(),i=mn();function n(a){return r(function(s,o){var l=-1,h=o.length,y=h>1?o[h-1]:void 0,m=h>2?o[2]:void 0;for(y=a.length>3&&typeof y=="function"?(h--,y):void 0,m&&i(o[0],o[1],m)&&(y=h<3?void 0:y,h=1),s=Object(s);++l<h;){var w=o[l];w&&a(s,w,l,y)}return s})}t.exports=n}),Hr=F((e,t)=>{var r=un(),i=_n(),n=i(function(a,s,o){r(a,s,o)});t.exports=n}),Yr=F((e,t)=>{var r=Oe(),i=ct(),n="[object Symbol]";function a(s){return typeof s=="symbol"||i(s)&&r(s)==n}t.exports=a}),yn=F((e,t)=>{var r=Et(),i=Yr(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;function s(o,l){if(r(o))return!1;var h=typeof o;return h=="number"||h=="symbol"||h=="boolean"||o==null||i(o)?!0:a.test(o)||!n.test(o)||l!=null&&o in Object(l)}t.exports=s}),bn=F((e,t)=>{var r=jt(),i="Expected a function";function n(a,s){if(typeof a!="function"||s!=null&&typeof s!="function")throw new TypeError(i);var o=function(){var l=arguments,h=s?s.apply(this,l):l[0],y=o.cache;if(y.has(h))return y.get(h);var m=a.apply(this,l);return o.cache=y.set(h,m)||y,m};return o.cache=new(n.Cache||r),o}n.Cache=r,t.exports=n}),Ln=F((e,t)=>{var r=bn(),i=500;function n(a){var s=r(a,function(l){return o.size===i&&o.clear(),l}),o=s.cache;return s}t.exports=n}),vn=F((e,t)=>{var r=Ln(),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,a=r(function(s){var o=[];return s.charCodeAt(0)===46&&o.push(""),s.replace(i,function(l,h,y,m){o.push(y?m.replace(n,"$1"):h||l)}),o});t.exports=a}),Cn=F((e,t)=>{function r(i,n){for(var a=-1,s=i==null?0:i.length,o=Array(s);++a<s;)o[a]=n(i[a],a,i);return o}t.exports=r}),xn=F((e,t)=>{var r=Ft(),i=Cn(),n=Et(),a=Yr(),s=r?r.prototype:void 0,o=s?s.toString:void 0;function l(h){if(typeof h=="string")return h;if(n(h))return i(h,l)+"";if(a(h))return o?o.call(h):"";var y=h+"";return y=="0"&&1/h==-1/0?"-0":y}t.exports=l}),kn=F((e,t)=>{var r=xn();function i(n){return n==null?"":r(n)}t.exports=i}),Mn=F((e,t)=>{var r=Et(),i=yn(),n=vn(),a=kn();function s(o,l){return r(o)?o:i(o,l)?[o]:n(a(o))}t.exports=s}),En=F((e,t)=>{var r=Yr();function i(n){if(typeof n=="string"||r(n))return n;var a=n+"";return a=="0"&&1/n==-1/0?"-0":a}t.exports=i}),Bn=F((e,t)=>{var r=Mn(),i=En();function n(a,s){s=r(s,a);for(var o=0,l=s.length;a!=null&&o<l;)a=a[i(s[o++])];return o&&o==l?a:void 0}t.exports=n}),_r=F((e,t)=>{var r=Bn();function i(n,a,s){var o=n==null?void 0:r(n,a);return o===void 0?s:o}t.exports=i}),wn=F((e,t)=>{(function(r,i){typeof e=="object"&&typeof t<"u"?t.exports=i():(r=r||self).RBush=i()})(e,function(){function r(_,b,k,S,M){(function P(u,c,d,p,g){for(;p>d;){if(p-d>600){var f=p-d+1,C=c-d+1,v=Math.log(f),x=.5*Math.exp(2*v/3),B=.5*Math.sqrt(v*x*(f-x)/f)*(C-f/2<0?-1:1),E=Math.max(d,Math.floor(c-C*x/f+B)),R=Math.min(p,Math.floor(c+(f-C)*x/f+B));P(u,c,E,R,g)}var j=u[c],N=d,V=p;for(i(u,d,c),g(u[p],j)>0&&i(u,d,p);N<V;){for(i(u,N,V),N++,V--;g(u[N],j)<0;)N++;for(;g(u[V],j)>0;)V--}g(u[d],j)===0?i(u,d,V):i(u,++V,p),V<=c&&(d=V+1),c<=V&&(p=V-1)}})(_,b,k||0,S||_.length-1,M||n)}function i(_,b,k){var S=_[b];_[b]=_[k],_[k]=S}function n(_,b){return _<b?-1:_>b?1:0}var a=function(_){_===void 0&&(_=9),this._maxEntries=Math.max(4,_),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(_,b,k){if(!k)return b.indexOf(_);for(var S=0;S<b.length;S++)if(k(_,b[S]))return S;return-1}function o(_,b){l(_,0,_.children.length,b,_)}function l(_,b,k,S,M){M||(M=G(null)),M.minX=1/0,M.minY=1/0,M.maxX=-1/0,M.maxY=-1/0;for(var P=b;P<k;P++){var u=_.children[P];h(M,_.leaf?S(u):u)}return M}function h(_,b){return _.minX=Math.min(_.minX,b.minX),_.minY=Math.min(_.minY,b.minY),_.maxX=Math.max(_.maxX,b.maxX),_.maxY=Math.max(_.maxY,b.maxY),_}function y(_,b){return _.minX-b.minX}function m(_,b){return _.minY-b.minY}function w(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function A(_){return _.maxX-_.minX+(_.maxY-_.minY)}function O(_,b){return _.minX<=b.minX&&_.minY<=b.minY&&b.maxX<=_.maxX&&b.maxY<=_.maxY}function I(_,b){return b.minX<=_.maxX&&b.minY<=_.maxY&&b.maxX>=_.minX&&b.maxY>=_.minY}function G(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function J(_,b,k,S,M){for(var P=[b,k];P.length;)if(!((k=P.pop())-(b=P.pop())<=S)){var u=b+Math.ceil((k-b)/S/2)*S;r(_,u,b,k,M),P.push(b,u,u,k)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(_){var b=this.data,k=[];if(!I(_,b))return k;for(var S=this.toBBox,M=[];b;){for(var P=0;P<b.children.length;P++){var u=b.children[P],c=b.leaf?S(u):u;I(_,c)&&(b.leaf?k.push(u):O(_,c)?this._all(u,k):M.push(u))}b=M.pop()}return k},a.prototype.collides=function(_){var b=this.data;if(!I(_,b))return!1;for(var k=[];b;){for(var S=0;S<b.children.length;S++){var M=b.children[S],P=b.leaf?this.toBBox(M):M;if(I(_,P)){if(b.leaf||O(_,P))return!0;k.push(M)}}b=k.pop()}return!1},a.prototype.load=function(_){if(!_||!_.length)return this;if(_.length<this._minEntries){for(var b=0;b<_.length;b++)this.insert(_[b]);return this}var k=this._build(_.slice(),0,_.length-1,0);if(this.data.children.length)if(this.data.height===k.height)this._splitRoot(this.data,k);else{if(this.data.height<k.height){var S=this.data;this.data=k,k=S}this._insert(k,this.data.height-k.height-1,!0)}else this.data=k;return this},a.prototype.insert=function(_){return _&&this._insert(_,this.data.height-1),this},a.prototype.clear=function(){return this.data=G([]),this},a.prototype.remove=function(_,b){if(!_)return this;for(var k,S,M,P=this.data,u=this.toBBox(_),c=[],d=[];P||c.length;){if(P||(P=c.pop(),S=c[c.length-1],k=d.pop(),M=!0),P.leaf){var p=s(_,P.children,b);if(p!==-1)return P.children.splice(p,1),c.push(P),this._condense(c),this}M||P.leaf||!O(P,u)?S?(k++,P=S.children[k],M=!1):P=null:(c.push(P),d.push(k),k=0,S=P,P=P.children[0])}return this},a.prototype.toBBox=function(_){return _},a.prototype.compareMinX=function(_,b){return _.minX-b.minX},a.prototype.compareMinY=function(_,b){return _.minY-b.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(_){return this.data=_,this},a.prototype._all=function(_,b){for(var k=[];_;)_.leaf?b.push.apply(b,_.children):k.push.apply(k,_.children),_=k.pop();return b},a.prototype._build=function(_,b,k,S){var M,P=k-b+1,u=this._maxEntries;if(P<=u)return o(M=G(_.slice(b,k+1)),this.toBBox),M;S||(S=Math.ceil(Math.log(P)/Math.log(u)),u=Math.ceil(P/Math.pow(u,S-1))),(M=G([])).leaf=!1,M.height=S;var c=Math.ceil(P/u),d=c*Math.ceil(Math.sqrt(u));J(_,b,k,d,this.compareMinX);for(var p=b;p<=k;p+=d){var g=Math.min(p+d-1,k);J(_,p,g,c,this.compareMinY);for(var f=p;f<=g;f+=c){var C=Math.min(f+c-1,g);M.children.push(this._build(_,f,C,S-1))}}return o(M,this.toBBox),M},a.prototype._chooseSubtree=function(_,b,k,S){for(;S.push(b),!b.leaf&&S.length-1!==k;){for(var M=1/0,P=1/0,u=void 0,c=0;c<b.children.length;c++){var d=b.children[c],p=w(d),g=(f=_,C=d,(Math.max(C.maxX,f.maxX)-Math.min(C.minX,f.minX))*(Math.max(C.maxY,f.maxY)-Math.min(C.minY,f.minY))-p);g<P?(P=g,M=p<M?p:M,u=d):g===P&&p<M&&(M=p,u=d)}b=u||b.children[0]}var f,C;return b},a.prototype._insert=function(_,b,k){var S=k?_:this.toBBox(_),M=[],P=this._chooseSubtree(S,this.data,b,M);for(P.children.push(_),h(P,S);b>=0&&M[b].children.length>this._maxEntries;)this._split(M,b),b--;this._adjustParentBBoxes(S,M,b)},a.prototype._split=function(_,b){var k=_[b],S=k.children.length,M=this._minEntries;this._chooseSplitAxis(k,M,S);var P=this._chooseSplitIndex(k,M,S),u=G(k.children.splice(P,k.children.length-P));u.height=k.height,u.leaf=k.leaf,o(k,this.toBBox),o(u,this.toBBox),b?_[b-1].children.push(u):this._splitRoot(k,u)},a.prototype._splitRoot=function(_,b){this.data=G([_,b]),this.data.height=_.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(_,b,k){for(var S,M,P,u,c,d,p,g=1/0,f=1/0,C=b;C<=k-b;C++){var v=l(_,0,C,this.toBBox),x=l(_,C,k,this.toBBox),B=(M=v,P=x,u=void 0,c=void 0,d=void 0,p=void 0,u=Math.max(M.minX,P.minX),c=Math.max(M.minY,P.minY),d=Math.min(M.maxX,P.maxX),p=Math.min(M.maxY,P.maxY),Math.max(0,d-u)*Math.max(0,p-c)),E=w(v)+w(x);B<g?(g=B,S=C,f=E<f?E:f):B===g&&E<f&&(f=E,S=C)}return S||k-b},a.prototype._chooseSplitAxis=function(_,b,k){var S=_.leaf?this.compareMinX:y,M=_.leaf?this.compareMinY:m;this._allDistMargin(_,b,k,S)<this._allDistMargin(_,b,k,M)&&_.children.sort(S)},a.prototype._allDistMargin=function(_,b,k,S){_.children.sort(S);for(var M=this.toBBox,P=l(_,0,b,M),u=l(_,k-b,k,M),c=A(P)+A(u),d=b;d<k-b;d++){var p=_.children[d];h(P,_.leaf?M(p):p),c+=A(P)}for(var g=k-b-1;g>=b;g--){var f=_.children[g];h(u,_.leaf?M(f):f),c+=A(u)}return c},a.prototype._adjustParentBBoxes=function(_,b,k){for(var S=k;S>=0;S--)h(b[S],_)},a.prototype._condense=function(_){for(var b=_.length-1,k=void 0;b>=0;b--)_[b].children.length===0?b>0?(k=_[b-1].children).splice(k.indexOf(_[b]),1):this.clear():o(_[b],this.toBBox)},a})}),_i=F(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=63710088e-1,e.factors={centimeters:e.earthRadius*100,centimetres:e.earthRadius*100,degrees:e.earthRadius/111325,feet:e.earthRadius*3.28084,inches:e.earthRadius*39.37,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:e.earthRadius*1e3,millimetres:e.earthRadius*1e3,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius*1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function t(p,g,f){f===void 0&&(f={});var C={type:"Feature"};return(f.id===0||f.id)&&(C.id=f.id),f.bbox&&(C.bbox=f.bbox),C.properties=g||{},C.geometry=p,C}e.feature=t;function r(p,g,f){switch(p){case"Point":return i(g).geometry;case"LineString":return o(g).geometry;case"Polygon":return a(g).geometry;case"MultiPoint":return m(g).geometry;case"MultiLineString":return y(g).geometry;case"MultiPolygon":return w(g).geometry;default:throw new Error(p+" is invalid")}}e.geometry=r;function i(p,g,f){if(f===void 0&&(f={}),!p)throw new Error("coordinates is required");if(!Array.isArray(p))throw new Error("coordinates must be an Array");if(p.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!P(p[0])||!P(p[1]))throw new Error("coordinates must contain numbers");var C={type:"Point",coordinates:p};return t(C,g,f)}e.point=i;function n(p,g,f){return f===void 0&&(f={}),h(p.map(function(C){return i(C,g)}),f)}e.points=n;function a(p,g,f){f===void 0&&(f={});for(var C=0,v=p;C<v.length;C++){var x=v[C];if(x.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var B=0;B<x[x.length-1].length;B++)if(x[x.length-1][B]!==x[0][B])throw new Error("First and last Position are not equivalent.")}var E={type:"Polygon",coordinates:p};return t(E,g,f)}e.polygon=a;function s(p,g,f){return f===void 0&&(f={}),h(p.map(function(C){return a(C,g)}),f)}e.polygons=s;function o(p,g,f){if(f===void 0&&(f={}),p.length<2)throw new Error("coordinates must be an array of two or more positions");var C={type:"LineString",coordinates:p};return t(C,g,f)}e.lineString=o;function l(p,g,f){return f===void 0&&(f={}),h(p.map(function(C){return o(C,g)}),f)}e.lineStrings=l;function h(p,g){g===void 0&&(g={});var f={type:"FeatureCollection"};return g.id&&(f.id=g.id),g.bbox&&(f.bbox=g.bbox),f.features=p,f}e.featureCollection=h;function y(p,g,f){f===void 0&&(f={});var C={type:"MultiLineString",coordinates:p};return t(C,g,f)}e.multiLineString=y;function m(p,g,f){f===void 0&&(f={});var C={type:"MultiPoint",coordinates:p};return t(C,g,f)}e.multiPoint=m;function w(p,g,f){f===void 0&&(f={});var C={type:"MultiPolygon",coordinates:p};return t(C,g,f)}e.multiPolygon=w;function A(p,g,f){f===void 0&&(f={});var C={type:"GeometryCollection",geometries:p};return t(C,g,f)}e.geometryCollection=A;function O(p,g){if(g===void 0&&(g=0),g&&!(g>=0))throw new Error("precision must be a positive number");var f=Math.pow(10,g||0);return Math.round(p*f)/f}e.round=O;function I(p,g){g===void 0&&(g="kilometers");var f=e.factors[g];if(!f)throw new Error(g+" units is invalid");return p*f}e.radiansToLength=I;function G(p,g){g===void 0&&(g="kilometers");var f=e.factors[g];if(!f)throw new Error(g+" units is invalid");return p/f}e.lengthToRadians=G;function J(p,g){return b(G(p,g))}e.lengthToDegrees=J;function _(p){var g=p%360;return g<0&&(g+=360),g}e.bearingToAzimuth=_;function b(p){var g=p%(2*Math.PI);return g*180/Math.PI}e.radiansToDegrees=b;function k(p){var g=p%360;return g*Math.PI/180}e.degreesToRadians=k;function S(p,g,f){if(g===void 0&&(g="kilometers"),f===void 0&&(f="kilometers"),!(p>=0))throw new Error("length must be a positive number");return I(G(p,g),f)}e.convertLength=S;function M(p,g,f){if(g===void 0&&(g="meters"),f===void 0&&(f="kilometers"),!(p>=0))throw new Error("area must be a positive number");var C=e.areaFactors[g];if(!C)throw new Error("invalid original units");var v=e.areaFactors[f];if(!v)throw new Error("invalid final units");return p/C*v}e.convertArea=M;function P(p){return!isNaN(p)&&p!==null&&!Array.isArray(p)}e.isNumber=P;function u(p){return!!p&&p.constructor===Object}e.isObject=u;function c(p){if(!p)throw new Error("bbox is required");if(!Array.isArray(p))throw new Error("bbox must be an Array");if(p.length!==4&&p.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");p.forEach(function(g){if(!P(g))throw new Error("bbox must only contain numbers")})}e.validateBBox=c;function d(p){if(!p)throw new Error("id is required");if(["string","number"].indexOf(typeof p)===-1)throw new Error("id must be a number or a string")}e.validateId=d}),yi=F(e=>{Object.defineProperty(e,"__esModule",{value:!0});var t=_i();function r(b,k,S){if(b!==null)for(var M,P,u,c,d,p,g,f=0,C=0,v,x=b.type,B=x==="FeatureCollection",E=x==="Feature",R=B?b.features.length:1,j=0;j<R;j++){g=B?b.features[j].geometry:E?b.geometry:b,v=g?g.type==="GeometryCollection":!1,d=v?g.geometries.length:1;for(var N=0;N<d;N++){var V=0,Q=0;if(c=v?g.geometries[N]:g,c!==null){p=c.coordinates;var ee=c.type;switch(f=S&&(ee==="Polygon"||ee==="MultiPolygon")?1:0,ee){case null:break;case"Point":if(k(p,C,j,V,Q)===!1)return!1;C++,V++;break;case"LineString":case"MultiPoint":for(M=0;M<p.length;M++){if(k(p[M],C,j,V,Q)===!1)return!1;C++,ee==="MultiPoint"&&V++}ee==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(M=0;M<p.length;M++){for(P=0;P<p[M].length-f;P++){if(k(p[M][P],C,j,V,Q)===!1)return!1;C++}ee==="MultiLineString"&&V++,ee==="Polygon"&&Q++}ee==="Polygon"&&V++;break;case"MultiPolygon":for(M=0;M<p.length;M++){for(Q=0,P=0;P<p[M].length;P++){for(u=0;u<p[M][P].length-f;u++){if(k(p[M][P][u],C,j,V,Q)===!1)return!1;C++}Q++}V++}break;case"GeometryCollection":for(M=0;M<c.geometries.length;M++)if(r(c.geometries[M],k,S)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i(b,k,S,M){var P=S;return r(b,function(u,c,d,p,g){c===0&&S===void 0?P=u:P=k(P,u,c,d,p,g)},M),P}function n(b,k){var S;switch(b.type){case"FeatureCollection":for(S=0;S<b.features.length&&k(b.features[S].properties,S)!==!1;S++);break;case"Feature":k(b.properties,0);break}}function a(b,k,S){var M=S;return n(b,function(P,u){u===0&&S===void 0?M=P:M=k(M,P,u)}),M}function s(b,k){if(b.type==="Feature")k(b,0);else if(b.type==="FeatureCollection")for(var S=0;S<b.features.length&&k(b.features[S],S)!==!1;S++);}function o(b,k,S){var M=S;return s(b,function(P,u){u===0&&S===void 0?M=P:M=k(M,P,u)}),M}function l(b){var k=[];return r(b,function(S){k.push(S)}),k}function h(b,k){var S,M,P,u,c,d,p,g,f,C,v=0,x=b.type==="FeatureCollection",B=b.type==="Feature",E=x?b.features.length:1;for(S=0;S<E;S++){for(d=x?b.features[S].geometry:B?b.geometry:b,g=x?b.features[S].properties:B?b.properties:{},f=x?b.features[S].bbox:B?b.bbox:void 0,C=x?b.features[S].id:B?b.id:void 0,p=d?d.type==="GeometryCollection":!1,c=p?d.geometries.length:1,P=0;P<c;P++){if(u=p?d.geometries[P]:d,u===null){if(k(null,v,g,f,C)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(k(u,v,g,f,C)===!1)return!1;break}case"GeometryCollection":{for(M=0;M<u.geometries.length;M++)if(k(u.geometries[M],v,g,f,C)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}v++}}function y(b,k,S){var M=S;return h(b,function(P,u,c,d,p){u===0&&S===void 0?M=P:M=k(M,P,u,c,d,p)}),M}function m(b,k){h(b,function(S,M,P,u,c){var d=S===null?null:S.type;switch(d){case null:case"Point":case"LineString":case"Polygon":return k(t.feature(S,P,{bbox:u,id:c}),M,0)===!1?!1:void 0}var p;switch(d){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var g=0;g<S.coordinates.length;g++){var f=S.coordinates[g],C={type:p,coordinates:f};if(k(t.feature(C,P),M,g)===!1)return!1}})}function w(b,k,S){var M=S;return m(b,function(P,u,c){u===0&&c===0&&S===void 0?M=P:M=k(M,P,u,c)}),M}function A(b,k){m(b,function(S,M,P){var u=0;if(S.geometry){var c=S.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var d,p=0,g=0,f=0;if(r(S,function(C,v,x,B,E){if(d===void 0||M>p||B>g||E>f){d=C,p=M,g=B,f=E,u=0;return}var R=t.lineString([d,C],S.properties);if(k(R,M,P,E,u)===!1)return!1;u++,d=C})===!1)return!1}}})}function O(b,k,S){var M=S,P=!1;return A(b,function(u,c,d,p,g){P===!1&&S===void 0?M=u:M=k(M,u,c,d,p,g),P=!0}),M}function I(b,k){if(!b)throw new Error("geojson is required");m(b,function(S,M,P){if(S.geometry!==null){var u=S.geometry.type,c=S.geometry.coordinates;switch(u){case"LineString":if(k(S,M,P,0,0)===!1)return!1;break;case"Polygon":for(var d=0;d<c.length;d++)if(k(t.lineString(c[d],S.properties),M,P,d)===!1)return!1;break}}})}function G(b,k,S){var M=S;return I(b,function(P,u,c,d){u===0&&S===void 0?M=P:M=k(M,P,u,c,d)}),M}function J(b,k){if(k=k||{},!t.isObject(k))throw new Error("options is invalid");var S=k.featureIndex||0,M=k.multiFeatureIndex||0,P=k.geometryIndex||0,u=k.segmentIndex||0,c=k.properties,d;switch(b.type){case"FeatureCollection":S<0&&(S=b.features.length+S),c=c||b.features[S].properties,d=b.features[S].geometry;break;case"Feature":c=c||b.properties,d=b.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":d=b;break;default:throw new Error("geojson is invalid")}if(d===null)return null;var p=d.coordinates;switch(d.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=p.length+u-1),t.lineString([p[u],p[u+1]],c,k);case"Polygon":return P<0&&(P=p.length+P),u<0&&(u=p[P].length+u-1),t.lineString([p[P][u],p[P][u+1]],c,k);case"MultiLineString":return M<0&&(M=p.length+M),u<0&&(u=p[M].length+u-1),t.lineString([p[M][u],p[M][u+1]],c,k);case"MultiPolygon":return M<0&&(M=p.length+M),P<0&&(P=p[M].length+P),u<0&&(u=p[M][P].length-u-1),t.lineString([p[M][P][u],p[M][P][u+1]],c,k)}throw new Error("geojson is invalid")}function _(b,k){if(k=k||{},!t.isObject(k))throw new Error("options is invalid");var S=k.featureIndex||0,M=k.multiFeatureIndex||0,P=k.geometryIndex||0,u=k.coordIndex||0,c=k.properties,d;switch(b.type){case"FeatureCollection":S<0&&(S=b.features.length+S),c=c||b.features[S].properties,d=b.features[S].geometry;break;case"Feature":c=c||b.properties,d=b.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":d=b;break;default:throw new Error("geojson is invalid")}if(d===null)return null;var p=d.coordinates;switch(d.type){case"Point":return t.point(p,c,k);case"MultiPoint":return M<0&&(M=p.length+M),t.point(p[M],c,k);case"LineString":return u<0&&(u=p.length+u),t.point(p[u],c,k);case"Polygon":return P<0&&(P=p.length+P),u<0&&(u=p[P].length+u),t.point(p[P][u],c,k);case"MultiLineString":return M<0&&(M=p.length+M),u<0&&(u=p[M].length+u),t.point(p[M][u],c,k);case"MultiPolygon":return M<0&&(M=p.length+M),P<0&&(P=p[M].length+P),u<0&&(u=p[M][P].length-u),t.point(p[M][P][u],c,k)}throw new Error("geojson is invalid")}e.coordAll=l,e.coordEach=r,e.coordReduce=i,e.featureEach=s,e.featureReduce=o,e.findPoint=_,e.findSegment=J,e.flattenEach=m,e.flattenReduce=w,e.geomEach=h,e.geomReduce=y,e.lineEach=I,e.lineReduce=G,e.propEach=n,e.propReduce=a,e.segmentEach=A,e.segmentReduce=O}),Dn=F(e=>{Object.defineProperty(e,"__esModule",{value:!0});var t=yi();function r(i){var n=[1/0,1/0,-1/0,-1/0];return t.coordEach(i,function(a){n[0]>a[0]&&(n[0]=a[0]),n[1]>a[1]&&(n[1]=a[1]),n[2]<a[0]&&(n[2]=a[0]),n[3]<a[1]&&(n[3]=a[1])}),n}r.default=r,e.default=r}),bi=F((e,t)=>{var r=wn(),i=_i(),n=yi(),a=Dn().default,s=n.featureEach;n.coordEach,i.polygon;var o=i.featureCollection;function l(h){var y=new r(h);return y.insert=function(m){if(m.type!=="Feature")throw new Error("invalid feature");return m.bbox=m.bbox?m.bbox:a(m),r.prototype.insert.call(this,m)},y.load=function(m){var w=[];return Array.isArray(m)?m.forEach(function(A){if(A.type!=="Feature")throw new Error("invalid features");A.bbox=A.bbox?A.bbox:a(A),w.push(A)}):s(m,function(A){if(A.type!=="Feature")throw new Error("invalid features");A.bbox=A.bbox?A.bbox:a(A),w.push(A)}),r.prototype.load.call(this,w)},y.remove=function(m,w){if(m.type!=="Feature")throw new Error("invalid feature");return m.bbox=m.bbox?m.bbox:a(m),r.prototype.remove.call(this,m,w)},y.clear=function(){return r.prototype.clear.call(this)},y.search=function(m){var w=r.prototype.search.call(this,this.toBBox(m));return o(w)},y.collides=function(m){return r.prototype.collides.call(this,this.toBBox(m))},y.all=function(){var m=r.prototype.all.call(this);return o(m)},y.toJSON=function(){return r.prototype.toJSON.call(this)},y.fromJSON=function(m){return r.prototype.fromJSON.call(this,m)},y.toBBox=function(m){var w;if(m.bbox)w=m.bbox;else if(Array.isArray(m)&&m.length===4)w=m;else if(Array.isArray(m)&&m.length===6)w=[m[0],m[1],m[3],m[4]];else if(m.type==="Feature")w=a(m);else if(m.type==="FeatureCollection")w=a(m);else throw new Error("invalid geojson");return{minX:w[0],minY:w[1],maxX:w[2],maxY:w[3]}},y}t.exports=l,t.exports.default=l});Array.prototype.findIndex=Array.prototype.findIndex||function(e){if(this===null)throw new TypeError("Array.prototype.findIndex called on null or undefined");if(typeof e!="function")throw new TypeError("callback must be a function");for(var t=Object(this),r=t.length>>>0,i=arguments[1],n=0;n<r;n++)if(e.call(i,t[n],n,t))return n;return-1},Array.prototype.find=Array.prototype.find||function(e){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof e!="function")throw new TypeError("callback must be a function");for(var t=Object(this),r=t.length>>>0,i=arguments[1],n=0;n<r;n++){var a=t[n];if(e.call(i,a,n,t))return a}},typeof Object.assign!="function"&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var r=arguments[t];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}),function(e){e.forEach(function(t){t.hasOwnProperty("remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(this==null)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(i===0)return!1;var n=t|0,a=Math.max(n>=0?n:i-Math.abs(n),0);function s(o,l){return o===l||typeof o=="number"&&typeof l=="number"&&isNaN(o)&&isNaN(l)}for(;a<i;){if(s(r[a],e))return!0;a++}return!1}});var Pn={version:"2.18.3"},Li=Be(Hr()),An={tooltips:{placeMarker:"Click to place marker",firstVertex:"Click to place first vertex",continueLine:"Click to continue drawing",finishLine:"Click any existing marker to finish",finishPoly:"Click first marker to finish",finishRect:"Click to finish",startCircle:"Click to place circle center",finishCircle:"Click to finish circle",placeCircleMarker:"Click to place circle marker",placeText:"Click to place text",selectFirstLayerFor:"Select first layer for {action}",selectSecondLayerFor:"Select second layer for {action}"},actions:{finish:"Finish",cancel:"Cancel",removeLastVertex:"Remove Last Vertex"},buttonTitles:{drawMarkerButton:"Draw Marker",drawPolyButton:"Draw Polygons",drawLineButton:"Draw Polyline",drawCircleButton:"Draw Circle",drawRectButton:"Draw Rectangle",editButton:"Edit Layers",dragButton:"Drag Layers",cutButton:"Cut Layers",deleteButton:"Remove Layers",drawCircleMarkerButton:"Draw Circle Marker",snappingButton:"Snap dragged marker to other layers and vertices",pinningButton:"Pin shared vertices together",rotateButton:"Rotate Layers",drawTextButton:"Draw Text",scaleButton:"Scale Layers",autoTracingButton:"Auto trace Line",snapGuidesButton:"Show SnapGuides",unionButton:"Union layers",differenceButton:"Subtract layers"},measurements:{totalLength:"Length",segmentLength:"Segment length",area:"Area",radius:"Radius",perimeter:"Perimeter",height:"Height",width:"Width",coordinates:"Position",coordinatesMarker:"Position Marker"}},Sn={tooltips:{placeMarker:"Platziere den Marker mit Klick",firstVertex:"Platziere den ersten Marker mit Klick",continueLine:"Klicke, um weiter zu zeichnen",finishLine:"Beende mit Klick auf existierenden Marker",finishPoly:"Beende mit Klick auf ersten Marker",finishRect:"Beende mit Klick",startCircle:"Platziere das Kreiszentrum mit Klick",finishCircle:"Beende den Kreis mit Klick",placeCircleMarker:"Platziere den Kreismarker mit Klick",placeText:"Platziere den Text mit Klick"},actions:{finish:"Beenden",cancel:"Abbrechen",removeLastVertex:"Letzten Vertex löschen"},buttonTitles:{drawMarkerButton:"Marker zeichnen",drawPolyButton:"Polygon zeichnen",drawLineButton:"Polyline zeichnen",drawCircleButton:"Kreis zeichnen",drawRectButton:"Rechteck zeichnen",editButton:"Layer editieren",dragButton:"Layer bewegen",cutButton:"Layer schneiden",deleteButton:"Layer löschen",drawCircleMarkerButton:"Kreismarker zeichnen",snappingButton:"Bewegter Layer an andere Layer oder Vertexe einhacken",pinningButton:"Vertexe an der gleichen Position verknüpfen",rotateButton:"Layer drehen",drawTextButton:"Text zeichnen",scaleButton:"Layer skalieren",autoTracingButton:"Linie automatisch nachzeichen"},measurements:{totalLength:"Länge",segmentLength:"Segment Länge",area:"Fläche",radius:"Radius",perimeter:"Umfang",height:"Höhe",width:"Breite",coordinates:"Position",coordinatesMarker:"Position Marker"}},Tn={tooltips:{placeMarker:"Clicca per posizionare un Marker",firstVertex:"Clicca per posizionare il primo vertice",continueLine:"Clicca per continuare a disegnare",finishLine:"Clicca qualsiasi marker esistente per terminare",finishPoly:"Clicca il primo marker per terminare",finishRect:"Clicca per terminare",startCircle:"Clicca per posizionare il punto centrale del cerchio",finishCircle:"Clicca per terminare il cerchio",placeCircleMarker:"Clicca per posizionare un Marker del cherchio"},actions:{finish:"Termina",cancel:"Annulla",removeLastVertex:"Rimuovi l'ultimo vertice"},buttonTitles:{drawMarkerButton:"Disegna Marker",drawPolyButton:"Disegna Poligoni",drawLineButton:"Disegna Polilinea",drawCircleButton:"Disegna Cerchio",drawRectButton:"Disegna Rettangolo",editButton:"Modifica Livelli",dragButton:"Sposta Livelli",cutButton:"Ritaglia Livelli",deleteButton:"Elimina Livelli",drawCircleMarkerButton:"Disegna Marker del Cerchio",snappingButton:"Snap ha trascinato il pennarello su altri strati e vertici",pinningButton:"Pin condiviso vertici insieme",rotateButton:"Ruota livello"}},Fn={tooltips:{placeMarker:"Klik untuk menempatkan marker",firstVertex:"Klik untuk menempatkan vertex pertama",continueLine:"Klik untuk meneruskan digitasi",finishLine:"Klik pada sembarang marker yang ada untuk mengakhiri",finishPoly:"Klik marker pertama untuk mengakhiri",finishRect:"Klik untuk mengakhiri",startCircle:"Klik untuk menempatkan titik pusat lingkaran",finishCircle:"Klik untuk mengakhiri lingkaran",placeCircleMarker:"Klik untuk menempatkan penanda lingkarann"},actions:{finish:"Selesai",cancel:"Batal",removeLastVertex:"Hilangkan Vertex Terakhir"},buttonTitles:{drawMarkerButton:"Digitasi Marker",drawPolyButton:"Digitasi Polygon",drawLineButton:"Digitasi Polyline",drawCircleButton:"Digitasi Lingkaran",drawRectButton:"Digitasi Segi Empat",editButton:"Edit Layer",dragButton:"Geser Layer",cutButton:"Potong Layer",deleteButton:"Hilangkan Layer",drawCircleMarkerButton:"Digitasi Penanda Lingkaran",snappingButton:"Jepretkan penanda yang ditarik ke lapisan dan simpul lain",pinningButton:"Sematkan simpul bersama bersama",rotateButton:"Putar lapisan"}},Rn={tooltips:{placeMarker:"Adaugă un punct",firstVertex:"Apasă aici pentru a adăuga primul Vertex",continueLine:"Apasă aici pentru a continua desenul",finishLine:"Apasă pe orice obiect pentru a finisa desenul",finishPoly:"Apasă pe primul obiect pentru a finisa",finishRect:"Apasă pentru a finisa",startCircle:"Apasă pentru a desena un cerc",finishCircle:"Apasă pentru a finisa un cerc",placeCircleMarker:"Adaugă un punct"},actions:{finish:"Termină",cancel:"Anulează",removeLastVertex:"Șterge ultimul Vertex"},buttonTitles:{drawMarkerButton:"Adaugă o bulină",drawPolyButton:"Desenează un poligon",drawLineButton:"Desenează o linie",drawCircleButton:"Desenează un cerc",drawRectButton:"Desenează un dreptunghi",editButton:"Editează straturile",dragButton:"Mută straturile",cutButton:"Taie straturile",deleteButton:"Șterge straturile",drawCircleMarkerButton:"Desenează marcatorul cercului",snappingButton:"Fixați marcatorul glisat pe alte straturi și vârfuri",pinningButton:"Fixați vârfurile partajate împreună",rotateButton:"Rotiți stratul"}},On={tooltips:{placeMarker:"Нажмите, чтобы нанести маркер",firstVertex:"Нажмите, чтобы нанести первый объект",continueLine:"Нажмите, чтобы продолжить рисование",finishLine:"Нажмите любой существующий маркер для завершения",finishPoly:"Выберите первую точку, чтобы закончить",finishRect:"Нажмите, чтобы закончить",startCircle:"Нажмите, чтобы добавить центр круга",finishCircle:"Нажмите, чтобы задать радиус",placeCircleMarker:"Нажмите, чтобы нанести круговой маркер"},actions:{finish:"Завершить",cancel:"Отменить",removeLastVertex:"Отменить последнее действие"},buttonTitles:{drawMarkerButton:"Добавить маркер",drawPolyButton:"Рисовать полигон",drawLineButton:"Рисовать кривую",drawCircleButton:"Рисовать круг",drawRectButton:"Рисовать прямоугольник",editButton:"Редактировать слой",dragButton:"Перенести слой",cutButton:"Вырезать слой",deleteButton:"Удалить слой",drawCircleMarkerButton:"Добавить круговой маркер",snappingButton:"Привязать перетаскиваемый маркер к другим слоям и вершинам",pinningButton:"Связать общие точки вместе",rotateButton:"Поворот слоя"}},In={tooltips:{placeMarker:"Presiona para colocar un marcador",firstVertex:"Presiona para colocar el primer vértice",continueLine:"Presiona para continuar dibujando",finishLine:"Presiona cualquier marcador existente para finalizar",finishPoly:"Presiona el primer marcador para finalizar",finishRect:"Presiona para finalizar",startCircle:"Presiona para colocar el centro del círculo",finishCircle:"Presiona para finalizar el círculo",placeCircleMarker:"Presiona para colocar un marcador de círculo"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Eliminar último vértice"},buttonTitles:{drawMarkerButton:"Dibujar Marcador",drawPolyButton:"Dibujar Polígono",drawLineButton:"Dibujar Línea",drawCircleButton:"Dibujar Círculo",drawRectButton:"Dibujar Rectángulo",editButton:"Editar Capas",dragButton:"Arrastrar Capas",cutButton:"Cortar Capas",deleteButton:"Eliminar Capas",drawCircleMarkerButton:"Dibujar Marcador de Círculo",snappingButton:"El marcador de Snap arrastrado a otras capas y vértices",pinningButton:"Fijar juntos los vértices compartidos",rotateButton:"Rotar capa"}},jn={tooltips:{placeMarker:"Klik om een marker te plaatsen",firstVertex:"Klik om het eerste punt te plaatsen",continueLine:"Klik om te blijven tekenen",finishLine:"Klik op een bestaand punt om te beëindigen",finishPoly:"Klik op het eerst punt om te beëindigen",finishRect:"Klik om te beëindigen",startCircle:"Klik om het middelpunt te plaatsen",finishCircle:"Klik om de cirkel te beëindigen",placeCircleMarker:"Klik om een marker te plaatsen"},actions:{finish:"Bewaar",cancel:"Annuleer",removeLastVertex:"Verwijder laatste punt"},buttonTitles:{drawMarkerButton:"Plaats Marker",drawPolyButton:"Teken een vlak",drawLineButton:"Teken een lijn",drawCircleButton:"Teken een cirkel",drawRectButton:"Teken een vierkant",editButton:"Bewerk",dragButton:"Verplaats",cutButton:"Knip",deleteButton:"Verwijder",drawCircleMarkerButton:"Plaats Marker",snappingButton:"Snap gesleepte marker naar andere lagen en hoekpunten",pinningButton:"Speld gedeelde hoekpunten samen",rotateButton:"Laag roteren"}},Gn={tooltips:{placeMarker:"Cliquez pour placer un marqueur",firstVertex:"Cliquez pour placer le premier sommet",continueLine:"Cliquez pour continuer à dessiner",finishLine:"Cliquez sur n'importe quel marqueur pour terminer",finishPoly:"Cliquez sur le premier marqueur pour terminer",finishRect:"Cliquez pour terminer",startCircle:"Cliquez pour placer le centre du cercle",finishCircle:"Cliquez pour finir le cercle",placeCircleMarker:"Cliquez pour placer le marqueur circulaire"},actions:{finish:"Terminer",cancel:"Annuler",removeLastVertex:"Retirer le dernier sommet"},buttonTitles:{drawMarkerButton:"Placer des marqueurs",drawPolyButton:"Dessiner des polygones",drawLineButton:"Dessiner des polylignes",drawCircleButton:"Dessiner un cercle",drawRectButton:"Dessiner un rectangle",editButton:"Éditer des calques",dragButton:"Déplacer des calques",cutButton:"Couper des calques",deleteButton:"Supprimer des calques",drawCircleMarkerButton:"Dessiner un marqueur circulaire",snappingButton:"Glisser le marqueur vers d'autres couches et sommets",pinningButton:"Épingler ensemble les sommets partagés",rotateButton:"Tourner des calques"}},Nn={tooltips:{placeMarker:"单击放置标记",firstVertex:"单击放置首个顶点",continueLine:"单击继续绘制",finishLine:"单击任何存在的标记以完成",finishPoly:"单击第一个标记以完成",finishRect:"单击完成",startCircle:"单击放置圆心",finishCircle:"单击完成圆形",placeCircleMarker:"点击放置圆形标记"},actions:{finish:"完成",cancel:"取消",removeLastVertex:"移除最后的顶点"},buttonTitles:{drawMarkerButton:"绘制标记",drawPolyButton:"绘制多边形",drawLineButton:"绘制线段",drawCircleButton:"绘制圆形",drawRectButton:"绘制长方形",editButton:"编辑图层",dragButton:"拖拽图层",cutButton:"剪切图层",deleteButton:"删除图层",drawCircleMarkerButton:"画圆圈标记",snappingButton:"将拖动的标记捕捉到其他图层和顶点",pinningButton:"将共享顶点固定在一起",rotateButton:"旋转图层"}},zn={tooltips:{placeMarker:"單擊放置標記",firstVertex:"單擊放置第一個頂點",continueLine:"單擊繼續繪製",finishLine:"單擊任何存在的標記以完成",finishPoly:"單擊第一個標記以完成",finishRect:"單擊完成",startCircle:"單擊放置圓心",finishCircle:"單擊完成圓形",placeCircleMarker:"點擊放置圓形標記"},actions:{finish:"完成",cancel:"取消",removeLastVertex:"移除最後一個頂點"},buttonTitles:{drawMarkerButton:"放置標記",drawPolyButton:"繪製多邊形",drawLineButton:"繪製線段",drawCircleButton:"繪製圓形",drawRectButton:"繪製方形",editButton:"編輯圖形",dragButton:"移動圖形",cutButton:"裁切圖形",deleteButton:"刪除圖形",drawCircleMarkerButton:"畫圓圈標記",snappingButton:"將拖動的標記對齊到其他圖層和頂點",pinningButton:"將共享頂點固定在一起",rotateButton:"旋轉圖形"}},Un={tooltips:{placeMarker:"Clique para posicionar o marcador",firstVertex:"Clique para posicionar o primeiro vértice",continueLine:"Clique para continuar desenhando",finishLine:"Clique em qualquer marcador existente para finalizar",finishPoly:"Clique no primeiro marcador para finalizar",finishRect:"Clique para finalizar",startCircle:"Clique para posicionar o centro do círculo",finishCircle:"Clique para finalizar o círculo",placeCircleMarker:"Clique para posicionar o marcador circular",placeText:"Clique para inserir texto"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Remover último vértice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Polígonos",drawLineButton:"Desenhar Linha Poligonal",drawCircleButton:"Desenhar Círculo",drawRectButton:"Desenhar Retângulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Recortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de Círculo",snappingButton:"Ajustar marcador arrastado a outras camadas e vértices",pinningButton:"Unir vértices compartilhados",rotateButton:"Rotacionar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Redimensionar Camadas",autoTracingButton:"Traçado Automático de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"Área",radius:"Raio",perimeter:"Perímetro",height:"Altura",width:"Largura",coordinates:"Posição",coordinatesMarker:"Marcador de Posição"}},vi={tooltips:{placeMarker:"Clique para colocar marcador",firstVertex:"Clique para colocar primeiro vértice",continueLine:"Clique para continuar a desenhar",finishLine:"Clique num marcador existente para terminar",finishPoly:"Clique no primeiro marcador para terminar",finishRect:"Clique para terminar",startCircle:"Clique para colocar o centro do círculo",finishCircle:"Clique para terminar o círculo",placeCircleMarker:"Clique para colocar marcador de círculo",placeText:"Clique para colocar texto"},actions:{finish:"Terminar",cancel:"Cancelar",removeLastVertex:"Remover Último Vértice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Polígonos",drawLineButton:"Desenhar Polilinha",drawCircleButton:"Desenhar Círculo",drawRectButton:"Desenhar Retângulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Cortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de Círculo",snappingButton:"Ajustar marcador arrastado a outras camadas e vértices",pinningButton:"Unir vértices partilhados",rotateButton:"Rodar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Escalar Camadas",autoTracingButton:"Traçado Automático de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"Área",radius:"Raio",perimeter:"Perímetro",height:"Altura",width:"Largura",coordinates:"Posição",coordinatesMarker:"Marcador de Posição"}},Vn={tooltips:{placeMarker:"Kliknij, aby umieścić znacznik",firstVertex:"Kliknij, aby umieścić pierwszy wierzchołek",continueLine:"Kliknij, aby kontynuować rysowanie",finishLine:"Kliknij dowolny istniejący znacznik, aby zakończyć",finishPoly:"Kliknij pierwszy znacznik, aby zakończyć",finishRect:"Kliknij, aby zakończyć",startCircle:"Kliknij, aby umieścić środek okręgu",finishCircle:"Kliknij, aby zakończyć okrąg",placeCircleMarker:"Kliknij, aby umieścić znacznik okręgu",placeText:"Kliknij, aby umieścić tekst"},actions:{finish:"Zakończ",cancel:"Anuluj",removeLastVertex:"Usuń ostatni wierzchołek"},buttonTitles:{drawMarkerButton:"Rysuj znacznik",drawPolyButton:"Rysuj wielokąt",drawLineButton:"Rysuj linię",drawCircleButton:"Rysuj okrąg",drawRectButton:"Rysuj prostokąt",editButton:"Edytuj warstwy",dragButton:"Przeciągnij warstwy",cutButton:"Wytnij warstwy",deleteButton:"Usuń warstwy",drawCircleMarkerButton:"Rysuj znacznik okrągły",snappingButton:"Przyciągnij przenoszony znacznik do innych warstw i wierzchołków",pinningButton:"Przypnij wspólne wierzchołki razem",rotateButton:"Obróć warstwy",drawTextButton:"Rysuj tekst",scaleButton:"Skaluj warstwy",autoTracingButton:"Automatyczne śledzenie linii"},measurements:{totalLength:"Długość",segmentLength:"Długość odcinka",area:"Obszar",radius:"Promień",perimeter:"Obwód",height:"Wysokość",width:"Szerokość",coordinates:"Pozycja",coordinatesMarker:"Znacznik pozycji"}},Kn={tooltips:{placeMarker:"Klicka för att placera markör",firstVertex:"Klicka för att placera första hörnet",continueLine:"Klicka för att fortsätta rita",finishLine:"Klicka på en existerande punkt för att slutföra",finishPoly:"Klicka på den första punkten för att slutföra",finishRect:"Klicka för att slutföra",startCircle:"Klicka för att placera cirkelns centrum",finishCircle:"Klicka för att slutföra cirkeln",placeCircleMarker:"Klicka för att placera cirkelmarkör"},actions:{finish:"Slutför",cancel:"Avbryt",removeLastVertex:"Ta bort sista hörnet"},buttonTitles:{drawMarkerButton:"Rita Markör",drawPolyButton:"Rita Polygoner",drawLineButton:"Rita Linje",drawCircleButton:"Rita Cirkel",drawRectButton:"Rita Rektangel",editButton:"Redigera Lager",dragButton:"Dra Lager",cutButton:"Klipp i Lager",deleteButton:"Ta bort Lager",drawCircleMarkerButton:"Rita Cirkelmarkör",snappingButton:"Snäpp dra markören till andra lager och hörn",pinningButton:"Fäst delade hörn tillsammans",rotateButton:"Rotera lagret"}},qn={tooltips:{placeMarker:"Κάντε κλικ για να τοποθετήσετε Δείκτη",firstVertex:"Κάντε κλικ για να τοποθετήσετε το πρώτο σημείο",continueLine:"Κάντε κλικ για να συνεχίσετε να σχεδιάζετε",finishLine:"Κάντε κλικ σε οποιονδήποτε υπάρχον σημείο για να ολοκληρωθεί",finishPoly:"Κάντε κλικ στο πρώτο σημείο για να τελειώσετε",finishRect:"Κάντε κλικ για να τελειώσετε",startCircle:"Κάντε κλικ για να τοποθετήσετε κέντρο Κύκλου",finishCircle:"Κάντε κλικ για να ολοκληρώσετε τον Κύκλο",placeCircleMarker:"Κάντε κλικ για να τοποθετήσετε Κυκλικό Δείκτη"},actions:{finish:"Τέλος",cancel:"Ακύρωση",removeLastVertex:"Κατάργηση τελευταίου σημείου"},buttonTitles:{drawMarkerButton:"Σχεδίαση Δείκτη",drawPolyButton:"Σχεδίαση Πολυγώνου",drawLineButton:"Σχεδίαση Γραμμής",drawCircleButton:"Σχεδίαση Κύκλου",drawRectButton:"Σχεδίαση Ορθογωνίου",editButton:"Επεξεργασία Επιπέδων",dragButton:"Μεταφορά Επιπέδων",cutButton:"Αποκοπή Επιπέδων",deleteButton:"Κατάργηση Επιπέδων",drawCircleMarkerButton:"Σχεδίαση Κυκλικού Δείκτη",snappingButton:"Προσκόλληση του Δείκτη μεταφοράς σε άλλα Επίπεδα και Κορυφές",pinningButton:"Περικοπή κοινών κορυφών μαζί",rotateButton:"Περιστρέψτε το στρώμα"}},Hn={tooltips:{placeMarker:"Kattintson a jelölő elhelyezéséhez",firstVertex:"Kattintson az első pont elhelyezéséhez",continueLine:"Kattintson a következő pont elhelyezéséhez",finishLine:"A befejezéshez kattintson egy meglévő pontra",finishPoly:"A befejezéshez kattintson az első pontra",finishRect:"Kattintson a befejezéshez",startCircle:"Kattintson a kör középpontjának elhelyezéséhez",finishCircle:"Kattintson a kör befejezéséhez",placeCircleMarker:"Kattintson a körjelölő elhelyezéséhez"},actions:{finish:"Befejezés",cancel:"Mégse",removeLastVertex:"Utolsó pont eltávolítása"},buttonTitles:{drawMarkerButton:"Jelölő rajzolása",drawPolyButton:"Poligon rajzolása",drawLineButton:"Vonal rajzolása",drawCircleButton:"Kör rajzolása",drawRectButton:"Négyzet rajzolása",editButton:"Elemek szerkesztése",dragButton:"Elemek mozgatása",cutButton:"Elemek vágása",deleteButton:"Elemek törlése",drawCircleMarkerButton:"Kör jelölő rajzolása",snappingButton:"Kapcsolja a jelöltőt másik elemhez vagy ponthoz",pinningButton:"Közös pontok összekötése",rotateButton:"Fólia elforgatása"}},Yn={tooltips:{placeMarker:"Tryk for at placere en markør",firstVertex:"Tryk for at placere det første punkt",continueLine:"Tryk for at fortsætte linjen",finishLine:"Tryk på et eksisterende punkt for at afslutte",finishPoly:"Tryk på det første punkt for at afslutte",finishRect:"Tryk for at afslutte",startCircle:"Tryk for at placere cirklens center",finishCircle:"Tryk for at afslutte cirklen",placeCircleMarker:"Tryk for at placere en cirkelmarkør"},actions:{finish:"Afslut",cancel:"Afbryd",removeLastVertex:"Fjern sidste punkt"},buttonTitles:{drawMarkerButton:"Placer markør",drawPolyButton:"Tegn polygon",drawLineButton:"Tegn linje",drawCircleButton:"Tegn cirkel",drawRectButton:"Tegn firkant",editButton:"Rediger",dragButton:"Træk",cutButton:"Klip",deleteButton:"Fjern",drawCircleMarkerButton:"Tegn cirkelmarkør",snappingButton:"Fastgør trukket markør til andre elementer",pinningButton:"Sammenlæg delte elementer",rotateButton:"Roter laget"}},$n={tooltips:{placeMarker:"Klikk for å plassere punkt",firstVertex:"Klikk for å plassere første punkt",continueLine:"Klikk for å tegne videre",finishLine:"Klikk på et eksisterende punkt for å fullføre",finishPoly:"Klikk første punkt for å fullføre",finishRect:"Klikk for å fullføre",startCircle:"Klikk for å sette sirkel midtpunkt",finishCircle:"Klikk for å fullføre sirkel",placeCircleMarker:"Klikk for å plassere sirkel",placeText:"Klikk for å plassere tekst"},actions:{finish:"Fullfør",cancel:"Kanseller",removeLastVertex:"Fjern forrige punkt"},buttonTitles:{drawMarkerButton:"Tegn punkt",drawPolyButton:"Tegn flate",drawLineButton:"Tegn linje",drawCircleButton:"Tegn sirkel",drawRectButton:"Tegn rektangel",editButton:"Rediger objekter",dragButton:"Dra objekter",cutButton:"Kutt objekter",deleteButton:"Fjern objekter",drawCircleMarkerButton:"Tegn sirkel-punkt",snappingButton:"Fest dratt punkt til andre objekter og punkt",pinningButton:"Pin delte punkter sammen",rotateButton:"Rotér objekter",drawTextButton:"Tegn tekst",scaleButton:"Skalér objekter",autoTracingButton:"Automatisk sporing av linje"},measurements:{totalLength:"Lengde",segmentLength:"Segmentlengde",area:"Område",radius:"Radius",perimeter:"Omriss",height:"Høyde",width:"Bredde",coordinates:"Posisjon",coordinatesMarker:"Posisjonsmarkør"}},Xn={tooltips:{placeMarker:"کلیک برای جانمایی نشان",firstVertex:"کلیک برای رسم اولین رأس",continueLine:"کلیک برای ادامه رسم",finishLine:"کلیک روی هر نشان موجود برای پایان",finishPoly:"کلیک روی اولین نشان برای پایان",finishRect:"کلیک برای پایان",startCircle:"کلیک برای رسم مرکز دایره",finishCircle:"کلیک برای پایان رسم دایره",placeCircleMarker:"کلیک برای رسم نشان دایره",placeText:"کلیک برای نوشتن متن"},actions:{finish:"پایان",cancel:"لفو",removeLastVertex:"حذف آخرین رأس"},buttonTitles:{drawMarkerButton:"درج نشان",drawPolyButton:"رسم چندضلعی",drawLineButton:"رسم خط",drawCircleButton:"رسم دایره",drawRectButton:"رسم چهارضلعی",editButton:"ویرایش لایه‌ها",dragButton:"جابجایی لایه‌ها",cutButton:"برش لایه‌ها",deleteButton:"حذف لایه‌ها",drawCircleMarkerButton:"رسم نشان دایره",snappingButton:"نشانگر را به لایه‌ها و رئوس دیگر بکشید",pinningButton:"رئوس مشترک را با هم پین کنید",rotateButton:"چرخش لایه",drawTextButton:"رسم متن",scaleButton:"مقیاس‌گذاری",autoTracingButton:"ردیاب خودکار"},measurements:{totalLength:"طول",segmentLength:"طول بخش",area:"ناحیه",radius:"شعاع",perimeter:"محیط",height:"ارتفاع",width:"عرض",coordinates:"موقعیت",coordinatesMarker:"موقعیت نشان"}},Jn={tooltips:{placeMarker:"Натисніть, щоб нанести маркер",firstVertex:"Натисніть, щоб нанести першу вершину",continueLine:"Натисніть, щоб продовжити малювати",finishLine:"Натисніть будь-який існуючий маркер для завершення",finishPoly:"Виберіть перший маркер, щоб завершити",finishRect:"Натисніть, щоб завершити",startCircle:"Натисніть, щоб додати центр кола",finishCircle:"Натисніть, щоб завершити коло",placeCircleMarker:"Натисніть, щоб нанести круговий маркер"},actions:{finish:"Завершити",cancel:"Відмінити",removeLastVertex:"Видалити попередню вершину"},buttonTitles:{drawMarkerButton:"Малювати маркер",drawPolyButton:"Малювати полігон",drawLineButton:"Малювати криву",drawCircleButton:"Малювати коло",drawRectButton:"Малювати прямокутник",editButton:"Редагувати шари",dragButton:"Перенести шари",cutButton:"Вирізати шари",deleteButton:"Видалити шари",drawCircleMarkerButton:"Малювати круговий маркер",snappingButton:"Прив’язати перетягнутий маркер до інших шарів та вершин",pinningButton:"Зв'язати спільні вершини разом",rotateButton:"Повернути шар"}},Zn={tooltips:{placeMarker:"İşaretçi yerleştirmek için tıklayın",firstVertex:"İlk tepe noktasını yerleştirmek için tıklayın",continueLine:"Çizime devam etmek için tıklayın",finishLine:"Bitirmek için mevcut herhangi bir işaretçiyi tıklayın",finishPoly:"Bitirmek için ilk işaretçiyi tıklayın",finishRect:"Bitirmek için tıklayın",startCircle:"Daire merkezine yerleştirmek için tıklayın",finishCircle:"Daireyi bitirmek için tıklayın",placeCircleMarker:"Daire işaretçisi yerleştirmek için tıklayın"},actions:{finish:"Bitir",cancel:"İptal",removeLastVertex:"Son köşeyi kaldır"},buttonTitles:{drawMarkerButton:"Çizim İşaretçisi",drawPolyButton:"Çokgenler çiz",drawLineButton:"Çoklu çizgi çiz",drawCircleButton:"Çember çiz",drawRectButton:"Dikdörtgen çiz",editButton:"Katmanları düzenle",dragButton:"Katmanları sürükle",cutButton:"Katmanları kes",deleteButton:"Katmanları kaldır",drawCircleMarkerButton:"Daire işaretçisi çiz",snappingButton:"Sürüklenen işaretçiyi diğer katmanlara ve köşelere yapıştır",pinningButton:"Paylaşılan köşeleri birbirine sabitle",rotateButton:"Katmanı döndür"}},Wn={tooltips:{placeMarker:"Kliknutím vytvoříte značku",firstVertex:"Kliknutím vytvoříte první objekt",continueLine:"Kliknutím pokračujte v kreslení",finishLine:"Kliknutí na libovolnou existující značku pro dokončení",finishPoly:"Vyberte první bod pro dokončení",finishRect:"Klikněte pro dokončení",startCircle:"Kliknutím přidejte střed kruhu",finishCircle:"Нажмите, чтобы задать радиус",placeCircleMarker:"Kliknutím nastavte poloměr"},actions:{finish:"Dokončit",cancel:"Zrušit",removeLastVertex:"Zrušit poslední akci"},buttonTitles:{drawMarkerButton:"Přidat značku",drawPolyButton:"Nakreslit polygon",drawLineButton:"Nakreslit křivku",drawCircleButton:"Nakreslit kruh",drawRectButton:"Nakreslit obdélník",editButton:"Upravit vrstvu",dragButton:"Přeneste vrstvu",cutButton:"Vyjmout vrstvu",deleteButton:"Smazat vrstvu",drawCircleMarkerButton:"Přidat kruhovou značku",snappingButton:"Navázat tažnou značku k dalším vrstvám a vrcholům",pinningButton:"Spojit společné body dohromady",rotateButton:"Otočte vrstvu"}},Qn={tooltips:{placeMarker:"クリックしてマーカーを配置",firstVertex:"クリックして最初の頂点を配置",continueLine:"クリックして描画を続ける",finishLine:"任意のマーカーをクリックして終了",finishPoly:"最初のマーカーをクリックして終了",finishRect:"クリックして終了",startCircle:"クリックして円の中心を配置",finishCircle:"クリックして円の描画を終了",placeCircleMarker:"クリックして円マーカーを配置",placeText:"クリックしてテキストを配置"},actions:{finish:"終了",cancel:"キャンセル",removeLastVertex:"最後の頂点を削除"},buttonTitles:{drawMarkerButton:"マーカーを描画",drawPolyButton:"ポリゴンを描画",drawLineButton:"折れ線を描画",drawCircleButton:"円を描画",drawRectButton:"矩形を描画",editButton:"レイヤーを編集",dragButton:"レイヤーをドラッグ",cutButton:"レイヤーを切り取り",deleteButton:"レイヤーを削除",drawCircleMarkerButton:"円マーカーを描画",snappingButton:"ドラッグしたマーカーを他のレイヤーや頂点にスナップする",pinningButton:"共有する頂点を同時に動かす",rotateButton:"レイヤーを回転",drawTextButton:"テキストを描画"}},ea={tooltips:{placeMarker:"Klikkaa asettaaksesi merkin",firstVertex:"Klikkaa asettaakseni ensimmäisen osuuden",continueLine:"Klikkaa jatkaaksesi piirtämistä",finishLine:"Klikkaa olemassa olevaa merkkiä lopettaaksesi",finishPoly:"Klikkaa ensimmäistä merkkiä lopettaaksesi",finishRect:"Klikkaa lopettaaksesi",startCircle:"Klikkaa asettaaksesi ympyrän keskipisteen",finishCircle:"Klikkaa lopettaaksesi ympyrän",placeCircleMarker:"Klikkaa asettaaksesi ympyrämerkin",placeText:"Klikkaa asettaaksesi tekstin"},actions:{finish:"Valmis",cancel:"Peruuta",removeLastVertex:"Poista viimeinen osuus"},buttonTitles:{drawMarkerButton:"Piirrä merkkejä",drawPolyButton:"Piirrä monikulmioita",drawLineButton:"Piirrä viivoja",drawCircleButton:"Piirrä ympyrä",drawRectButton:"Piirrä neliskulmioita",editButton:"Muokkaa",dragButton:"Siirrä",cutButton:"Leikkaa",deleteButton:"Poista",drawCircleMarkerButton:"Piirrä ympyrämerkki",snappingButton:"Kiinnitä siirrettävä merkki toisiin muotoihin",pinningButton:"Kiinnitä jaetut muodot yhteen",rotateButton:"Käännä",drawTextButton:"Piirrä tekstiä"}},ta={tooltips:{placeMarker:"마커 위치를 클릭하세요",firstVertex:"첫번째 꼭지점 위치을 클릭하세요",continueLine:"계속 그리려면 클릭하세요",finishLine:"끝내려면 기존 마커를 클릭하세요",finishPoly:"끝내려면 처음 마커를 클릭하세요",finishRect:"끝내려면 클릭하세요",startCircle:"원의 중심이 될 위치를 클릭하세요",finishCircle:"원을 끝내려면 클릭하세요",placeCircleMarker:"원 마커 위치를 클릭하세요",placeText:"텍스트 위치를 클릭하세요"},actions:{finish:"끝내기",cancel:"취소",removeLastVertex:"마지막 꼭지점 제거"},buttonTitles:{drawMarkerButton:"마커 그리기",drawPolyButton:"다각형 그리기",drawLineButton:"다각선 그리기",drawCircleButton:"원 그리기",drawRectButton:"직사각형 그리기",editButton:"레이어 편집하기",dragButton:"레이어 끌기",cutButton:"레이어 자르기",deleteButton:"레이어 제거하기",drawCircleMarkerButton:"원 마커 그리기",snappingButton:"잡아끈 마커를 다른 레이어 및 꼭지점에 들러붙게 하기",pinningButton:"공유 꼭지점을 함께 찍기",rotateButton:"레이어 회전하기",drawTextButton:"텍스트 그리기"}},ra={tooltips:{placeMarker:"Маркерди жайгаштыруу үчүн басыңыз",firstVertex:"Биринчи чокуну жайгаштырууну үчүн басыңыз",continueLine:"Сүрөт тартууну улантуу үчүн басыңыз",finishLine:"Аяктоо үчүн учурдагы маркерди басыңыз",finishPoly:"Бүтүрүү үчүн биринчи маркерди басыңыз",finishRect:"Бүтүрүү үчүн басыңыз",startCircle:"Айлананын борборун жайгаштырууну үчүн басыңыз",finishCircle:"Айлананы бүтүрүү үчүн басыңыз",placeCircleMarker:"Тегерек маркерди жайгаштыруу үчүн басыңыз",placeText:"Текстти жайгаштыруу үчүн басыңыз"},actions:{finish:"Аягы",cancel:"Жок кылуу",removeLastVertex:"Акыркы чокуну өчүрүү"},buttonTitles:{drawMarkerButton:"Маркерди чизуу",drawPolyButton:"Полигон чизуу",drawLineButton:"Полилиния чизуу",drawCircleButton:"Дайынды чизуу",drawRectButton:"Прямоугольник чизуу",editButton:"Слоопту түзөтүү",dragButton:"Слоопту карап сүйлөү",cutButton:"Слооптун башын кесүү",deleteButton:"Слооптун өчүрүү",drawCircleMarkerButton:"Дайынды маркерди чизуу",snappingButton:"Башка слооптордун жана вертекстердин арасына чекилдөө",pinningButton:"Бөлүшкөн вертекстерди бирге тутуштуруу",rotateButton:"Слооптун өзгөртүү",drawTextButton:"Текст чизуу",scaleButton:"Слооптун өлчөмүн өзгөртүү",autoTracingButton:"Автоматтык тизмеги чизуу"},measurements:{totalLength:"Узундук",segmentLength:"Сегмент узундугу",area:"Аймак",radius:"Радиус",perimeter:"Периметр",height:"Диаметр",width:"Кенчилик",coordinates:"Координаттар",coordinatesMarker:"Маркердин координаттары"}},ia=vi,Vt={en:An,de:Sn,it:Tn,id:Fn,ro:Rn,ru:On,es:In,nl:jn,fr:Gn,pt:ia,pt_br:Un,pt_pt:vi,zh:Nn,zh_tw:zn,pl:Vn,sv:Kn,el:qn,hu:Hn,da:Yn,no:$n,fa:Xn,ua:Jn,tr:Zn,cz:Wn,ja:Qn,fi:ea,ko:ta,ky:ra},na={_globalEditModeEnabled:!1,enableGlobalEditMode(e){let t={...e};this._globalEditModeEnabled=!0,this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),L.PM.Utils.findLayers(this.map).forEach(r=>{this._isRelevantForEdit(r)&&r.pm.enable(t)}),this.throttledReInitEdit||(this.throttledReInitEdit=L.Util.throttle(this.handleLayerAdditionInGlobalEditMode,100,this)),this._addedLayersEdit={},this.map.on("layeradd",this._layerAddedEdit,this),this.map.on("layeradd",this.throttledReInitEdit,this),this._fireGlobalEditModeToggled(!0)},disableGlobalEditMode(){this._globalEditModeEnabled=!1,L.PM.Utils.findLayers(this.map).forEach(e=>{e.pm.disable()}),this.map.off("layeradd",this._layerAddedEdit,this),this.map.off("layeradd",this.throttledReInitEdit,this),this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),this._fireGlobalEditModeToggled(!1)},globalEditEnabled(){return this.globalEditModeEnabled()},globalEditModeEnabled(){return this._globalEditModeEnabled},toggleGlobalEditMode(e=this.globalOptions){this.globalEditModeEnabled()?this.disableGlobalEditMode():this.enableGlobalEditMode(e)},handleLayerAdditionInGlobalEditMode(){let e=this._addedLayersEdit;if(this._addedLayersEdit={},this.globalEditModeEnabled())for(let t in e){let r=e[t];this._isRelevantForEdit(r)&&r.pm.enable({...this.globalOptions})}},_layerAddedEdit({layer:e}){this._addedLayersEdit[L.stamp(e)]=e},_isRelevantForEdit(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowEditing}},aa=na,sa={_globalDragModeEnabled:!1,enableGlobalDragMode(){let e=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!0,this._addedLayersDrag={},e.forEach(t=>{this._isRelevantForDrag(t)&&t.pm.enableLayerDrag()}),this.throttledReInitDrag||(this.throttledReInitDrag=L.Util.throttle(this.reinitGlobalDragMode,100,this)),this.map.on("layeradd",this._layerAddedDrag,this),this.map.on("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!0)},disableGlobalDragMode(){let e=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!1,e.forEach(t=>{t.pm.disableLayerDrag()}),this.map.off("layeradd",this._layerAddedDrag,this),this.map.off("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!1)},globalDragModeEnabled(){return!!this._globalDragModeEnabled},toggleGlobalDragMode(){this.globalDragModeEnabled()?this.disableGlobalDragMode():this.enableGlobalDragMode()},reinitGlobalDragMode(){let e=this._addedLayersDrag;if(this._addedLayersDrag={},this.globalDragModeEnabled())for(let t in e){let r=e[t];this._isRelevantForDrag(r)&&r.pm.enableLayerDrag()}},_layerAddedDrag({layer:e}){this._addedLayersDrag[L.stamp(e)]=e},_isRelevantForDrag(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.draggable}},oa=sa,ua={_globalRemovalModeEnabled:!1,enableGlobalRemovalMode(){this._globalRemovalModeEnabled=!0,this.map.eachLayer(e=>{this._isRelevantForRemoval(e)&&(e.pm.enabled()&&e.pm.disable(),e.on("click",this.removeLayer,this))}),this.throttledReInitRemoval||(this.throttledReInitRemoval=L.Util.throttle(this.handleLayerAdditionInGlobalRemovalMode,100,this)),this._addedLayersRemoval={},this.map.on("layeradd",this._layerAddedRemoval,this),this.map.on("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!0)},disableGlobalRemovalMode(){this._globalRemovalModeEnabled=!1,this.map.eachLayer(e=>{e.off("click",this.removeLayer,this)}),this.map.off("layeradd",this._layerAddedRemoval,this),this.map.off("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!1)},globalRemovalEnabled(){return this.globalRemovalModeEnabled()},globalRemovalModeEnabled(){return!!this._globalRemovalModeEnabled},toggleGlobalRemovalMode(){this.globalRemovalModeEnabled()?this.disableGlobalRemovalMode():this.enableGlobalRemovalMode()},removeLayer(e){let t=e.target;this._isRelevantForRemoval(t)&&!t.pm.dragging()&&(t.removeFrom(this.map.pm._getContainingLayer()),t.remove(),t instanceof L.LayerGroup?(this._fireRemoveLayerGroup(t),this._fireRemoveLayerGroup(this.map,t)):(t.pm._fireRemove(t),t.pm._fireRemove(this.map,t)))},_isRelevantForRemoval(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowRemoval},handleLayerAdditionInGlobalRemovalMode(){let e=this._addedLayersRemoval;if(this._addedLayersRemoval={},this.globalRemovalModeEnabled())for(let t in e){let r=e[t];this._isRelevantForRemoval(r)&&(r.pm.enabled()&&r.pm.disable(),r.on("click",this.removeLayer,this))}},_layerAddedRemoval({layer:e}){this._addedLayersRemoval[L.stamp(e)]=e}},la=ua,ha={_globalRotateModeEnabled:!1,enableGlobalRotateMode(){this._globalRotateModeEnabled=!0,L.PM.Utils.findLayers(this.map).filter(e=>e instanceof L.Polyline).forEach(e=>{this._isRelevantForRotate(e)&&e.pm.enableRotate()}),this.throttledReInitRotate||(this.throttledReInitRotate=L.Util.throttle(this.handleLayerAdditionInGlobalRotateMode,100,this)),this._addedLayersRotate={},this.map.on("layeradd",this._layerAddedRotate,this),this.map.on("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},disableGlobalRotateMode(){this._globalRotateModeEnabled=!1,L.PM.Utils.findLayers(this.map).filter(e=>e instanceof L.Polyline).forEach(e=>{e.pm.disableRotate()}),this.map.off("layeradd",this._layerAddedRotate,this),this.map.off("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},globalRotateModeEnabled(){return!!this._globalRotateModeEnabled},toggleGlobalRotateMode(){this.globalRotateModeEnabled()?this.disableGlobalRotateMode():this.enableGlobalRotateMode()},_isRelevantForRotate(e){return e.pm&&e instanceof L.Polyline&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowRotation},handleLayerAdditionInGlobalRotateMode(){let e=this._addedLayersRotate;if(this._addedLayersRotate={},this.globalRotateModeEnabled())for(let t in e){let r=e[t];this._isRelevantForRemoval(r)&&r.pm.enableRotate()}},_layerAddedRotate({layer:e}){this._addedLayersRotate[L.stamp(e)]=e}},ca=ha,pa=Be(Hr()),da={_fireDrawStart(e="Draw",t={}){this.__fire(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer},e,t)},_fireDrawEnd(e="Draw",t={}){this.__fire(this._map,"pm:drawend",{shape:this._shape},e,t)},_fireCreate(e,t="Draw",r={}){this.__fire(this._map,"pm:create",{shape:this._shape,marker:e,layer:e},t,r)},_fireCenterPlaced(e="Draw",t={}){let r=e==="Draw"?this._layer:void 0,i=e!=="Draw"?this._layer:void 0;this.__fire(this._layer,"pm:centerplaced",{shape:this._shape,workingLayer:r,layer:i,latlng:this._layer.getLatLng()},e,t)},_fireCut(e,t,r,i="Draw",n={}){this.__fire(e,"pm:cut",{shape:this._shape,layer:t,originalLayer:r},i,n)},_fireEdit(e=this._layer,t="Edit",r={}){this.__fire(e,"pm:edit",{layer:this._layer,shape:this.getShape()},t,r)},_fireEnable(e="Edit",t={}){this.__fire(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()},e,t)},_fireDisable(e="Edit",t={}){this.__fire(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()},e,t)},_fireUpdate(e="Edit",t={}){this.__fire(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()},e,t)},_fireMarkerDragStart(e,t=void 0,r="Edit",i={}){this.__fire(this._layer,"pm:markerdragstart",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t},r,i)},_fireMarkerDrag(e,t=void 0,r="Edit",i={}){this.__fire(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t},r,i)},_fireMarkerDragEnd(e,t=void 0,r=void 0,i="Edit",n={}){this.__fire(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t,intersectionReset:r},i,n)},_fireDragStart(e="Edit",t={}){this.__fire(this._layer,"pm:dragstart",{layer:this._layer,shape:this.getShape()},e,t)},_fireDrag(e,t="Edit",r={}){this.__fire(this._layer,"pm:drag",{...e,shape:this.getShape()},t,r)},_fireDragEnd(e="Edit",t={}){this.__fire(this._layer,"pm:dragend",{layer:this._layer,shape:this.getShape()},e,t)},_fireDragEnable(e="Edit",t={}){this.__fire(this._layer,"pm:dragenable",{layer:this._layer,shape:this.getShape()},e,t)},_fireDragDisable(e="Edit",t={}){this.__fire(this._layer,"pm:dragdisable",{layer:this._layer,shape:this.getShape()},e,t)},_fireRemove(e,t=e,r="Edit",i={}){this.__fire(e,"pm:remove",{layer:t,shape:this.getShape()},r,i)},_fireVertexAdded(e,t,r,i="Edit",n={}){this.__fire(this._layer,"pm:vertexadded",{layer:this._layer,workingLayer:this._layer,marker:e,indexPath:t,latlng:r,shape:this.getShape()},i,n)},_fireVertexRemoved(e,t,r="Edit",i={}){this.__fire(this._layer,"pm:vertexremoved",{layer:this._layer,marker:e,indexPath:t,shape:this.getShape()},r,i)},_fireVertexClick(e,t,r="Edit",i={}){this.__fire(this._layer,"pm:vertexclick",{layer:this._layer,markerEvent:e,indexPath:t,shape:this.getShape()},r,i)},_fireIntersect(e,t=this._layer,r="Edit",i={}){this.__fire(t,"pm:intersect",{layer:this._layer,intersection:e,shape:this.getShape()},r,i)},_fireLayerReset(e,t,r="Edit",i={}){this.__fire(this._layer,"pm:layerreset",{layer:this._layer,markerEvent:e,indexPath:t,shape:this.getShape()},r,i)},_fireChange(e,t="Edit",r={}){this.__fire(this._layer,"pm:change",{layer:this._layer,latlngs:e,shape:this.getShape()},t,r)},_fireTextChange(e,t="Edit",r={}){this.__fire(this._layer,"pm:textchange",{layer:this._layer,text:e,shape:this.getShape()},t,r)},_fireTextFocus(e="Edit",t={}){this.__fire(this._layer,"pm:textfocus",{layer:this._layer,shape:this.getShape()},e,t)},_fireTextBlur(e="Edit",t={}){this.__fire(this._layer,"pm:textblur",{layer:this._layer,shape:this.getShape()},e,t)},_fireSnapDrag(e,t,r="Snapping",i={}){this.__fire(e,"pm:snapdrag",t,r,i)},_fireSnap(e,t,r="Snapping",i={}){this.__fire(e,"pm:snap",t,r,i)},_fireUnsnap(e,t,r="Snapping",i={}){this.__fire(e,"pm:unsnap",t,r,i)},_fireRotationEnable(e,t,r="Rotation",i={}){this.__fire(e,"pm:rotateenable",{layer:this._layer,helpLayer:this._rotatePoly,shape:this.getShape()},r,i)},_fireRotationDisable(e,t="Rotation",r={}){this.__fire(e,"pm:rotatedisable",{layer:this._layer,shape:this.getShape()},t,r)},_fireRotationStart(e,t,r="Rotation",i={}){this.__fire(e,"pm:rotatestart",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:this._startAngle,originLatLngs:t},r,i)},_fireRotation(e,t,r,i=this._rotationLayer,n="Rotation",a={}){this.__fire(e,"pm:rotate",{layer:i,helpLayer:this._layer,startAngle:this._startAngle,angle:i.pm.getAngle(),angleDiff:t,oldLatLngs:r,newLatLngs:i.getLatLngs()},n,a)},_fireRotationEnd(e,t,r,i="Rotation",n={}){this.__fire(e,"pm:rotateend",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:t,angle:this._rotationLayer.pm.getAngle(),originLatLngs:r,newLatLngs:this._rotationLayer.getLatLngs()},i,n)},_fireActionClick(e,t,r,i="Toolbar",n={}){this.__fire(this._map,"pm:actionclick",{text:e.text,action:e,btnName:t,button:r},i,n)},_fireButtonClick(e,t,r="Toolbar",i={}){this.__fire(this._map,"pm:buttonclick",{btnName:e,button:t},r,i)},_fireLangChange(e,t,r,i,n="Global",a={}){this.__fire(this.map,"pm:langchange",{oldLang:e,activeLang:t,fallback:r,translations:i},n,a)},_fireGlobalDragModeToggled(e,t="Global",r={}){this.__fire(this.map,"pm:globaldragmodetoggled",{enabled:e,map:this.map},t,r)},_fireGlobalEditModeToggled(e,t="Global",r={}){this.__fire(this.map,"pm:globaleditmodetoggled",{enabled:e,map:this.map},t,r)},_fireGlobalRemovalModeToggled(e,t="Global",r={}){this.__fire(this.map,"pm:globalremovalmodetoggled",{enabled:e,map:this.map},t,r)},_fireGlobalCutModeToggled(e="Global",t={}){this.__fire(this._map,"pm:globalcutmodetoggled",{enabled:!!this._enabled,map:this._map},e,t)},_fireGlobalDrawModeToggled(e="Global",t={}){this.__fire(this._map,"pm:globaldrawmodetoggled",{enabled:this._enabled,shape:this._shape,map:this._map},e,t)},_fireGlobalRotateModeToggled(e="Global",t={}){this.__fire(this.map,"pm:globalrotatemodetoggled",{enabled:this.globalRotateModeEnabled(),map:this.map},e,t)},_fireRemoveLayerGroup(e,t=e,r="Edit",i={}){this.__fire(e,"pm:remove",{layer:t,shape:void 0},r,i)},_fireKeyeventEvent(e,t,r,i="Global",n={}){this.__fire(this.map,"pm:keyevent",{event:e,eventType:t,focusOn:r},i,n)},__fire(e,t,r,i,n={}){r=(0,pa.default)(r,n,{source:i}),L.PM.Utils._fireEvent(e,t,r)}},yr=da,ga=()=>({_lastEvents:{keydown:void 0,keyup:void 0,current:void 0},_initKeyListener(e){this.map=e,L.DomEvent.on(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.on(window,"blur",this._onBlur,this),e.once("unload",this._unbindKeyListenerEvents,this)},_unbindKeyListenerEvents(){L.DomEvent.off(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.off(window,"blur",this._onBlur,this)},_onKeyListener(e){let t="document";this.map.getContainer().contains(e.target)&&(t="map");let r={event:e,eventType:e.type,focusOn:t};this._lastEvents[e.type]=r,this._lastEvents.current=r,this.map.pm._fireKeyeventEvent(e,e.type,t)},_onBlur(e){e.altKey=!1;let t={event:e,eventType:e.type,focusOn:"document"};this._lastEvents[e.type]=t,this._lastEvents.current=t},getLastKeyEvent(e="current"){return this._lastEvents[e]},isShiftKeyPressed(){return this._lastEvents.current?.event.shiftKey},isAltKeyPressed(){return this._lastEvents.current?.event.altKey},isCtrlKeyPressed(){return this._lastEvents.current?.event.ctrlKey},isMetaKeyPressed(){return this._lastEvents.current?.event.metaKey},getPressedKey(){return this._lastEvents.current?.event.key}}),fa=ga,Ci=Be(_r());function Z(e){let t=L.PM.activeLang;return(0,Ci.default)(Vt[t],e)||(0,Ci.default)(Vt.en,e)||e}function $r(e){for(let t=0;t<e.length;t+=1){let r=e[t];if(Array.isArray(r)){if($r(r))return!0}else if(r!=null&&r!=="")return!0}return!1}function br(e){return e.reduce((t,r)=>{if(r.length!==0){let i=Array.isArray(r)?br(r):r;Array.isArray(i)?i.length!==0&&t.push(i):t.push(i)}return t},[])}function ma(e,t,r){let i={a:L.CRS.Earth.R,b:63567523142e-4,f:.0033528106647474805},{a:n,b:a,f:s}=i,o=e.lng,l=e.lat,h=r,y=Math.PI,m=t*y/180,w=Math.sin(m),A=Math.cos(m),O=(1-s)*Math.tan(l*y/180),I=1/Math.sqrt(1+O*O),G=O*I,J=Math.atan2(O,A),_=I*w,b=1-_*_,k=b*(n*n-a*a)/(a*a),S=1+k/16384*(4096+k*(-768+k*(320-175*k))),M=k/1024*(256+k*(-128+k*(74-47*k))),P=h/(a*S),u=2*Math.PI,c,d,p;for(;Math.abs(P-u)>1e-12;){c=Math.cos(2*J+P),d=Math.sin(P),p=Math.cos(P);let R=M*d*(c+M/4*(p*(-1+2*c*c)-M/6*c*(-3+4*d*d)*(-3+4*c*c)));u=P,P=h/(a*S)+R}let g=G*d-I*p*A,f=Math.atan2(G*p+I*d*A,(1-s)*Math.sqrt(_*_+g*g)),C=Math.atan2(d*w,I*p-G*d*A),v=s/16*b*(4+s*(4-3*b)),x=C-(1-v)*s*_*(P+v*d*(c+v*p*(-1+2*c*c))),B=o+x*180/y,E=f*180/y;return L.latLng(B,E)}function xi(e,t,r,i,n=!0){let a,s,o,l=[];for(let h=0;h<r;h+=1){if(n)a=h*360/r+i,s=ma(e,a,t),o=L.latLng(s.lng,s.lat);else{let y=e.lat+Math.cos(2*h*Math.PI/r)*t,m=e.lng+Math.sin(2*h*Math.PI/r)*t;o=L.latLng(y,m)}l.push(o)}return l}function _a(e,t,r){t=(t+360)%360;let i=Math.PI/180,n=180/Math.PI,{R:a}=L.CRS.Earth,s=e.lng*i,o=e.lat*i,l=t*i,h=Math.sin(o),y=Math.cos(o),m=Math.cos(r/a),w=Math.sin(r/a),A=Math.asin(h*m+y*w*Math.cos(l)),O=s+Math.atan2(Math.sin(l)*w*y,m-h*Math.sin(A));O*=n;let I=O-360,G=O<-180?O+360:O;return O=O>180?I:G,L.latLng([A*n,O])}function Xr(e,t,r){let i=e.latLngToContainerPoint(t),n=e.latLngToContainerPoint(r),a=Math.atan2(n.y-i.y,n.x-i.x)*180/Math.PI+90;return a+=a<0?360:0,a}function Lr(e,t,r,i){let n=Xr(e,t,r);return _a(t,n,i)}function ya(e,t,r="asc"){if(!t||Object.keys(t).length===0)return(l,h)=>l-h;let i=Object.keys(t),n,a=i.length-1,s={};for(;a>=0;)n=i[a],s[n.toLowerCase()]=t[n],a-=1;function o(l){if(l instanceof L.Marker)return"Marker";if(l instanceof L.Circle)return"Circle";if(l instanceof L.CircleMarker)return"CircleMarker";if(l instanceof L.Rectangle)return"Rectangle";if(l instanceof L.Polygon)return"Polygon";if(l instanceof L.Polyline)return"Line"}return(l,h)=>{let y,m;if(y=o(l.layer).toLowerCase(),m=o(h.layer).toLowerCase(),!y||!m)return 0;let w=y in s?s[y]:Number.MAX_SAFE_INTEGER,A=m in s?s[m]:Number.MAX_SAFE_INTEGER,O=0;return w<A?O=-1:w>A&&(O=1),r==="desc"?O*-1:O}}function dt(e,t=e.getLatLngs()){return e instanceof L.Polygon?L.polygon(t).getLatLngs():L.polyline(t).getLatLngs()}function ki(e,t){if(t.options.crs?.projection?.MAX_LATITUDE){let r=t.options.crs?.projection?.MAX_LATITUDE;e.lat=Math.max(Math.min(r,e.lat),-r)}return e}function Kt(e){return e.options.renderer||e._map&&(e._map._getPaneRenderer(e.options.pane)||e._map.options.renderer||e._map._renderer)||e._renderer}var ba=L.Class.extend({includes:[aa,oa,la,ca,yr],initialize(e){this.map=e,this.Draw=new L.PM.Draw(e),this.Toolbar=new L.PM.Toolbar(e),this.Keyboard=fa(),this.globalOptions={snappable:!0,layerGroup:void 0,snappingOrder:["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],panes:{vertexPane:"markerPane",layerPane:"overlayPane",markerPane:"markerPane"},draggable:!0},this.Keyboard._initKeyListener(e)},setLang(e="en",t,r="en"){if(e=e.trim().toLowerCase(),!/^[a-z]{2}$/.test(e)){let n=e.replace(/[-_\s]/g,"-").replace(/^(\w{2})$/,"$1-").match(/([a-z]{2})-?([a-z]{2})?/);if(n){let a=[`${n[1]}_${n[2]}`,`${n[1]}`];for(let s of a)if(Vt[s]){e=s;break}}}let i=L.PM.activeLang;t&&(Vt[e]=(0,Li.default)(Vt[r],t)),L.PM.activeLang=e,this.map.pm.Toolbar.reinit(),this._fireLangChange(i,e,r,Vt[e])},addControls(e){this.Toolbar.addControls(e)},removeControls(){this.Toolbar.removeControls()},toggleControls(){this.Toolbar.toggleControls()},controlsVisible(){return this.Toolbar.isVisible},enableDraw(e="Polygon",t){e==="Poly"&&(e="Polygon"),this.Draw.enable(e,t)},disableDraw(e="Polygon"){e==="Poly"&&(e="Polygon"),this.Draw.disable(e)},setPathOptions(e,t={}){let r=t.ignoreShapes||[],i=t.merge||!1;this.map.pm.Draw.shapes.forEach(n=>{r.indexOf(n)===-1&&this.map.pm.Draw[n].setPathOptions(e,i)})},getGlobalOptions(){return this.globalOptions},setGlobalOptions(e){let t=(0,Li.default)(this.globalOptions,e);t.editable&&(t.resizeableCircleMarker=t.editable,delete t.editable);let r=!1;this.map.pm.Draw.CircleMarker.enabled()&&!!this.map.pm.Draw.CircleMarker.options.resizeableCircleMarker!=!!t.resizeableCircleMarker&&(this.map.pm.Draw.CircleMarker.disable(),r=!0);let i=!1;this.map.pm.Draw.Circle.enabled()&&!!this.map.pm.Draw.Circle.options.resizeableCircle!=!!t.resizeableCircle&&(this.map.pm.Draw.Circle.disable(),i=!0),this.map.pm.Draw.shapes.forEach(n=>{this.map.pm.Draw[n].setOptions(t)}),r&&this.map.pm.Draw.CircleMarker.enable(),i&&this.map.pm.Draw.Circle.enable(),L.PM.Utils.findLayers(this.map).forEach(n=>{n.pm.setOptions(t)}),this.map.fire("pm:globaloptionschanged"),this.globalOptions=t,this.applyGlobalOptions()},applyGlobalOptions(){L.PM.Utils.findLayers(this.map).forEach(e=>{e.pm.enabled()&&e.pm.applyOptions()})},globalDrawModeEnabled(){return!!this.Draw.getActiveShape()},globalCutModeEnabled(){return!!this.Draw.Cut.enabled()},enableGlobalCutMode(e){return this.Draw.Cut.enable(e)},toggleGlobalCutMode(e){return this.Draw.Cut.toggle(e)},disableGlobalCutMode(){return this.Draw.Cut.disable()},getGeomanLayers(e=!1){let t=L.PM.Utils.findLayers(this.map);if(!e)return t;let r=L.featureGroup();return r._pmTempLayer=!0,t.forEach(i=>{r.addLayer(i)}),r},getGeomanDrawLayers(e=!1){let t=L.PM.Utils.findLayers(this.map).filter(i=>i._drawnByGeoman===!0);if(!e)return t;let r=L.featureGroup();return r._pmTempLayer=!0,t.forEach(i=>{r.addLayer(i)}),r},_getContainingLayer(){return this.globalOptions.layerGroup&&this.globalOptions.layerGroup instanceof L.LayerGroup?this.globalOptions.layerGroup:this.map},_isCRSSimple(){return this.map.options.crs===L.CRS.Simple},_touchEventCounter:0,_addTouchEvents(e){this._touchEventCounter===0&&(L.DomEvent.on(e,"touchmove",this._canvasTouchMove,this),L.DomEvent.on(e,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter+=1},_removeTouchEvents(e){this._touchEventCounter===1&&(L.DomEvent.off(e,"touchmove",this._canvasTouchMove,this),L.DomEvent.off(e,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter=this._touchEventCounter<=1?0:this._touchEventCounter-1},_canvasTouchMove(e){Kt(this.map)._onMouseMove(this._createMouseEvent("mousemove",e))},_canvasTouchClick(e){let t="";e.type==="touchstart"||e.type==="pointerdown"?t="mousedown":(e.type==="touchend"||e.type==="pointerup"||e.type==="touchcancel"||e.type==="pointercancel")&&(t="mouseup"),t&&Kt(this.map)._onClick(this._createMouseEvent(t,e))},_createMouseEvent(e,t){let r,i=t.touches[0]||t.changedTouches[0];try{r=new MouseEvent(e,{bubbles:t.bubbles,cancelable:t.cancelable,view:t.view,detail:i.detail,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:t.button,relatedTarget:t.relatedTarget})}catch{r=document.createEvent("MouseEvents"),r.initMouseEvent(e,t.bubbles,t.cancelable,t.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget)}return r}}),La=ba,va=L.Control.extend({includes:[yr],options:{position:"topleft",disableByOtherButtons:!0},initialize(e){this._button=L.Util.extend({},this.options,e)},onAdd(e){return this._map=e,this._map.pm.Toolbar.options.oneBlock?this._container=this._map.pm.Toolbar._createContainer(this.options.position):this._button.tool==="edit"?this._container=this._map.pm.Toolbar.editContainer:this._button.tool==="options"?this._container=this._map.pm.Toolbar.optionsContainer:this._button.tool==="custom"?this._container=this._map.pm.Toolbar.customContainer:this._container=this._map.pm.Toolbar.drawContainer,this._renderButton(),this._container},_renderButton(){let e=this.buttonsDomNode;this.buttonsDomNode=this._makeButton(this._button),e?e.replaceWith(this.buttonsDomNode):this._container.appendChild(this.buttonsDomNode)},onRemove(){return this.buttonsDomNode.remove(),this._container},getText(){return this._button.text},getIconUrl(){return this._button.iconUrl},destroy(){this._button={},this._update()},toggle(e){return typeof e=="boolean"?this._button.toggleStatus=e:this._button.toggleStatus=!this._button.toggleStatus,this._applyStyleClasses(),this._updateActiveAction(this._button),this._button.toggleStatus},toggled(){return this._button.toggleStatus},onCreate(){this.toggle(!1)},disable(){this.toggle(!1),this._button.disabled=!0,this._updateDisabled()},enable(){this._button.disabled=!1,this._updateDisabled(),this._updateActiveAction(this._button)},_triggerClick(e){e&&e.preventDefault(),!this._button.disabled&&(this._button.onClick(e,{button:this,event:e}),this._clicked(e),this._button.afterClick(e,{button:this,event:e}))},_makeButton(e){let t=this.options.position.indexOf("right")>-1?"pos-right":"",r=L.DomUtil.create("div",`button-container  ${t}`,this._container);e.title&&r.setAttribute("title",e.title);let i=L.DomUtil.create("a","leaflet-buttons-control-button",r);i.setAttribute("role","button"),i.setAttribute("tabindex","0"),i.href="#";let n=L.DomUtil.create("div",`leaflet-pm-actions-container ${t}`,r),a=e.actions,s={cancel:{text:Z("actions.cancel"),title:Z("actions.cancel"),onClick(){this._triggerClick()}},finishMode:{text:Z("actions.finish"),title:Z("actions.finish"),onClick(){this._triggerClick()}},removeLastVertex:{text:Z("actions.removeLastVertex"),title:Z("actions.removeLastVertex"),onClick(){this._map.pm.Draw[e.jsClass]._removeLastVertex()}},finish:{text:Z("actions.finish"),title:Z("actions.finish"),onClick(l){this._map.pm.Draw[e.jsClass]._finishShape(l)}}};e._preparedActions=a.map(l=>{let h=typeof l=="string"?l:l.name,y;if(s[h])y=s[h];else if(l.text)y=l;else return y;let m=L.DomUtil.create("a",`leaflet-pm-action ${t} action-${h}`,n);if(m.setAttribute("role","button"),m.setAttribute("tabindex","0"),m.href="#",y.title&&(m.title=y.title),m.innerHTML=y.text,L.DomEvent.disableClickPropagation(m),L.DomEvent.on(m,"click",L.DomEvent.stop),y._node=m,!e.disabled&&y.onClick){let w=A=>{A.preventDefault();let O="",{buttons:I}=this._map.pm.Toolbar;for(let G in I)if(I[G]._button===e){O=G;break}this._fireActionClick(y,O,e)};L.DomEvent.addListener(m,"click",w,this),L.DomEvent.addListener(m,"click",y.onClick,this),L.DomEvent.addListener(m,"click",()=>this._updateActiveAction(e))}return y}),this._updateActiveAction(e),e.toggleStatus&&L.DomUtil.addClass(r,"active");let o=L.DomUtil.create("div","control-icon",i);return e.iconUrl&&o.setAttribute("src",e.iconUrl),e.className&&L.DomUtil.addClass(o,e.className),L.DomEvent.disableClickPropagation(i),L.DomEvent.on(i,"click",L.DomEvent.stop),e.disabled||(L.DomEvent.addListener(i,"click",this._onBtnClick,this),L.DomEvent.addListener(i,"click",this._triggerClick,this)),e.disabled&&(L.DomUtil.addClass(i,"pm-disabled"),i.setAttribute("aria-disabled","true")),r},_applyStyleClasses(){this._container&&(!this._button.toggleStatus||this._button.cssToggle===!1?(L.DomUtil.removeClass(this.buttonsDomNode,"active"),L.DomUtil.removeClass(this._container,"activeChild")):(L.DomUtil.addClass(this.buttonsDomNode,"active"),L.DomUtil.addClass(this._container,"activeChild")))},_onBtnClick(){if(this._button.disabled)return;this._button.disableOtherButtons&&this._map.pm.Toolbar.triggerClickOnToggledButtons(this);let e="",{buttons:t}=this._map.pm.Toolbar;for(let r in t)if(t[r]._button===this._button){e=r;break}this._fireButtonClick(e,this._button)},_clicked(){this._button.doToggle&&this.toggle()},_updateDisabled(){if(!this._container)return;let e="pm-disabled",t=this.buttonsDomNode.children[0];this._button.disabled?(L.DomUtil.addClass(t,e),t.setAttribute("aria-disabled","true")):(L.DomUtil.removeClass(t,e),t.setAttribute("aria-disabled","false"))},_updateActiveAction(e){e._preparedActions?.forEach(t=>{t?._node&&(t.isActive&&t.isActive.call(this)?L.DomUtil.addClass(t._node,"active-action"):L.DomUtil.removeClass(t._node,"active-action"))})}}),Ca=va;L.Control.PMButton=Ca;var xa=L.Class.extend({options:{drawMarker:!0,drawRectangle:!0,drawPolyline:!0,drawPolygon:!0,drawCircle:!0,drawCircleMarker:!0,drawText:!0,editMode:!0,dragMode:!0,cutPolygon:!0,removalMode:!0,rotateMode:!0,snappingOption:!0,drawControls:!0,editControls:!0,optionsControls:!0,customControls:!0,oneBlock:!1,position:"topleft",positions:{draw:"",edit:"",options:"",custom:""}},customButtons:[],initialize(e){this.customButtons=[],this.options.positions={draw:"",edit:"",options:"",custom:""},this.init(e)},reinit(){let e=this.isVisible;this.removeControls(),this._defineButtons(),e&&this.addControls()},init(e){this.map=e,this.buttons={},this.isVisible=!1,this.drawContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-draw leaflet-bar leaflet-control"),this.editContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-edit leaflet-bar leaflet-control"),this.optionsContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-options leaflet-bar leaflet-control"),this.customContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-custom leaflet-bar leaflet-control"),this._defineButtons()},_createContainer(e){let t=`${e}Container`;return this[t]||(this[t]=L.DomUtil.create("div",`leaflet-pm-toolbar leaflet-pm-${e} leaflet-bar leaflet-control`)),this[t]},getButtons(){return this.buttons},addControls(e=this.options){typeof e.editPolygon<"u"&&(e.editMode=e.editPolygon),typeof e.deleteLayer<"u"&&(e.removalMode=e.deleteLayer),L.Util.setOptions(this,e),this.applyIconStyle(),this.isVisible=!0,this._showHideButtons()},applyIconStyle(){let e=this.getButtons(),t={geomanIcons:{drawMarker:"control-icon leaflet-pm-icon-marker",drawPolyline:"control-icon leaflet-pm-icon-polyline",drawRectangle:"control-icon leaflet-pm-icon-rectangle",drawPolygon:"control-icon leaflet-pm-icon-polygon",drawCircle:"control-icon leaflet-pm-icon-circle",drawCircleMarker:"control-icon leaflet-pm-icon-circle-marker",editMode:"control-icon leaflet-pm-icon-edit",dragMode:"control-icon leaflet-pm-icon-drag",cutPolygon:"control-icon leaflet-pm-icon-cut",removalMode:"control-icon leaflet-pm-icon-delete",drawText:"control-icon leaflet-pm-icon-text"}};for(let r in e){let i=e[r];L.Util.setOptions(i,{className:t.geomanIcons[r]})}},removeControls(){let e=this.getButtons();for(let t in e)e[t].remove();this.isVisible=!1},toggleControls(e=this.options){this.isVisible?this.removeControls():this.addControls(e)},_addButton(e,t){return this.buttons[e]=t,this.options[e]=!!this.options[e]||!1,this.buttons[e]},triggerClickOnToggledButtons(e){for(let t in this.buttons){let r=this.buttons[t];r._button.disableByOtherButtons&&r!==e&&r.toggled()&&r._triggerClick()}},toggleButton(e,t,r=!0){e==="editPolygon"&&(e="editMode"),e==="deleteLayer"&&(e="removalMode");let i=e;return r&&this.triggerClickOnToggledButtons(this.buttons[i]),this.buttons[i]?this.buttons[i].toggle(t):!1},_defineButtons(){let e={className:"control-icon leaflet-pm-icon-marker",title:Z("buttonTitles.drawMarkerButton"),jsClass:"Marker",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},t={title:Z("buttonTitles.drawPolyButton"),className:"control-icon leaflet-pm-icon-polygon",jsClass:"Polygon",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},r={className:"control-icon leaflet-pm-icon-polyline",title:Z("buttonTitles.drawLineButton"),jsClass:"Line",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},i={title:Z("buttonTitles.drawCircleButton"),className:"control-icon leaflet-pm-icon-circle",jsClass:"Circle",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},n={title:Z("buttonTitles.drawCircleMarkerButton"),className:"control-icon leaflet-pm-icon-circle-marker",jsClass:"CircleMarker",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},a={title:Z("buttonTitles.drawRectButton"),className:"control-icon leaflet-pm-icon-rectangle",jsClass:"Rectangle",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},s={title:Z("buttonTitles.editButton"),className:"control-icon leaflet-pm-icon-edit",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalEditMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},o={title:Z("buttonTitles.dragButton"),className:"control-icon leaflet-pm-icon-drag",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalDragMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},l={title:Z("buttonTitles.cutButton"),className:"control-icon leaflet-pm-icon-cut",jsClass:"Cut",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle({snappable:!0,cursorMarker:!0,allowSelfIntersection:!1})},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finish","removeLastVertex","cancel"]},h={title:Z("buttonTitles.deleteButton"),className:"control-icon leaflet-pm-icon-delete",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRemovalMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},y={title:Z("buttonTitles.rotateButton"),className:"control-icon leaflet-pm-icon-rotate",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRotateMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},m={className:"control-icon leaflet-pm-icon-text",title:Z("buttonTitles.drawTextButton"),jsClass:"Text",onClick:()=>{},afterClick:(w,A)=>{this.map.pm.Draw[A.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]};this._addButton("drawMarker",new L.Control.PMButton(e)),this._addButton("drawPolyline",new L.Control.PMButton(r)),this._addButton("drawRectangle",new L.Control.PMButton(a)),this._addButton("drawPolygon",new L.Control.PMButton(t)),this._addButton("drawCircle",new L.Control.PMButton(i)),this._addButton("drawCircleMarker",new L.Control.PMButton(n)),this._addButton("drawText",new L.Control.PMButton(m)),this._addButton("editMode",new L.Control.PMButton(s)),this._addButton("dragMode",new L.Control.PMButton(o)),this._addButton("cutPolygon",new L.Control.PMButton(l)),this._addButton("removalMode",new L.Control.PMButton(h)),this._addButton("rotateMode",new L.Control.PMButton(y))},_showHideButtons(){if(!this.isVisible)return;this.removeControls(),this.isVisible=!0;let e=this.getButtons(),t=[];this.options.drawControls===!1&&(t=t.concat(Object.keys(e).filter(r=>!e[r]._button.tool))),this.options.editControls===!1&&(t=t.concat(Object.keys(e).filter(r=>e[r]._button.tool==="edit"))),this.options.optionsControls===!1&&(t=t.concat(Object.keys(e).filter(r=>e[r]._button.tool==="options"))),this.options.customControls===!1&&(t=t.concat(Object.keys(e).filter(r=>e[r]._button.tool==="custom")));for(let r in e)if(this.options[r]&&t.indexOf(r)===-1){let i=e[r]._button.tool;i||(i="draw"),e[r].setPosition(this._getBtnPosition(i)),e[r].addTo(this.map)}},_getBtnPosition(e){return this.options.positions&&this.options.positions[e]?this.options.positions[e]:this.options.position},setBlockPosition(e,t){this.options.positions[e]=t,this._showHideButtons(),this.changeControlOrder()},getBlockPositions(){return this.options.positions},copyDrawControl(e,t){if(t)typeof t!="object"&&(t={name:t});else throw new TypeError("Button has no name");let r=this._btnNameMapping(e);if(!t.name)throw new TypeError("Button has no name");if(this.buttons[t.name])throw new TypeError("Button with this name already exists");let i=this.map.pm.Draw.createNewDrawInstance(t.name,r);t={...this.buttons[r]._button,...t};let n=this.createCustomControl(t);return{drawInstance:i,control:n}},createCustomControl(e){if(!e.name)throw new TypeError("Button has no name");if(this.buttons[e.name])throw new TypeError("Button with this name already exists");e.onClick||(e.onClick=()=>{}),e.afterClick||(e.afterClick=()=>{}),e.toggle!==!1&&(e.toggle=!0),e.block&&(e.block=e.block.toLowerCase()),(!e.block||e.block==="draw")&&(e.block=""),e.className?e.className.indexOf("control-icon")===-1&&(e.className=`control-icon ${e.className}`):e.className="control-icon";let t={tool:e.block,className:e.className,title:e.title||"",jsClass:e.name,onClick:e.onClick,afterClick:e.afterClick,doToggle:e.toggle,toggleStatus:!1,disableOtherButtons:e.disableOtherButtons??!0,disableByOtherButtons:e.disableByOtherButtons??!0,cssToggle:e.toggle,position:this.options.position,actions:e.actions||[],disabled:!!e.disabled};this.options[e.name]!==!1&&(this.options[e.name]=!0);let r=this._addButton(e.name,new L.Control.PMButton(t));return this.changeControlOrder(),r},controlExists(e){return!!this.getButton(e)},getButton(e){return this.getButtons()[e]},getButtonsInBlock(e){let t={};if(e)for(let r in this.getButtons()){let i=this.getButtons()[r];(i._button.tool===e||e==="draw"&&!i._button.tool)&&(t[r]=i)}return t},changeControlOrder(e=[]){let t=this._shapeMapping(),r=[];e.forEach(a=>{t[a]?r.push(t[a]):r.push(a)});let i=this.getButtons(),n={};r.forEach(a=>{i[a]&&(n[a]=i[a])}),Object.keys(i).filter(a=>!i[a]._button.tool||i[a]._button.tool==="draw").forEach(a=>{r.indexOf(a)===-1&&(n[a]=i[a])}),Object.keys(i).filter(a=>i[a]._button.tool==="edit").forEach(a=>{r.indexOf(a)===-1&&(n[a]=i[a])}),Object.keys(i).filter(a=>i[a]._button.tool==="options").forEach(a=>{r.indexOf(a)===-1&&(n[a]=i[a])}),Object.keys(i).filter(a=>i[a]._button.tool==="custom").forEach(a=>{r.indexOf(a)===-1&&(n[a]=i[a])}),Object.keys(i).forEach(a=>{r.indexOf(a)===-1&&(n[a]=i[a])}),this.map.pm.Toolbar.buttons=n,this._showHideButtons()},getControlOrder(){let e=this.getButtons(),t=[];for(let r in e)t.push(r);return t},changeActionsOfControl(e,t){let r=this._btnNameMapping(e);if(!r)throw new TypeError("No name passed");if(!t)throw new TypeError("No actions passed");if(!this.buttons[r])throw new TypeError("Button with this name not exists");this.buttons[r]._button.actions=t,this.changeControlOrder()},setButtonDisabled(e,t){let r=this._btnNameMapping(e);t?this.buttons[r].disable():this.buttons[r].enable()},_shapeMapping(){return{Marker:"drawMarker",Circle:"drawCircle",Polygon:"drawPolygon",Rectangle:"drawRectangle",Polyline:"drawPolyline",Line:"drawPolyline",CircleMarker:"drawCircleMarker",Edit:"editMode",Drag:"dragMode",Cut:"cutPolygon",Removal:"removalMode",Rotate:"rotateMode",Text:"drawText"}},_btnNameMapping(e){let t=this._shapeMapping();return t[e]?t[e]:e}}),ka=xa,Ma=Be(Hr()),Ea={_initSnappableMarkers(){this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,this._assignEvents(this._markers),this._layer.off("pm:dragstart",this._unsnap,this),this._layer.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){this._layer.off("pm:dragstart",this._unsnap,this)},_assignEvents(e){e.forEach(t=>{if(Array.isArray(t)){this._assignEvents(t);return}t.off("drag",this._handleSnapping,this),t.on("drag",this._handleSnapping,this),t.off("dragend",this._cleanupSnapping,this),t.on("dragend",this._cleanupSnapping,this)})},_cleanupSnapping(e){if(e){let t=e.target;t._snapped=!1}delete this._snapList,this.throttledList&&(this._map.off("layeradd",this.throttledList,this),this.throttledList=void 0),this._map.off("layerremove",this._handleSnapLayerRemoval,this),this.debugIndicatorLines&&this.debugIndicatorLines.forEach(t=>{t.remove()})},_handleThrottleSnapping(){this.throttledList&&this._createSnapList()},_handleSnapping(e){let t=e.target;if(t._snapped=!1,this.throttledList||(this.throttledList=L.Util.throttle(this._handleThrottleSnapping,100,this)),e?.originalEvent?.altKey||this._map?.pm?.Keyboard.isAltKeyPressed()||(this._snapList===void 0&&(this._createSnapList(),this._map.off("layeradd",this.throttledList,this),this._map.on("layeradd",this.throttledList,this)),this._snapList.length<=0))return!1;let r=this._calcClosestLayer(t.getLatLng(),this._snapList);if(Object.keys(r).length===0)return!1;let i=r.layer instanceof L.Marker||r.layer instanceof L.CircleMarker||!this.options.snapSegment,n;i?n=r.latlng:n=this._checkPrioritiySnapping(r);let a=this.options.snapDistance,s={marker:t,shape:this._shape,snapLatLng:n,segment:r.segment,layer:this._layer,workingLayer:this._layer,layerInteractedWith:r.layer,distance:r.distance};if(this._fireSnapDrag(s.marker,s),this._fireSnapDrag(this._layer,s),r.distance<a){t._orgLatLng=t.getLatLng(),t.setLatLng(n),t._snapped=!0,t._snapInfo=s;let o=()=>{this._snapLatLng=n,this._fireSnap(t,s),this._fireSnap(this._layer,s)},l=this._snapLatLng||{},h=n||{};(l.lat!==h.lat||l.lng!==h.lng)&&o()}else this._snapLatLng&&(this._unsnap(s),t._snapped=!1,t._snapInfo=void 0,this._fireUnsnap(s.marker,s),this._fireUnsnap(this._layer,s));return!0},_createSnapList(){let e=[],t=[],r=this._map;r.off("layerremove",this._handleSnapLayerRemoval,this),r.on("layerremove",this._handleSnapLayerRemoval,this),r.eachLayer(i=>{if((i instanceof L.Polyline||i instanceof L.Marker||i instanceof L.CircleMarker||i instanceof L.ImageOverlay)&&i.options.snapIgnore!==!0){if(i.options.snapIgnore===void 0&&(!L.PM.optIn&&i.options.pmIgnore===!0||L.PM.optIn&&i.options.pmIgnore!==!1))return;(i instanceof L.Circle||i instanceof L.CircleMarker)&&i.pm&&i.pm._hiddenPolyCircle?e.push(i.pm._hiddenPolyCircle):i instanceof L.ImageOverlay&&(i=L.rectangle(i.getBounds())),e.push(i);let n=L.polyline([],{color:"red",pmIgnore:!0});n._pmTempLayer=!0,t.push(n),(i instanceof L.Circle||i instanceof L.CircleMarker)&&t.push(n)}}),e=e.filter(i=>this._layer!==i),e=e.filter(i=>i._latlng||i._latlngs&&$r(i._latlngs)),e=e.filter(i=>!i._pmTempLayer),this._otherSnapLayers?(this._otherSnapLayers.forEach(()=>{let i=L.polyline([],{color:"red",pmIgnore:!0});i._pmTempLayer=!0,t.push(i)}),this._snapList=e.concat(this._otherSnapLayers)):this._snapList=e,this.debugIndicatorLines=t},_handleSnapLayerRemoval({layer:e}){if(!e._leaflet_id)return;let t=this._snapList.findIndex(r=>r._leaflet_id===e._leaflet_id);t>-1&&this._snapList.splice(t,1)},_calcClosestLayer(e,t){return this._calcClosestLayers(e,t,1)[0]},_calcClosestLayers(e,t,r=1){let i=[],n={};t.forEach((s,o)=>{if(s._parentCopy&&s._parentCopy===this._layer||s.getLatLngs?.().flat(5).length<2)return;let l=this._calcLayerDistances(e,s);if(l.distance=Math.floor(l.distance),this.debugIndicatorLines){if(!this.debugIndicatorLines[o]){let h=L.polyline([],{color:"red",pmIgnore:!0});h._pmTempLayer=!0,this.debugIndicatorLines[o]=h}this.debugIndicatorLines[o].setLatLngs([e,l.latlng])}r===1&&(n.distance===void 0||l.distance-5<=n.distance)?(l.distance+5<n.distance&&(i=[]),n=l,n.layer=s,i.push(n)):r!==1&&(n={},n=l,n.layer=s,i.push(n))}),r!==1&&(i=i.sort((s,o)=>s.distance-o.distance)),r===-1&&(r=i.length);let a=this._getClosestLayerByPriority(i,r);return L.Util.isArray(a)?a:[a]},_calcLayerDistances(e,t){let r=this._map,i=t instanceof L.Marker||t instanceof L.CircleMarker,n=t instanceof L.Polygon,a=e;if(i){let s=t.getLatLng();return{latlng:{...s},distance:this._getDistance(r,s,a)}}return this._calcLatLngDistances(a,t.getLatLngs(),r,n)},_calcLatLngDistances(e,t,r,i=!1){let n,a,s,o=l=>{l.forEach((h,y)=>{if(Array.isArray(h)){o(h);return}if(this.options.snapSegment){let m=h,w;i?w=y+1===l.length?0:y+1:w=y+1===l.length?void 0:y+1;let A=l[w];if(A){let O=this._getDistanceToSegment(r,e,m,A);(a===void 0||O<a)&&(a=O,s=[m,A])}}else{let m=this._getDistance(r,e,h);(a===void 0||m<a)&&(a=m,n=h)}})};return o(t),this.options.snapSegment?{latlng:{...this._getClosestPointOnSegment(r,e,s[0],s[1])},segment:s,distance:a}:{latlng:n,distance:a}},_getClosestLayerByPriority(e,t=1){e=e.sort((s,o)=>s._leaflet_id-o._leaflet_id);let r=["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],i=this._map.pm.globalOptions.snappingOrder||[],n=0,a={};return i.concat(r).forEach(s=>{a[s]||(n+=1,a[s]=n)}),e.sort(ya("instanceofShape",a)),t===1?e[0]||{}:e.slice(0,t)},_checkPrioritiySnapping(e){let t=this._map,r=e.segment[0],i=e.segment[1],n=e.latlng,a=n;if(this.options.snapVertex){let s=this._getDistance(t,r,n),o=this._getDistance(t,i,n),l=s<o?r:i,h=s<o?s:o;if(this.options.snapMiddle){let m=L.PM.Utils.calcMiddleLatLng(t,r,i),w=this._getDistance(t,m,n);w<s&&w<o&&(l=m,h=w)}let y=this.options.snapDistance;h<y&&(a=l)}return{...a}},_unsnap(){delete this._snapLatLng},_getClosestPointOnSegment(e,t,r,i){let n=e.getMaxZoom();n===1/0&&(n=e.getZoom());let a=e.project(t,n),s=e.project(r,n),o=e.project(i,n),l=L.LineUtil.closestPointOnSegment(a,s,o);return e.unproject(l,n)},_getDistanceToSegment(e,t,r,i){let n=e.latLngToContainerPoint(t),a=e.latLngToContainerPoint(r),s=e.latLngToContainerPoint(i);return L.LineUtil.pointToSegmentDistance(n,a,s)},_getDistance(e,t,r){return e.latLngToContainerPoint(t).distanceTo(e.latLngToContainerPoint(r))}},Mi=Ea,Ba=L.Class.extend({includes:[Mi,yr],options:{snappable:!0,snapDistance:20,snapMiddle:!1,allowSelfIntersection:!0,tooltips:!0,templineStyle:{},hintlineStyle:{color:"#3388ff",dashArray:"5,5"},pathOptions:null,cursorMarker:!0,finishOn:null,markerStyle:{draggable:!0,icon:L.icon()},hideMiddleMarkers:!1,minRadiusCircle:null,maxRadiusCircle:null,minRadiusCircleMarker:null,maxRadiusCircleMarker:null,resizeableCircleMarker:!1,resizeableCircle:!0,markerEditable:!0,continueDrawing:!1,snapSegment:!0,requireSnapToFinish:!1,rectangleAngle:0,textOptions:{text:null,focusAfterDraw:null,removeIfEmpty:null,className:null},snapVertex:!0},setOptions(e){L.Util.setOptions(this,e),this.setStyle(this.options)},setStyle(){},getOptions(){return this.options},initialize(e){let t=new L.Icon.Default;t.options.tooltipAnchor=[0,0],this.options.markerStyle.icon=t,this._map=e,this.shapes=["Marker","CircleMarker","Line","Polygon","Rectangle","Circle","Cut","Text"],this.shapes.forEach(r=>{this[r]=new L.PM.Draw[r](this._map)}),this.Marker.setOptions({continueDrawing:!0}),this.CircleMarker.setOptions({continueDrawing:!0})},setPathOptions(e,t=!1){t?this.options.pathOptions=(0,Ma.default)(this.options.pathOptions,e):this.options.pathOptions=e},getShapes(){return this.shapes},getShape(){return this._shape},enable(e,t){if(!e)throw new Error(`Error: Please pass a shape as a parameter. Possible shapes are: ${this.getShapes().join(",")}`);this.disable(),this[e].enable(t)},disable(){this.shapes.forEach(e=>{this[e].disable()})},addControls(){this.shapes.forEach(e=>{this[e].addButton()})},getActiveShape(){let e;return this.shapes.forEach(t=>{this[t]._enabled&&(e=t)}),e},_setGlobalDrawMode(){this._shape==="Cut"?this._fireGlobalCutModeToggled():this._fireGlobalDrawModeToggled();let e=[];this._map.eachLayer(t=>{(t instanceof L.Polyline||t instanceof L.Marker||t instanceof L.Circle||t instanceof L.CircleMarker||t instanceof L.ImageOverlay)&&(t._pmTempLayer||e.push(t))}),this._enabled?e.forEach(t=>{L.PM.Utils.disablePopup(t)}):e.forEach(t=>{L.PM.Utils.enablePopup(t)})},createNewDrawInstance(e,t){let r=this._getShapeFromBtnName(t);if(this[e])throw new TypeError("Draw Type already exists");if(!L.PM.Draw[r])throw new TypeError(`There is no class L.PM.Draw.${r}`);return this[e]=new L.PM.Draw[r](this._map),this[e].toolbarButtonName=e,this[e]._shape=e,this.shapes.push(e),this[t]&&this[e].setOptions(this[t].options),this[e].setOptions(this[e].options),this[e]},_getShapeFromBtnName(e){let t={drawMarker:"Marker",drawCircle:"Circle",drawPolygon:"Polygon",drawPolyline:"Line",drawRectangle:"Rectangle",drawCircleMarker:"CircleMarker",editMode:"Edit",dragMode:"Drag",cutPolygon:"Cut",removalMode:"Removal",rotateMode:"Rotate",drawText:"Text"};return t[e]?t[e]:this[e]?this[e]._shape:e},_finishLayer(e){e.pm&&(e.pm.setOptions(this.options),e.pm._shape=this._shape,e.pm._map=this._map),this._addDrawnLayerProp(e)},_addDrawnLayerProp(e){e._drawnByGeoman=!0},_setPane(e,t){t==="layerPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":t==="vertexPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":t==="markerPane"&&(e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},_isFirstLayer(){return(this._map||this._layer._map).pm.getGeomanLayers().length===0}}),be=Ba;be.Marker=be.extend({initialize(e){this._map=e,this._shape="Marker",this.toolbarButtonName="drawMarker"},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),this.options.markerStyle),this._setPane(this._hintMarker,"markerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.tooltips&&this._hintMarker.bindTooltip(Z("tooltips.placeMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this.options.markerEditable&&this._map.eachLayer(t=>{this.isRelevantMarker(t)&&t.pm.enable()}),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createMarker,this),this._hintMarker.remove(),this._map.off("mousemove",this._syncHintMarker,this),this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.disable()}),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},isRelevantMarker(e){return e instanceof L.Marker&&e.pm&&!e._pmTempLayer&&!e.pm._initTextMarker},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let t=e;t.target=this._hintMarker,this._handleSnapping(t)}this._fireChange(this._hintMarker.getLatLng(),"Draw")},_createMarker(e){if(!e.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),r=new L.Marker(t,this.options.markerStyle);this._setPane(r,"markerPane"),this._finishLayer(r),r.pm||(r.options.draggable=!1),r.addTo(this._map.pm._getContainingLayer()),r.pm&&this.options.markerEditable?r.pm.enable():r.dragging&&r.dragging.disable(),this._fireCreate(r),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},setStyle(){this.options.markerStyle?.icon&&this._hintMarker?.setIcon(this.options.markerStyle.icon)}});var ke=63710088e-1,Ei={centimeters:ke*100,centimetres:ke*100,degrees:ke/111325,feet:ke*3.28084,inches:ke*39.37,kilometers:ke/1e3,kilometres:ke/1e3,meters:ke,metres:ke,miles:ke/1609.344,millimeters:ke*1e3,millimetres:ke*1e3,nauticalmiles:ke/1852,radians:1,yards:ke*1.0936};function qt(e,t,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function Ht(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Bi(e[0])||!Bi(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return qt(i,t,r)}function rr(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return qt(i,t,r)}function gt(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function wa(e,t){t===void 0&&(t="kilometers");var r=Ei[t];if(!r)throw new Error(t+" units is invalid");return e*r}function Da(e,t){t===void 0&&(t="kilometers");var r=Ei[t];if(!r)throw new Error(t+" units is invalid");return e/r}function Jr(e){var t=e%(2*Math.PI);return t*180/Math.PI}function je(e){var t=e%360;return t*Math.PI/180}function Bi(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function vr(e){var t,r,i={type:"FeatureCollection",features:[]};if(e.type==="Feature"?r=e.geometry:r=e,r.type==="LineString")t=[r.coordinates];else if(r.type==="MultiLineString")t=r.coordinates;else if(r.type==="MultiPolygon")t=[].concat.apply([],r.coordinates);else if(r.type==="Polygon")t=r.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return t.forEach(function(n){t.forEach(function(a){for(var s=0;s<n.length-1;s++)for(var o=s;o<a.length-1;o++)if(!(n===a&&(Math.abs(s-o)===1||s===0&&o===n.length-2&&n[s][0]===n[n.length-1][0]&&n[s][1]===n[n.length-1][1]))){var l=Pa(n[s][0],n[s][1],n[s+1][0],n[s+1][1],a[o][0],a[o][1],a[o+1][0],a[o+1][1]);l&&i.features.push(Ht([l[0],l[1]]))}})}),i}function Pa(e,t,r,i,n,a,s,o){var l,h,y,m,w,A={x:null,y:null,onLine1:!1,onLine2:!1};return l=(o-a)*(r-e)-(s-n)*(i-t),l===0?A.x!==null&&A.y!==null?A:!1:(h=t-a,y=e-n,m=(s-n)*h-(o-a)*y,w=(r-e)*h-(i-t)*y,h=m/l,y=w/l,A.x=e+h*(r-e),A.y=t+h*(i-t),h>=0&&h<=1&&(A.onLine1=!0),y>=0&&y<=1&&(A.onLine2=!0),A.onLine1&&A.onLine2?[A.x,A.y]:!1)}be.Line=be.extend({initialize(e){this._map=e,this._shape="Line",this.toolbarButtonName="drawPolyline",this._doesSelfIntersect=!1},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._markers=[],this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.polyline([],{...this.options.templineStyle,pmIgnore:!1}),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._layerGroup.addLayer(this._layer),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(Z("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createVertex,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.on(this.options.finishOn,this._finishShape,this),this.options.finishOn==="dblclick"&&(this.tempMapDoubleClickZoomState=this._map.doubleClickZoom._enabled,this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.disable()),this._map.on("mousemove",this._syncHintMarker,this),this._hintMarker.on("move",this._syncHintLine,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this.isRed=!1,this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createVertex,this),this._map.off("mousemove",this._syncHintMarker,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.off(this.options.finishOn,this._finishShape,this),this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.enable(),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_syncHintLine(){let e=this._layer.getLatLngs();if(e.length>0){let t=e[e.length-1];this._hintline.setLatLngs([t,this._hintMarker.getLatLng()])}},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let r=e;r.target=this._hintMarker,this._handleSnapping(r)}this.options.allowSelfIntersection||this._handleSelfIntersection(!0,this._hintMarker.getLatLng());let t=this._layer._defaultShape().slice();t.push(this._hintMarker.getLatLng()),this._change(t)},hasSelfIntersection(){return vr(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersection(e,t){let r=L.polyline(this._layer.getLatLngs());e&&(t||(t=this._hintMarker.getLatLng()),r.addLatLng(t));let i=vr(r.toGeoJSON(15));this._doesSelfIntersect=i.features.length>0,this._doesSelfIntersect?this.isRed||(this.isRed=!0,this._hintline.setStyle({color:"#f00000ff"}),this._fireIntersect(i,this._map,"Draw")):this._hintline.isEmpty()||(this.isRed=!1,this._hintline.setStyle(this.options.hintlineStyle))},_createVertex(e){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,e.latlng),this._doesSelfIntersect))return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),r=this._layer.getLatLngs(),i=r[r.length-1];if(t.equals(r[0])||r.length>0&&t.equals(i)){this._finishShape();return}this._layer._latlngInfo=this._layer._latlngInfo||[],this._layer._latlngInfo.push({latlng:t,snapInfo:this._hintMarker._snapInfo}),this._layer.addLatLng(t);let n=this._createMarker(t);this._setTooltipText(),this._setHintLineAfterNewVertex(t),this._fireVertexAdded(n,void 0,t,"Draw"),this._change(this._layer.getLatLngs()),this.options.finishOn==="snap"&&this._hintMarker._snapped&&this._finishShape(e)},_setHintLineAfterNewVertex(e){this._hintline.setLatLngs([e,e])},_removeLastVertex(){let e=this._markers;if(e.length<=1){this.disable();return}let t=this._layer.getLatLngs(),r=e[e.length-1],{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(e,r);e.pop(),this._layerGroup.removeLayer(r);let n=e[e.length-1],a=t.indexOf(n.getLatLng());t=t.slice(0,a+1),this._layer.setLatLngs(t),this._layer._latlngInfo.pop(),this._syncHintLine(),this._setTooltipText(),this._fireVertexRemoved(r,i,"Draw"),this._change(this._layer.getLatLngs())},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!1),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=1)return;let t=L.polyline(e,this.options.pathOptions);this._setPane(t,"layerPane"),this._finishLayer(t),t.addTo(this._map.pm._getContainingLayer()),this._fireCreate(t),this.options.snappable&&this._cleanupSnapping();let r=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(r))},_createMarker(e){let t=new L.Marker(e,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this._layerGroup.addLayer(t),this._markers.push(t),t.on("click",this._finishShape,this),t},_setTooltipText(){let{length:e}=this._layer.getLatLngs().flat(),t="";e<=1?t=Z("tooltips.continueLine"):t=Z("tooltips.finishLine"),this._hintMarker.setTooltipContent(t)},_change(e){this._fireChange(e,"Draw")},setStyle(){this._layer?.setStyle(this.options.templineStyle),this._hintline?.setStyle(this.options.hintlineStyle)}}),be.Polygon=be.Line.extend({initialize(e){this._map=e,this._shape="Polygon",this.toolbarButtonName="drawPolygon"},enable(e){L.PM.Draw.Line.prototype.enable.call(this,e),this._layer.pm._shape="Polygon"},_createMarker(e){let t=new L.Marker(e,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this._layerGroup.addLayer(t),this._markers.push(t),this._layer.getLatLngs().flat().length===1?(t.on("click",this._finishShape,this),this._tempSnapLayerIndex=this._otherSnapLayers.push(t)-1,this.options.snappable&&this._cleanupSnapping()):t.on("click",()=>1),t},_setTooltipText(){let{length:e}=this._layer.getLatLngs().flat(),t="";e<=2?t=Z("tooltips.continueLine"):t=Z("tooltips.finishPoly"),this._hintMarker.setTooltipContent(t)},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=2)return;let t=L.polygon(e,this.options.pathOptions);this._setPane(t,"layerPane"),this._finishLayer(t),t.addTo(this._map.pm._getContainingLayer()),this._fireCreate(t),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex;let r=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(r))}}),be.Rectangle=be.extend({initialize(e){this._map=e,this._shape="Rectangle",this.toolbarButtonName="drawRectangle"},enable(e){if(L.Util.setOptions(this,e),this._enabled=!0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.rectangle([[0,0],[0,0]],this.options.pathOptions),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._startMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-start-marker"}),draggable:!1,zIndexOffset:-100,opacity:this.options.cursorMarker?1:0}),this._setPane(this._startMarker,"vertexPane"),this._startMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._startMarker),this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:150,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(Z("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this.options.cursorMarker){this._styleMarkers=[];for(let t=0;t<2;t+=1){let r=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-style-marker"}),draggable:!1,zIndexOffset:100});this._setPane(r,"vertexPane"),r._pmTempLayer=!0,this._layerGroup.addLayer(r),this._styleMarkers.push(r)}}this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._placeStartingMarkers,this),this._map.on("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._finishShape,this),this._map.off("click",this._placeStartingMarkers,this),this._map.off("mousemove",this._syncHintMarker,this),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_placeStartingMarkers(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng();L.DomUtil.addClass(this._startMarker._icon,"visible"),this._startMarker.setLatLng(t),this.options.cursorMarker&&this._styleMarkers&&this._styleMarkers.forEach(r=>{L.DomUtil.addClass(r._icon,"visible"),r.setLatLng(t)}),this._map.off("click",this._placeStartingMarkers,this),this._map.on("click",this._finishShape,this),this._hintMarker.setTooltipContent(Z("tooltips.finishRect")),this._setRectangleOrigin()},_setRectangleOrigin(){let e=this._startMarker.getLatLng();e&&(this._layerGroup.addLayer(this._layer),this._layer.setLatLngs([e,e]),this._hintMarker.on("move",this._syncRectangleSize,this))},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let r=e;r.target=this._hintMarker,this._handleSnapping(r)}let t=this._layerGroup&&this._layerGroup.hasLayer(this._layer)?this._layer.getLatLngs():[this._hintMarker.getLatLng()];this._fireChange(t,"Draw")},_syncRectangleSize(){let e=ki(this._startMarker.getLatLng(),this._map),t=ki(this._hintMarker.getLatLng(),this._map),r=L.PM.Utils._getRotatedRectangle(e,t,this.options.rectangleAngle||0,this._map);if(this._layer.setLatLngs(r),this.options.cursorMarker&&this._styleMarkers){let i=[];r.forEach(n=>{!n.equals(e,1e-8)&&!n.equals(t,1e-8)&&i.push(n)}),i.forEach((n,a)=>{try{this._styleMarkers[a].setLatLng(n)}catch{}})}},_findCorners(){let e=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(e[0],e[2],this.options.rectangleAngle||0,this._map)},_finishShape(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),r=this._startMarker.getLatLng();if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||r.equals(t))return;let i=L.rectangle([r,t],this.options.pathOptions);if(this.options.rectangleAngle){let a=L.PM.Utils._getRotatedRectangle(r,t,this.options.rectangleAngle||0,this._map);i.setLatLngs(a),i.pm&&i.pm._setAngle(this.options.rectangleAngle||0)}this._setPane(i,"layerPane"),this._finishLayer(i),i.addTo(this._map.pm._getContainingLayer()),this._fireCreate(i);let n=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(n))},setStyle(){this._layer?.setStyle(this.options.pathOptions)}}),be.CircleMarker=be.extend({initialize(e){this._map=e,this._shape="CircleMarker",this.toolbarButtonName="drawCircleMarker",this._layerIsDragging=!1,this._BaseCircleClass=L.CircleMarker,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._defaultRadius=10},enable(e){if(L.Util.setOptions(this,e),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),this._enabled=!0,this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._map.getContainer().classList.add("geoman-draw-cursor"),this.options[this._editableOption]){let t={};L.extend(t,this.options.templineStyle),t.radius=0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=new this._BaseCircleClass(this._map.getCenter(),t),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._centerMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon"}),draggable:!1,zIndexOffset:100}),this._setPane(this._centerMarker,"vertexPane"),this._centerMarker._pmTempLayer=!0,this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:110,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(Z("tooltips.startCircle"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._map.on("click",this._placeCenterMarker,this)}else this._map.on("click",this._createMarker,this),this._hintMarker=new this._BaseCircleClass(this._map.getCenter(),{radius:this._defaultRadius,...this.options.templineStyle}),this._setPane(this._hintMarker,"layerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this._layer=this._hintMarker,this.options.tooltips&&this._hintMarker.bindTooltip(Z("tooltips.placeCircleMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip();this._map.on("mousemove",this._syncHintMarker,this),this._extendingEnable(),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},_extendingEnable(){!this.options[this._editableOption]&&this.options.markerEditable&&this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.enable()}),this._layer.bringToBack()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this.options[this._editableOption]?(this._map.off("click",this._finishShape,this),this._map.off("click",this._placeCenterMarker,this),this._map.removeLayer(this._layerGroup)):(this._map.off("click",this._createMarker,this),this._extendingDisable(),this._hintMarker.remove()),this._map.off("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},_extendingDisable(){this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.disable()})},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_placeCenterMarker(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng),this._layerGroup.addLayer(this._layer),this._layerGroup.addLayer(this._centerMarker);let t=this._hintMarker.getLatLng();this._centerMarker.setLatLng(t),this._map.off("click",this._placeCenterMarker,this),this._map.on("click",this._finishShape,this),this._placeCircleCenter()},_placeCircleCenter(){let e=this._centerMarker.getLatLng();e&&(this._layer.setLatLng(e),this._hintMarker.on("move",this._syncHintLine,this),this._hintMarker.on("move",this._syncCircleRadius,this),this._hintMarker.setTooltipContent(Z("tooltips.finishCircle")),this._fireCenterPlaced(),this._fireChange(this._layer.getLatLng(),"Draw"))},_syncHintLine(){let e=this._centerMarker.getLatLng(),t=this._getNewDestinationOfHintMarker();this._hintline.setLatLngs([e,t])},_syncCircleRadius(){let e=this._centerMarker.getLatLng(),t=this._hintMarker.getLatLng(),r=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&r<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&r>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(r)},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker()),this.options.snappable){let r=e;r.target=this._hintMarker,this._handleSnapping(r)}this._handleHintMarkerSnapping();let t=this._layerGroup&&this._layerGroup.hasLayer(this._centerMarker)?this._centerMarker.getLatLng():this._hintMarker.getLatLng();this._fireChange(t,"Draw")},isRelevantMarker(e){return e instanceof L.CircleMarker&&!(e instanceof L.Circle)&&e.pm&&!e._pmTempLayer},_createMarker(e){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||!e.latlng||this._layerIsDragging)return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),r=new this._BaseCircleClass(t,{radius:this._defaultRadius,...this.options.pathOptions});this._setPane(r,"layerPane"),this._finishLayer(r),r.addTo(this._map.pm._getContainingLayer()),this._extendingCreateMarker(r),this._fireCreate(r),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},_extendingCreateMarker(e){e.pm&&this.options.markerEditable&&e.pm.enable()},_finishShape(e){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._centerMarker.getLatLng(),r=this._defaultRadius;if(this.options[this._editableOption]){let s=this._hintMarker.getLatLng();r=this._distanceCalculation(t,s),this.options[this._minRadiusOption]&&r<this.options[this._minRadiusOption]?r=this.options[this._minRadiusOption]:this.options[this._maxRadiusOption]&&r>this.options[this._maxRadiusOption]&&(r=this.options[this._maxRadiusOption])}let i={...this.options.pathOptions,radius:r},n=new this._BaseCircleClass(t,i);this._setPane(n,"layerPane"),this._finishLayer(n),n.addTo(this._map.pm._getContainingLayer()),n.pm&&n.pm._updateHiddenPolyCircle(),this._fireCreate(n);let a=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(a))},_getNewDestinationOfHintMarker(){let e=this._hintMarker.getLatLng();if(this.options[this._editableOption]){if(!this._layerGroup.hasLayer(this._centerMarker))return e;let t=this._centerMarker.getLatLng(),r=this._distanceCalculation(t,e);this.options[this._minRadiusOption]&&r<this.options[this._minRadiusOption]?e=Lr(this._map,t,e,this._getMinDistanceInMeter()):this.options[this._maxRadiusOption]&&r>this.options[this._maxRadiusOption]&&(e=Lr(this._map,t,e,this._getMaxDistanceInMeter()))}return e},_getMinDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,this._centerMarker.getLatLng())},_getMaxDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,this._centerMarker.getLatLng())},_handleHintMarkerSnapping(){if(this.options[this._editableOption]){if(this._hintMarker._snapped){let e=this._centerMarker.getLatLng(),t=this._hintMarker.getLatLng(),r=this._distanceCalculation(e,t);this._layerGroup.hasLayer(this._centerMarker)&&(this.options[this._minRadiusOption]&&r<this.options[this._minRadiusOption]?this._hintMarker.setLatLng(this._hintMarker._orgLatLng):this.options[this._maxRadiusOption]&&r>this.options[this._maxRadiusOption]&&this._hintMarker.setLatLng(this._hintMarker._orgLatLng))}this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker())}},setStyle(){let e={};L.extend(e,this.options.templineStyle),this.options[this._editableOption]&&(e.radius=0),this._layer?.setStyle(e),this._hintline?.setStyle(this.options.hintlineStyle)},_distanceCalculation(e,t){return this._map.project(e).distanceTo(this._map.project(t))}}),be.Circle=be.CircleMarker.extend({initialize(e){this._map=e,this._shape="Circle",this.toolbarButtonName="drawCircle",this._BaseCircleClass=L.Circle,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizeableCircle",this._defaultRadius=100},_extendingEnable(){},_extendingDisable(){},_extendingCreateMarker(){},isRelevantMarker(){},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_distanceCalculation(e,t){return this._map.distance(e,t)}});function Ye(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function $e(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Cr(e){return e.type==="Feature"?e.geometry:e}function wi(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Zr(e,t,r){if(e!==null)for(var i,n,a,s,o,l,h,y=0,m=0,w,A=e.type,O=A==="FeatureCollection",I=A==="Feature",G=O?e.features.length:1,J=0;J<G;J++){h=O?e.features[J].geometry:I?e.geometry:e,w=h?h.type==="GeometryCollection":!1,o=w?h.geometries.length:1;for(var _=0;_<o;_++){var b=0,k=0;if(s=w?h.geometries[_]:h,s!==null){l=s.coordinates;var S=s.type;switch(y=0,S){case null:break;case"Point":if(t(l,m,J,b,k)===!1)return!1;m++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(t(l[i],m,J,b,k)===!1)return!1;m++,S==="MultiPoint"&&b++}S==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(n=0;n<l[i].length-y;n++){if(t(l[i][n],m,J,b,k)===!1)return!1;m++}S==="MultiLineString"&&b++,S==="Polygon"&&k++}S==="Polygon"&&b++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(k=0,n=0;n<l[i].length;n++){for(a=0;a<l[i][n].length-y;a++){if(t(l[i][n][a],m,J,b,k)===!1)return!1;m++}k++}b++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(Zr(s.geometries[i],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ir(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function Aa(e,t,r){var i=r;return ir(e,function(n,a){a===0&&r===void 0?i=n:i=t(i,n,a)}),i}function Sa(e,t){var r,i,n,a,s,o,l,h,y,m,w=0,A=e.type==="FeatureCollection",O=e.type==="Feature",I=A?e.features.length:1;for(r=0;r<I;r++){for(o=A?e.features[r].geometry:O?e.geometry:e,h=A?e.features[r].properties:O?e.properties:{},y=A?e.features[r].bbox:O?e.bbox:void 0,m=A?e.features[r].id:O?e.id:void 0,l=o?o.type==="GeometryCollection":!1,s=l?o.geometries.length:1,n=0;n<s;n++){if(a=l?o.geometries[n]:o,a===null){if(t(null,w,h,y,m)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,w,h,y,m)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<a.geometries.length;i++)if(t(a.geometries[i],w,h,y,m)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function Wr(e,t){Sa(e,function(r,i,n,a,s){var o=r===null?null:r.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return t(qt(r,n,{bbox:a,id:s}),i,0)===!1?!1:void 0}var l;switch(o){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var h=0;h<r.coordinates.length;h++){var y=r.coordinates[h],m={type:l,coordinates:y};if(t(qt(m,n),i,h)===!1)return!1}})}function Ta(e){if(!e)throw new Error("geojson is required");var t=[];return Wr(e,function(r){Fa(r,t)}),gt(t)}function Fa(e,t){var r=[],i=e.geometry;if(i!==null){switch(i.type){case"Polygon":r=$e(i);break;case"LineString":r=[$e(i)]}r.forEach(function(n){var a=Ra(n,e.properties);a.forEach(function(s){s.id=t.length,t.push(s)})})}}function Ra(e,t){var r=[];return e.reduce(function(i,n){var a=rr([i,n],t);return a.bbox=Oa(i,n),r.push(a),n}),r}function Oa(e,t){var r=e[0],i=e[1],n=t[0],a=t[1],s=r<n?r:n,o=i<a?i:a,l=r>n?r:n,h=i>a?i:a;return[s,o,l,h]}var Qr=Ta,Ia=Be(bi(),1);function ja(e,t){var r={},i=[];if(e.type==="LineString"&&(e=qt(e)),t.type==="LineString"&&(t=qt(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var n=Di(e,t);return n&&i.push(n),gt(i)}var a=(0,Ia.default)();return a.load(Qr(t)),ir(Qr(e),function(s){ir(a.search(s),function(o){var l=Di(s,o);if(l){var h=$e(l).join(",");r[h]||(r[h]=!0,i.push(l))}})}),gt(i)}function Di(e,t){var r=$e(e),i=$e(t);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var n=r[0][0],a=r[0][1],s=r[1][0],o=r[1][1],l=i[0][0],h=i[0][1],y=i[1][0],m=i[1][1],w=(m-h)*(s-n)-(y-l)*(o-a),A=(y-l)*(a-h)-(m-h)*(n-l),O=(s-n)*(a-h)-(o-a)*(n-l);if(w===0)return null;var I=A/w,G=O/w;if(I>=0&&I<=1&&G>=0&&G<=1){var J=n+I*(s-n),_=a+I*(o-a);return Ht([J,_])}return null}var wt=ja,Pi=Be(bi(),1);function Ga(e,t,r){r===void 0&&(r={});var i=Ye(e),n=Ye(t),a=je(n[1]-i[1]),s=je(n[0]-i[0]),o=je(i[1]),l=je(n[1]),h=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(o)*Math.cos(l);return wa(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),r.units)}var Dt=Ga;function Na(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=Dt(e.slice(0,2),[i,r]),s=Dt(e.slice(0,2),[t,n]);if(a>=s){var o=(r+n)/2;return[t,o-(i-t)/2,i,o+(i-t)/2]}else{var l=(t+i)/2;return[l-(n-r)/2,r,l+(n-r)/2,n]}}var za=Na;function ei(e){var t=[1/0,1/0,-1/0,-1/0];return Zr(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}ei.default=ei;var nr=ei;function Ua(e,t){t===void 0&&(t={});var r=t.precision,i=t.coordinates,n=t.mutate;if(r=r==null||isNaN(r)?6:r,i=i==null||isNaN(i)?3:i,!e)throw new Error("<geojson> is required");if(typeof r!="number")throw new Error("<precision> must be a number");if(typeof i!="number")throw new Error("<coordinates> must be a number");(n===!1||n===void 0)&&(e=JSON.parse(JSON.stringify(e)));var a=Math.pow(10,r);return Zr(e,function(s){Va(s,a,i)}),e}function Va(e,t,r){e.length>r&&e.splice(r,e.length);for(var i=0;i<e.length;i++)e[i]=Math.round(e[i]*t)/t;return e}var Ka=Ua;function Ai(e,t,r){if(r===void 0&&(r={}),r.final===!0)return qa(e,t);var i=Ye(e),n=Ye(t),a=je(i[0]),s=je(n[0]),o=je(i[1]),l=je(n[1]),h=Math.sin(s-a)*Math.cos(l),y=Math.cos(o)*Math.sin(l)-Math.sin(o)*Math.cos(l)*Math.cos(s-a);return Jr(Math.atan2(h,y))}function qa(e,t){var r=Ai(t,e);return r=(r+180)%360,r}function Si(e,t,r,i){i===void 0&&(i={});var n=Ye(e),a=je(n[0]),s=je(n[1]),o=je(r),l=Da(t,i.units),h=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(o)),y=a+Math.atan2(Math.sin(o)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(h)),m=Jr(y),w=Jr(h);return Ht([m,w],i.properties)}function Ha(e,t,r){r===void 0&&(r={});var i=Ht([1/0,1/0],{dist:1/0}),n=0;return Wr(e,function(a){for(var s=$e(a),o=0;o<s.length-1;o++){var l=Ht(s[o]);l.properties.dist=Dt(t,l,r);var h=Ht(s[o+1]);h.properties.dist=Dt(t,h,r);var y=Dt(l,h,r),m=Math.max(l.properties.dist,h.properties.dist),w=Ai(l,h),A=Si(t,m,w+90,r),O=Si(t,m,w-90,r),I=wt(rr([A.geometry.coordinates,O.geometry.coordinates]),rr([l.geometry.coordinates,h.geometry.coordinates])),G=null;I.features.length>0&&(G=I.features[0],G.properties.dist=Dt(t,G,r),G.properties.location=n+Dt(l,G,r)),l.properties.dist<i.properties.dist&&(i=l,i.properties.index=o,i.properties.location=n),h.properties.dist<i.properties.dist&&(i=h,i.properties.index=o+1,i.properties.location=n+y),G&&G.properties.dist<i.properties.dist&&(i=G,i.properties.index=o),n+=y}}),i}var Ya=Ha;function $a(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var r=wi(e),i=wi(t);if(r!=="LineString")throw new Error("line must be LineString");if(i==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(i==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var n=Ka(t,{precision:7});switch(i){case"Point":return ti(e,n);case"MultiPoint":return Ti(e,n);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Ti(e,wt(e,n))}}function Ti(e,t){var r=[],i=(0,Pi.default)();return Wr(t,function(n){if(r.forEach(function(o,l){o.id=l}),!r.length)r=ti(e,n).features,r.forEach(function(o){o.bbox||(o.bbox=za(nr(o)))}),i.load(gt(r));else{var a=i.search(n);if(a.features.length){var s=Fi(n,a);r=r.filter(function(o){return o.id!==s.id}),i.remove(s),ir(ti(s,n),function(o){r.push(o),i.insert(o)})}}}),gt(r)}function ti(e,t){var r=[],i=$e(e)[0],n=$e(e)[e.geometry.coordinates.length-1];if(ri(i,Ye(t))||ri(n,Ye(t)))return gt([e]);var a=(0,Pi.default)(),s=Qr(e);a.load(s);var o=a.search(t);if(!o.features.length)return gt([e]);var l=Fi(t,o),h=[i],y=Aa(s,function(m,w,A){var O=$e(w)[1],I=Ye(t);return A===l.id?(m.push(I),r.push(rr(m)),ri(I,O)?[I]:[I,O]):(m.push(O),m)},h);return y.length>1&&r.push(rr(y)),gt(r)}function Fi(e,t){if(!t.features.length)throw new Error("lines must contain features");if(t.features.length===1)return t.features[0];var r,i=1/0;return ir(t,function(n){var a=Ya(n,e),s=a.properties.dist;s<i&&(r=n,i=s)}),r}function ri(e,t){return e[0]===t[0]&&e[1]===t[1]}var Xa=$a;function xr(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var i=Ye(e),n=Cr(t),a=n.type,s=t.bbox,o=n.coordinates;if(s&&Ja(i,s)===!1)return!1;a==="Polygon"&&(o=[o]);for(var l=!1,h=0;h<o.length&&!l;h++)if(Ri(i,o[h][0],r.ignoreBoundary)){for(var y=!1,m=1;m<o[h].length&&!y;)Ri(i,o[h][m],!r.ignoreBoundary)&&(y=!0),m++;y||(l=!0)}return l}function Ri(e,t,r){var i=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var n=0,a=t.length-1;n<t.length;a=n++){var s=t[n][0],o=t[n][1],l=t[a][0],h=t[a][1],y=e[1]*(s-l)+o*(l-e[0])+h*(e[0]-s)===0&&(s-e[0])*(l-e[0])<=0&&(o-e[1])*(h-e[1])<=0;if(y)return!r;var m=o>e[1]!=h>e[1]&&e[0]<(l-s)*(e[1]-o)/(h-o)+s;m&&(i=!i)}return i}function Ja(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function Za(e,t,r){r===void 0&&(r={});for(var i=Ye(e),n=$e(t),a=0;a<n.length-1;a++){var s=!1;if(r.ignoreEndVertices&&(a===0&&(s="start"),a===n.length-2&&(s="end"),a===0&&a+1===n.length-1&&(s="both")),Wa(n[a],n[a+1],i,s,typeof r.epsilon>"u"?null:r.epsilon))return!0}return!1}function Wa(e,t,r,i,n){var a=r[0],s=r[1],o=e[0],l=e[1],h=t[0],y=t[1],m=r[0]-o,w=r[1]-l,A=h-o,O=y-l,I=m*O-w*A;if(n!==null){if(Math.abs(I)>n)return!1}else if(I!==0)return!1;if(i){if(i==="start")return Math.abs(A)>=Math.abs(O)?A>0?o<a&&a<=h:h<=a&&a<o:O>0?l<s&&s<=y:y<=s&&s<l;if(i==="end")return Math.abs(A)>=Math.abs(O)?A>0?o<=a&&a<h:h<a&&a<=o:O>0?l<=s&&s<y:y<s&&s<=l;if(i==="both")return Math.abs(A)>=Math.abs(O)?A>0?o<a&&a<h:h<a&&a<o:O>0?l<s&&s<y:y<s&&s<l}else return Math.abs(A)>=Math.abs(O)?A>0?o<=a&&a<=h:h<=a&&a<=o:O>0?l<=s&&s<=y:y<=s&&s<=l;return!1}var ar=Za;function Qa(e,t){var r=Cr(e),i=Cr(t),n=r.type,a=i.type,s=r.coordinates,o=i.coordinates;switch(n){case"Point":switch(a){case"Point":return ii(s,o);default:throw new Error("feature2 "+a+" geometry not supported")}case"MultiPoint":switch(a){case"Point":return es(r,i);case"MultiPoint":return ts(r,i);default:throw new Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"Point":return ar(i,r,{ignoreEndVertices:!0});case"LineString":return ns(r,i);case"MultiPoint":return rs(r,i);default:throw new Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Point":return xr(i,r,{ignoreBoundary:!0});case"LineString":return as(r,i);case"Polygon":return ss(r,i);case"MultiPoint":return is(r,i);default:throw new Error("feature2 "+a+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function es(e,t){var r,i=!1;for(r=0;r<e.coordinates.length;r++)if(ii(e.coordinates[r],t.coordinates)){i=!0;break}return i}function ts(e,t){for(var r=0,i=t.coordinates;r<i.length;r++){for(var n=i[r],a=!1,s=0,o=e.coordinates;s<o.length;s++){var l=o[s];if(ii(n,l)){a=!0;break}}if(!a)return!1}return!0}function rs(e,t){for(var r=!1,i=0,n=t.coordinates;i<n.length;i++){var a=n[i];if(ar(a,e,{ignoreEndVertices:!0})&&(r=!0),!ar(a,e))return!1}return!!r}function is(e,t){for(var r=0,i=t.coordinates;r<i.length;r++){var n=i[r];if(!xr(n,e,{ignoreBoundary:!0}))return!1}return!0}function ns(e,t){for(var r=!1,i=0,n=t.coordinates;i<n.length;i++){var a=n[i];if(ar({type:"Point",coordinates:a},e,{ignoreEndVertices:!0})&&(r=!0),!ar({type:"Point",coordinates:a},e,{ignoreEndVertices:!1}))return!1}return r}function as(e,t){var r=!1,i=0,n=nr(e),a=nr(t);if(!Oi(n,a))return!1;for(i;i<t.coordinates.length-1;i++){var s=os(t.coordinates[i],t.coordinates[i+1]);if(xr({type:"Point",coordinates:s},e,{ignoreBoundary:!0})){r=!0;break}}return r}function ss(e,t){if(e.type==="Feature"&&e.geometry===null||t.type==="Feature"&&t.geometry===null)return!1;var r=nr(e),i=nr(t);if(!Oi(r,i))return!1;for(var n=Cr(t).coordinates,a=0,s=n;a<s.length;a++)for(var o=s[a],l=0,h=o;l<h.length;l++){var y=h[l];if(!xr(y,e))return!1}return!0}function Oi(e,t){return!(e[0]>t[0]||e[2]<t[2]||e[1]>t[1]||e[3]<t[3])}function ii(e,t){return e[0]===t[0]&&e[1]===t[1]}function os(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}var us=Be(_r()),Ii=e=>()=>e,ni=e=>{let t=e?(r,i)=>i.minus(r).abs().isLessThanOrEqualTo(e):Ii(!1);return(r,i)=>t(r,i)?0:r.comparedTo(i)};function ls(e){let t=e?(r,i,n,a,s)=>r.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(i).exponentiatedBy(2).plus(s.minus(n).exponentiatedBy(2)).times(e)):Ii(!1);return(r,i,n)=>{let a=r.x,s=r.y,o=n.x,l=n.y,h=s.minus(l).times(i.x.minus(o)).minus(a.minus(o).times(i.y.minus(l)));return t(h,a,s,o,l)?0:h.comparedTo(0)}}var hs=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ai=Math.ceil,Ae=Math.floor,Me="[BigNumber Error] ",ji=Me+"Number primitive has more than 15 significant digits: ",Ge=1e14,H=14,si=9007199254740991,oi=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ft=1e7,fe=1e9;function Gi(e){var t,r,i,n=_.prototype={constructor:_,toString:null,valueOf:null},a=new _(1),s=20,o=4,l=-7,h=21,y=-1e7,m=1e7,w=!1,A=1,O=0,I={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},G="0123456789abcdefghijklmnopqrstuvwxyz",J=!0;function _(u,c){var d,p,g,f,C,v,x,B,E=this;if(!(E instanceof _))return new _(u,c);if(c==null){if(u&&u._isBigNumber===!0){E.s=u.s,!u.c||u.e>m?E.c=E.e=null:u.e<y?E.c=[E.e=0]:(E.e=u.e,E.c=u.c.slice());return}if((v=typeof u=="number")&&u*0==0){if(E.s=1/u<0?(u=-u,-1):1,u===~~u){for(f=0,C=u;C>=10;C/=10,f++);f>m?E.c=E.e=null:(E.e=f,E.c=[u]);return}B=String(u)}else{if(!hs.test(B=String(u)))return i(E,B,v);E.s=B.charCodeAt(0)==45?(B=B.slice(1),-1):1}(f=B.indexOf("."))>-1&&(B=B.replace(".","")),(C=B.search(/e/i))>0?(f<0&&(f=C),f+=+B.slice(C+1),B=B.substring(0,C)):f<0&&(f=B.length)}else{if(ae(c,2,G.length,"Base"),c==10&&J)return E=new _(u),M(E,s+E.e+1,o);if(B=String(u),v=typeof u=="number"){if(u*0!=0)return i(E,B,v,c);if(E.s=1/u<0?(B=B.slice(1),-1):1,_.DEBUG&&B.replace(/^0\.0*|\./,"").length>15)throw Error(ji+u)}else E.s=B.charCodeAt(0)===45?(B=B.slice(1),-1):1;for(d=G.slice(0,c),f=C=0,x=B.length;C<x;C++)if(d.indexOf(p=B.charAt(C))<0){if(p=="."){if(C>f){f=x;continue}}else if(!g&&(B==B.toUpperCase()&&(B=B.toLowerCase())||B==B.toLowerCase()&&(B=B.toUpperCase()))){g=!0,C=-1,f=0;continue}return i(E,String(u),v,c)}v=!1,B=r(B,c,10,E.s),(f=B.indexOf("."))>-1?B=B.replace(".",""):f=B.length}for(C=0;B.charCodeAt(C)===48;C++);for(x=B.length;B.charCodeAt(--x)===48;);if(B=B.slice(C,++x)){if(x-=C,v&&_.DEBUG&&x>15&&(u>si||u!==Ae(u)))throw Error(ji+E.s*u);if((f=f-C-1)>m)E.c=E.e=null;else if(f<y)E.c=[E.e=0];else{if(E.e=f,E.c=[],C=(f+1)%H,f<0&&(C+=H),C<x){for(C&&E.c.push(+B.slice(0,C)),x-=H;C<x;)E.c.push(+B.slice(C,C+=H));C=H-(B=B.slice(C)).length}else C-=x;for(;C--;B+="0");E.c.push(+B)}}else E.c=[E.e=0]}_.clone=Gi,_.ROUND_UP=0,_.ROUND_DOWN=1,_.ROUND_CEIL=2,_.ROUND_FLOOR=3,_.ROUND_HALF_UP=4,_.ROUND_HALF_DOWN=5,_.ROUND_HALF_EVEN=6,_.ROUND_HALF_CEIL=7,_.ROUND_HALF_FLOOR=8,_.EUCLID=9,_.config=_.set=function(u){var c,d;if(u!=null)if(typeof u=="object"){if(u.hasOwnProperty(c="DECIMAL_PLACES")&&(d=u[c],ae(d,0,fe,c),s=d),u.hasOwnProperty(c="ROUNDING_MODE")&&(d=u[c],ae(d,0,8,c),o=d),u.hasOwnProperty(c="EXPONENTIAL_AT")&&(d=u[c],d&&d.pop?(ae(d[0],-fe,0,c),ae(d[1],0,fe,c),l=d[0],h=d[1]):(ae(d,-fe,fe,c),l=-(h=d<0?-d:d))),u.hasOwnProperty(c="RANGE"))if(d=u[c],d&&d.pop)ae(d[0],-fe,-1,c),ae(d[1],1,fe,c),y=d[0],m=d[1];else if(ae(d,-fe,fe,c),d)y=-(m=d<0?-d:d);else throw Error(Me+c+" cannot be zero: "+d);if(u.hasOwnProperty(c="CRYPTO"))if(d=u[c],d===!!d)if(d)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))w=d;else throw w=!d,Error(Me+"crypto unavailable");else w=d;else throw Error(Me+c+" not true or false: "+d);if(u.hasOwnProperty(c="MODULO_MODE")&&(d=u[c],ae(d,0,9,c),A=d),u.hasOwnProperty(c="POW_PRECISION")&&(d=u[c],ae(d,0,fe,c),O=d),u.hasOwnProperty(c="FORMAT"))if(d=u[c],typeof d=="object")I=d;else throw Error(Me+c+" not an object: "+d);if(u.hasOwnProperty(c="ALPHABET"))if(d=u[c],typeof d=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(d))J=d.slice(0,10)=="0123456789",G=d;else throw Error(Me+c+" invalid: "+d)}else throw Error(Me+"Object expected: "+u);return{DECIMAL_PLACES:s,ROUNDING_MODE:o,EXPONENTIAL_AT:[l,h],RANGE:[y,m],CRYPTO:w,MODULO_MODE:A,POW_PRECISION:O,FORMAT:I,ALPHABET:G}},_.isBigNumber=function(u){if(!u||u._isBigNumber!==!0)return!1;if(!_.DEBUG)return!0;var c,d,p=u.c,g=u.e,f=u.s;e:if({}.toString.call(p)=="[object Array]"){if((f===1||f===-1)&&g>=-fe&&g<=fe&&g===Ae(g)){if(p[0]===0){if(g===0&&p.length===1)return!0;break e}if(c=(g+1)%H,c<1&&(c+=H),String(p[0]).length==c){for(c=0;c<p.length;c++)if(d=p[c],d<0||d>=Ge||d!==Ae(d))break e;if(d!==0)return!0}}}else if(p===null&&g===null&&(f===null||f===1||f===-1))return!0;throw Error(Me+"Invalid BigNumber: "+u)},_.maximum=_.max=function(){return k(arguments,-1)},_.minimum=_.min=function(){return k(arguments,1)},_.random=function(){var u=9007199254740992,c=Math.random()*u&2097151?function(){return Ae(Math.random()*u)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(d){var p,g,f,C,v,x=0,B=[],E=new _(a);if(d==null?d=s:ae(d,0,fe),C=ai(d/H),w)if(crypto.getRandomValues){for(p=crypto.getRandomValues(new Uint32Array(C*=2));x<C;)v=p[x]*131072+(p[x+1]>>>11),v>=9e15?(g=crypto.getRandomValues(new Uint32Array(2)),p[x]=g[0],p[x+1]=g[1]):(B.push(v%1e14),x+=2);x=C/2}else if(crypto.randomBytes){for(p=crypto.randomBytes(C*=7);x<C;)v=(p[x]&31)*281474976710656+p[x+1]*1099511627776+p[x+2]*4294967296+p[x+3]*16777216+(p[x+4]<<16)+(p[x+5]<<8)+p[x+6],v>=9e15?crypto.randomBytes(7).copy(p,x):(B.push(v%1e14),x+=7);x=C/7}else throw w=!1,Error(Me+"crypto unavailable");if(!w)for(;x<C;)v=c(),v<9e15&&(B[x++]=v%1e14);for(C=B[--x],d%=H,C&&d&&(v=oi[H-d],B[x]=Ae(C/v)*v);B[x]===0;B.pop(),x--);if(x<0)B=[f=0];else{for(f=-1;B[0]===0;B.splice(0,1),f-=H);for(x=1,v=B[0];v>=10;v/=10,x++);x<H&&(f-=H-x)}return E.e=f,E.c=B,E}}(),_.sum=function(){for(var u=1,c=arguments,d=new _(c[0]);u<c.length;)d=d.plus(c[u++]);return d},r=function(){var u="0123456789";function c(d,p,g,f){for(var C,v=[0],x,B=0,E=d.length;B<E;){for(x=v.length;x--;v[x]*=p);for(v[0]+=f.indexOf(d.charAt(B++)),C=0;C<v.length;C++)v[C]>g-1&&(v[C+1]==null&&(v[C+1]=0),v[C+1]+=v[C]/g|0,v[C]%=g)}return v.reverse()}return function(d,p,g,f,C){var v,x,B,E,R,j,N,V,Q=d.indexOf("."),ee=s,W=o;for(Q>=0&&(E=O,O=0,d=d.replace(".",""),V=new _(p),j=V.pow(d.length-Q),O=E,V.c=c(at(Te(j.c),j.e,"0"),10,g,u),V.e=V.c.length),N=c(d,p,g,C?(v=G,u):(v=u,G)),B=E=N.length;N[--E]==0;N.pop());if(!N[0])return v.charAt(0);if(Q<0?--B:(j.c=N,j.e=B,j.s=f,j=t(j,V,ee,W,g),N=j.c,R=j.r,B=j.e),x=B+ee+1,Q=N[x],E=g/2,R=R||x<0||N[x+1]!=null,R=W<4?(Q!=null||R)&&(W==0||W==(j.s<0?3:2)):Q>E||Q==E&&(W==4||R||W==6&&N[x-1]&1||W==(j.s<0?8:7)),x<1||!N[0])d=R?at(v.charAt(1),-ee,v.charAt(0)):v.charAt(0);else{if(N.length=x,R)for(--g;++N[--x]>g;)N[x]=0,x||(++B,N=[1].concat(N));for(E=N.length;!N[--E];);for(Q=0,d="";Q<=E;d+=v.charAt(N[Q++]));d=at(d,B,v.charAt(0))}return d}}(),t=function(){function u(p,g,f){var C,v,x,B,E=0,R=p.length,j=g%ft,N=g/ft|0;for(p=p.slice();R--;)x=p[R]%ft,B=p[R]/ft|0,C=N*x+B*j,v=j*x+C%ft*ft+E,E=(v/f|0)+(C/ft|0)+N*B,p[R]=v%f;return E&&(p=[E].concat(p)),p}function c(p,g,f,C){var v,x;if(f!=C)x=f>C?1:-1;else for(v=x=0;v<f;v++)if(p[v]!=g[v]){x=p[v]>g[v]?1:-1;break}return x}function d(p,g,f,C){for(var v=0;f--;)p[f]-=v,v=p[f]<g[f]?1:0,p[f]=v*C+p[f]-g[f];for(;!p[0]&&p.length>1;p.splice(0,1));}return function(p,g,f,C,v){var x,B,E,R,j,N,V,Q,ee,W,te,Ce,Fr,ci,pi,Ze,lr,Fe=p.s==g.s?1:-1,xe=p.c,se=g.c;if(!xe||!xe[0]||!se||!se[0])return new _(!p.s||!g.s||(xe?se&&xe[0]==se[0]:!se)?NaN:xe&&xe[0]==0||!se?Fe*0:Fe/0);for(Q=new _(Fe),ee=Q.c=[],B=p.e-g.e,Fe=f+B+1,v||(v=Ge,B=Se(p.e/H)-Se(g.e/H),Fe=Fe/H|0),E=0;se[E]==(xe[E]||0);E++);if(se[E]>(xe[E]||0)&&B--,Fe<0)ee.push(1),R=!0;else{for(ci=xe.length,Ze=se.length,E=0,Fe+=2,j=Ae(v/(se[0]+1)),j>1&&(se=u(se,j,v),xe=u(xe,j,v),Ze=se.length,ci=xe.length),Fr=Ze,W=xe.slice(0,Ze),te=W.length;te<Ze;W[te++]=0);lr=se.slice(),lr=[0].concat(lr),pi=se[0],se[1]>=v/2&&pi++;do{if(j=0,x=c(se,W,Ze,te),x<0){if(Ce=W[0],Ze!=te&&(Ce=Ce*v+(W[1]||0)),j=Ae(Ce/pi),j>1)for(j>=v&&(j=v-1),N=u(se,j,v),V=N.length,te=W.length;c(N,W,V,te)==1;)j--,d(N,Ze<V?lr:se,V,v),V=N.length,x=1;else j==0&&(x=j=1),N=se.slice(),V=N.length;if(V<te&&(N=[0].concat(N)),d(W,N,te,v),te=W.length,x==-1)for(;c(se,W,Ze,te)<1;)j++,d(W,Ze<te?lr:se,te,v),te=W.length}else x===0&&(j++,W=[0]);ee[E++]=j,W[0]?W[te++]=xe[Fr]||0:(W=[xe[Fr]],te=1)}while((Fr++<ci||W[0]!=null)&&Fe--);R=W[0]!=null,ee[0]||ee.splice(0,1)}if(v==Ge){for(E=1,Fe=ee[0];Fe>=10;Fe/=10,E++);M(Q,f+(Q.e=E+B*H-1)+1,C,R)}else Q.e=B,Q.r=+R;return Q}}();function b(u,c,d,p){var g,f,C,v,x;if(d==null?d=o:ae(d,0,8),!u.c)return u.toString();if(g=u.c[0],C=u.e,c==null)x=Te(u.c),x=p==1||p==2&&(C<=l||C>=h)?Mr(x,C):at(x,C,"0");else if(u=M(new _(u),c,d),f=u.e,x=Te(u.c),v=x.length,p==1||p==2&&(c<=f||f<=l)){for(;v<c;x+="0",v++);x=Mr(x,f)}else if(c-=C,x=at(x,f,"0"),f+1>v){if(--c>0)for(x+=".";c--;x+="0");}else if(c+=f-v,c>0)for(f+1==v&&(x+=".");c--;x+="0");return u.s<0&&g?"-"+x:x}function k(u,c){for(var d,p,g=1,f=new _(u[0]);g<u.length;g++)p=new _(u[g]),(!p.s||(d=Pt(f,p))===c||d===0&&f.s===c)&&(f=p);return f}function S(u,c,d){for(var p=1,g=c.length;!c[--g];c.pop());for(g=c[0];g>=10;g/=10,p++);return(d=p+d*H-1)>m?u.c=u.e=null:d<y?u.c=[u.e=0]:(u.e=d,u.c=c),u}i=function(){var u=/^(-?)0([xbo])(?=\w[\w.]*$)/i,c=/^([^.]+)\.$/,d=/^\.([^.]+)$/,p=/^-?(Infinity|NaN)$/,g=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(f,C,v,x){var B,E=v?C:C.replace(g,"");if(p.test(E))f.s=isNaN(E)?null:E<0?-1:1;else{if(!v&&(E=E.replace(u,function(R,j,N){return B=(N=N.toLowerCase())=="x"?16:N=="b"?2:8,!x||x==B?j:R}),x&&(B=x,E=E.replace(c,"$1").replace(d,"0.$1")),C!=E))return new _(E,B);if(_.DEBUG)throw Error(Me+"Not a"+(x?" base "+x:"")+" number: "+C);f.s=null}f.c=f.e=null}}();function M(u,c,d,p){var g,f,C,v,x,B,E,R=u.c,j=oi;if(R){e:{for(g=1,v=R[0];v>=10;v/=10,g++);if(f=c-g,f<0)f+=H,C=c,x=R[B=0],E=Ae(x/j[g-C-1]%10);else if(B=ai((f+1)/H),B>=R.length)if(p){for(;R.length<=B;R.push(0));x=E=0,g=1,f%=H,C=f-H+1}else break e;else{for(x=v=R[B],g=1;v>=10;v/=10,g++);f%=H,C=f-H+g,E=C<0?0:Ae(x/j[g-C-1]%10)}if(p=p||c<0||R[B+1]!=null||(C<0?x:x%j[g-C-1]),p=d<4?(E||p)&&(d==0||d==(u.s<0?3:2)):E>5||E==5&&(d==4||p||d==6&&(f>0?C>0?x/j[g-C]:0:R[B-1])%10&1||d==(u.s<0?8:7)),c<1||!R[0])return R.length=0,p?(c-=u.e+1,R[0]=j[(H-c%H)%H],u.e=-c||0):R[0]=u.e=0,u;if(f==0?(R.length=B,v=1,B--):(R.length=B+1,v=j[H-f],R[B]=C>0?Ae(x/j[g-C]%j[C])*v:0),p)for(;;)if(B==0){for(f=1,C=R[0];C>=10;C/=10,f++);for(C=R[0]+=v,v=1;C>=10;C/=10,v++);f!=v&&(u.e++,R[0]==Ge&&(R[0]=1));break}else{if(R[B]+=v,R[B]!=Ge)break;R[B--]=0,v=1}for(f=R.length;R[--f]===0;R.pop());}u.e>m?u.c=u.e=null:u.e<y&&(u.c=[u.e=0])}return u}function P(u){var c,d=u.e;return d===null?u.toString():(c=Te(u.c),c=d<=l||d>=h?Mr(c,d):at(c,d,"0"),u.s<0?"-"+c:c)}return n.absoluteValue=n.abs=function(){var u=new _(this);return u.s<0&&(u.s=1),u},n.comparedTo=function(u,c){return Pt(this,new _(u,c))},n.decimalPlaces=n.dp=function(u,c){var d,p,g,f=this;if(u!=null)return ae(u,0,fe),c==null?c=o:ae(c,0,8),M(new _(f),u+f.e+1,c);if(!(d=f.c))return null;if(p=((g=d.length-1)-Se(this.e/H))*H,g=d[g])for(;g%10==0;g/=10,p--);return p<0&&(p=0),p},n.dividedBy=n.div=function(u,c){return t(this,new _(u,c),s,o)},n.dividedToIntegerBy=n.idiv=function(u,c){return t(this,new _(u,c),0,1)},n.exponentiatedBy=n.pow=function(u,c){var d,p,g,f,C,v,x,B,E,R=this;if(u=new _(u),u.c&&!u.isInteger())throw Error(Me+"Exponent not an integer: "+P(u));if(c!=null&&(c=new _(c)),v=u.e>14,!R.c||!R.c[0]||R.c[0]==1&&!R.e&&R.c.length==1||!u.c||!u.c[0])return E=new _(Math.pow(+P(R),v?u.s*(2-kr(u)):+P(u))),c?E.mod(c):E;if(x=u.s<0,c){if(c.c?!c.c[0]:!c.s)return new _(NaN);p=!x&&R.isInteger()&&c.isInteger(),p&&(R=R.mod(c))}else{if(u.e>9&&(R.e>0||R.e<-1||(R.e==0?R.c[0]>1||v&&R.c[1]>=24e7:R.c[0]<8e13||v&&R.c[0]<=9999975e7)))return f=R.s<0&&kr(u)?-0:0,R.e>-1&&(f=1/f),new _(x?1/f:f);O&&(f=ai(O/H+2))}for(v?(d=new _(.5),x&&(u.s=1),B=kr(u)):(g=Math.abs(+P(u)),B=g%2),E=new _(a);;){if(B){if(E=E.times(R),!E.c)break;f?E.c.length>f&&(E.c.length=f):p&&(E=E.mod(c))}if(g){if(g=Ae(g/2),g===0)break;B=g%2}else if(u=u.times(d),M(u,u.e+1,1),u.e>14)B=kr(u);else{if(g=+P(u),g===0)break;B=g%2}R=R.times(R),f?R.c&&R.c.length>f&&(R.c.length=f):p&&(R=R.mod(c))}return p?E:(x&&(E=a.div(E)),c?E.mod(c):f?M(E,O,o,C):E)},n.integerValue=function(u){var c=new _(this);return u==null?u=o:ae(u,0,8),M(c,c.e+1,u)},n.isEqualTo=n.eq=function(u,c){return Pt(this,new _(u,c))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(u,c){return Pt(this,new _(u,c))>0},n.isGreaterThanOrEqualTo=n.gte=function(u,c){return(c=Pt(this,new _(u,c)))===1||c===0},n.isInteger=function(){return!!this.c&&Se(this.e/H)>this.c.length-2},n.isLessThan=n.lt=function(u,c){return Pt(this,new _(u,c))<0},n.isLessThanOrEqualTo=n.lte=function(u,c){return(c=Pt(this,new _(u,c)))===-1||c===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(u,c){var d,p,g,f,C=this,v=C.s;if(u=new _(u,c),c=u.s,!v||!c)return new _(NaN);if(v!=c)return u.s=-c,C.plus(u);var x=C.e/H,B=u.e/H,E=C.c,R=u.c;if(!x||!B){if(!E||!R)return E?(u.s=-c,u):new _(R?C:NaN);if(!E[0]||!R[0])return R[0]?(u.s=-c,u):new _(E[0]?C:o==3?-0:0)}if(x=Se(x),B=Se(B),E=E.slice(),v=x-B){for((f=v<0)?(v=-v,g=E):(B=x,g=R),g.reverse(),c=v;c--;g.push(0));g.reverse()}else for(p=(f=(v=E.length)<(c=R.length))?v:c,v=c=0;c<p;c++)if(E[c]!=R[c]){f=E[c]<R[c];break}if(f&&(g=E,E=R,R=g,u.s=-u.s),c=(p=R.length)-(d=E.length),c>0)for(;c--;E[d++]=0);for(c=Ge-1;p>v;){if(E[--p]<R[p]){for(d=p;d&&!E[--d];E[d]=c);--E[d],E[p]+=Ge}E[p]-=R[p]}for(;E[0]==0;E.splice(0,1),--B);return E[0]?S(u,E,B):(u.s=o==3?-1:1,u.c=[u.e=0],u)},n.modulo=n.mod=function(u,c){var d,p,g=this;return u=new _(u,c),!g.c||!u.s||u.c&&!u.c[0]?new _(NaN):!u.c||g.c&&!g.c[0]?new _(g):(A==9?(p=u.s,u.s=1,d=t(g,u,0,3),u.s=p,d.s*=p):d=t(g,u,0,A),u=g.minus(d.times(u)),!u.c[0]&&A==1&&(u.s=g.s),u)},n.multipliedBy=n.times=function(u,c){var d,p,g,f,C,v,x,B,E,R,j,N,V,Q,ee,W=this,te=W.c,Ce=(u=new _(u,c)).c;if(!te||!Ce||!te[0]||!Ce[0])return!W.s||!u.s||te&&!te[0]&&!Ce||Ce&&!Ce[0]&&!te?u.c=u.e=u.s=null:(u.s*=W.s,!te||!Ce?u.c=u.e=null:(u.c=[0],u.e=0)),u;for(p=Se(W.e/H)+Se(u.e/H),u.s*=W.s,x=te.length,R=Ce.length,x<R&&(V=te,te=Ce,Ce=V,g=x,x=R,R=g),g=x+R,V=[];g--;V.push(0));for(Q=Ge,ee=ft,g=R;--g>=0;){for(d=0,j=Ce[g]%ee,N=Ce[g]/ee|0,C=x,f=g+C;f>g;)B=te[--C]%ee,E=te[C]/ee|0,v=N*B+E*j,B=j*B+v%ee*ee+V[f]+d,d=(B/Q|0)+(v/ee|0)+N*E,V[f--]=B%Q;V[f]=d}return d?++p:V.splice(0,1),S(u,V,p)},n.negated=function(){var u=new _(this);return u.s=-u.s||null,u},n.plus=function(u,c){var d,p=this,g=p.s;if(u=new _(u,c),c=u.s,!g||!c)return new _(NaN);if(g!=c)return u.s=-c,p.minus(u);var f=p.e/H,C=u.e/H,v=p.c,x=u.c;if(!f||!C){if(!v||!x)return new _(g/0);if(!v[0]||!x[0])return x[0]?u:new _(v[0]?p:g*0)}if(f=Se(f),C=Se(C),v=v.slice(),g=f-C){for(g>0?(C=f,d=x):(g=-g,d=v),d.reverse();g--;d.push(0));d.reverse()}for(g=v.length,c=x.length,g-c<0&&(d=x,x=v,v=d,c=g),g=0;c;)g=(v[--c]=v[c]+x[c]+g)/Ge|0,v[c]=Ge===v[c]?0:v[c]%Ge;return g&&(v=[g].concat(v),++C),S(u,v,C)},n.precision=n.sd=function(u,c){var d,p,g,f=this;if(u!=null&&u!==!!u)return ae(u,1,fe),c==null?c=o:ae(c,0,8),M(new _(f),u,c);if(!(d=f.c))return null;if(g=d.length-1,p=g*H+1,g=d[g]){for(;g%10==0;g/=10,p--);for(g=d[0];g>=10;g/=10,p++);}return u&&f.e+1>p&&(p=f.e+1),p},n.shiftedBy=function(u){return ae(u,-si,si),this.times("1e"+u)},n.squareRoot=n.sqrt=function(){var u,c,d,p,g,f=this,C=f.c,v=f.s,x=f.e,B=s+4,E=new _("0.5");if(v!==1||!C||!C[0])return new _(!v||v<0&&(!C||C[0])?NaN:C?f:1/0);if(v=Math.sqrt(+P(f)),v==0||v==1/0?(c=Te(C),(c.length+x)%2==0&&(c+="0"),v=Math.sqrt(+c),x=Se((x+1)/2)-(x<0||x%2),v==1/0?c="5e"+x:(c=v.toExponential(),c=c.slice(0,c.indexOf("e")+1)+x),d=new _(c)):d=new _(v+""),d.c[0]){for(x=d.e,v=x+B,v<3&&(v=0);;)if(g=d,d=E.times(g.plus(t(f,g,B,1))),Te(g.c).slice(0,v)===(c=Te(d.c)).slice(0,v))if(d.e<x&&--v,c=c.slice(v-3,v+1),c=="9999"||!p&&c=="4999"){if(!p&&(M(g,g.e+s+2,0),g.times(g).eq(f))){d=g;break}B+=4,v+=4,p=1}else{(!+c||!+c.slice(1)&&c.charAt(0)=="5")&&(M(d,d.e+s+2,1),u=!d.times(d).eq(f));break}}return M(d,d.e+s+1,o,u)},n.toExponential=function(u,c){return u!=null&&(ae(u,0,fe),u++),b(this,u,c,1)},n.toFixed=function(u,c){return u!=null&&(ae(u,0,fe),u=u+this.e+1),b(this,u,c)},n.toFormat=function(u,c,d){var p,g=this;if(d==null)u!=null&&c&&typeof c=="object"?(d=c,c=null):u&&typeof u=="object"?(d=u,u=c=null):d=I;else if(typeof d!="object")throw Error(Me+"Argument not an object: "+d);if(p=g.toFixed(u,c),g.c){var f,C=p.split("."),v=+d.groupSize,x=+d.secondaryGroupSize,B=d.groupSeparator||"",E=C[0],R=C[1],j=g.s<0,N=j?E.slice(1):E,V=N.length;if(x&&(f=v,v=x,x=f,V-=f),v>0&&V>0){for(f=V%v||v,E=N.substr(0,f);f<V;f+=v)E+=B+N.substr(f,v);x>0&&(E+=B+N.slice(f)),j&&(E="-"+E)}p=R?E+(d.decimalSeparator||"")+((x=+d.fractionGroupSize)?R.replace(new RegExp("\\d{"+x+"}\\B","g"),"$&"+(d.fractionGroupSeparator||"")):R):E}return(d.prefix||"")+p+(d.suffix||"")},n.toFraction=function(u){var c,d,p,g,f,C,v,x,B,E,R,j,N=this,V=N.c;if(u!=null&&(v=new _(u),!v.isInteger()&&(v.c||v.s!==1)||v.lt(a)))throw Error(Me+"Argument "+(v.isInteger()?"out of range: ":"not an integer: ")+P(v));if(!V)return new _(N);for(c=new _(a),B=d=new _(a),p=x=new _(a),j=Te(V),f=c.e=j.length-N.e-1,c.c[0]=oi[(C=f%H)<0?H+C:C],u=!u||v.comparedTo(c)>0?f>0?c:B:v,C=m,m=1/0,v=new _(j),x.c[0]=0;E=t(v,c,0,1),g=d.plus(E.times(p)),g.comparedTo(u)!=1;)d=p,p=g,B=x.plus(E.times(g=B)),x=g,c=v.minus(E.times(g=c)),v=g;return g=t(u.minus(d),p,0,1),x=x.plus(g.times(B)),d=d.plus(g.times(p)),x.s=B.s=N.s,f=f*2,R=t(B,p,f,o).minus(N).abs().comparedTo(t(x,d,f,o).minus(N).abs())<1?[B,p]:[x,d],m=C,R},n.toNumber=function(){return+P(this)},n.toPrecision=function(u,c){return u!=null&&ae(u,1,fe),b(this,u,c,2)},n.toString=function(u){var c,d=this,p=d.s,g=d.e;return g===null?p?(c="Infinity",p<0&&(c="-"+c)):c="NaN":(u==null?c=g<=l||g>=h?Mr(Te(d.c),g):at(Te(d.c),g,"0"):u===10&&J?(d=M(new _(d),s+g+1,o),c=at(Te(d.c),d.e,"0")):(ae(u,2,G.length,"Base"),c=r(at(Te(d.c),g,"0"),10,u,p,!0)),p<0&&d.c[0]&&(c="-"+c)),c},n.valueOf=n.toJSON=function(){return P(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,e!=null&&_.set(e),_}function Se(e){var t=e|0;return e>0||e===t?t:t-1}function Te(e){for(var t,r,i=1,n=e.length,a=e[0]+"";i<n;){for(t=e[i++]+"",r=H-t.length;r--;t="0"+t);a+=t}for(n=a.length;a.charCodeAt(--n)===48;);return a.slice(0,n+1||1)}function Pt(e,t){var r,i,n=e.c,a=t.c,s=e.s,o=t.s,l=e.e,h=t.e;if(!s||!o)return null;if(r=n&&!n[0],i=a&&!a[0],r||i)return r?i?0:-o:s;if(s!=o)return s;if(r=s<0,i=l==h,!n||!a)return i?0:!n^r?1:-1;if(!i)return l>h^r?1:-1;for(o=(l=n.length)<(h=a.length)?l:h,s=0;s<o;s++)if(n[s]!=a[s])return n[s]>a[s]^r?1:-1;return l==h?0:l>h^r?1:-1}function ae(e,t,r,i){if(e<t||e>r||e!==Ae(e))throw Error(Me+(i||"Argument")+(typeof e=="number"?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function kr(e){var t=e.c.length-1;return Se(e.e/H)==t&&e.c[t]%2!=0}function Mr(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function at(e,t,r){var i,n;if(t<0){for(n=r+".";++t;n+=r);e=n+e}else if(i=e.length,++t>i){for(n=r,t-=i;--t;n+=r);e+=n}else t<i&&(e=e.slice(0,t)+"."+e.slice(t));return e}var cs=Gi(),Xe=cs,ps=class{key;left=null;right=null;constructor(e){this.key=e}},sr=class extends ps{constructor(e){super(e)}},ds=class{size=0;modificationCount=0;splayCount=0;splay(e){let t=this.root;if(t==null)return this.compare(e,e),-1;let r=null,i=null,n=null,a=null,s=t,o=this.compare,l;for(;;)if(l=o(s.key,e),l>0){let h=s.left;if(h==null||(l=o(h.key,e),l>0&&(s.left=h.right,h.right=s,s=h,h=s.left,h==null)))break;r==null?i=s:r.left=s,r=s,s=h}else if(l<0){let h=s.right;if(h==null||(l=o(h.key,e),l<0&&(s.right=h.left,h.left=s,s=h,h=s.right,h==null)))break;n==null?a=s:n.right=s,n=s,s=h}else break;return n!=null&&(n.right=s.left,s.left=a),r!=null&&(r.left=s.right,s.right=i),this.root!==s&&(this.root=s,this.splayCount++),l}splayMin(e){let t=e,r=t.left;for(;r!=null;){let i=r;t.left=i.right,i.right=t,t=i,r=t.left}return t}splayMax(e){let t=e,r=t.right;for(;r!=null;){let i=r;t.right=i.left,i.left=t,t=i,r=t.right}return t}_delete(e){if(this.root==null||this.splay(e)!=0)return null;let t=this.root,r=t,i=t.left;if(this.size--,i==null)this.root=t.right;else{let n=t.right;t=this.splayMax(i),t.right=n,this.root=t}return this.modificationCount++,r}addNewRoot(e,t){this.size++,this.modificationCount++;let r=this.root;if(r==null){this.root=e;return}t<0?(e.left=r,e.right=r.right,r.right=null):(e.right=r,e.left=r.left,r.left=null),this.root=e}_first(){let e=this.root;return e==null?null:(this.root=this.splayMin(e),this.root)}_last(){let e=this.root;return e==null?null:(this.root=this.splayMax(e),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(e){return this.validKey(e)&&this.splay(e)==0}defaultCompare(){return(e,t)=>e<t?-1:e>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:e=>{this.root=e},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:e=>{this.splayCount=e},splay:e=>this.splay(e),has:e=>this.has(e)}}},Er=class hr extends ds{root=null;compare;validKey;constructor(t,r){super(),this.compare=t??this.defaultCompare(),this.validKey=r??(i=>i!=null&&i!=null)}delete(t){return this.validKey(t)?this._delete(t)!=null:!1}deleteAll(t){for(let r of t)this.delete(r)}forEach(t){let r=this[Symbol.iterator](),i;for(;i=r.next(),!i.done;)t(i.value,i.value,this)}add(t){let r=this.splay(t);return r!=0&&this.addNewRoot(new sr(t),r),this}addAndReturn(t){let r=this.splay(t);return r!=0&&this.addNewRoot(new sr(t),r),this.root.key}addAll(t){for(let r of t)this.add(r)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)<0)return this.root.key;let r=this.root.left;if(r==null)return null;let i=r.right;for(;i!=null;)r=i,i=r.right;return r.key}firstAfter(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)>0)return this.root.key;let r=this.root.right;if(r==null)return null;let i=r.left;for(;i!=null;)r=i,i=r.left;return r.key}retainAll(t){let r=new hr(this.compare,this.validKey),i=this.modificationCount;for(let n of t){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(n)&&this.splay(n)==0&&r.add(this.root.key)}r.size!=this.size&&(this.root=r.root,this.size=r.size,this.modificationCount++)}lookup(t){return!this.validKey(t)||this.splay(t)!=0?null:this.root.key}intersection(t){let r=new hr(this.compare,this.validKey);for(let i of this)t.has(i)&&r.add(i);return r}difference(t){let r=new hr(this.compare,this.validKey);for(let i of this)t.has(i)||r.add(i);return r}union(t){let r=this.clone();return r.addAll(t),r}clone(){let t=new hr(this.compare,this.validKey);return t.size=this.size,t.root=this.copyNode(this.root),t}copyNode(t){if(t==null)return null;function r(n,a){let s,o;do{if(s=n.left,o=n.right,s!=null){let l=new sr(s.key);a.left=l,r(s,l)}if(o!=null){let l=new sr(o.key);a.right=l,n=o,a=l}}while(o!=null)}let i=new sr(t.key);return r(t,i),i}toSet(){return this.clone()}entries(){return new fs(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new gs(this.wrap())}[Symbol.toStringTag]="[object Set]"},Ni=class{tree;path=new Array;modificationCount=null;splayCount;constructor(e){this.tree=e,this.splayCount=e.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let e=this.path[this.path.length-1];return this.getValue(e)}rebuildPath(e){this.path.splice(0,this.path.length),this.tree.splay(e),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(e){for(;e!=null;)this.path.push(e),e=e.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let r=this.tree.getRoot();for(;r!=null;)this.path.push(r),r=r.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let e=this.path[this.path.length-1],t=e.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===e;)e=this.path.pop();return this.path.length>0}},gs=class extends Ni{getValue(e){return e.key}},fs=class extends Ni{getValue(e){return[e.key,e.key]}},ms=e=>e,_s=e=>{if(e){let t=new Er(ni(e)),r=new Er(ni(e)),i=(a,s)=>s.addAndReturn(a),n=a=>({x:i(a.x,t),y:i(a.y,r)});return n({x:new Xe(0),y:new Xe(0)}),n}return ms},ui=e=>({set:t=>{st=ui(t)},reset:()=>ui(e),compare:ni(e),snap:_s(e),orient:ls(e)}),st=ui(),or=(e,t)=>e.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(e.ur.x)&&e.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(e.ur.y),li=(e,t)=>{if(t.ur.x.isLessThan(e.ll.x)||e.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(e.ll.y)||e.ur.y.isLessThan(t.ll.y))return null;let r=e.ll.x.isLessThan(t.ll.x)?t.ll.x:e.ll.x,i=e.ur.x.isLessThan(t.ur.x)?e.ur.x:t.ur.x,n=e.ll.y.isLessThan(t.ll.y)?t.ll.y:e.ll.y,a=e.ur.y.isLessThan(t.ur.y)?e.ur.y:t.ur.y;return{ll:{x:r,y:n},ur:{x:i,y:a}}},Br=(e,t)=>e.x.times(t.y).minus(e.y.times(t.x)),zi=(e,t)=>e.x.times(t.x).plus(e.y.times(t.y)),wr=e=>zi(e,e).sqrt(),ys=(e,t,r)=>{let i={x:t.x.minus(e.x),y:t.y.minus(e.y)},n={x:r.x.minus(e.x),y:r.y.minus(e.y)};return Br(n,i).div(wr(n)).div(wr(i))},bs=(e,t,r)=>{let i={x:t.x.minus(e.x),y:t.y.minus(e.y)},n={x:r.x.minus(e.x),y:r.y.minus(e.y)};return zi(n,i).div(wr(n)).div(wr(i))},Ui=(e,t,r)=>t.y.isZero()?null:{x:e.x.plus(t.x.div(t.y).times(r.minus(e.y))),y:r},Vi=(e,t,r)=>t.x.isZero()?null:{x:r,y:e.y.plus(t.y.div(t.x).times(r.minus(e.x)))},Ls=(e,t,r,i)=>{if(t.x.isZero())return Vi(r,i,e.x);if(i.x.isZero())return Vi(e,t,r.x);if(t.y.isZero())return Ui(r,i,e.y);if(i.y.isZero())return Ui(e,t,r.y);let n=Br(t,i);if(n.isZero())return null;let a={x:r.x.minus(e.x),y:r.y.minus(e.y)},s=Br(a,t).div(n),o=Br(a,i).div(n),l=e.x.plus(o.times(t.x)),h=r.x.plus(s.times(i.x)),y=e.y.plus(o.times(t.y)),m=r.y.plus(s.times(i.y)),w=l.plus(h).div(2),A=y.plus(m).div(2);return{x:w,y:A}},Je=class sn{point;isLeft;segment;otherSE;consumedBy;static compare(t,r){let i=sn.comparePoints(t.point,r.point);return i!==0?i:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Dr.compare(t.segment,r.segment))}static comparePoints(t,r){return t.x.isLessThan(r.x)?-1:t.x.isGreaterThan(r.x)?1:t.y.isLessThan(r.y)?-1:t.y.isGreaterThan(r.y)?1:0}constructor(t,r){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=r}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");let r=t.point.events;for(let i=0,n=r.length;i<n;i++){let a=r[i];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){let t=this.point.events.length;for(let r=0;r<t;r++){let i=this.point.events[r];if(i.segment.consumedBy===void 0)for(let n=r+1;n<t;n++){let a=this.point.events[n];a.consumedBy===void 0&&i.otherSE.point.events===a.otherSE.point.events&&i.segment.consume(a.segment)}}}getAvailableLinkedEvents(){let t=[];for(let r=0,i=this.point.events.length;r<i;r++){let n=this.point.events[r];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){let r=new Map,i=n=>{let a=n.otherSE;r.set(n,{sine:ys(this.point,t.point,a.point),cosine:bs(this.point,t.point,a.point)})};return(n,a)=>{r.has(n)||i(n),r.has(a)||i(a);let{sine:s,cosine:o}=r.get(n),{sine:l,cosine:h}=r.get(a);return s.isGreaterThanOrEqualTo(0)&&l.isGreaterThanOrEqualTo(0)?o.isLessThan(h)?1:o.isGreaterThan(h)?-1:0:s.isLessThan(0)&&l.isLessThan(0)?o.isLessThan(h)?-1:o.isGreaterThan(h)?1:0:l.isLessThan(s)?-1:l.isGreaterThan(s)?1:0}}},vs=0,Dr=class jr{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(t,r){let i=t.leftSE.point.x,n=r.leftSE.point.x,a=t.rightSE.point.x,s=r.rightSE.point.x;if(s.isLessThan(i))return 1;if(a.isLessThan(n))return-1;let o=t.leftSE.point.y,l=r.leftSE.point.y,h=t.rightSE.point.y,y=r.rightSE.point.y;if(i.isLessThan(n)){if(l.isLessThan(o)&&l.isLessThan(h))return 1;if(l.isGreaterThan(o)&&l.isGreaterThan(h))return-1;let m=t.comparePoint(r.leftSE.point);if(m<0)return 1;if(m>0)return-1;let w=r.comparePoint(t.rightSE.point);return w!==0?w:-1}if(i.isGreaterThan(n)){if(o.isLessThan(l)&&o.isLessThan(y))return-1;if(o.isGreaterThan(l)&&o.isGreaterThan(y))return 1;let m=r.comparePoint(t.leftSE.point);if(m!==0)return m;let w=t.comparePoint(r.rightSE.point);return w<0?1:w>0?-1:1}if(o.isLessThan(l))return-1;if(o.isGreaterThan(l))return 1;if(a.isLessThan(s)){let m=r.comparePoint(t.rightSE.point);if(m!==0)return m}if(a.isGreaterThan(s)){let m=t.comparePoint(r.rightSE.point);if(m<0)return 1;if(m>0)return-1}if(!a.eq(s)){let m=h.minus(o),w=a.minus(i),A=y.minus(l),O=s.minus(n);if(m.isGreaterThan(w)&&A.isLessThan(O))return 1;if(m.isLessThan(w)&&A.isGreaterThan(O))return-1}return a.isGreaterThan(s)?1:a.isLessThan(s)||h.isLessThan(y)?-1:h.isGreaterThan(y)?1:t.id<r.id?-1:t.id>r.id?1:0}constructor(t,r,i,n){this.id=++vs,this.leftSE=t,t.segment=this,t.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=t,this.rings=i,this.windings=n}static fromRing(t,r,i){let n,a,s,o=Je.comparePoints(t,r);if(o<0)n=t,a=r,s=1;else if(o>0)n=r,a=t,s=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);let l=new Je(n,!0),h=new Je(a,!1);return new jr(l,h,[i],[s])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(r)?t:r},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(r)?t:r}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return st.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){let r=this.bbox(),i=t.bbox(),n=li(r,i);if(n===null)return null;let a=this.leftSE.point,s=this.rightSE.point,o=t.leftSE.point,l=t.rightSE.point,h=or(r,o)&&this.comparePoint(o)===0,y=or(i,a)&&t.comparePoint(a)===0,m=or(r,l)&&this.comparePoint(l)===0,w=or(i,s)&&t.comparePoint(s)===0;if(y&&h)return w&&!m?s:!w&&m?l:null;if(y)return m&&a.x.eq(l.x)&&a.y.eq(l.y)?null:a;if(h)return w&&s.x.eq(o.x)&&s.y.eq(o.y)?null:o;if(w&&m)return null;if(w)return s;if(m)return l;let A=Ls(a,this.vector(),o,t.vector());return A===null||!or(n,A)?null:st.snap(A)}split(t){let r=[],i=t.events!==void 0,n=new Je(t,!0),a=new Je(t,!1),s=this.rightSE;this.replaceRightSE(a),r.push(a),r.push(n);let o=new jr(n,s,this.rings.slice(),this.windings.slice());return Je.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),Je.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),a.checkForConsuming()),r}swapEvents(){let t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}consume(t){let r=this,i=t;for(;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;let n=jr.compare(r,i);if(n!==0){if(n>0){let a=r;r=i,i=a}if(r.prev===i){let a=r;r=i,i=a}for(let a=0,s=i.rings.length;a<s;a++){let o=i.rings[a],l=i.windings[a],h=r.rings.indexOf(o);h===-1?(r.rings.push(o),r.windings.push(l)):r.windings[h]+=l}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};let r=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let o=0,l=this.rings.length;o<l;o++){let h=this.rings[o],y=this.windings[o],m=r.indexOf(h);m===-1?(r.push(h),i.push(y)):i[m]+=y}let a=[],s=[];for(let o=0,l=r.length;o<l;o++){if(i[o]===0)continue;let h=r[o],y=h.poly;if(s.indexOf(y)===-1)if(h.isExterior)a.push(y);else{s.indexOf(y)===-1&&s.push(y);let m=a.indexOf(h.poly);m!==-1&&a.splice(m,1)}}for(let o=0,l=a.length;o<l;o++){let h=a[o].multiPoly;n.indexOf(h)===-1&&n.push(h)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Pr.type){case"union":{let i=t.length===0,n=r.length===0;this._isInResult=i!==n;break}case"intersection":{let i,n;t.length<r.length?(i=t.length,n=r.length):(i=r.length,n=t.length),this._isInResult=n===Pr.numMultiPolys&&i<n;break}case"xor":{let i=Math.abs(t.length-r.length);this._isInResult=i%2===1;break}case"difference":{let i=n=>n.length===1&&n[0].isSubject;this._isInResult=i(t)!==i(r);break}}return this._isInResult}},Ki=class{poly;isExterior;segments;bbox;constructor(e,t,r){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let i=st.snap({x:new Xe(e[0][0]),y:new Xe(e[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let n=i;for(let a=1,s=e.length;a<s;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let o=st.snap({x:new Xe(e[a][0]),y:new Xe(e[a][1])});o.x.eq(n.x)&&o.y.eq(n.y)||(this.segments.push(Dr.fromRing(n,o,this)),o.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=o.x),o.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=o.y),o.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=o.x),o.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=o.y),n=o)}(!i.x.eq(n.x)||!i.y.eq(n.y))&&this.segments.push(Dr.fromRing(n,i,this))}getSweepEvents(){let e=[];for(let t=0,r=this.segments.length;t<r;t++){let i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}},Cs=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ki(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,i=e.length;r<i;r++){let n=new Ki(e[r],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){let e=this.exteriorRing.getSweepEvents();for(let t=0,r=this.interiorRings.length;t<r;t++){let i=this.interiorRings[t].getSweepEvents();for(let n=0,a=i.length;n<a;n++)e.push(i[n])}return e}},qi=class{isSubject;polys;bbox;constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:new Xe(Number.POSITIVE_INFINITY),y:new Xe(Number.POSITIVE_INFINITY)},ur:{x:new Xe(Number.NEGATIVE_INFINITY),y:new Xe(Number.NEGATIVE_INFINITY)}};for(let r=0,i=e.length;r<i;r++){let n=new Cs(e[r],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){let e=[];for(let t=0,r=this.polys.length;t<r;t++){let i=this.polys[t].getSweepEvents();for(let n=0,a=i.length;n<a;n++)e.push(i[n])}return e}},xs=class fi{events;poly;_isExteriorRing;_enclosingRing;static factory(t){let r=[];for(let i=0,n=t.length;i<n;i++){let a=t[i];if(!a.isInResult()||a.ringOut)continue;let s=null,o=a.leftSE,l=a.rightSE,h=[o],y=o.point,m=[];for(;s=o,o=l,h.push(o),o.point!==y;)for(;;){let w=o.getAvailableLinkedEvents();if(w.length===0){let I=h[0].point,G=h[h.length-1].point;throw new Error(`Unable to complete output ring starting at [${I.x}, ${I.y}]. Last matching segment found ends at [${G.x}, ${G.y}].`)}if(w.length===1){l=w[0].otherSE;break}let A=null;for(let I=0,G=m.length;I<G;I++)if(m[I].point===o.point){A=I;break}if(A!==null){let I=m.splice(A)[0],G=h.splice(I.index);G.unshift(G[0].otherSE),r.push(new fi(G.reverse()));continue}m.push({index:h.length,point:o.point});let O=o.getLeftmostComparator(s);l=w.sort(O)[0].otherSE;break}r.push(new fi(h))}return r}constructor(t){this.events=t;for(let r=0,i=t.length;r<i;r++)t[r].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point,r=[t];for(let h=1,y=this.events.length-1;h<y;h++){let m=this.events[h].point,w=this.events[h+1].point;st.orient(m,t,w)!==0&&(r.push(m),t=m)}if(r.length===1)return null;let i=r[0],n=r[1];st.orient(i,t,n)===0&&r.shift(),r.push(r[0]);let a=this.isExteriorRing()?1:-1,s=this.isExteriorRing()?0:r.length-1,o=this.isExteriorRing()?r.length:-1,l=[];for(let h=s;h!=o;h+=a)l.push([r[h].x.toNumber(),r[h].y.toNumber()]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){let t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let n=1,a=this.events.length;n<a;n++){let s=this.events[n];Je.compare(t,s)>0&&(t=s)}let r=t.segment.prevInResult(),i=r?r.prevInResult():null;for(;;){if(!r)return null;if(!i)return r.ringOut;if(i.ringOut!==r.ringOut)return i.ringOut?.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut?.enclosingRing();r=i.prevInResult(),i=r?r.prevInResult():null}}},Hi=class{exteriorRing;interiorRings;constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){let e=this.exteriorRing.getGeom();if(e===null)return null;let t=[e];for(let r=0,i=this.interiorRings.length;r<i;r++){let n=this.interiorRings[r].getGeom();n!==null&&t.push(n)}return t}},ks=class{rings;polys;constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){let e=[];for(let t=0,r=this.polys.length;t<r;t++){let i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){let t=[];for(let r=0,i=e.length;r<i;r++){let n=e[r];if(!n.poly)if(n.isExteriorRing())t.push(new Hi(n));else{let a=n.enclosingRing();a?.poly||t.push(new Hi(a)),a?.poly?.addInterior(n)}}return t}},Ms=class{queue;tree;segments;constructor(e,t=Dr.compare){this.queue=e,this.tree=new Er(t),this.segments=[]}process(e){let t=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.delete(e.otherSE):this.tree.delete(t),r;e.isLeft&&this.tree.add(t);let i=t,n=t;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(e.isLeft){let a=null;if(i){let o=i.getIntersection(t);if(o!==null&&(t.isAnEndpoint(o)||(a=o),!i.isAnEndpoint(o))){let l=this._splitSafely(i,o);for(let h=0,y=l.length;h<y;h++)r.push(l[h])}}let s=null;if(n){let o=n.getIntersection(t);if(o!==null&&(t.isAnEndpoint(o)||(s=o),!n.isAnEndpoint(o))){let l=this._splitSafely(n,o);for(let h=0,y=l.length;h<y;h++)r.push(l[h])}}if(a!==null||s!==null){let o=null;a===null?o=s:s===null?o=a:o=Je.comparePoints(a,s)<=0?a:s,this.queue.delete(t.rightSE),r.push(t.rightSE);let l=t.split(o);for(let h=0,y=l.length;h<y;h++)r.push(l[h])}r.length>0?(this.tree.delete(t),r.push(e)):(this.segments.push(t),t.prev=i)}else{if(i&&n){let a=i.getIntersection(n);if(a!==null){if(!i.isAnEndpoint(a)){let s=this._splitSafely(i,a);for(let o=0,l=s.length;o<l;o++)r.push(s[o])}if(!n.isAnEndpoint(a)){let s=this._splitSafely(n,a);for(let o=0,l=s.length;o<l;o++)r.push(s[o])}}}this.tree.delete(t)}return r}_splitSafely(e,t){this.tree.delete(e);let r=e.rightSE;this.queue.delete(r);let i=e.split(t);return i.push(r),e.consumedBy===void 0&&this.tree.add(e),i}},Es=class{type;numMultiPolys;run(e,t,r){ur.type=e;let i=[new qi(t,!0)];for(let l=0,h=r.length;l<h;l++)i.push(new qi(r[l],!1));if(ur.numMultiPolys=i.length,ur.type==="difference"){let l=i[0],h=1;for(;h<i.length;)li(i[h].bbox,l.bbox)!==null?h++:i.splice(h,1)}if(ur.type==="intersection")for(let l=0,h=i.length;l<h;l++){let y=i[l];for(let m=l+1,w=i.length;m<w;m++)if(li(y.bbox,i[m].bbox)===null)return[]}let n=new Er(Je.compare);for(let l=0,h=i.length;l<h;l++){let y=i[l].getSweepEvents();for(let m=0,w=y.length;m<w;m++)n.add(y[m])}let a=new Ms(n),s=null;for(n.size!=0&&(s=n.first(),n.delete(s));s;){let l=a.process(s);for(let h=0,y=l.length;h<y;h++){let m=l[h];m.consumedBy===void 0&&n.add(m)}n.size!=0?(s=n.first(),n.delete(s)):s=null}st.reset();let o=xs.factory(a.segments);return new ks(o).getGeom()}},ur=new Es,Pr=ur,Bs=(e,...t)=>Pr.run("intersection",e,t),ws=(e,...t)=>Pr.run("difference",e,t);st.set;function Ar(e){let t={type:"Feature"};return t.geometry=e,t}function Sr(e){return e.type==="Feature"?e.geometry:e}function Yi(e){return e&&e.geometry&&e.geometry.coordinates?e.geometry.coordinates:e}function Ds(e){return Ar({type:"LineString",coordinates:e})}function Ps(e){return Ar({type:"MultiLineString",coordinates:e})}function $i(e){return Ar({type:"Polygon",coordinates:e})}function Xi(e){return Ar({type:"MultiPolygon",coordinates:e})}function As(e,t){let r=Sr(e),i=Sr(t),n=Bs(r.coordinates,i.coordinates);return n.length===0?null:n.length===1?$i(n[0]):Xi(n)}function Ss(e,t){let r=Sr(e),i=Sr(t),n=ws(r.coordinates,i.coordinates);return n.length===0?null:n.length===1?$i(n[0]):Xi(n)}function Ji(e){return Array.isArray(e)?1+Ji(e[0]):-1}function Ts(e){e instanceof L.Polyline&&(e=e.toGeoJSON(15));let t=Yi(e),r=Ji(t),i=[];return r>1?t.forEach(n=>{i.push(Ds(n))}):i.push(e),i}function Fs(e){let t=[];return e.eachLayer(r=>{t.push(Yi(r.toGeoJSON(15)))}),Ps(t)}be.Cut=be.Polygon.extend({initialize(e){this._map=e,this._shape="Cut",this.toolbarButtonName="cutPolygon"},_finishShape(){if(this._editedLayers=[],!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=2)return;let t=L.polygon(e,this.options.pathOptions);t._latlngInfos=this._layer._latlngInfo,this.cut(t),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex,this._editedLayers.forEach(({layer:i,originalLayer:n})=>{this._fireCut(n,i,n),this._fireCut(this._map,i,n),n.pm._fireEdit()}),this._editedLayers=[];let r=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(r))},cut(e){let t=this._map._layers,r=e._latlngInfos||[];Object.keys(t).map(i=>t[i]).filter(i=>i.pm).filter(i=>!i._pmTempLayer).filter(i=>!L.PM.optIn&&!i.options.pmIgnore||L.PM.optIn&&i.options.pmIgnore===!1).filter(i=>i instanceof L.Polyline).filter(i=>i!==e).filter(i=>i.pm.options.allowCutting).filter(i=>this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0?this.options.layersToCut.indexOf(i)>-1:!0).filter(i=>!this._layerGroup.hasLayer(i)).filter(i=>{try{let n=!!wt(e.toGeoJSON(15),i.toGeoJSON(15)).features.length>0;return n||i instanceof L.Polyline&&!(i instanceof L.Polygon)?n:!!As(e.toGeoJSON(15),i.toGeoJSON(15))}catch{return i instanceof L.Polygon&&console.error("You can't cut polygons with self-intersections"),!1}}).forEach(i=>{let n;if(i instanceof L.Polygon){n=L.polygon(i.getLatLngs());let l=n.getLatLngs();r.forEach(h=>{if(h&&h.snapInfo){let{latlng:y}=h,m=this._calcClosestLayer(y,[n]);if(m&&m.segment&&m.distance<this.options.snapDistance){let{segment:w}=m;if(w&&w.length===2){let{indexPath:A,parentPath:O,newIndex:I}=L.PM.Utils._getIndexFromSegment(l,w);(A.length>1?(0,us.default)(l,O):l).splice(I,0,y)}}}})}else n=i;let a=this._cutLayer(e,n),s=L.geoJSON(a,i.options);s.getLayers().length===1&&([s]=s.getLayers()),this._setPane(s,"layerPane");let o=s.addTo(this._map.pm._getContainingLayer());if(o.pm.enable(i.pm.options),o.pm.disable(),i._pmTempLayer=!0,e._pmTempLayer=!0,i.remove(),i.removeFrom(this._map.pm._getContainingLayer()),e.remove(),e.removeFrom(this._map.pm._getContainingLayer()),o.getLayers&&o.getLayers().length===0&&this._map.pm.removeLayer({target:o}),o instanceof L.LayerGroup?(o.eachLayer(l=>{this._addDrawnLayerProp(l)}),this._addDrawnLayerProp(o)):this._addDrawnLayerProp(o),this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0){let l=this.options.layersToCut.indexOf(i);l>-1&&this.options.layersToCut.splice(l,1)}this._editedLayers.push({layer:o,originalLayer:i})})},_cutLayer(e,t){let r=L.geoJSON(),i;if(t instanceof L.Polygon)i=Ss(t.toGeoJSON(15),e.toGeoJSON(15));else{let n=Ts(t);n.forEach(a=>{let s=Xa(a,e.toGeoJSON(15)),o;s&&s.features.length>0?o=L.geoJSON(s):o=L.geoJSON(a),o.getLayers().forEach(l=>{Qa(e.toGeoJSON(15),l.toGeoJSON(15))||l.addTo(r)})}),n.length>1?i=Fs(r):i=r.toGeoJSON(15)}return i},_change:L.Util.falseFn}),be.Text=be.extend({initialize(e){this._map=e,this._shape="Text",this.toolbarButtonName="drawText"},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(Z("tooltips.placeText"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this._map.getContainer().classList.add("geoman-draw-cursor"),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.off("click",this._createMarker,this),this._hintMarker?.remove(),this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("mousemove",this._syncHintMarker,this),this._map.off("mousemove",this._showHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let t=e;t.target=this._hintMarker,this._handleSnapping(t)}},_createMarker(e){if(!e.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng();if(this.textArea=this._createTextArea(),this.options.textOptions?.className){let n=this.options.textOptions.className.split(" ");this.textArea.classList.add(...n)}let r=this._createTextIcon(this.textArea),i=new L.Marker(t,{textMarker:!0,_textMarkerOverPM:!0,icon:r});if(this._setPane(i,"markerPane"),this._finishLayer(i),i.pm||(i.options.draggable=!1),i.addTo(this._map.pm._getContainingLayer()),i.pm){i.pm.textArea=this.textArea,L.setOptions(i.pm,{removeIfEmpty:this.options.textOptions?.removeIfEmpty??!0});let n=this.options.textOptions?.focusAfterDraw??!0;i.pm._createTextMarker(n),this.options.textOptions?.text&&i.pm.setText(this.options.textOptions.text)}this._fireCreate(i),this._cleanupSnapping(),this.disable(),this.options.continueDrawing&&this._map.once("mousemove",this._showHintMarkerAfterMoving,this)},_showHintMarkerAfterMoving(e){this.enable(),this._hintMarker.setLatLng(e.latlng)},_createTextArea(){let e=document.createElement("textarea");return e.readOnly=!0,e.classList.add("pm-textarea","pm-disabled"),e},_createTextIcon(e){return L.divIcon({className:"pm-text-marker",html:e})}});var Rs={enableLayerDrag(){if(!this.options.draggable||!this._layer._map)return;this.disable(),this._layerDragEnabled=!0,this._map||(this._map=this._layer._map),(this._layer instanceof L.Marker||this._layer instanceof L.ImageOverlay)&&L.DomEvent.on(this._getDOMElem(),"dragstart",this._stopDOMImageDrag),this._layer.dragging&&this._layer.dragging.disable(),this._tempDragCoord=null,Kt(this._layer)instanceof L.Canvas?(this._layer.on("mouseout",this.removeDraggingClass,this),this._layer.on("mouseover",this.addDraggingClass,this)):this.addDraggingClass(),this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!0;let e=this._getDOMElem();e&&(Kt(this._layer)instanceof L.Canvas?(this._layer.on("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._addTouchEvents(e)):L.DomEvent.on(e,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._fireDragEnable()},disableLayerDrag(){this._layerDragEnabled=!1,Kt(this._layer)instanceof L.Canvas?(this._layer.off("mouseout",this.removeDraggingClass,this),this._layer.off("mouseover",this.addDraggingClass,this)):this.removeDraggingClass(),this._originalMapDragState&&this._dragging&&this._map.dragging.enable(),this._safeToCacheDragState=!1,this._layer.dragging&&this._layer.dragging.disable();let e=this._getDOMElem();e&&(Kt(this._layer)instanceof L.Canvas?(this._layer.off("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._removeTouchEvents(e)):L.DomEvent.off(e,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._layerDragged&&this._fireUpdate(),this._layerDragged=!1,this._fireDragDisable()},dragging(){return this._dragging},layerDragEnabled(){return!!this._layerDragEnabled},_simulateMouseDownEvent(e){let t=e.touches?e.touches[0]:e,r={originalEvent:t,target:this._layer};return r.containerPoint=this._map.mouseEventToContainerPoint(t),r.latlng=this._map.containerPointToLatLng(r.containerPoint),this._dragMixinOnMouseDown(r),!1},_simulateMouseMoveEvent(e){let t=e.touches?e.touches[0]:e,r={originalEvent:t,target:this._layer};return r.containerPoint=this._map.mouseEventToContainerPoint(t),r.latlng=this._map.containerPointToLatLng(r.containerPoint),this._dragMixinOnMouseMove(r),!1},_simulateMouseUpEvent(e){let t={originalEvent:e.touches?e.touches[0]:e,target:this._layer};return e.type.indexOf("touch")===-1&&(t.containerPoint=this._map.mouseEventToContainerPoint(e),t.latlng=this._map.containerPointToLatLng(t.containerPoint)),this._dragMixinOnMouseUp(t),!1},_dragMixinOnMouseDown(e){if(e.originalEvent.button>0)return;this._overwriteEventIfItComesFromMarker(e);let t=e._fromLayerSync,r=this._syncLayers("_dragMixinOnMouseDown",e);if(this._layer instanceof L.Marker&&(this.options.snappable&&!t&&!r?this._initSnappableMarkers():this._disableSnapping()),this._layer instanceof L.CircleMarker){let i="resizeableCircleMarker";this._layer instanceof L.Circle&&(i="resizeableCircle"),this.options.snappable&&!t&&!r?this._layer.pm.options[i]||this._initSnappableMarkersDrag():this._layer.pm.options[i]?this._layer.pm._disableSnapping():this._layer.pm._disableSnappingDrag()}this._safeToCacheDragState&&(this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!1),this._tempDragCoord=e.latlng,L.DomEvent.on(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),L.DomEvent.on(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this)},_dragMixinOnMouseMove(e){this._overwriteEventIfItComesFromMarker(e);let t=this._getDOMElem();this._syncLayers("_dragMixinOnMouseMove",e),this._dragging||(this._dragging=!0,L.DomUtil.addClass(t,"leaflet-pm-dragging"),this._layer instanceof L.Marker||this._layer.bringToFront(),this._originalMapDragState&&this._map.dragging.disable(),this._fireDragStart()),this._tempDragCoord||(this._tempDragCoord=e.latlng),this._onLayerDrag(e),this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle()},_dragMixinOnMouseUp(e){let t=this._getDOMElem();return this._syncLayers("_dragMixinOnMouseUp",e),this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0,L.DomEvent.off(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this),L.DomEvent.off(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),this._dragging?(this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle(),this._layerDragged=!0,window.setTimeout(()=>{this._dragging=!1,t&&L.DomUtil.removeClass(t,"leaflet-pm-dragging"),this._fireDragEnd(),this._fireEdit(),this._layerEdited=!0},10),!0):!1},_onLayerDrag(e){let{latlng:t}=e,r={lat:t.lat-this._tempDragCoord.lat,lng:t.lng-this._tempDragCoord.lng},i=n=>n.map(a=>{if(Array.isArray(a))return i(a);let s={lat:a.lat+r.lat,lng:a.lng+r.lng};return(a.alt||a.alt===0)&&(s.alt=a.alt),s});if(this._layer instanceof L.Circle&&this._layer.options.resizeableCircle||this._layer instanceof L.CircleMarker&&this._layer.options.resizeableCircleMarker){let n=i([this._layer.getLatLng()]);this._layer.setLatLng(n[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.CircleMarker||this._layer instanceof L.Marker){let n=this._layer.getLatLng();this._layer._snapped&&(n=this._layer._orgLatLng);let a=i([n]);this._layer.setLatLng(a[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.ImageOverlay){let n=i([this._layer.getBounds().getNorthWest(),this._layer.getBounds().getSouthEast()]);this._layer.setBounds(n),this._fireChange(this._layer.getBounds(),"Edit")}else{let n=i(this._layer.getLatLngs());this._layer.setLatLngs(n),this._fireChange(this._layer.getLatLngs(),"Edit")}this._tempDragCoord=t,e.layer=this._layer,this._fireDrag(e)},addDraggingClass(){let e=this._getDOMElem();e&&L.DomUtil.addClass(e,"leaflet-pm-draggable")},removeDraggingClass(){let e=this._getDOMElem();e&&L.DomUtil.removeClass(e,"leaflet-pm-draggable")},_getDOMElem(){let e=null;return this._layer._path?e=this._layer._path:this._layer._renderer&&this._layer._renderer._container?e=this._layer._renderer._container:this._layer._image?e=this._layer._image:this._layer._icon&&(e=this._layer._icon),e},_overwriteEventIfItComesFromMarker(e){e.target.getLatLng&&(!e.target._radius||e.target._radius<=10)&&(e.containerPoint=this._map.mouseEventToContainerPoint(e.originalEvent),e.latlng=this._map.containerPointToLatLng(e.containerPoint))},_syncLayers(e,t){if(this.enabled())return!1;if(!t._fromLayerSync&&this._layer===t.target&&this.options.syncLayersOnDrag){t._fromLayerSync=!0;let r=[];if(L.Util.isArray(this.options.syncLayersOnDrag))r=this.options.syncLayersOnDrag,this.options.syncLayersOnDrag.forEach(i=>{i instanceof L.LayerGroup&&(r=r.concat(i.pm.getLayers(!0)))});else if(this.options.syncLayersOnDrag===!0&&this._parentLayerGroup)for(let i in this._parentLayerGroup){let n=this._parentLayerGroup[i];n.pm&&(r=n.pm.getLayers(!0))}return L.Util.isArray(r)&&r.length>0&&(r=r.filter(i=>!!i.pm).filter(i=>!!i.pm.options.draggable),r.forEach(i=>{i!==this._layer&&i.pm[e]&&(i._snapped=!1,i.pm[e](t))})),r.length>0}return!1},_stopDOMImageDrag(e){return e.preventDefault(),!1}},Os=Rs,Is=Be(_r());function js(e,t,r,i){return r.unproject(t.transform(r.project(e,i)),i)}function Zi(e,t,r){let i=r.getMaxZoom();if(i===1/0&&(i=r.getZoom()),L.Util.isArray(e)){let n=[];return e.forEach(a=>{n.push(Zi(a,t,r))}),n}return e instanceof L.LatLng?js(e,t,r,i):null}function Yt(e,t){t instanceof L.Layer&&(t=t.getLatLng());let r=e.getMaxZoom();return r===1/0&&(r=e.getZoom()),e.project(t,r)}function Tr(e,t){let r=e.getMaxZoom();return r===1/0&&(r=e.getZoom()),e.unproject(t,r)}var Gs={_onRotateStart(e){this._preventRenderingMarkers(!0),this._rotationOriginLatLng=this._getRotationCenter().clone(),this._rotationOriginPoint=Yt(this._map,this._rotationOriginLatLng),this._rotationStartPoint=Yt(this._map,e.target.getLatLng()),this._initialRotateLatLng=dt(this._layer),this._startAngle=this.getAngle();let t=dt(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._fireRotationStart(this._rotationLayer,t),this._fireRotationStart(this._map,t)},_onRotate(e){let t=Yt(this._map,e.target.getLatLng()),r=this._rotationStartPoint,i=this._rotationOriginPoint,n=Math.atan2(t.y-i.y,t.x-i.x)-Math.atan2(r.y-i.y,r.x-i.x);this._layer.setLatLngs(this._rotateLayer(n,this._initialRotateLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let a=this;function s(y,m=[],w=-1){if(w>-1&&m.push(w),L.Util.isArray(y[0]))y.forEach((A,O)=>s(A,m.slice(),O));else{let A=m.length>0?(0,Is.default)(a._markers,m):a._markers[0];y.forEach((O,I)=>{A[I].setLatLng(O)})}}s(this._layer.getLatLngs());let o=dt(this._rotationLayer);this._rotationLayer.setLatLngs(this._rotateLayer(n,this._rotationLayer.pm._rotateOrgLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let l=n*180/Math.PI;l=l<0?l+360:l;let h=l+this._startAngle;this._setAngle(h),this._rotationLayer.pm._setAngle(h),this._fireRotation(this._rotationLayer,l,o),this._fireRotation(this._map,l,o),this._rotationLayer.pm._fireChange(this._rotationLayer.getLatLngs(),"Rotation")},_onRotateEnd(){let e=this._startAngle;delete this._rotationOriginLatLng,delete this._rotationOriginPoint,delete this._rotationStartPoint,delete this._initialRotateLatLng,delete this._startAngle;let t=dt(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._rotationLayer.pm._rotateOrgLatLng=dt(this._rotationLayer),this._fireRotationEnd(this._rotationLayer,e,t),this._fireRotationEnd(this._map,e,t),this._rotationLayer.pm._fireEdit(this._rotationLayer,"Rotation"),this._preventRenderingMarkers(!1),this._layerRotated=!0},_rotateLayer(e,t,r,i,n){let a=Yt(n,r);return this._matrix=i.clone().rotate(e,a).flip(),Zi(t,this._matrix,n)},_setAngle(e){e=e<0?e+360:e,this._angle=e%360},_getRotationCenter(){if(this._rotationCenter)return this._rotationCenter;let e=L.polygon(this._layer.getLatLngs(),{stroke:!1,fill:!1,pmIgnore:!0}).addTo(this._layer._map),t=e.getCenter();return e.removeFrom(this._layer._map),t},enableRotate(){if(!this.options.allowRotation){this.disableRotate();return}this.rotateEnabled()&&this.disableRotate(),this._layer instanceof L.Rectangle&&this._angle===void 0&&this.setInitAngle(Xr(this._layer._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let e={fill:!1,stroke:!1,pmIgnore:!1,snapIgnore:!0};this._rotatePoly=L.polygon(this._layer.getLatLngs(),e),this._rotatePoly._pmTempLayer=!0,this._rotatePoly.addTo(this._layer._map),this._rotatePoly.pm._setAngle(this.getAngle()),this._rotatePoly.pm.setRotationCenter(this.getRotationCenter()),this._rotatePoly.pm.setOptions(this._layer._map.pm.getGlobalOptions()),this._rotatePoly.pm.setOptions({rotate:!0,snappable:!1,hideMiddleMarkers:!0}),this._rotatePoly.pm._rotationLayer=this._layer,this._rotatePoly.pm.enable(),this._rotateOrgLatLng=dt(this._layer),this._rotateEnabled=!0,this._layer.on("remove",this.disableRotate,this),this._fireRotationEnable(this._layer),this._fireRotationEnable(this._layer._map)},disableRotate(){this.rotateEnabled()&&(this._rotatePoly.pm._layerRotated&&this._fireUpdate(),this._rotatePoly.pm._layerRotated=!1,this._rotatePoly.pm.disable(),this._rotatePoly.remove(),this._rotatePoly.pm.setOptions({rotate:!1}),this._rotatePoly=void 0,this._rotateOrgLatLng=void 0,this._layer.off("remove",this.disableRotate,this),this._rotateEnabled=!1,this._fireRotationDisable(this._layer),this._fireRotationDisable(this._layer._map))},rotateEnabled(){return!!this._rotateEnabled},rotateLayer(e){let t=this.getAngle(),r=this._layer.getLatLngs(),i=e*(Math.PI/180);this._layer.setLatLngs(this._rotateLayer(i,this._layer.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._layer._map)),this._rotateOrgLatLng=L.polygon(this._layer.getLatLngs()).getLatLngs(),this._setAngle(this.getAngle()+e),this.rotateEnabled()&&this._rotatePoly&&this._rotatePoly.pm.enabled()&&(this._rotatePoly.setLatLngs(this._rotateLayer(i,this._rotatePoly.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._rotatePoly._map)),this._rotatePoly.pm._initMarkers());let n=this.getAngle()-t;n=n<0?n+360:n,this._startAngle=t,this._fireRotation(this._layer,n,r,this._layer),this._fireRotation(this._map||this._layer._map,n,r,this._layer),delete this._startAngle,this._fireChange(this._layer.getLatLngs(),"Rotation")},rotateLayerToAngle(e){let t=e-this.getAngle();this.rotateLayer(t)},getAngle(){return this._angle||0},setInitAngle(e){this._setAngle(e)},getRotationCenter(){return this._getRotationCenter()},setRotationCenter(e){this._rotationCenter=e,this._rotatePoly&&this._rotatePoly.pm.setRotationCenter(e)}},Ns=Gs,zs=L.Class.extend({includes:[Os,Mi,Ns,yr],options:{snappable:!0,snapDistance:20,allowSelfIntersection:!0,allowSelfIntersectionEdit:!1,preventMarkerRemoval:!1,removeLayerBelowMinVertexCount:!0,limitMarkersToCount:-1,hideMiddleMarkers:!1,snapSegment:!0,syncLayersOnDrag:!1,draggable:!0,allowEditing:!0,allowRemoval:!0,allowCutting:!0,allowRotation:!0,addVertexOn:"click",removeVertexOn:"contextmenu",removeVertexValidation:void 0,addVertexValidation:void 0,moveVertexValidation:void 0,resizeableCircleMarker:!1,resizeableCircle:!0,snapMiddle:!1,snapVertex:!0},setOptions(e){L.Util.setOptions(this,e)},getOptions(){return this.options},applyOptions(){},isPolygon(){return this._layer instanceof L.Polygon},getShape(){return this._shape},_setPane(e,t){t==="layerPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":t==="vertexPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":t==="markerPane"&&(e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},remove(){(this._map||this._layer._map).pm.removeLayer({target:this._layer})},_vertexValidation(e,t){let r=t.target,i={layer:this._layer,marker:r,event:t},n="";return e==="move"?n="moveVertexValidation":e==="add"?n="addVertexValidation":e==="remove"&&(n="removeVertexValidation"),this.options[n]&&typeof this.options[n]=="function"&&!this.options[n](i)?(e==="move"&&(r._cancelDragEventChain=r.getLatLng()),!1):(r._cancelDragEventChain=null,!0)},_vertexValidationDrag(e){return e._cancelDragEventChain?(e._latlng=e._cancelDragEventChain,e.update(),!1):!0},_vertexValidationDragEnd(e){return e._cancelDragEventChain?(e._cancelDragEventChain=null,!1):!0}}),me=zs;me.LayerGroup=L.Class.extend({initialize(e){this._layerGroup=e,this._layers=this.getLayers(),this._getMap(),this._layers.forEach(i=>this._initLayer(i));let t=i=>{if(i.layer._pmTempLayer)return;this._layers=this.getLayers();let n=this._layers.filter(a=>!a.pm._parentLayerGroup||!(this._layerGroup._leaflet_id in a.pm._parentLayerGroup));n.forEach(a=>{this._initLayer(a)}),n.length>0&&this._getMap()&&this._getMap().pm.globalEditModeEnabled()&&this.enabled()&&this.enable(this.getOptions())};this._layerGroup.on("layeradd",L.Util.throttle(t,100,this),this),this._layerGroup.on("layerremove",i=>{this._removeLayerFromGroup(i.target)},this);let r=i=>{i.target._pmTempLayer||(this._layers=this.getLayers())};this._layerGroup.on("layerremove",L.Util.throttle(r,100,this),this)},enable(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this._options=e,this._layers.forEach(r=>{r instanceof L.LayerGroup?t.indexOf(r._leaflet_id)===-1&&(t.push(r._leaflet_id),r.pm.enable(e,t)):r.pm.enable(e)})},disable(e=[]){e.length===0&&(this._layers=this.getLayers()),this._layers.forEach(t=>{t instanceof L.LayerGroup?e.indexOf(t._leaflet_id)===-1&&(e.push(t._leaflet_id),t.pm.disable(e)):t.pm.disable()})},enabled(e=[]){return e.length===0&&(this._layers=this.getLayers()),!!this._layers.find(t=>t instanceof L.LayerGroup?e.indexOf(t._leaflet_id)===-1?(e.push(t._leaflet_id),t.pm.enabled(e)):!1:t.pm.enabled())},toggleEdit(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this._options=e,this._layers.forEach(r=>{r instanceof L.LayerGroup?t.indexOf(r._leaflet_id)===-1&&(t.push(r._leaflet_id),r.pm.toggleEdit(e,t)):r.pm.toggleEdit(e)})},_initLayer(e){let t=L.Util.stamp(this._layerGroup);e.pm._parentLayerGroup||(e.pm._parentLayerGroup={}),e.pm._parentLayerGroup[t]=this._layerGroup},_removeLayerFromGroup(e){if(e.pm&&e.pm._layerGroup){let t=L.Util.stamp(this._layerGroup);delete e.pm._layerGroup[t]}},dragging(){return this._layers=this.getLayers(),this._layers?!!this._layers.find(e=>e.pm.dragging()):!1},getOptions(){return this.options},_getMap(){return this._map||this._layers.find(e=>!!e._map)?._map||null},getLayers(e=!1,t=!0,r=!0,i=[]){let n=[];return e?this._layerGroup.getLayers().forEach(a=>{n.push(a),a instanceof L.LayerGroup&&i.indexOf(a._leaflet_id)===-1&&(i.push(a._leaflet_id),n=n.concat(a.pm.getLayers(!0,!0,!0,i)))}):n=this._layerGroup.getLayers(),r&&(n=n.filter(a=>!(a instanceof L.LayerGroup))),t&&(n=n.filter(a=>!!a.pm),n=n.filter(a=>!a._pmTempLayer),n=n.filter(a=>!L.PM.optIn&&!a.options.pmIgnore||L.PM.optIn&&a.options.pmIgnore===!1)),n},setOptions(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this.options=e,this._layers.forEach(r=>{r.pm&&(r instanceof L.LayerGroup?t.indexOf(r._leaflet_id)===-1&&(t.push(r._leaflet_id),r.pm.setOptions(e,t)):r.pm.setOptions(e))})}}),me.Marker=me.extend({_shape:"Marker",initialize(e){this._layer=e,this._enabled=!1,this._layer.on("dragend",this._onDragEnd,this)},enable(e={draggable:!0}){if(L.Util.setOptions(this,e),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._fireEnable()},disable(){this.enabled()&&(this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this._layer.off("contextmenu",this._removeMarker,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1)},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this.options.draggable?this.enableLayerDrag():this.disableLayerDrag(),this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_removeMarker(e){let t=e.target;t.remove(),this._fireRemove(t),this._fireRemove(this._map,t)},_onDragEnd(){this._fireEdit(),this._layerEdited=!0},_initSnappableMarkers(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)}});var mt=Be(_r()),Us={filterMarkerGroup(){this.markerCache=[],this.createCache(),this._layer.on("pm:edit",this.createCache,this),this.applyLimitFilters({}),this.throttledApplyLimitFilters||(this.throttledApplyLimitFilters=L.Util.throttle(this.applyLimitFilters,100,this)),this._layer.on("pm:disable",this._removeMarkerLimitEvents,this),this._layer.on("remove",this._removeMarkerLimitEvents,this),this.options.limitMarkersToCount>-1&&(this._layer.on("pm:vertexremoved",this._initMarkers,this),this._map.on("mousemove",this.throttledApplyLimitFilters,this))},_removeMarkerLimitEvents(){this._map.off("mousemove",this.throttledApplyLimitFilters,this),this._layer.off("pm:edit",this.createCache,this),this._layer.off("pm:disable",this._removeMarkerLimitEvents,this),this._layer.off("pm:vertexremoved",this._initMarkers,this)},createCache(){let e=[...this._markerGroup.getLayers(),...this.markerCache];this.markerCache=e.filter((t,r,i)=>i.indexOf(t)===r)},_removeFromCache(e){let t=this.markerCache.indexOf(e);t>-1&&this.markerCache.splice(t,1)},renderLimits(e){this.markerCache.forEach(t=>{e.includes(t)?this._markerGroup.addLayer(t):this._markerGroup.removeLayer(t)})},applyLimitFilters({latlng:e={lat:0,lng:0}}){if(this._preventRenderMarkers)return;let t=[...this._filterClosestMarkers(e)];this.renderLimits(t)},_filterClosestMarkers(e){let t=[...this.markerCache],r=this.options.limitMarkersToCount;return r===-1?t:(t.sort((i,n)=>{let a=i._latlng.distanceTo(e),s=n._latlng.distanceTo(e);return a-s}),t.filter((i,n)=>r>-1?n<r:!0))},_preventRenderMarkers:!1,_preventRenderingMarkers(e){this._preventRenderMarkers=!!e}},Vs=Us;me.Line=me.extend({includes:[Vs],_shape:"Line",initialize(e){this._layer=e,this._enabled=!1},enable(e){if(L.Util.setOptions(this,e),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()&&this.disable(),this._enabled=!0,this._initMarkers(),this.applyOptions(),this._layer.on("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.on("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this),this.options.allowSelfIntersection?this.cachedColor=void 0:(this._layer.options.color!=="#f00000ff"?(this.cachedColor=this._layer.options.color,this.isRed=!1):this.isRed=!0,this._handleLayerStyle()),this._fireEnable()}},disable(){if(!this.enabled()||this._dragging)return;this._enabled=!1,this._markerGroup.clearLayers(),this._markerGroup.removeFrom(this._map),this._layer.off("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.off("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this);let e=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(e,"leaflet-pm-draggable"),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()},enabled(){return this._enabled},toggleEdit(e){return this.enabled()?this.disable():this.enable(e),this.enabled()},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initMarkers(){let e=this._map,t=this._layer.getLatLngs();this._markerGroup&&(this._markerGroup.removeFrom(e),this._markerGroup.clearLayers()),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0;let r=i=>{if(Array.isArray(i[0]))return i.map(r,this);let n=i.map(this._createMarker,this);return this.options.hideMiddleMarkers!==!0&&i.map((a,s)=>{let o=this.isPolygon()?(s+1)%i.length:s+1;return this._createMiddleMarker(n[s],n[o])}),n};this._markers=r(t),this.filterMarkerGroup(),e.addLayer(this._markerGroup)},_createMarker(e){let t=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this.options.rotate?(t.on("dragstart",this._onRotateStart,this),t.on("drag",this._onRotate,this),t.on("dragend",this._onRotateEnd,this)):(t.on("click",this._onVertexClick,this),t.on("dragstart",this._onMarkerDragStart,this),t.on("move",this._onMarkerDrag,this),t.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||t.on(this.options.removeVertexOn,this._removeMarker,this)),this._markerGroup.addLayer(t),t},_createMiddleMarker(e,t){if(!e||!t)return!1;let r=L.PM.Utils.calcMiddleLatLng(this._map,e.getLatLng(),t.getLatLng()),i=this._createMarker(r),n=L.divIcon({className:"marker-icon marker-icon-middle"});return i.setIcon(n),i.leftM=e,i.rightM=t,e._middleMarkerNext=i,t._middleMarkerPrev=i,i.on(this.options.addVertexOn,this._onMiddleMarkerClick,this),i.on("movestart",this._onMiddleMarkerMoveStart,this),i},_onMiddleMarkerClick(e){let t=e.target;if(!this._vertexValidation("add",e))return;let r=L.divIcon({className:"marker-icon"});t.setIcon(r),this._addMarker(t,t.leftM,t.rightM)},_onMiddleMarkerMoveStart(e){let t=e.target;if(t.on("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidation("add",e)){t.on("move",this._onMiddleMarkerMovePrevent,this);return}t._dragging=!0,this._addMarker(t,t.leftM,t.rightM)},_onMiddleMarkerMovePrevent(e){let t=e.target;this._vertexValidationDrag(t)},_onMiddleMarkerMoveEnd(e){let t=e.target;if(t.off("move",this._onMiddleMarkerMovePrevent,this),t.off("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidationDragEnd(t))return;let r=L.divIcon({className:"marker-icon"});t.setIcon(r),setTimeout(()=>{delete t._dragging},100)},_addMarker(e,t,r){e.off("movestart",this._onMiddleMarkerMoveStart,this),e.off(this.options.addVertexOn,this._onMiddleMarkerClick,this);let i=e.getLatLng(),n=this._layer._latlngs;delete e.leftM,delete e.rightM;let{indexPath:a,index:s,parentPath:o}=L.PM.Utils.findDeepMarkerIndex(this._markers,t),l=a.length>1?(0,mt.default)(n,o):n,h=a.length>1?(0,mt.default)(this._markers,o):this._markers;l.splice(s+1,0,i),h.splice(s+1,0,e),this._layer.setLatLngs(n),this.options.hideMiddleMarkers!==!0&&(this._createMiddleMarker(t,e),this._createMiddleMarker(e,r)),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit"),this._fireVertexAdded(e,L.PM.Utils.findDeepMarkerIndex(this._markers,e).indexPath,i),this.options.snappable&&this._initSnappableMarkers()},hasSelfIntersection(){return vr(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersectionOnVertexRemoval(){this._handleLayerStyle(!0)&&(this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers())},_handleLayerStyle(e){let t=this._layer,r,i;if(this.options.allowSelfIntersection?r=!1:(i=vr(this._layer.toGeoJSON(15)),r=i.features.length>0),r){if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!0),this.isRed)return r;e?this._flashLayer():(t.setStyle({color:"#f00000ff"}),this.isRed=!0),this._fireIntersect(i)}else t.setStyle({color:this.cachedColor}),this.isRed=!1,!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!1);return r},_flashLayer(){this.cachedColor||(this.cachedColor=this._layer.options.color),this._layer.setStyle({color:"#f00000ff"}),this.isRed=!0,window.setTimeout(()=>{this._layer.setStyle({color:this.cachedColor}),this.isRed=!1},200)},_updateDisabledMarkerStyle(e,t){e.forEach(r=>{Array.isArray(r)?this._updateDisabledMarkerStyle(r,t):r._icon&&(t&&!this._checkMarkerAllowedToDrag(r)?L.DomUtil.addClass(r._icon,"vertexmarker-disabled"):L.DomUtil.removeClass(r._icon,"vertexmarker-disabled"))})},_removeMarker(e){let t=e.target;if(!this._vertexValidation("remove",e))return;this.options.allowSelfIntersection||(this._coordsBeforeEdit=dt(this._layer,this._layer.getLatLngs()));let r=this._layer.getLatLngs(),{indexPath:i,index:n,parentPath:a}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);if(!i)return;let s=i.length>1?(0,mt.default)(r,a):r,o=i.length>1?(0,mt.default)(this._markers,a):this._markers,l=a[a.length-1]>0&&this._layer instanceof L.Polygon;if(!this.options.removeLayerBelowMinVertexCount&&!l&&(s.length<=2||this.isPolygon()&&s.length<=3)){this._flashLayer();return}s.splice(n,1),this._layer.setLatLngs(r),this.isPolygon()&&s.length<=2&&s.splice(0,s.length);let h=!1;if(s.length<=1&&(s.splice(0,s.length),a.length>1&&i.length>1&&(r=br(r)),this._layer.setLatLngs(r),this._initMarkers(),h=!0),$r(r)||this._layer.remove(),r=br(r),this._layer.setLatLngs(r),this._markers=br(this._markers),!h&&(o=i.length>1?(0,mt.default)(this._markers,a):this._markers,t._middleMarkerPrev&&(this._markerGroup.removeLayer(t._middleMarkerPrev),this._removeFromCache(t._middleMarkerPrev)),t._middleMarkerNext&&(this._markerGroup.removeLayer(t._middleMarkerNext),this._removeFromCache(t._middleMarkerNext)),this._markerGroup.removeLayer(t),this._removeFromCache(t),o)){let y,m;if(this.isPolygon()?(y=(n+1)%o.length,m=(n+(o.length-1))%o.length):(m=n-1<0?void 0:n-1,y=n+1>=o.length?void 0:n+1),y!==m){let w=o[m],A=o[y];this.options.hideMiddleMarkers!==!0&&this._createMiddleMarker(w,A)}o.splice(n,1)}this._fireEdit(),this._layerEdited=!0,this._fireVertexRemoved(t,i),this._fireChange(this._layer.getLatLngs(),"Edit")},updatePolygonCoordsFromMarkerDrag(e){let t=this._layer.getLatLngs(),r=e.getLatLng(),{indexPath:i,index:n,parentPath:a}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);(i.length>1?(0,mt.default)(t,a):t).splice(n,1,r),this._layer.setLatLngs(t)},_getNeighborMarkers(e){let{indexPath:t,index:r,parentPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,e),n=t.length>1?(0,mt.default)(this._markers,i):this._markers,a=(r+1)%n.length,s=(r+(n.length-1))%n.length,o=n[s],l=n[a];return{prevMarker:o,nextMarker:l}},_checkMarkerAllowedToDrag(e){let{prevMarker:t,nextMarker:r}=this._getNeighborMarkers(e),i=L.polyline([t.getLatLng(),e.getLatLng()]),n=L.polyline([e.getLatLng(),r.getLatLng()]),a=wt(this._layer.toGeoJSON(15),i.toGeoJSON(15)).features.length,s=wt(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length;return e.getLatLng()===this._markers[0][0].getLatLng()?s+=1:e.getLatLng()===this._markers[0][this._markers[0].length-1].getLatLng()&&(a+=1),!(a<=2&&s<=2)},_onMarkerDragStart(e){let t=e.target;if(this.cachedColor||(this.cachedColor=this._layer.options.color),!this._vertexValidation("move",e))return;let{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragStart(e,r),this.options.allowSelfIntersection||(this._coordsBeforeEdit=dt(this._layer,this._layer.getLatLngs())),!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()?this._markerAllowedToDrag=this._checkMarkerAllowedToDrag(t):this._markerAllowedToDrag=null},_onMarkerDrag(e){let t=e.target;if(!this._vertexValidationDrag(t))return;let{indexPath:r,index:i,parentPath:n}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);if(!r)return;if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()&&this._markerAllowedToDrag===!1){this._layer.setLatLngs(this._coordsBeforeEdit),this._initMarkers(),this._handleLayerStyle();return}this.updatePolygonCoordsFromMarkerDrag(t);let a=r.length>1?(0,mt.default)(this._markers,n):this._markers,s=(i+1)%a.length,o=(i+(a.length-1))%a.length,l=t.getLatLng(),h=a[o].getLatLng(),y=a[s].getLatLng();if(t._middleMarkerNext){let m=L.PM.Utils.calcMiddleLatLng(this._map,l,y);t._middleMarkerNext.setLatLng(m)}if(t._middleMarkerPrev){let m=L.PM.Utils.calcMiddleLatLng(this._map,l,h);t._middleMarkerPrev.setLatLng(m)}this.options.allowSelfIntersection||this._handleLayerStyle(),this._fireMarkerDrag(e,r),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(e){let t=e.target;if(!this._vertexValidationDragEnd(t))return;let{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,t),i=!this.options.allowSelfIntersection&&this.hasSelfIntersection();i&&this.options.allowSelfIntersectionEdit&&this._markerAllowedToDrag&&(i=!1);let n=!this.options.allowSelfIntersection&&i;if(this._fireMarkerDragEnd(e,r,n),n){this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers(),this.options.snappable&&this._initSnappableMarkers(),this._handleLayerStyle(),this._fireLayerReset(e,r);return}!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._handleLayerStyle(),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_onVertexClick(e){let t=e.target;if(t._dragging)return;let{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireVertexClick(e,r)}}),me.Polygon=me.Line.extend({_shape:"Polygon",_checkMarkerAllowedToDrag(e){let{prevMarker:t,nextMarker:r}=this._getNeighborMarkers(e),i=L.polyline([t.getLatLng(),e.getLatLng()]),n=L.polyline([e.getLatLng(),r.getLatLng()]),a=wt(this._layer.toGeoJSON(15),i.toGeoJSON(15)).features.length,s=wt(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length;return!(a<=2&&s<=2)}}),me.Rectangle=me.Polygon.extend({_shape:"Rectangle",_initMarkers(){let e=this._map,t=this._findCorners();this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0,e.addLayer(this._markerGroup),this._markers=[],this._markers[0]=t.map(this._createMarker,this),[this._cornerMarkers]=this._markers,this._layer.getLatLngs()[0].forEach((r,i)=>{let n=this._cornerMarkers.find(a=>a._index===i);n&&n.setLatLng(r)})},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this._addMarkerEvents()},_createMarker(e,t){let r=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(r,"vertexPane"),r._origLatLng=e,r._index=t,r._pmTempLayer=!0,r.on("click",this._onVertexClick,this),this._markerGroup.addLayer(r),r},_addMarkerEvents(){this._markers[0].forEach(e=>{e.on("dragstart",this._onMarkerDragStart,this),e.on("drag",this._onMarkerDrag,this),e.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||e.on("contextmenu",this._removeMarker,this)})},_removeMarker(){return null},_onMarkerDragStart(e){if(!this._vertexValidation("move",e))return;let t=e.target,r=this._cornerMarkers;t._oppositeCornerLatLng=r.find(n=>n._index===(t._index+2)%4).getLatLng(),t._snapped=!1;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragStart(e,i)},_onMarkerDrag(e){let t=e.target;if(!this._vertexValidationDrag(t)||t._index===void 0)return;this._adjustRectangleForMarkerMove(t);let{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDrag(e,r),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(e){let t=e.target;if(!this._vertexValidationDragEnd(t))return;this._cornerMarkers.forEach(i=>{delete i._oppositeCornerLatLng});let{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragEnd(e,r),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_adjustRectangleForMarkerMove(e){L.extend(e._origLatLng,e._latlng);let t=L.PM.Utils._getRotatedRectangle(e.getLatLng(),e._oppositeCornerLatLng,this.getAngle(),this._map);this._layer.setLatLngs(t),this._adjustAllMarkers(e),this._layer.redraw()},_adjustAllMarkers(e){let t=this._layer.getLatLngs()[0];if(t&&t.length!==4&&t.length>0)t.forEach((r,i)=>{this._cornerMarkers[i].setLatLng(r)}),this._cornerMarkers.slice(t.length).forEach(r=>{r.setLatLng(t[0])});else if(!t||!t.length)console.error("The layer has no LatLngs");else{let r=t.findIndex(i=>e.getLatLng().equals(i));r>-1?(this._cornerMarkers[(e._index+1)%4].setLatLng(t[(r+1)%4]),this._cornerMarkers[(e._index+2)%4].setLatLng(t[(r+2)%4]),this._cornerMarkers[(e._index+3)%4].setLatLng(t[(r+3)%4])):this._cornerMarkers.forEach(i=>{i.setLatLng(t[i._index])})}},_findCorners(){this._angle===void 0&&this.setInitAngle(Xr(this._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let e=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(e[0],e[2],this.getAngle(),this._map||this)}}),me.CircleMarker=me.extend({_shape:"CircleMarker",initialize(e){this._layer=e,this._enabled=!1,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._updateHiddenPolyCircle()},enable(e={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,e),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._extendingEnable(),this._updateHiddenPolyCircle(),this._fireEnable()},_extendingEnable(){this._layer.on("pm:dragstart",this._onDragStart,this),this._layer.on("pm:drag",this._onMarkerDrag,this),this._layer.on("pm:dragend",this._onMarkerDragEnd,this)},disable(){this.dragging()||(this._map||(this._map=this._layer._map),this._map&&this.enabled()&&(this.layerDragEnabled()&&this.disableLayerDrag(),this._helperLayers&&(this._helperLayers.clearLayers(),this._helperLayers.removeFrom(this._map)),this.options[this._editableOption]?(this._map.off("move",this._syncMarkers,this),this._outerMarker.off("drag",this._handleOuterMarkerSnapping,this)):this._map.off("move",this._updateHiddenPolyCircle,this),this._extendingDisable(),this._layer.off("remove",this.disable,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1))},_extendingDisable(){this._layer.off("contextmenu",this._removeMarker,this)},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options[this._editableOption]?(this._initMarkers(),this._map.on("move",this._syncMarkers,this),this.options.snappable?(this._initSnappableMarkers(),this._outerMarker.on("drag",this._handleOuterMarkerSnapping,this),this._outerMarker.on("move",this._syncHintLine,this),this._outerMarker.on("move",this._syncCircleRadius,this)):this._disableSnapping()):(this.options.draggable&&this.enableLayerDrag(),this._map.on("move",this._updateHiddenPolyCircle,this),this.options.snappable?this._initSnappableMarkersDrag():this._disableSnappingDrag()),this._extendingApplyOptions()},_extendingApplyOptions(){this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_initMarkers(){let e=this._map;this._helperLayers&&(this._helperLayers.removeFrom(e),this._helperLayers.clearLayers()),this._helperLayers=new L.FeatureGroup,this._helperLayers._pmTempLayer=!0,this._helperLayers.addTo(e);let t=this._layer.getLatLng(),r=this._layer._radius,i=this._getLatLngOnCircle(t,r);this._centerMarker=this._createCenterMarker(t),this._outerMarker=this._createOuterMarker(i),this._markers=[this._centerMarker,this._outerMarker],this._createHintLine(this._centerMarker,this._outerMarker)},_getLatLngOnCircle(e,t){let r=this._map.project(e),i=L.point(r.x+t,r.y);return this._map.unproject(i)},_createHintLine(e,t){let r=e.getLatLng(),i=t.getLatLng();this._hintline=L.polyline([r,i],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._helperLayers.addLayer(this._hintline)},_createCenterMarker(e){let t=this._createMarker(e);return this.options.draggable?(L.DomUtil.addClass(t._icon,"leaflet-pm-draggable"),t.on("move",this._moveCircle,this)):t.dragging.disable(),t},_createOuterMarker(e){let t=this._createMarker(e);return t.on("drag",this._resizeCircle,this),t},_createMarker(e){let t=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._origLatLng=e,t._pmTempLayer=!0,t.on("dragstart",this._onMarkerDragStart,this),t.on("drag",this._onMarkerDrag,this),t.on("dragend",this._onMarkerDragEnd,this),t.on("click",this._onVertexClick,this),this._helperLayers.addLayer(t),t},_moveCircle(e){if(e.target._cancelDragEventChain)return;let t=this._centerMarker.getLatLng();this._layer.setLatLng(t);let r=this._layer._radius,i=this._getLatLngOnCircle(t,r);this._outerMarker._latlng=i,this._outerMarker.update(),this._syncHintLine(),this._updateHiddenPolyCircle(),this._fireCenterPlaced("Edit"),this._fireChange(this._layer.getLatLng(),"Edit")},_syncMarkers(){let e=this._layer.getLatLng(),t=this._layer._radius,r=this._getLatLngOnCircle(e,t);this._outerMarker.setLatLng(r),this._centerMarker.setLatLng(e),this._syncHintLine(),this._updateHiddenPolyCircle()},_resizeCircle(){this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker()),this._syncHintLine(),this._syncCircleRadius()},_syncCircleRadius(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),r=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&r<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&r>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(r),this._updateHiddenPolyCircle(),this._fireChange(this._layer.getLatLng(),"Edit")},_syncHintLine(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng();this._hintline.setLatLngs([e,t])},_removeMarker(){this.options[this._editableOption]&&this.disable(),this._layer.remove(),this._fireRemove(this._layer),this._fireRemove(this._map,this._layer)},_onDragStart(){this._map.pm.Draw.CircleMarker._layerIsDragging=!0},_onMarkerDragStart(e){this._vertexValidation("move",e)&&this._fireMarkerDragStart(e)},_onMarkerDrag(e){let t=e.target;t instanceof L.Marker&&!this._vertexValidationDrag(t)||this._fireMarkerDrag(e)},_onMarkerDragEnd(e){this._extedingMarkerDragEnd();let t=e.target;this._vertexValidationDragEnd(t)&&(this.options[this._editableOption]&&(this._fireEdit(),this._layerEdited=!0),this._fireMarkerDragEnd(e))},_extedingMarkerDragEnd(){this._map.pm.Draw.CircleMarker._layerIsDragging=!1},_initSnappableMarkersDrag(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnappingDrag(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)},_updateHiddenPolyCircle(){let e=this._layer._map||this._map;if(e){let t=L.PM.Utils.pxRadiusToMeterRadius(this._layer.getRadius(),e,this._layer.getLatLng()),r=L.circle(this._layer.getLatLng(),this._layer.options);r.setRadius(t);let i=e&&e.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(r,200,!i).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(r,200,!i),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)}},_getNewDestinationOfOuterMarker(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),r=this._distanceCalculation(e,t);return this.options[this._minRadiusOption]&&r<this.options[this._minRadiusOption]?t=Lr(this._map,e,t,this._getMinDistanceInMeter(e)):this.options[this._maxRadiusOption]&&r>this.options[this._maxRadiusOption]&&(t=Lr(this._map,e,t,this._getMaxDistanceInMeter(e))),t},_handleOuterMarkerSnapping(){if(this._outerMarker._snapped){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),r=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&r<this.options[this._minRadiusOption]?this._outerMarker.setLatLng(this._outerMarker._orgLatLng):this.options[this._maxRadiusOption]&&r>this.options[this._maxRadiusOption]&&this._outerMarker.setLatLng(this._outerMarker._orgLatLng)}this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker())},_distanceCalculation(e,t){return this._map.project(e).distanceTo(this._map.project(t))},_getMinDistanceInMeter(e){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,e)},_getMaxDistanceInMeter(e){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,e)},_onVertexClick(e){e.target._dragging||this._fireVertexClick(e,void 0)}}),me.Circle=me.CircleMarker.extend({_shape:"Circle",initialize(e){this._layer=e,this._enabled=!1,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizeableCircle",this._updateHiddenPolyCircle()},enable(e){L.PM.Edit.CircleMarker.prototype.enable.call(this,e||{})},_extendingEnable(){},_extendingDisable(){this._layer.off("remove",this.disable,this);let e=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(e,"leaflet-pm-draggable")},_extendingApplyOptions(){},_syncMarkers(){},_removeMarker(){},_onDragStart(){},_extedingMarkerDragEnd(){},_updateHiddenPolyCircle(){let e=this._map&&this._map.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(this._layer,200,!e).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(this._layer,200,!e),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)},_distanceCalculation(e,t){return this._map.distance(e,t)},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_onVertexClick(e){e.target._dragging||this._fireVertexClick(e,void 0)}}),me.ImageOverlay=me.extend({_shape:"ImageOverlay",initialize(e){this._layer=e,this._enabled=!1},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},enabled(){return this._enabled},enable(e={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,e),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()||this.disable(),this.enableLayerDrag(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._otherSnapLayers=this._findCorners(),this._fireEnable()}},disable(){this._dragging||(this._map||(this._map=this._layer._map),this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this.enabled()||(this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()),this._enabled=!1)},_findCorners(){let e=this._layer.getBounds(),t=e.getNorthWest(),r=e.getNorthEast(),i=e.getSouthEast(),n=e.getSouthWest();return[t,r,i,n]}}),me.Text=me.extend({_shape:"Text",initialize(e){this._layer=e,this._enabled=!1},enable(e){if(L.Util.setOptions(this,e),!!this.textArea){if(!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._safeToCacheDragState=!0,this._focusChange(),this.textArea.readOnly=!1,this.textArea.classList.remove("pm-disabled"),this._layer.on("remove",this.disable,this),L.DomEvent.on(this.textArea,"input",this._autoResize,this),L.DomEvent.on(this.textArea,"focus",this._focusChange,this),L.DomEvent.on(this.textArea,"blur",this._focusChange,this),this._layer.on("dblclick",L.DomEvent.stop),L.DomEvent.off(this.textArea,"mousedown",this._preventTextSelection),this._enabled=!0,this._fireEnable()}},disable(){if(!this.enabled())return;this._layer.off("remove",this.disable,this),L.DomEvent.off(this.textArea,"input",this._autoResize,this),L.DomEvent.off(this.textArea,"focus",this._focusChange,this),L.DomEvent.off(this.textArea,"blur",this._focusChange,this),L.DomEvent.off(document,"click",this._documentClick,this),this._focusChange(),this.textArea.readOnly=!0,this.textArea.classList.add("pm-disabled");let e=document.activeElement;this.textArea.focus(),this.textArea.selectionStart=0,this.textArea.selectionEnd=0,L.DomEvent.on(this.textArea,"mousedown",this._preventTextSelection),e.focus(),this._disableOnBlurActive=!1,this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initSnappableMarkers(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)},_autoResize(){this.textArea.style.height="1px",this.textArea.style.width="1px";let e=this.textArea.scrollHeight>21?this.textArea.scrollHeight:21,t=this.textArea.scrollWidth>16?this.textArea.scrollWidth:16;this.textArea.style.height=`${e}px`,this.textArea.style.width=`${t}px`,this._layer.options.text=this.getText(),this._fireTextChange(this.getText())},_disableOnBlur(){this._disableOnBlurActive=!0,setTimeout(()=>{this.enabled()&&L.DomEvent.on(document,"click",this._documentClick,this)},100)},_documentClick(e){e.target!==this.textArea&&(this.disable(),!this.getText()&&this.options.removeIfEmpty&&this.remove())},_focusChange(e={}){let t=this._hasFocus;this._hasFocus=e.type==="focus",!t!=!this._hasFocus&&(this._hasFocus?(this._applyFocus(),this._focusText=this.getText(),this._fireTextFocus()):(this._removeFocus(),this._fireTextBlur(),this._focusText!==this.getText()&&(this._fireEdit(),this._layerEdited=!0)))},_applyFocus(){this.textArea.classList.add("pm-hasfocus"),this._map.dragging&&(this._safeToCacheDragState&&(this._originalMapDragState=this._map.dragging._enabled,this._safeToCacheDragState=!1),this._map.dragging.disable())},_removeFocus(){this._map.dragging&&(this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0),this.textArea.classList.remove("pm-hasfocus")},focus(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.focus()},blur(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.blur(),this._disableOnBlurActive&&this.disable()},hasFocus(){return this._hasFocus},getElement(){return this.textArea},setText(e){e&&(this.textArea.value=e),this._autoResize()},getText(){return this.textArea.value},_initTextMarker(){if(this.textArea=L.PM.Draw.Text.prototype._createTextArea.call(this),this.options.className){let t=this.options.className.split(" ");this.textArea.classList.add(...t)}let e=L.PM.Draw.Text.prototype._createTextIcon.call(this,this.textArea);this._layer.setIcon(e),this._layer.once("add",this._createTextMarker,this)},_createTextMarker(e=!1){this._layer.off("add",this._createTextMarker,this),this._layer.getElement().tabIndex=-1,this.textArea.wrap="off",this.textArea.style.overflow="hidden",this.textArea.style.height=L.DomUtil.getStyle(this.textArea,"font-size"),this.textArea.style.width="1px",this._layer.options.text&&this.setText(this._layer.options.text),this._autoResize(),e===!0&&(this.enable(),this.focus(),this._disableOnBlur())},_preventTextSelection(e){e.preventDefault()}});var hi=function(e,t,r,i,n,a){this._matrix=[e,t,r,i,n,a]};hi.init=()=>new L.PM.Matrix(1,0,0,1,0,0),hi.prototype={transform(e){return this._transform(e.clone())},_transform(e){let t=this._matrix,{x:r,y:i}=e;return e.x=t[0]*r+t[1]*i+t[4],e.y=t[2]*r+t[3]*i+t[5],e},untransform(e){let t=this._matrix;return new L.Point((e.x/t[0]-t[4])/t[0],(e.y/t[2]-t[5])/t[2])},clone(){let e=this._matrix;return new L.PM.Matrix(e[0],e[1],e[2],e[3],e[4],e[5])},translate(e){if(e===void 0)return new L.Point(this._matrix[4],this._matrix[5]);let t,r;return typeof e=="number"?(t=e,r=e):(t=e.x,r=e.y),this._add(1,0,0,1,t,r)},scale(e,t){if(e===void 0)return new L.Point(this._matrix[0],this._matrix[3]);let r,i;return t=t||L.point(0,0),typeof e=="number"?(r=e,i=e):(r=e.x,i=e.y),this._add(r,0,0,i,t.x,t.y)._add(1,0,0,1,-t.x,-t.y)},rotate(e,t){let r=Math.cos(e),i=Math.sin(e);return t=t||new L.Point(0,0),this._add(r,i,-i,r,t.x,t.y)._add(1,0,0,1,-t.x,-t.y)},flip(){return this._matrix[1]*=-1,this._matrix[2]*=-1,this},_add(e,t,r,i,n,a){let s=[[],[],[]],o=this._matrix,l=[[o[0],o[2],o[4]],[o[1],o[3],o[5]],[0,0,1]],h=[[e,r,n],[t,i,a],[0,0,1]],y;e&&e instanceof L.PM.Matrix&&(o=e._matrix,h=[[o[0],o[2],o[4]],[o[1],o[3],o[5]],[0,0,1]]);for(let m=0;m<3;m+=1)for(let w=0;w<3;w+=1){y=0;for(let A=0;A<3;A+=1)y+=l[m][A]*h[A][w];s[m][w]=y}return this._matrix=[s[0][0],s[1][0],s[0][1],s[1][1],s[0][2],s[1][2]],this}};var Ks=hi,qs={calcMiddleLatLng(e,t,r){let i=e.project(t),n=e.project(r);return e.unproject(i._add(n)._divideBy(2))},findLayers(e){let t=[];return e.eachLayer(r=>{(r instanceof L.Polyline||r instanceof L.Marker||r instanceof L.Circle||r instanceof L.CircleMarker||r instanceof L.ImageOverlay)&&t.push(r)}),t=t.filter(r=>!!r.pm),t=t.filter(r=>!r._pmTempLayer),t=t.filter(r=>!L.PM.optIn&&!r.options.pmIgnore||L.PM.optIn&&r.options.pmIgnore===!1),t},circleToPolygon(e,t=60,r=!0){let i=e.getLatLng(),n=e.getRadius(),a=xi(i,n,t,0,r),s=[];for(let o=0;o<a.length;o+=1){let l=[a[o].lat,a[o].lng];s.push(l)}return L.polygon(s,e.options)},disablePopup(e){e.getPopup()&&(e._tempPopupCopy=e.getPopup(),e.unbindPopup())},enablePopup(e){e._tempPopupCopy&&(e.bindPopup(e._tempPopupCopy),delete e._tempPopupCopy)},_fireEvent(e,t,r,i=!1){e.fire(t,r,i);let{groups:n}=this.getAllParentGroups(e);n.forEach(a=>{a.fire(t,r,i)})},getAllParentGroups(e){let t=[],r=[],i=n=>{for(let a in n._eventParents)if(t.indexOf(a)===-1){t.push(a);let s=n._eventParents[a];r.push(s),i(s)}};return!e._pmLastGroupFetch||!e._pmLastGroupFetch.time||new Date().getTime()-e._pmLastGroupFetch.time>1e3?(i(e),e._pmLastGroupFetch={time:new Date().getTime(),groups:r,groupIds:t},{groupIds:t,groups:r}):{groups:e._pmLastGroupFetch.groups,groupIds:e._pmLastGroupFetch.groupIds}},createGeodesicPolygon:xi,getTranslation:Z,findDeepCoordIndex(e,t,r=!0){let i,n=s=>(o,l)=>{let h=s.concat(l);if(r){if(o.lat&&o.lat===t.lat&&o.lng===t.lng)return i=h,!0}else if(o.lat&&L.latLng(o).equals(t))return i=h,!0;return Array.isArray(o)&&o.some(n(h))};e.some(n([]));let a={};return i&&(a={indexPath:i,index:i[i.length-1],parentPath:i.slice(0,i.length-1)}),a},findDeepMarkerIndex(e,t){let r,i=a=>(s,o)=>{let l=a.concat(o);return s._leaflet_id===t._leaflet_id?(r=l,!0):Array.isArray(s)&&s.some(i(l))};e.some(i([]));let n={};return r&&(n={indexPath:r,index:r[r.length-1],parentPath:r.slice(0,r.length-1)}),n},_getIndexFromSegment(e,t){if(t&&t.length===2){let r=this.findDeepCoordIndex(e,t[0]),i=this.findDeepCoordIndex(e,t[1]),n=Math.max(r.index,i.index);return(r.index===0||i.index===0)&&n!==1&&(n+=1),{indexA:r,indexB:i,newIndex:n,indexPath:r.indexPath,parentPath:r.parentPath}}return null},_getRotatedRectangle(e,t,r,i){let n=Yt(i,e),a=Yt(i,t),s=r*Math.PI/180,o=Math.cos(s),l=Math.sin(s),h=(a.x-n.x)*o+(a.y-n.y)*l,y=(a.y-n.y)*o-(a.x-n.x)*l,m=h*o+n.x,w=h*l+n.y,A=-y*l+n.x,O=y*o+n.y,I=Tr(i,n),G=Tr(i,{x:m,y:w}),J=Tr(i,a),_=Tr(i,{x:A,y:O});return[I,G,J,_]},pxRadiusToMeterRadius(e,t,r){let i=t.project(r),n=L.point(i.x+e,i.y);return t.distance(t.unproject(n),r)}},Hs=qs;L.PM=L.PM||{version:Pn.version,Map:La,Toolbar:ka,Draw:be,Edit:me,Utils:Hs,Matrix:Ks,activeLang:"en",optIn:!1,initialize(e){this.addInitHooks(e)},setOptIn(e){this.optIn=!!e},addInitHooks(){function e(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Map(this)):this.options.pmIgnore||(this.pm=new L.PM.Map(this)),this.pm&&this.pm.setGlobalOptions({})}L.Map.addInitHook(e);function t(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.LayerGroup(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.LayerGroup(this))}L.LayerGroup.addInitHook(t);function r(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this)):this.options.pmIgnore||(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this))}L.Marker.addInitHook(r);function i(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.CircleMarker(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.CircleMarker(this))}L.CircleMarker.addInitHook(i);function n(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Line(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Line(this))}L.Polyline.addInitHook(n);function a(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Polygon(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Polygon(this))}L.Polygon.addInitHook(a);function s(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Rectangle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Rectangle(this))}L.Rectangle.addInitHook(s);function o(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Circle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Circle(this))}L.Circle.addInitHook(o);function l(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.ImageOverlay(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.ImageOverlay(this))}L.ImageOverlay.addInitHook(l)},reInitLayer(e){e instanceof L.LayerGroup&&e.eachLayer(t=>{this.reInitLayer(t)}),e.pm||L.PM.optIn&&e.options.pmIgnore!==!1||e.options.pmIgnore||(e instanceof L.Map?e.pm=new L.PM.Map(e):e instanceof L.Marker?e.options.textMarker?(e.pm=new L.PM.Edit.Text(e),e.pm._initTextMarker(),e.pm._createTextMarker(!1)):e.pm=new L.PM.Edit.Marker(e):e instanceof L.Circle?e.pm=new L.PM.Edit.Circle(e):e instanceof L.CircleMarker?e.pm=new L.PM.Edit.CircleMarker(e):e instanceof L.Rectangle?e.pm=new L.PM.Edit.Rectangle(e):e instanceof L.Polygon?e.pm=new L.PM.Edit.Polygon(e):e instanceof L.Polyline?e.pm=new L.PM.Edit.Line(e):e instanceof L.LayerGroup?e.pm=new L.PM.Edit.LayerGroup(e):e instanceof L.ImageOverlay&&(e.pm=new L.PM.Edit.ImageOverlay(e)))}},L.version==="1.7.1"&&L.Canvas.include({_onClick(e){let t=this._map.mouseEventToLayerPoint(e),r,i;for(let n=this._drawFirst;n;n=n.next)r=n.layer,r.options.interactive&&r._containsPoint(t)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(r))&&(i=r);i&&(L.DomEvent.fakeStop(e),this._fireEvent([i],e))}}),L.PM.initialize()})()),rn}Qs();function an(re){const ue=new Date(re),Ee=oe=>String(oe).padStart(2,"0");return`${ue.getFullYear()}-${Ee(ue.getMonth()+1)}-${Ee(ue.getDate())}T${Ee(ue.getHours())}:${Ee(ue.getMinutes())}`}function eo(){const re=St();return K.useEffect(()=>{const ue=We.control.scale({position:"bottomleft"});return ue.addTo(re),()=>{ue.remove()}},[re]),null}function to(){const re=St(),[ue,Ee]=K.useState({});return K.useEffect(()=>{const oe=()=>{re&&Ee({center:re.getCenter(),zoom:re.getZoom(),size:re.getSize(),bounds:re.getBounds()})};return oe(),re.on("move zoom resize",oe),()=>{re.off("move zoom resize",oe)}},[re]),null}function ro(){const re=St();return K.useEffect(()=>{console.log("SimpleMapTest: Map instance:",re),console.log("SimpleMapTest: Map size:",re.getSize()),console.log("SimpleMapTest: Map center:",re.getCenter()),console.log("SimpleMapTest: Map zoom:",re.getZoom())},[re]),null}function ao(){const re=K.useMemo(()=>[37.7749,-122.4194],[]),[ue,Ee]=K.useState("history"),[oe,_t]=K.useState("24h"),[Ne,F]=K.useState(()=>an(Date.now()-1440*60*1e3)),[Re,Be]=K.useState(()=>an(Date.now())),[ze,pe]=K.useState([]),[le,he]=K.useState(["all"]),[ge,Qe]=K.useState([]),[_e,Le]=K.useState({}),[ne,yt]=K.useState(null),[Tt,Gr]=K.useState(!1),[bt,Ue]=K.useState(null),[Ft,$t]=K.useState(null),Xt=K.useRef(null),[Oe,et]=K.useState(!0),[De,Nr]=K.useState(!1),[ot,Rt]=K.useState(!1),[Ot,Jt]=K.useState(null),[Lt,cr]=K.useState(1),[ut,It]=K.useState(!1),[Pe,vt]=K.useState(null),[Ct,xt]=K.useState(250),[Ie,Ve]=K.useState(["all"]),[Ke,qe]=K.useState(""),[we,kt]=K.useState(!1),[ye,Mt]=K.useState(""),[jt,Zt]=K.useState(!0),[Wt,Gt]=K.useState(!0),[lt,ht]=K.useState("#0066cc"),[Qt,Nt]=K.useState(null),[de,zr]=K.useState(!1),[tt,pr]=K.useState(!1),[ve,zt]=K.useState(null),Ur=["#0066cc","#0d47a1","#1565c0","#1976d2","#0288d1","#00695c","#00796b","#00897b","#26a69a","#c62828","#d84315","#455a64","#546e7a","#607d8b","#2e7d32","#388e3c"],rt=D=>D&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(D),{timeRangeStart:it,timeRangeEnd:He,isCustomRangeValid:ct}=K.useMemo(()=>{const D=Date.now();if(oe==="7d")return{timeRangeStart:D-168*3600*1e3,timeRangeEnd:D,isCustomRangeValid:!0};if(oe==="30d")return{timeRangeStart:D-720*3600*1e3,timeRangeEnd:D,isCustomRangeValid:!0};if(oe==="custom"){const q=new Date(Ne).getTime(),z=new Date(Re).getTime();if(Number.isFinite(q)&&Number.isFinite(z)&&z>q)return{timeRangeStart:q,timeRangeEnd:z,isCustomRangeValid:!0}}return{timeRangeStart:D-24*3600*1e3,timeRangeEnd:D,isCustomRangeValid:oe!=="custom"}},[oe,Ne,Re]);K.useEffect(()=>{const D=()=>{zr(window.innerWidth<=768)};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]);const Vr=D=>{try{const q=Xt.current;if(!q)return;const z=Array.isArray(_e[D])?_e[D]:[],U=z.length?z[z.length-1]:null;if(!U||!Number.isFinite(U.lat)||!Number.isFinite(U.lng))return;const Y=Math.max(14,q.getZoom()||0);try{typeof q.flyTo=="function"?q.flyTo([U.lat,U.lng],Y,{animate:!0,duration:.8}):q.setView([U.lat,U.lng],Y,{animate:!0})}catch{}try{const $=We.circleMarker([U.lat,U.lng],{radius:10,color:"#1a1a1a",weight:2,fillColor:"#0066cc",fillOpacity:.6,opacity:.9});$.addTo(q),setTimeout(()=>{try{$.remove()}catch{}},1200)}catch{}}catch{}};K.useEffect(()=>{if(!ne){Le({});return}const D=it,q=He;try{const z=le.includes("all");console.log("📊 Loading locations - myTags:",ge.length,ge.map(X=>({id:X.id,status:X.status,name:X.customName||"Unnamed"})));const U=ge.filter(X=>X.status==="linked"&&X.hardwareId);console.log("🔗 Linked tags:",U.length,U.map(X=>({id:X.id,name:X.customName||"Unnamed"})));const $=(z?U:U.filter(X=>le.includes(X.id))).map(X=>({hardwareId:X.hardwareId,tagId:X.id,displayName:X.customName||`Tag ${X.id.slice(-4)}`}));if(console.log("✅ Active tags to query:",$.length,$),$.length===0){console.log("⚠️ No active tags to query - stopping"),Le({});return}const ie=[],ce={};for(const X of $){console.log(`🔍 Querying locations for tag: ${X.displayName} (${X.tagId})`);const nt=Or(At,"airtags",X.hardwareId,"locations"),tr=Wi(nt,Ys("timestampMs",">=",D),Qi("timestampMs","asc")),fr=di(tr,Bt=>{$t(null),console.log(`✅ Locations loaded for ${X.displayName}:`,Bt.size);const qr=Bt.docs.map(pt=>{const Ut=pt.data(),mr=Number(Ut.timestampMs);return{lat:Number(Ut.latitude),lng:Number(Ut.longitude),ts:new Date(mr),timestampMs:mr}}).filter(pt=>Number.isFinite(pt.lat)&&Number.isFinite(pt.lng)&&Number.isFinite(pt.timestampMs)&&pt.timestampMs<=q);ce[X.tagId]=qr,Le({...ce})},Bt=>{console.error(`❌ locations subscribe error for hardware ${X.hardwareId}`,Bt),console.error(`Current user UID: ${ne}`),$t(Bt)});ie.push(fr)}return()=>ie.forEach(X=>X())}catch(z){console.error("airtags subscribe setup failed",z),$t(z),Le({})}},[ne,it,He,le.join("|"),ge]),K.useEffect(()=>{Ft&&Le({})},[Ft]),K.useEffect(()=>{const D=document.body.style.overflow,q=document.body.style.height,z=document.body.style.minHeight;return document.body.style.overflow="visible",document.body.style.height="100vh",document.body.style.minHeight="100vh",()=>{document.body.style.overflow=D,document.body.style.height=q,document.body.style.minHeight=z}},[]),K.useEffect(()=>{if(!ne){Qe([]);return}try{const D=Or(At,"users",ne,"tags"),q=di(D,z=>{const U=z.docs.map(ie=>({id:ie.id,...ie.data()||{}}));Qe(U);const Y=new Set(U.map(ie=>ie.id)),$=le.filter(ie=>ie==="all"||Y.has(ie));$.length!==le.length&&he($)},()=>Qe([]));return()=>q()}catch{Qe([])}},[ne]),K.useEffect(()=>{const D=en.currentUser;D&&yt(D.uid);const q=$s(en,z=>yt(z?z.uid:null));return()=>q()},[]),K.useEffect(()=>{if(!ne){pe([]);return}try{const D=Or(At,"users",ne,"geofences"),q=Wi(D,Qi("createdAt","asc")),z=di(q,U=>{const Y=U.docs.map($=>({id:$.id,...$.data()}));pe(Y),Ue(null)},U=>{console.error("Firebase error:",U),Ue("Failed to load geofences. Please check your connection."),pe([])});return()=>z()}catch(D){console.error("Firebase setup error:",D),Ue("Failed to connect to database."),pe([])}},[ne]);function dr({enabled:D,onPickCenter:q}){const z=St();return K.useEffect(()=>{if(!D)return;const U=Y=>q&&q(Y.latlng);return z.getContainer().style.cursor="crosshair",z.on("click",U),()=>{z.off("click",U),z.getContainer().style.cursor=""}},[z,D,q]),null}function Et({center:D,radius:q,color:z="#0066cc"}){const U=St(),Y=K.useRef(null);return K.useEffect(()=>{const $=Number(D?.lat),ie=Number(D?.lng),ce=Number(q);if(!D||!Number.isFinite($)||!Number.isFinite(ie)||!Number.isFinite(ce)||ce<=0){Y.current&&(Y.current.remove(),Y.current=null);return}Y.current?(Y.current.setLatLng([$,ie]),Y.current.setRadius(ce)):Y.current=We.circle([$,ie],{radius:ce,color:z,fillColor:z,fillOpacity:.1,weight:2,dashArray:"4,3"}).addTo(U)},[U,D,q,z]),K.useEffect(()=>()=>{Y.current&&(Y.current.remove(),Y.current=null)},[U]),null}function gr(){return K.useEffect(()=>{const D=document.querySelector(".global-header"),q=D?D.getBoundingClientRect().height:80,z=document.querySelectorAll(".leaflet-top");return z.forEach(U=>{U.style.marginTop=`${q+12}px`}),()=>{z.forEach(U=>{U.style.marginTop=""})}},[]),null}const er=async()=>{if(!tt)try{if(pr(!0),!ne){alert("Please sign in to save geofences.");return}if(!Pe){alert("Click on the map to set a center.");return}if(!Ke.trim()){alert("Please enter a name for the geofence.");return}if(!!Qt){const q=gi(At,"users",ne,"geofences",Qt);await tn(q,{name:Ke.trim(),color:lt,updatedAt:Ir(),geometry:{center:{lat:Pe.lat,lng:Pe.lng},radiusMeters:Ct},targetTagIds:Ie,alertPreferences:{onEntry:jt,onExit:Wt,emailEnabled:we,emailAddress:we?ye.trim():null}})}else{const q=Or(At,"users",ne,"geofences");await Ws(q,{name:Ke.trim(),color:lt,active:!0,createdAt:Ir(),updatedAt:Ir(),type:"circle",geometry:{center:{lat:Pe.lat,lng:Pe.lng},radiusMeters:Ct},targetTagIds:Ie,alertPreferences:{onEntry:jt,onExit:Wt,emailEnabled:we,emailAddress:we?ye.trim():null}})}It(!1),Nt(null),vt(null),xt(250),Ve(["all"]),qe(""),ht("#0066cc"),kt(!1),Mt(""),Zt(!0),Gt(!0)}catch(D){console.error("Failed to save geofence:",D),alert("Failed to save geofence. Please try again.")}finally{pr(!1)}};function Kr(){const D=St(),q=K.useRef(null);return K.useEffect(()=>{q.current||(q.current=We.layerGroup().addTo(D));const z=q.current;return z.clearLayers(),ze.forEach(U=>{if(U.active!==!1){if(U.type==="circle"&&U.geometry?.center){const Y=Number(U.geometry.center.lat),$=Number(U.geometry.center.lng),ie=Number(U.geometry.radiusMeters||100);if(!Number.isFinite(Y)||!Number.isFinite($)||!Number.isFinite(ie)||ie<=0)return;We.circle([Y,$],{radius:ie,color:U.color||"#0066cc",fillColor:U.color||"#0066cc",fillOpacity:.1,weight:2}).addTo(z)}else if(U.type==="polygon"&&U.geometry){const Y=U.geometry;let $=[];try{Y&&Array.isArray(Y.coordinates)&&(Y.type==="Polygon"?$=Array.isArray(Y.coordinates[0])?Y.coordinates[0]:[]:Y.type==="MultiPolygon"&&($=Array.isArray(Y.coordinates[0])&&Array.isArray(Y.coordinates[0][0])?Y.coordinates[0][0]:[]))}catch{$=[]}const ie=Array.isArray($)?$.filter(ce=>Array.isArray(ce)&&ce.length>=2).map(([ce,X])=>[Number(X),Number(ce)]).filter(([ce,X])=>Number.isFinite(ce)&&Number.isFinite(X)):[];ie.length>=3&&We.polygon(ie,{color:U.color||"#0066cc",fillColor:U.color||"#0066cc",fillOpacity:.1,weight:2}).addTo(z)}}}),()=>{z.clearLayers()}},[D,ze]),null}return K.useEffect(()=>{if(!ot||!De)return;const D=setInterval(()=>{Jt(q=>{if(!q)return it;const z=q+1e3*60*Lt;return z>=He?(Rt(!1),He):z})},100);return()=>clearInterval(D)},[ot,De,Lt,it,He]),T.jsxs("div",{style:{height:"100vh",width:"100%",background:"#f0f0f0",position:"relative",overflow:"hidden"},children:[bt&&T.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(255,165,0,0.9)",color:"white",padding:"12px 20px",borderRadius:"8px",zIndex:4e3,textAlign:"center",maxWidth:"400px"},children:[T.jsx("div",{style:{fontSize:"14px"},children:bt}),T.jsx("div",{style:{fontSize:"12px",marginTop:"4px",opacity:.8},children:"Map will still work, but geofences may not load."})]}),T.jsxs(Xs,{ref:Xt,center:re,zoom:5,minZoom:1,maxZoom:19,zoomSnap:1,zoomDelta:1,style:{height:de?"60vh":"100%",width:"100%",position:"absolute",top:0,left:0,zIndex:1},zoomControl:!0,scrollWheelZoom:!0,zoomAnimation:!1,fadeAnimation:!1,inertia:!1,whenReady:()=>{console.log("MapContainer ready"),Gr(!0),window.__mapContainerReady=!0,setTimeout(()=>{Xt.current?.invalidateSize()},100)},children:[T.jsx(Js,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"© OpenStreetMap contributors & CartoDB",maxZoom:19,minZoom:1}),T.jsx(eo,{}),T.jsx(gr,{}),T.jsx(Kr,{}),T.jsx(dr,{enabled:ut,onPickCenter:vt}),T.jsx(Et,{center:Pe,radius:Ct}),T.jsx(to,{}),T.jsx(ro,{}),T.jsx(io,{pathsByTag:_e,myTags:ge,showPathLines:Oe,maxTimestamp:De?Ot:null})]}),T.jsxs("div",{id:"map-ui",style:{position:"fixed",...de?{top:"calc(5rem + 60vh)",left:0,right:0,bottom:0,width:"100%",borderRadius:0,display:"flex",flexDirection:"column"}:{top:"calc(5rem + 12px)",left:"50%",transform:"translateX(-50%)",width:"min(90vw, 640px)",borderRadius:12},background:"rgba(255,255,255,0.95)",border:"1px solid var(--color-border-light)",color:"var(--color-text)",zIndex:3e3,backdropFilter:"blur(6px)",boxShadow:"0 4px 20px rgba(0,0,0,0.08)"},children:[T.jsx("div",{style:{display:"flex",gap:6,padding:8,alignItems:"center",justifyContent:"space-between"},children:T.jsx("div",{style:{display:"flex",gap:6,flex:1},children:["history","geofences"].map(D=>T.jsx("button",{onClick:()=>Ee(D),style:{flex:1,padding:"8px 10px",borderRadius:8,border:"1px solid var(--color-border)",background:ue===D?"var(--color-accent)":"var(--color-surface-hover)",color:ue===D?"white":"var(--color-text)",fontWeight:700,cursor:"pointer"},children:D==="geofences"?"Geofences & Assets":D[0].toUpperCase()+D.slice(1)},D))})}),T.jsxs("div",{style:{...de?{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"}:{padding:"8px 12px 12px 12px"}},children:[ue==="history"&&T.jsxs("div",{style:{...de?{flex:1,overflowY:"auto",padding:"0 12px 12px 12px"}:{}},children:[T.jsxs("div",{style:{display:"flex",gap:8,marginBottom:10,alignItems:"flex-start"},children:[T.jsxs("div",{style:{flex:1},children:[T.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:T.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:8,cursor:"pointer",color:"var(--color-text)"},children:[T.jsx("input",{type:"checkbox",checked:le.includes("all"),onChange:D=>{D.target.checked?he(["all"]):he([])}}),T.jsx("span",{style:{fontWeight:700},children:"Select all"})]})}),T.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,maxHeight:160,overflowY:"auto",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8},children:ge.map(D=>{const z=le.includes("all")||le.includes(D.id),U=/^#([0-9a-fA-F]{3}){1,2}$/.test(D.color||"")?D.color:"#0066cc",Y=Array.isArray(_e[D.id])&&_e[D.id].length>0,$=Tt&&Y;return T.jsxs("li",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 10px",borderBottom:"1px solid rgba(255,255,255,0.06)"},children:[T.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,cursor:"pointer",color:"var(--color-text)",flex:1},children:[T.jsx("input",{type:"checkbox",checked:z,onChange:ie=>{const ce=ie.target.checked;he(X=>{if(ce){const nt=X.filter(tr=>tr!=="all");return nt.includes(D.id)||nt.push(D.id),nt}else return X.includes("all")?[]:X.filter(nt=>nt!==D.id)})}}),T.jsx("span",{style:{width:12,height:12,background:U,borderRadius:3,border:"1px solid rgba(255,255,255,0.4)"}}),T.jsx("span",{style:{fontWeight:700,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:D.customName||`Tag ${D.id.slice(0,8)}`})]}),T.jsx("button",{onClick:()=>{Vr(D.id)},disabled:!$,style:{padding:"4px 8px",borderRadius:6,border:"1px solid var(--color-border)",background:$?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.04)",color:$?"#fff":"#777",cursor:$?"pointer":"not-allowed"},title:$?"Zoom to latest known location":"No location points available yet",children:"Zoom"})]},D.id)})}),T.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginTop:10,color:"var(--color-text)"},children:[T.jsx("span",{children:"Show path lines"}),T.jsx("button",{type:"button","aria-pressed":Oe,onClick:()=>et(D=>!D),style:{width:44,height:24,borderRadius:9999,border:"1px solid rgba(255,255,255,0.3)",background:Oe?"#0066cc":"rgba(255,255,255,0.2)",position:"relative",cursor:"pointer",padding:0},title:Oe?"Hide path lines":"Show path lines",children:T.jsx("span",{style:{position:"absolute",top:1,left:Oe?22:1,width:20,height:20,borderRadius:9999,background:"#fff"}})})]})]}),T.jsxs("select",{value:oe,onChange:D=>_t(D.target.value),style:{width:140,padding:8,borderRadius:8,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)",height:40},children:[T.jsx("option",{value:"24h",children:"Last 24h"}),T.jsx("option",{value:"7d",children:"Last 7 days"}),T.jsx("option",{value:"30d",children:"Last 30 days"}),T.jsx("option",{value:"custom",children:"Custom…"})]})]}),oe==="custom"&&T.jsxs("div",{style:{marginBottom:10,padding:10,border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,background:"rgba(255,255,255,0.04)"},children:[T.jsxs("div",{style:{display:"grid",gap:8,gridTemplateColumns:de?"1fr":"1fr 1fr"},children:[T.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"var(--color-text-secondary)"},children:["Start",T.jsx("input",{type:"datetime-local",value:Ne,max:Re||void 0,onChange:D=>F(D.target.value),style:{padding:8,borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)"}})]}),T.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"var(--color-text-secondary)"},children:["End",T.jsx("input",{type:"datetime-local",value:Re,min:Ne||void 0,onChange:D=>Be(D.target.value),style:{padding:8,borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)"}})]})]}),!ct&&T.jsx("div",{style:{marginTop:8,fontSize:12,color:"#ffb4b4"},children:"Choose a valid range where the end time is after the start time."})]}),De&&T.jsxs("div",{style:{marginTop:12,padding:"12px",background:"rgba(255,255,255,0.05)",borderRadius:8,border:"1px solid rgba(255,255,255,0.1)"},children:[T.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[T.jsx("button",{onClick:()=>Rt(!ot),style:{padding:"6px 12px",borderRadius:6,border:"1px solid var(--color-border)",background:ot?"#dc3545":"#0066cc",color:ot?"#fff":"#000",fontWeight:600,cursor:"pointer"},children:ot?"⏸️ Pause":"▶️ Play"}),T.jsx("button",{onClick:()=>{Jt(null),Rt(!1)},style:{padding:"6px 12px",borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)",fontWeight:600,cursor:"pointer"},children:"🔄 Reset"}),T.jsxs("select",{value:Lt,onChange:D=>cr(Number(D.target.value)),style:{padding:"6px 8px",borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)"},children:[T.jsx("option",{value:.5,children:"0.5x"}),T.jsx("option",{value:1,children:"1x"}),T.jsx("option",{value:2,children:"2x"}),T.jsx("option",{value:4,children:"4x"})]})]}),T.jsx("input",{type:"range",min:it,max:He,value:Ot||He,onChange:D=>{Jt(Number(D.target.value)),Rt(!1)},style:{width:"100%",height:6,cursor:"pointer"}}),T.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"var(--color-text-muted)",marginTop:4},children:[T.jsx("span",{children:new Date(it).toLocaleString()}),T.jsx("span",{children:Ot?new Date(Ot).toLocaleString():oe==="custom"?new Date(He).toLocaleString():"Live"})]})]}),T.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginTop:10,color:"var(--color-text)"},children:[T.jsx("span",{children:"Timeline mode"}),T.jsx("button",{onClick:()=>Nr(!De),style:{width:44,height:24,borderRadius:9999,border:"1px solid rgba(255,255,255,0.3)",background:De?"#0066cc":"rgba(255,255,255,0.2)",position:"relative",cursor:"pointer",padding:0},children:T.jsx("span",{style:{position:"absolute",top:1,left:De?22:1,width:20,height:20,borderRadius:9999,background:"#fff",transition:"left 0.2s ease"}})})]}),T.jsx("div",{style:{marginTop:8,fontSize:12,color:"var(--color-text-muted)"},children:De?"Timeline playback: animate location data over time. Drag slider to scrub.":"Showing past locations as lines with per-point timestamps. Use Zoom to focus on a tag's last seen."})]}),ue==="geofences"&&T.jsxs("div",{style:{...de?{flex:1,overflowY:"auto",padding:"0 12px 12px 12px"}:{}},children:[T.jsx("div",{style:{display:"flex",gap:8,marginBottom:10},children:T.jsx("div",{style:{fontSize:12,color:"var(--color-text-muted)",alignSelf:"center"},children:"Create circle geofences and monitor tag activity."})}),T.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:10},children:[ut?T.jsx("div",{style:{marginBottom:8,fontSize:14,fontWeight:600,color:"var(--color-text)"},children:Qt?"✏️ Editing Geofence":"➕ Creating New Geofence"}):T.jsx("button",{onClick:()=>{It(!0),Nt(null),vt(null),qe(""),Ve(["all"]),ht("#0066cc"),kt(!1),Mt("")},style:{padding:"6px 10px",borderRadius:8,border:"1px solid var(--color-border)",background:"var(--color-accent)",color:"#fff",fontWeight:700,cursor:"pointer"},children:"Add Circle"}),ut&&T.jsxs("div",{style:{display:"grid",gap:de?6:8,width:"100%"},children:[T.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[T.jsx("input",{type:"text",placeholder:"Geofence name",value:Ke,onChange:D=>qe(D.target.value),style:{flex:1,padding:6,borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)"}}),T.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:12},children:"Click map to set center"})]}),T.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[T.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:12},children:"Radius:"}),T.jsx("input",{type:"range",min:25,max:5e3,step:25,value:Ct,onChange:D=>xt(Number(D.target.value)),style:{flex:1}}),T.jsx("input",{type:"number",min:1,value:Ct,onChange:D=>xt(Math.max(1,Number(D.target.value)||0)),style:{width:90,padding:6,borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)"}}),T.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:12},children:"m"})]}),T.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[T.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:12},children:"Monitor tags:"}),T.jsxs("select",{value:Ie.includes("all")?"all":"specific",onChange:D=>{D.target.value==="all"?Ve(["all"]):Ve([])},style:{padding:6,borderRadius:6,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)"},children:[T.jsx("option",{value:"all",children:"All tags"}),T.jsx("option",{value:"specific",children:"Specific tags"})]})]}),!Ie.includes("all")&&T.jsx("div",{style:{border:"1px solid rgba(255,255,255,0.12)",borderRadius:6,padding:6,maxHeight:80,overflowY:"auto"},children:ge.map(D=>T.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,padding:"2px 0",cursor:"pointer",fontSize:12},children:[T.jsx("input",{type:"checkbox",checked:Ie.includes(D.id),onChange:q=>{q.target.checked?Ve(z=>[...z,D.id]):Ve(z=>z.filter(U=>U!==D.id))}}),T.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:D.color||"#0066cc",marginRight:"4px"}}),T.jsx("span",{style:{color:"var(--color-text)"},children:D.customName||`Tag ${D.id.slice(0,8)}`})]},D.id))}),T.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:12},children:[T.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:12},children:"Geofence color:"}),T.jsx("div",{style:{display:"flex",gap:de?"4px":"6px",flexWrap:"wrap",maxWidth:de?"calc(100vw - 120px)":"300px",overflowX:de?"auto":"visible",paddingBottom:de?"4px":"0"},children:Ur.map(D=>T.jsx("div",{onClick:()=>ht(D),style:{width:de?"20px":"24px",height:de?"20px":"24px",borderRadius:"50%",background:D,border:lt===D?"2px solid #fff":"1px solid rgba(255,255,255,0.2)",cursor:"pointer",transform:lt===D?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",flexShrink:0},title:D},D))})]}),T.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:12},children:[T.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:12},children:"Email alerts:"}),T.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[T.jsx("input",{type:"checkbox",checked:we,onChange:D=>kt(D.target.checked),style:{width:16,height:16}}),T.jsx("span",{style:{color:"var(--color-text)",fontSize:12},children:"Enable email notifications"})]})]}),we&&T.jsxs(T.Fragment,{children:[T.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:8},children:[T.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:12},children:"Email address:"}),T.jsx("input",{type:"email",placeholder:"Enter email address",value:ye,onChange:D=>Mt(D.target.value),required:we,style:{flex:1,padding:6,borderRadius:6,border:ye&&!rt(ye)?"1px solid #f87171":"1px solid #444",background:"var(--color-bg-alt)",color:"var(--color-text)"}}),ye&&!rt(ye)&&T.jsx("span",{style:{fontSize:12,color:"#f87171",marginLeft:8},children:"Invalid email format"})]}),T.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center",marginTop:8,marginLeft:8},children:[T.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[T.jsx("input",{type:"checkbox",checked:jt,onChange:D=>Zt(D.target.checked),style:{width:14,height:14}}),T.jsx("span",{style:{color:"var(--color-text)",fontSize:12},children:"Alert on entry"})]}),T.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[T.jsx("input",{type:"checkbox",checked:Wt,onChange:D=>Gt(D.target.checked),style:{width:14,height:14}}),T.jsx("span",{style:{color:"var(--color-text)",fontSize:12},children:"Alert on exit"})]})]})]}),T.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[T.jsx("button",{onClick:er,disabled:tt||!Pe||!Ke.trim()||Ie.length===0||we&&(!ye.trim()||!rt(ye)),style:{padding:de?"4px 8px":"6px 10px",borderRadius:8,border:"1px solid var(--color-border)",background:tt?"#666":Pe&&Ke.trim()&&Ie.length>0&&(!we||ye.trim()&&rt(ye))?"#0066cc":"rgba(255,255,255,0.08)",color:tt?"#fff":Pe&&Ke.trim()&&Ie.length>0&&(!we||ye.trim()&&rt(ye))?"#000":"#777",fontWeight:700,fontSize:de?"14px":"16px",cursor:tt?"not-allowed":Pe&&Ke.trim()&&Ie.length>0&&(!we||ye.trim()&&rt(ye))?"pointer":"not-allowed",opacity:tt?.7:1},children:tt?"Saving...":"Save"}),T.jsx("button",{onClick:()=>{It(!1),Nt(null),vt(null),xt(250),Ve(["all"]),qe(""),ht("#0066cc"),kt(!1),Mt("")},style:{padding:de?"4px 8px":"6px 10px",borderRadius:8,border:"1px solid var(--color-border)",background:"var(--color-bg-alt)",color:"var(--color-text)",fontSize:de?"14px":"16px"},children:"Cancel"})]})]})]}),bt&&T.jsxs("div",{style:{marginBottom:8,fontSize:12,color:"#ff6b6b"},children:["⚠️ ",bt]}),T.jsxs("ul",{style:{listStyle:"none",padding:0,margin:0,maxHeight:180,overflowY:"auto"},children:[ze.length===0&&T.jsx("li",{style:{color:"#aaa"},children:"No geofences yet"}),ze.map(D=>{const q=D.targetTagIds?.includes("all")?"All tags":D.targetTagIds?.map(z=>{const U=ge.find($=>$.id===z);return U?.customName||U?.name||`Tag ${z.slice(0,8)}`}).join(", ")||"No tags";return T.jsx("li",{style:{border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,marginBottom:6,padding:8},children:T.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4},children:[T.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1},children:[T.jsx("span",{style:{width:10,height:10,background:D.color||"#0066cc",borderRadius:2}}),T.jsxs("div",{children:[T.jsx("div",{style:{fontWeight:700,color:"var(--color-text)"},children:D.name||D.type}),T.jsxs("div",{style:{fontSize:11,color:"var(--color-text-muted)"},children:[D.geometry?.radiusMeters,"m radius • ",q]})]})]}),T.jsxs("div",{style:{display:"flex",gap:6},children:[T.jsx("button",{disabled:ve===D.id,style:{padding:"4px 8px",borderRadius:6,border:"1px solid var(--color-border)",background:ve===D.id?"#666":D.active?"rgba(255,255,255,0.08)":"#0066cc",color:ve===D.id||D.active?"#fff":"#000",cursor:ve===D.id?"not-allowed":"pointer",fontSize:12,opacity:ve===D.id?.7:1},onClick:async()=>{if(!(!ne||ve===D.id)){zt(D.id);try{await tn(gi(At,"users",ne,"geofences",D.id),{active:!D.active,updatedAt:Ir()})}catch(z){console.error("Failed to update geofence:",z),alert("Failed to update geofence. Please try again.")}finally{zt(null)}}},children:ve===D.id?"Updating...":D.active?"Deactivate":"Activate"}),T.jsx("button",{style:{padding:"4px 8px",borderRadius:6,border:"1px solid var(--color-border)",background:"#0066cc",color:"#000",cursor:"pointer",fontSize:12},onClick:()=>{Nt(D.id),qe(D.name||""),vt(D.geometry?.center?{lat:Number(D.geometry.center.lat),lng:Number(D.geometry.center.lng)}:null),xt(Number(D.geometry?.radiusMeters||250)),Ve(D.targetTagIds||["all"]),ht(D.color||"#0066cc"),kt(!!D.alertPreferences?.emailEnabled),Mt(D.alertPreferences?.emailAddress||""),Zt(D.alertPreferences?.onEntry!==!1),Gt(D.alertPreferences?.onExit!==!1),It(!0)},children:"Edit"}),T.jsx("button",{disabled:ve===D.id,style:{padding:"4px 8px",borderRadius:6,border:"1px solid var(--color-border)",background:ve===D.id?"#666":"rgba(255,255,255,0.08)",color:(ve===D.id,"#fff"),cursor:ve===D.id?"not-allowed":"pointer",fontSize:12,opacity:ve===D.id?.7:1},onClick:async()=>{if(!(!ne||ve===D.id)&&confirm("Delete this geofence? This cannot be undone.")){zt(D.id);try{await Zs(gi(At,"users",ne,"geofences",D.id))}catch(z){console.error("Failed to delete geofence:",z),alert("Failed to delete geofence. Please try again.")}finally{zt(null)}}},children:ve===D.id?"Deleting...":"Delete"})]})]})},D.id)})]})]}),!1]})]})]})}function io({pathsByTag:re,myTags:ue,showPathLines:Ee,maxTimestamp:oe=null}){const _t=St(),Ne=K.useRef(null);return K.useEffect(()=>{Ne.current||(Ne.current=We.layerGroup().addTo(_t));const F=Ne.current;F.clearLayers();const Re=pe=>{const he=ue.find(ge=>ge.id===pe)?.color;return/^#([0-9a-fA-F]{3}){1,2}$/.test(he||"")?he:"#0066cc"},Be=oe?Object.fromEntries(Object.entries(re||{}).map(([pe,le])=>[pe,le.filter(he=>(he.ts&&typeof he.ts.toDate=="function"?he.ts.toDate().getTime():he.ts?.seconds?he.ts.seconds*1e3:he.ts)<=oe)])):re||{},ze=[];if(Object.entries(Be).forEach(([pe,le])=>{if(!Array.isArray(le)||le.length===0)return;const he=le.map(_e=>[Number(_e.lat),Number(_e.lng),_e.ts]).filter(([_e,Le])=>Number.isFinite(_e)&&Number.isFinite(Le));if(he.length===0)return;const ge=he.map(([_e,Le])=>[_e,Le]);ze.push(...ge),Ee&&We.polyline(ge,{color:Re(pe),weight:3,opacity:.9}).addTo(F);const Qe=ge[ge.length-1];Qe&&We.circleMarker(Qe,{radius:6,color:"#1a1a1a",weight:2,fillColor:Re(pe),fillOpacity:1}).addTo(F),he.forEach(([_e,Le,ne])=>{const yt=We.circleMarker([_e,Le],{radius:3,color:Re(pe),weight:1,fillColor:Re(pe),fillOpacity:.9}),Tt=ne&&typeof ne.toDate=="function"?ne.toDate().toLocaleString():ne?.seconds?new Date(ne.seconds*1e3).toLocaleString():ne?String(ne):"";Tt&&yt.bindTooltip(Tt),yt.addTo(F)})}),ze.length>0&&oe===null)try{_t.fitBounds(ze,{padding:[30,30]})}catch{}return()=>{F.clearLayers()}},[_t,re,ue,Ee,oe]),null}export{ao as default};
