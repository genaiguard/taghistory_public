import{u as xo,c as pn,a as vo,r as I,b as ei,d as $e,q as vr,w as za,o as Lr,e as Cr,f as Ua,g as Lo,l as ua,j as _,M as Co,T as ko,h as Ha,i as mi,s as ha,k as fn,m as Va,n as Ve,t as ca,p as da,v as Mo,x as Eo}from"./index-DixKOjBR.js";function Vi(){return xo().map}var Ka={},Wa;function Bo(){return Wa||(Wa=1,(()=>{var j=Object.create,W=Object.defineProperty,J=Object.getOwnPropertyDescriptor,H=Object.getOwnPropertyNames,ne=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty,N=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Me=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of H(t))!oe.call(e,n)&&n!==i&&W(e,n,{get:()=>t[n],enumerable:!(r=J(t,n))||r.enumerable});return e},Oe=(e,t,i)=>(i=e!=null?j(ne(e)):{},Me(t||!e||!e.__esModule?W(i,"default",{value:e,enumerable:!0}):i,e)),Ye=N((e,t)=>{function i(){this.__data__=[],this.size=0}t.exports=i}),Qe=N((e,t)=>{function i(r,n){return r===n||r!==r&&n!==n}t.exports=i}),Ge=N((e,t)=>{var i=Qe();function r(n,a){for(var s=n.length;s--;)if(i(n[s][0],a))return s;return-1}t.exports=r}),je=N((e,t)=>{var i=Ge(),r=Array.prototype,n=r.splice;function a(s){var o=this.__data__,h=i(o,s);if(h<0)return!1;var c=o.length-1;return h==c?o.pop():n.call(o,h,1),--this.size,!0}t.exports=a}),Pe=N((e,t)=>{var i=Ge();function r(n){var a=this.__data__,s=i(a,n);return s<0?void 0:a[s][1]}t.exports=r}),Ht=N((e,t)=>{var i=Ge();function r(n){return i(this.__data__,n)>-1}t.exports=r}),ze=N((e,t)=>{var i=Ge();function r(n,a){var s=this.__data__,o=i(s,n);return o<0?(++this.size,s.push([n,a])):s[o][1]=a,this}t.exports=r}),at=N((e,t)=>{var i=Ye(),r=je(),n=Pe(),a=Ht(),s=ze();function o(h){var c=-1,x=h==null?0:h.length;for(this.clear();++c<x;){var y=h[c];this.set(y[0],y[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),st=N((e,t)=>{var i=at();function r(){this.__data__=new i,this.size=0}t.exports=r}),xt=N((e,t)=>{function i(r){var n=this.__data__,a=n.delete(r);return this.size=n.size,a}t.exports=i}),et=N((e,t)=>{function i(r){return this.__data__.get(r)}t.exports=i}),yi=N((e,t)=>{function i(r){return this.__data__.has(r)}t.exports=i}),pe=N((e,t)=>{var i=typeof pn=="object"&&pn&&pn.Object===Object&&pn;t.exports=i}),de=N((e,t)=>{var i=pe(),r=typeof self=="object"&&self&&self.Object===Object&&self,n=i||r||Function("return this")();t.exports=n}),le=N((e,t)=>{var i=de(),r=i.Symbol;t.exports=r}),me=N((e,t)=>{var i=le(),r=Object.prototype,n=r.hasOwnProperty,a=r.toString,s=i?i.toStringTag:void 0;function o(h){var c=n.call(h,s),x=h[s];try{h[s]=void 0;var y=!0}catch{}var T=a.call(h);return y&&(c?h[s]=x:delete h[s]),T}t.exports=o}),Ee=N((e,t)=>{var i=Object.prototype,r=i.toString;function n(a){return r.call(a)}t.exports=n}),we=N((e,t)=>{var i=le(),r=me(),n=Ee(),a="[object Null]",s="[object Undefined]",o=i?i.toStringTag:void 0;function h(c){return c==null?c===void 0?s:a:o&&o in Object(c)?r(c):n(c)}t.exports=h}),ye=N((e,t)=>{function i(r){var n=typeof r;return r!=null&&(n=="object"||n=="function")}t.exports=i}),Te=N((e,t)=>{var i=we(),r=ye(),n="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",o="[object Proxy]";function h(c){if(!r(c))return!1;var x=i(c);return x==a||x==s||x==n||x==o}t.exports=h}),Ie=N((e,t)=>{var i=de(),r=i["__core-js_shared__"];t.exports=r}),ve=N((e,t)=>{var i=Ie(),r=function(){var a=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}();function n(a){return!!r&&r in a}t.exports=n}),Ke=N((e,t)=>{var i=Function.prototype,r=i.toString;function n(a){if(a!=null){try{return r.call(a)}catch{}try{return a+""}catch{}}return""}t.exports=n}),Vt=N((e,t)=>{var i=Te(),r=ve(),n=ye(),a=Ke(),s=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,h=Function.prototype,c=Object.prototype,x=h.toString,y=c.hasOwnProperty,T=RegExp("^"+x.call(y).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function F(z){if(!n(z)||r(z))return!1;var q=i(z)?T:o;return q.test(a(z))}t.exports=F}),ii=N((e,t)=>{function i(r,n){return r?.[n]}t.exports=i}),vt=N((e,t)=>{var i=Vt(),r=ii();function n(a,s){var o=r(a,s);return i(o)?o:void 0}t.exports=n}),Lt=N((e,t)=>{var i=vt(),r=de(),n=i(r,"Map");t.exports=n}),At=N((e,t)=>{var i=vt(),r=i(Object,"create");t.exports=r}),Pt=N((e,t)=>{var i=At();function r(){this.__data__=i?i(null):{},this.size=0}t.exports=r}),Ki=N((e,t)=>{function i(r){var n=this.has(r)&&delete this.__data__[r];return this.size-=n?1:0,n}t.exports=i}),Tt=N((e,t)=>{var i=At(),r="__lodash_hash_undefined__",n=Object.prototype,a=n.hasOwnProperty;function s(o){var h=this.__data__;if(i){var c=h[o];return c===r?void 0:c}return a.call(h,o)?h[o]:void 0}t.exports=s}),Wi=N((e,t)=>{var i=At(),r=Object.prototype,n=r.hasOwnProperty;function a(s){var o=this.__data__;return i?o[s]!==void 0:n.call(o,s)}t.exports=a}),_i=N((e,t)=>{var i=At(),r="__lodash_hash_undefined__";function n(a,s){var o=this.__data__;return this.size+=this.has(a)?0:1,o[a]=i&&s===void 0?r:s,this}t.exports=n}),vn=N((e,t)=>{var i=Pt(),r=Ki(),n=Tt(),a=Wi(),s=_i();function o(h){var c=-1,x=h==null?0:h.length;for(this.clear();++c<x;){var y=h[c];this.set(y[0],y[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),bi=N((e,t)=>{var i=vn(),r=at(),n=Lt();function a(){this.size=0,this.__data__={hash:new i,map:new(n||r),string:new i}}t.exports=a}),Ln=N((e,t)=>{function i(r){var n=typeof r;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?r!=="__proto__":r===null}t.exports=i}),fe=N((e,t)=>{var i=Ln();function r(n,a){var s=n.__data__;return i(a)?s[typeof a=="string"?"string":"hash"]:s.map}t.exports=r}),Er=N((e,t)=>{var i=fe();function r(n){var a=i(this,n).delete(n);return this.size-=a?1:0,a}t.exports=r}),Br=N((e,t)=>{var i=fe();function r(n){return i(this,n).get(n)}t.exports=r}),Cn=N((e,t)=>{var i=fe();function r(n){return i(this,n).has(n)}t.exports=r}),xi=N((e,t)=>{var i=fe();function r(n,a){var s=i(this,n),o=s.size;return s.set(n,a),this.size+=s.size==o?0:1,this}t.exports=r}),vi=N((e,t)=>{var i=bi(),r=Er(),n=Br(),a=Cn(),s=xi();function o(h){var c=-1,x=h==null?0:h.length;for(this.clear();++c<x;){var y=h[c];this.set(y[0],y[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),wr=N((e,t)=>{var i=at(),r=Lt(),n=vi(),a=200;function s(o,h){var c=this.__data__;if(c instanceof i){var x=c.__data__;if(!r||x.length<a-1)return x.push([o,h]),this.size=++c.size,this;c=this.__data__=new n(x)}return c.set(o,h),this.size=c.size,this}t.exports=s}),qi=N((e,t)=>{var i=at(),r=st(),n=xt(),a=et(),s=yi(),o=wr();function h(c){var x=this.__data__=new i(c);this.size=x.size}h.prototype.clear=r,h.prototype.delete=n,h.prototype.get=a,h.prototype.has=s,h.prototype.set=o,t.exports=h}),$i=N((e,t)=>{var i=vt(),r=function(){try{var n=i(Object,"defineProperty");return n({},"",{}),n}catch{}}();t.exports=r}),Li=N((e,t)=>{var i=$i();function r(n,a,s){a=="__proto__"&&i?i(n,a,{configurable:!0,enumerable:!0,value:s,writable:!0}):n[a]=s}t.exports=r}),Yi=N((e,t)=>{var i=Li(),r=Qe();function n(a,s,o){(o!==void 0&&!r(a[s],o)||o===void 0&&!(s in a))&&i(a,s,o)}t.exports=n}),ri=N((e,t)=>{function i(r){return function(n,a,s){for(var o=-1,h=Object(n),c=s(n),x=c.length;x--;){var y=c[r?x:++o];if(a(h[y],y,h)===!1)break}return n}}t.exports=i}),kn=N((e,t)=>{var i=ri(),r=i();t.exports=r}),ot=N((e,t)=>{var i=de(),r=typeof e=="object"&&e&&!e.nodeType&&e,n=r&&typeof t=="object"&&t&&!t.nodeType&&t,a=n&&n.exports===r,s=a?i.Buffer:void 0,o=s?s.allocUnsafe:void 0;function h(c,x){if(x)return c.slice();var y=c.length,T=o?o(y):new c.constructor(y);return c.copy(T),T}t.exports=h}),Mn=N((e,t)=>{var i=de(),r=i.Uint8Array;t.exports=r}),ni=N((e,t)=>{var i=Mn();function r(n){var a=new n.constructor(n.byteLength);return new i(a).set(new i(n)),a}t.exports=r}),ai=N((e,t)=>{var i=ni();function r(n,a){var s=a?i(n.buffer):n.buffer;return new n.constructor(s,n.byteOffset,n.length)}t.exports=r}),Ci=N((e,t)=>{function i(r,n){var a=-1,s=r.length;for(n||(n=Array(s));++a<s;)n[a]=r[a];return n}t.exports=i}),ki=N((e,t)=>{var i=ye(),r=Object.create,n=function(){function a(){}return function(s){if(!i(s))return{};if(r)return r(s);a.prototype=s;var o=new a;return a.prototype=void 0,o}}();t.exports=n}),Xi=N((e,t)=>{function i(r,n){return function(a){return r(n(a))}}t.exports=i}),Sr=N((e,t)=>{var i=Xi(),r=i(Object.getPrototypeOf,Object);t.exports=r}),ft=N((e,t)=>{var i=Object.prototype;function r(n){var a=n&&n.constructor,s=typeof a=="function"&&a.prototype||i;return n===s}t.exports=r}),Zi=N((e,t)=>{var i=ki(),r=Sr(),n=ft();function a(s){return typeof s.constructor=="function"&&!n(s)?i(r(s)):{}}t.exports=a}),Xe=N((e,t)=>{function i(r){return r!=null&&typeof r=="object"}t.exports=i}),Mi=N((e,t)=>{var i=we(),r=Xe(),n="[object Arguments]";function a(s){return r(s)&&i(s)==n}t.exports=a}),Rt=N((e,t)=>{var i=Mi(),r=Xe(),n=Object.prototype,a=n.hasOwnProperty,s=n.propertyIsEnumerable,o=i(function(){return arguments}())?i:function(h){return r(h)&&a.call(h,"callee")&&!s.call(h,"callee")};t.exports=o}),gt=N((e,t)=>{var i=Array.isArray;t.exports=i}),tt=N((e,t)=>{var i=9007199254740991;function r(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=i}t.exports=r}),mt=N((e,t)=>{var i=Te(),r=tt();function n(a){return a!=null&&r(a.length)&&!i(a)}t.exports=n}),Kt=N((e,t)=>{var i=mt(),r=Xe();function n(a){return r(a)&&i(a)}t.exports=n}),Ei=N((e,t)=>{function i(){return!1}t.exports=i}),lt=N((e,t)=>{var i=de(),r=Ei(),n=typeof e=="object"&&e&&!e.nodeType&&e,a=n&&typeof t=="object"&&t&&!t.nodeType&&t,s=a&&a.exports===n,o=s?i.Buffer:void 0,h=o?o.isBuffer:void 0,c=h||r;t.exports=c}),Bi=N((e,t)=>{var i=we(),r=Sr(),n=Xe(),a="[object Object]",s=Function.prototype,o=Object.prototype,h=s.toString,c=o.hasOwnProperty,x=h.call(Object);function y(T){if(!n(T)||i(T)!=a)return!1;var F=r(T);if(F===null)return!0;var z=c.call(F,"constructor")&&F.constructor;return typeof z=="function"&&z instanceof z&&h.call(z)==x}t.exports=y}),Ft=N((e,t)=>{var i=we(),r=tt(),n=Xe(),a="[object Arguments]",s="[object Array]",o="[object Boolean]",h="[object Date]",c="[object Error]",x="[object Function]",y="[object Map]",T="[object Number]",F="[object Object]",z="[object RegExp]",q="[object Set]",Y="[object String]",ue="[object WeakMap]",b="[object ArrayBuffer]",v="[object DataView]",B="[object Float32Array]",O="[object Float64Array]",S="[object Int8Array]",R="[object Int16Array]",u="[object Int32Array]",d="[object Uint8Array]",f="[object Uint8ClampedArray]",p="[object Uint16Array]",g="[object Uint32Array]",m={};m[B]=m[O]=m[S]=m[R]=m[u]=m[d]=m[f]=m[p]=m[g]=!0,m[a]=m[s]=m[b]=m[o]=m[v]=m[h]=m[c]=m[x]=m[y]=m[T]=m[F]=m[z]=m[q]=m[Y]=m[ue]=!1;function k(C){return n(C)&&r(C.length)&&!!m[i(C)]}t.exports=k}),wi=N((e,t)=>{function i(r){return function(n){return r(n)}}t.exports=i}),Si=N((e,t)=>{var i=pe(),r=typeof e=="object"&&e&&!e.nodeType&&e,n=r&&typeof t=="object"&&t&&!t.nodeType&&t,a=n&&n.exports===r,s=a&&i.process,o=function(){try{var h=n&&n.require&&n.require("util").types;return h||s&&s.binding&&s.binding("util")}catch{}}();t.exports=o}),si=N((e,t)=>{var i=Ft(),r=wi(),n=Si(),a=n&&n.isTypedArray,s=a?r(a):i;t.exports=s}),oi=N((e,t)=>{function i(r,n){if(!(n==="constructor"&&typeof r[n]=="function")&&n!="__proto__")return r[n]}t.exports=i}),Di=N((e,t)=>{var i=Li(),r=Qe(),n=Object.prototype,a=n.hasOwnProperty;function s(o,h,c){var x=o[h];(!(a.call(o,h)&&r(x,c))||c===void 0&&!(h in o))&&i(o,h,c)}t.exports=s}),Wt=N((e,t)=>{var i=Di(),r=Li();function n(a,s,o,h){var c=!o;o||(o={});for(var x=-1,y=s.length;++x<y;){var T=s[x],F=h?h(o[T],a[T],T,o,a):void 0;F===void 0&&(F=a[T]),c?r(o,T,F):i(o,T,F)}return o}t.exports=n}),Ai=N((e,t)=>{function i(r,n){for(var a=-1,s=Array(r);++a<r;)s[a]=n(a);return s}t.exports=i}),it=N((e,t)=>{var i=9007199254740991,r=/^(?:0|[1-9]\d*)$/;function n(a,s){var o=typeof a;return s=s??i,!!s&&(o=="number"||o!="symbol"&&r.test(a))&&a>-1&&a%1==0&&a<s}t.exports=n}),Ji=N((e,t)=>{var i=Ai(),r=Rt(),n=gt(),a=lt(),s=it(),o=si(),h=Object.prototype,c=h.hasOwnProperty;function x(y,T){var F=n(y),z=!F&&r(y),q=!F&&!z&&a(y),Y=!F&&!z&&!q&&o(y),ue=F||z||q||Y,b=ue?i(y.length,String):[],v=b.length;for(var B in y)(T||c.call(y,B))&&!(ue&&(B=="length"||q&&(B=="offset"||B=="parent")||Y&&(B=="buffer"||B=="byteLength"||B=="byteOffset")||s(B,v)))&&b.push(B);return b}t.exports=x}),Qi=N((e,t)=>{function i(r){var n=[];if(r!=null)for(var a in Object(r))n.push(a);return n}t.exports=i}),er=N((e,t)=>{var i=ye(),r=ft(),n=Qi(),a=Object.prototype,s=a.hasOwnProperty;function o(h){if(!i(h))return n(h);var c=r(h),x=[];for(var y in h)y=="constructor"&&(c||!s.call(h,y))||x.push(y);return x}t.exports=o}),ie=N((e,t)=>{var i=Ji(),r=er(),n=mt();function a(s){return n(s)?i(s,!0):r(s)}t.exports=a}),En=N((e,t)=>{var i=Wt(),r=ie();function n(a){return i(a,r(a))}t.exports=n}),Pi=N((e,t)=>{var i=Yi(),r=ot(),n=ai(),a=Ci(),s=Zi(),o=Rt(),h=gt(),c=Kt(),x=lt(),y=Te(),T=ye(),F=Bi(),z=si(),q=oi(),Y=En();function ue(b,v,B,O,S,R,u){var d=q(b,B),f=q(v,B),p=u.get(f);if(p){i(b,B,p);return}var g=R?R(d,f,B+"",b,v,u):void 0,m=g===void 0;if(m){var k=h(f),C=!k&&x(f),E=!k&&!C&&z(f);g=f,k||C||E?h(d)?g=d:c(d)?g=a(d):C?(m=!1,g=r(f,!0)):E?(m=!1,g=n(f,!0)):g=[]:F(f)||o(f)?(g=d,o(d)?g=Y(d):(!T(d)||y(d))&&(g=s(f))):m=!1}m&&(u.set(f,g),S(g,f,O,R,u),u.delete(f)),i(b,B,g)}t.exports=ue}),Bn=N((e,t)=>{var i=qi(),r=Yi(),n=kn(),a=Pi(),s=ye(),o=ie(),h=oi();function c(x,y,T,F,z){x!==y&&n(y,function(q,Y){if(z||(z=new i),s(q))a(x,y,Y,T,c,F,z);else{var ue=F?F(h(x,Y),q,Y+"",x,y,z):void 0;ue===void 0&&(ue=q),r(x,Y,ue)}},o)}t.exports=c}),Dr=N((e,t)=>{function i(r){return r}t.exports=i}),Ar=N((e,t)=>{function i(r,n,a){switch(a.length){case 0:return r.call(n);case 1:return r.call(n,a[0]);case 2:return r.call(n,a[0],a[1]);case 3:return r.call(n,a[0],a[1],a[2])}return r.apply(n,a)}t.exports=i}),tr=N((e,t)=>{var i=Ar(),r=Math.max;function n(a,s,o){return s=r(s===void 0?a.length-1:s,0),function(){for(var h=arguments,c=-1,x=r(h.length-s,0),y=Array(x);++c<x;)y[c]=h[s+c];c=-1;for(var T=Array(s+1);++c<s;)T[c]=h[c];return T[s]=o(y),i(a,this,T)}}t.exports=n}),Pr=N((e,t)=>{function i(r){return function(){return r}}t.exports=i}),Ti=N((e,t)=>{var i=Pr(),r=$i(),n=Dr(),a=r?function(s,o){return r(s,"toString",{configurable:!0,enumerable:!1,value:i(o),writable:!0})}:n;t.exports=a}),Ct=N((e,t)=>{var i=800,r=16,n=Date.now;function a(s){var o=0,h=0;return function(){var c=n(),x=r-(c-h);if(h=c,x>0){if(++o>=i)return arguments[0]}else o=0;return s.apply(void 0,arguments)}}t.exports=a}),ir=N((e,t)=>{var i=Ti(),r=Ct(),n=r(i);t.exports=n}),Ue=N((e,t)=>{var i=Dr(),r=tr(),n=ir();function a(s,o){return n(r(s,o,i),s+"")}t.exports=a}),Tr=N((e,t)=>{var i=Qe(),r=mt(),n=it(),a=ye();function s(o,h,c){if(!a(c))return!1;var x=typeof h;return(x=="number"?r(c)&&n(h,c.length):x=="string"&&h in c)?i(c[h],o):!1}t.exports=s}),xe=N((e,t)=>{var i=Ue(),r=Tr();function n(a){return i(function(s,o){var h=-1,c=o.length,x=c>1?o[c-1]:void 0,y=c>2?o[2]:void 0;for(x=a.length>3&&typeof x=="function"?(c--,x):void 0,y&&r(o[0],o[1],y)&&(x=c<3?void 0:x,c=1),s=Object(s);++h<c;){var T=o[h];T&&a(s,T,h,x)}return s})}t.exports=n}),qt=N((e,t)=>{var i=Bn(),r=xe(),n=r(function(a,s,o){i(a,s,o)});t.exports=n}),rr=N((e,t)=>{var i=we(),r=Xe(),n="[object Symbol]";function a(s){return typeof s=="symbol"||r(s)&&i(s)==n}t.exports=a}),Rr=N((e,t)=>{var i=gt(),r=rr(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;function s(o,h){if(i(o))return!1;var c=typeof o;return c=="number"||c=="symbol"||c=="boolean"||o==null||r(o)?!0:a.test(o)||!n.test(o)||h!=null&&o in Object(h)}t.exports=s}),wn=N((e,t)=>{var i=vi(),r="Expected a function";function n(a,s){if(typeof a!="function"||s!=null&&typeof s!="function")throw new TypeError(r);var o=function(){var h=arguments,c=s?s.apply(this,h):h[0],x=o.cache;if(x.has(c))return x.get(c);var y=a.apply(this,h);return o.cache=x.set(c,y)||x,y};return o.cache=new(n.Cache||i),o}n.Cache=i,t.exports=n}),Fr=N((e,t)=>{var i=wn(),r=500;function n(a){var s=i(a,function(h){return o.size===r&&o.clear(),h}),o=s.cache;return s}t.exports=n}),Sn=N((e,t)=>{var i=Fr(),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,a=i(function(s){var o=[];return s.charCodeAt(0)===46&&o.push(""),s.replace(r,function(h,c,x,y){o.push(x?y.replace(n,"$1"):c||h)}),o});t.exports=a}),Ri=N((e,t)=>{function i(r,n){for(var a=-1,s=r==null?0:r.length,o=Array(s);++a<s;)o[a]=n(r[a],a,r);return o}t.exports=i}),ut=N((e,t)=>{var i=le(),r=Ri(),n=gt(),a=rr(),s=i?i.prototype:void 0,o=s?s.toString:void 0;function h(c){if(typeof c=="string")return c;if(n(c))return r(c,h)+"";if(a(c))return o?o.call(c):"";var x=c+"";return x=="0"&&1/c==-1/0?"-0":x}t.exports=h}),Fi=N((e,t)=>{var i=ut();function r(n){return n==null?"":i(n)}t.exports=r}),yt=N((e,t)=>{var i=gt(),r=Rr(),n=Sn(),a=Fi();function s(o,h){return i(o)?o:r(o,h)?[o]:n(a(o))}t.exports=s}),nr=N((e,t)=>{var i=rr();function r(n){if(typeof n=="string"||i(n))return n;var a=n+"";return a=="0"&&1/n==-1/0?"-0":a}t.exports=r}),Oi=N((e,t)=>{var i=yt(),r=nr();function n(a,s){s=i(s,a);for(var o=0,h=s.length;a!=null&&o<h;)a=a[r(s[o++])];return o&&o==h?a:void 0}t.exports=n}),li=N((e,t)=>{var i=Oi();function r(n,a,s){var o=n==null?void 0:i(n,a);return o===void 0?s:o}t.exports=r}),$t=N((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?t.exports=r():(i=i||self).RBush=r()})(e,function(){function i(b,v,B,O,S){(function R(u,d,f,p,g){for(;p>f;){if(p-f>600){var m=p-f+1,k=d-f+1,C=Math.log(m),E=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*E*(m-E)/m)*(k-m/2<0?-1:1),A=Math.max(f,Math.floor(d-k*E/m+P)),G=Math.min(p,Math.floor(d+(m-k)*E/m+P));R(u,d,A,G,g)}var $=u[d],X=f,Q=p;for(r(u,f,d),g(u[p],$)>0&&r(u,f,p);X<Q;){for(r(u,X,Q),X++,Q--;g(u[X],$)<0;)X++;for(;g(u[Q],$)>0;)Q--}g(u[f],$)===0?r(u,f,Q):r(u,++Q,p),Q<=d&&(f=Q+1),d<=Q&&(p=Q-1)}})(b,v,B||0,O||b.length-1,S||n)}function r(b,v,B){var O=b[v];b[v]=b[B],b[B]=O}function n(b,v){return b<v?-1:b>v?1:0}var a=function(b){b===void 0&&(b=9),this._maxEntries=Math.max(4,b),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(b,v,B){if(!B)return v.indexOf(b);for(var O=0;O<v.length;O++)if(B(b,v[O]))return O;return-1}function o(b,v){h(b,0,b.children.length,v,b)}function h(b,v,B,O,S){S||(S=Y(null)),S.minX=1/0,S.minY=1/0,S.maxX=-1/0,S.maxY=-1/0;for(var R=v;R<B;R++){var u=b.children[R];c(S,b.leaf?O(u):u)}return S}function c(b,v){return b.minX=Math.min(b.minX,v.minX),b.minY=Math.min(b.minY,v.minY),b.maxX=Math.max(b.maxX,v.maxX),b.maxY=Math.max(b.maxY,v.maxY),b}function x(b,v){return b.minX-v.minX}function y(b,v){return b.minY-v.minY}function T(b){return(b.maxX-b.minX)*(b.maxY-b.minY)}function F(b){return b.maxX-b.minX+(b.maxY-b.minY)}function z(b,v){return b.minX<=v.minX&&b.minY<=v.minY&&v.maxX<=b.maxX&&v.maxY<=b.maxY}function q(b,v){return v.minX<=b.maxX&&v.minY<=b.maxY&&v.maxX>=b.minX&&v.maxY>=b.minY}function Y(b){return{children:b,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ue(b,v,B,O,S){for(var R=[v,B];R.length;)if(!((B=R.pop())-(v=R.pop())<=O)){var u=v+Math.ceil((B-v)/O/2)*O;i(b,u,v,B,S),R.push(v,u,u,B)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(b){var v=this.data,B=[];if(!q(b,v))return B;for(var O=this.toBBox,S=[];v;){for(var R=0;R<v.children.length;R++){var u=v.children[R],d=v.leaf?O(u):u;q(b,d)&&(v.leaf?B.push(u):z(b,d)?this._all(u,B):S.push(u))}v=S.pop()}return B},a.prototype.collides=function(b){var v=this.data;if(!q(b,v))return!1;for(var B=[];v;){for(var O=0;O<v.children.length;O++){var S=v.children[O],R=v.leaf?this.toBBox(S):S;if(q(b,R)){if(v.leaf||z(b,R))return!0;B.push(S)}}v=B.pop()}return!1},a.prototype.load=function(b){if(!b||!b.length)return this;if(b.length<this._minEntries){for(var v=0;v<b.length;v++)this.insert(b[v]);return this}var B=this._build(b.slice(),0,b.length-1,0);if(this.data.children.length)if(this.data.height===B.height)this._splitRoot(this.data,B);else{if(this.data.height<B.height){var O=this.data;this.data=B,B=O}this._insert(B,this.data.height-B.height-1,!0)}else this.data=B;return this},a.prototype.insert=function(b){return b&&this._insert(b,this.data.height-1),this},a.prototype.clear=function(){return this.data=Y([]),this},a.prototype.remove=function(b,v){if(!b)return this;for(var B,O,S,R=this.data,u=this.toBBox(b),d=[],f=[];R||d.length;){if(R||(R=d.pop(),O=d[d.length-1],B=f.pop(),S=!0),R.leaf){var p=s(b,R.children,v);if(p!==-1)return R.children.splice(p,1),d.push(R),this._condense(d),this}S||R.leaf||!z(R,u)?O?(B++,R=O.children[B],S=!1):R=null:(d.push(R),f.push(B),B=0,O=R,R=R.children[0])}return this},a.prototype.toBBox=function(b){return b},a.prototype.compareMinX=function(b,v){return b.minX-v.minX},a.prototype.compareMinY=function(b,v){return b.minY-v.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(b){return this.data=b,this},a.prototype._all=function(b,v){for(var B=[];b;)b.leaf?v.push.apply(v,b.children):B.push.apply(B,b.children),b=B.pop();return v},a.prototype._build=function(b,v,B,O){var S,R=B-v+1,u=this._maxEntries;if(R<=u)return o(S=Y(b.slice(v,B+1)),this.toBBox),S;O||(O=Math.ceil(Math.log(R)/Math.log(u)),u=Math.ceil(R/Math.pow(u,O-1))),(S=Y([])).leaf=!1,S.height=O;var d=Math.ceil(R/u),f=d*Math.ceil(Math.sqrt(u));ue(b,v,B,f,this.compareMinX);for(var p=v;p<=B;p+=f){var g=Math.min(p+f-1,B);ue(b,p,g,d,this.compareMinY);for(var m=p;m<=g;m+=d){var k=Math.min(m+d-1,g);S.children.push(this._build(b,m,k,O-1))}}return o(S,this.toBBox),S},a.prototype._chooseSubtree=function(b,v,B,O){for(;O.push(v),!v.leaf&&O.length-1!==B;){for(var S=1/0,R=1/0,u=void 0,d=0;d<v.children.length;d++){var f=v.children[d],p=T(f),g=(m=b,k=f,(Math.max(k.maxX,m.maxX)-Math.min(k.minX,m.minX))*(Math.max(k.maxY,m.maxY)-Math.min(k.minY,m.minY))-p);g<R?(R=g,S=p<S?p:S,u=f):g===R&&p<S&&(S=p,u=f)}v=u||v.children[0]}var m,k;return v},a.prototype._insert=function(b,v,B){var O=B?b:this.toBBox(b),S=[],R=this._chooseSubtree(O,this.data,v,S);for(R.children.push(b),c(R,O);v>=0&&S[v].children.length>this._maxEntries;)this._split(S,v),v--;this._adjustParentBBoxes(O,S,v)},a.prototype._split=function(b,v){var B=b[v],O=B.children.length,S=this._minEntries;this._chooseSplitAxis(B,S,O);var R=this._chooseSplitIndex(B,S,O),u=Y(B.children.splice(R,B.children.length-R));u.height=B.height,u.leaf=B.leaf,o(B,this.toBBox),o(u,this.toBBox),v?b[v-1].children.push(u):this._splitRoot(B,u)},a.prototype._splitRoot=function(b,v){this.data=Y([b,v]),this.data.height=b.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(b,v,B){for(var O,S,R,u,d,f,p,g=1/0,m=1/0,k=v;k<=B-v;k++){var C=h(b,0,k,this.toBBox),E=h(b,k,B,this.toBBox),P=(S=C,R=E,u=void 0,d=void 0,f=void 0,p=void 0,u=Math.max(S.minX,R.minX),d=Math.max(S.minY,R.minY),f=Math.min(S.maxX,R.maxX),p=Math.min(S.maxY,R.maxY),Math.max(0,f-u)*Math.max(0,p-d)),A=T(C)+T(E);P<g?(g=P,O=k,m=A<m?A:m):P===g&&A<m&&(m=A,O=k)}return O||B-v},a.prototype._chooseSplitAxis=function(b,v,B){var O=b.leaf?this.compareMinX:x,S=b.leaf?this.compareMinY:y;this._allDistMargin(b,v,B,O)<this._allDistMargin(b,v,B,S)&&b.children.sort(O)},a.prototype._allDistMargin=function(b,v,B,O){b.children.sort(O);for(var S=this.toBBox,R=h(b,0,v,S),u=h(b,B-v,B,S),d=F(R)+F(u),f=v;f<B-v;f++){var p=b.children[f];c(R,b.leaf?S(p):p),d+=F(R)}for(var g=B-v-1;g>=v;g--){var m=b.children[g];c(u,b.leaf?S(m):m),d+=F(u)}return d},a.prototype._adjustParentBBoxes=function(b,v,B){for(var O=B;O>=0;O--)c(v[O],b)},a.prototype._condense=function(b){for(var v=b.length-1,B=void 0;v>=0;v--)b[v].children.length===0?v>0?(B=b[v-1].children).splice(B.indexOf(b[v]),1):this.clear():o(b[v],this.toBBox)},a})}),Ot=N(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=63710088e-1,e.factors={centimeters:e.earthRadius*100,centimetres:e.earthRadius*100,degrees:e.earthRadius/111325,feet:e.earthRadius*3.28084,inches:e.earthRadius*39.37,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:e.earthRadius*1e3,millimetres:e.earthRadius*1e3,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius*1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function t(p,g,m){m===void 0&&(m={});var k={type:"Feature"};return(m.id===0||m.id)&&(k.id=m.id),m.bbox&&(k.bbox=m.bbox),k.properties=g||{},k.geometry=p,k}e.feature=t;function i(p,g,m){switch(p){case"Point":return r(g).geometry;case"LineString":return o(g).geometry;case"Polygon":return a(g).geometry;case"MultiPoint":return y(g).geometry;case"MultiLineString":return x(g).geometry;case"MultiPolygon":return T(g).geometry;default:throw new Error(p+" is invalid")}}e.geometry=i;function r(p,g,m){if(m===void 0&&(m={}),!p)throw new Error("coordinates is required");if(!Array.isArray(p))throw new Error("coordinates must be an Array");if(p.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!R(p[0])||!R(p[1]))throw new Error("coordinates must contain numbers");var k={type:"Point",coordinates:p};return t(k,g,m)}e.point=r;function n(p,g,m){return m===void 0&&(m={}),c(p.map(function(k){return r(k,g)}),m)}e.points=n;function a(p,g,m){m===void 0&&(m={});for(var k=0,C=p;k<C.length;k++){var E=C[k];if(E.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var P=0;P<E[E.length-1].length;P++)if(E[E.length-1][P]!==E[0][P])throw new Error("First and last Position are not equivalent.")}var A={type:"Polygon",coordinates:p};return t(A,g,m)}e.polygon=a;function s(p,g,m){return m===void 0&&(m={}),c(p.map(function(k){return a(k,g)}),m)}e.polygons=s;function o(p,g,m){if(m===void 0&&(m={}),p.length<2)throw new Error("coordinates must be an array of two or more positions");var k={type:"LineString",coordinates:p};return t(k,g,m)}e.lineString=o;function h(p,g,m){return m===void 0&&(m={}),c(p.map(function(k){return o(k,g)}),m)}e.lineStrings=h;function c(p,g){g===void 0&&(g={});var m={type:"FeatureCollection"};return g.id&&(m.id=g.id),g.bbox&&(m.bbox=g.bbox),m.features=p,m}e.featureCollection=c;function x(p,g,m){m===void 0&&(m={});var k={type:"MultiLineString",coordinates:p};return t(k,g,m)}e.multiLineString=x;function y(p,g,m){m===void 0&&(m={});var k={type:"MultiPoint",coordinates:p};return t(k,g,m)}e.multiPoint=y;function T(p,g,m){m===void 0&&(m={});var k={type:"MultiPolygon",coordinates:p};return t(k,g,m)}e.multiPolygon=T;function F(p,g,m){m===void 0&&(m={});var k={type:"GeometryCollection",geometries:p};return t(k,g,m)}e.geometryCollection=F;function z(p,g){if(g===void 0&&(g=0),g&&!(g>=0))throw new Error("precision must be a positive number");var m=Math.pow(10,g||0);return Math.round(p*m)/m}e.round=z;function q(p,g){g===void 0&&(g="kilometers");var m=e.factors[g];if(!m)throw new Error(g+" units is invalid");return p*m}e.radiansToLength=q;function Y(p,g){g===void 0&&(g="kilometers");var m=e.factors[g];if(!m)throw new Error(g+" units is invalid");return p/m}e.lengthToRadians=Y;function ue(p,g){return v(Y(p,g))}e.lengthToDegrees=ue;function b(p){var g=p%360;return g<0&&(g+=360),g}e.bearingToAzimuth=b;function v(p){var g=p%(2*Math.PI);return g*180/Math.PI}e.radiansToDegrees=v;function B(p){var g=p%360;return g*Math.PI/180}e.degreesToRadians=B;function O(p,g,m){if(g===void 0&&(g="kilometers"),m===void 0&&(m="kilometers"),!(p>=0))throw new Error("length must be a positive number");return q(Y(p,g),m)}e.convertLength=O;function S(p,g,m){if(g===void 0&&(g="meters"),m===void 0&&(m="kilometers"),!(p>=0))throw new Error("area must be a positive number");var k=e.areaFactors[g];if(!k)throw new Error("invalid original units");var C=e.areaFactors[m];if(!C)throw new Error("invalid final units");return p/k*C}e.convertArea=S;function R(p){return!isNaN(p)&&p!==null&&!Array.isArray(p)}e.isNumber=R;function u(p){return!!p&&p.constructor===Object}e.isObject=u;function d(p){if(!p)throw new Error("bbox is required");if(!Array.isArray(p))throw new Error("bbox must be an Array");if(p.length!==4&&p.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");p.forEach(function(g){if(!R(g))throw new Error("bbox must only contain numbers")})}e.validateBBox=d;function f(p){if(!p)throw new Error("id is required");if(["string","number"].indexOf(typeof p)===-1)throw new Error("id must be a number or a string")}e.validateId=f}),Or=N(e=>{Object.defineProperty(e,"__esModule",{value:!0});var t=Ot();function i(v,B,O){if(v!==null)for(var S,R,u,d,f,p,g,m=0,k=0,C,E=v.type,P=E==="FeatureCollection",A=E==="Feature",G=P?v.features.length:1,$=0;$<G;$++){g=P?v.features[$].geometry:A?v.geometry:v,C=g?g.type==="GeometryCollection":!1,f=C?g.geometries.length:1;for(var X=0;X<f;X++){var Q=0,ge=0;if(d=C?g.geometries[X]:g,d!==null){p=d.coordinates;var _e=d.type;switch(m=O&&(_e==="Polygon"||_e==="MultiPolygon")?1:0,_e){case null:break;case"Point":if(B(p,k,$,Q,ge)===!1)return!1;k++,Q++;break;case"LineString":case"MultiPoint":for(S=0;S<p.length;S++){if(B(p[S],k,$,Q,ge)===!1)return!1;k++,_e==="MultiPoint"&&Q++}_e==="LineString"&&Q++;break;case"Polygon":case"MultiLineString":for(S=0;S<p.length;S++){for(R=0;R<p[S].length-m;R++){if(B(p[S][R],k,$,Q,ge)===!1)return!1;k++}_e==="MultiLineString"&&Q++,_e==="Polygon"&&ge++}_e==="Polygon"&&Q++;break;case"MultiPolygon":for(S=0;S<p.length;S++){for(ge=0,R=0;R<p[S].length;R++){for(u=0;u<p[S][R].length-m;u++){if(B(p[S][R][u],k,$,Q,ge)===!1)return!1;k++}ge++}Q++}break;case"GeometryCollection":for(S=0;S<d.geometries.length;S++)if(i(d.geometries[S],B,O)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function r(v,B,O,S){var R=O;return i(v,function(u,d,f,p,g){d===0&&O===void 0?R=u:R=B(R,u,d,f,p,g)},S),R}function n(v,B){var O;switch(v.type){case"FeatureCollection":for(O=0;O<v.features.length&&B(v.features[O].properties,O)!==!1;O++);break;case"Feature":B(v.properties,0);break}}function a(v,B,O){var S=O;return n(v,function(R,u){u===0&&O===void 0?S=R:S=B(S,R,u)}),S}function s(v,B){if(v.type==="Feature")B(v,0);else if(v.type==="FeatureCollection")for(var O=0;O<v.features.length&&B(v.features[O],O)!==!1;O++);}function o(v,B,O){var S=O;return s(v,function(R,u){u===0&&O===void 0?S=R:S=B(S,R,u)}),S}function h(v){var B=[];return i(v,function(O){B.push(O)}),B}function c(v,B){var O,S,R,u,d,f,p,g,m,k,C=0,E=v.type==="FeatureCollection",P=v.type==="Feature",A=E?v.features.length:1;for(O=0;O<A;O++){for(f=E?v.features[O].geometry:P?v.geometry:v,g=E?v.features[O].properties:P?v.properties:{},m=E?v.features[O].bbox:P?v.bbox:void 0,k=E?v.features[O].id:P?v.id:void 0,p=f?f.type==="GeometryCollection":!1,d=p?f.geometries.length:1,R=0;R<d;R++){if(u=p?f.geometries[R]:f,u===null){if(B(null,C,g,m,k)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(B(u,C,g,m,k)===!1)return!1;break}case"GeometryCollection":{for(S=0;S<u.geometries.length;S++)if(B(u.geometries[S],C,g,m,k)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function x(v,B,O){var S=O;return c(v,function(R,u,d,f,p){u===0&&O===void 0?S=R:S=B(S,R,u,d,f,p)}),S}function y(v,B){c(v,function(O,S,R,u,d){var f=O===null?null:O.type;switch(f){case null:case"Point":case"LineString":case"Polygon":return B(t.feature(O,R,{bbox:u,id:d}),S,0)===!1?!1:void 0}var p;switch(f){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var g=0;g<O.coordinates.length;g++){var m=O.coordinates[g],k={type:p,coordinates:m};if(B(t.feature(k,R),S,g)===!1)return!1}})}function T(v,B,O){var S=O;return y(v,function(R,u,d){u===0&&d===0&&O===void 0?S=R:S=B(S,R,u,d)}),S}function F(v,B){y(v,function(O,S,R){var u=0;if(O.geometry){var d=O.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var f,p=0,g=0,m=0;if(i(O,function(k,C,E,P,A){if(f===void 0||S>p||P>g||A>m){f=k,p=S,g=P,m=A,u=0;return}var G=t.lineString([f,k],O.properties);if(B(G,S,R,A,u)===!1)return!1;u++,f=k})===!1)return!1}}})}function z(v,B,O){var S=O,R=!1;return F(v,function(u,d,f,p,g){R===!1&&O===void 0?S=u:S=B(S,u,d,f,p,g),R=!0}),S}function q(v,B){if(!v)throw new Error("geojson is required");y(v,function(O,S,R){if(O.geometry!==null){var u=O.geometry.type,d=O.geometry.coordinates;switch(u){case"LineString":if(B(O,S,R,0,0)===!1)return!1;break;case"Polygon":for(var f=0;f<d.length;f++)if(B(t.lineString(d[f],O.properties),S,R,f)===!1)return!1;break}}})}function Y(v,B,O){var S=O;return q(v,function(R,u,d,f){u===0&&O===void 0?S=R:S=B(S,R,u,d,f)}),S}function ue(v,B){if(B=B||{},!t.isObject(B))throw new Error("options is invalid");var O=B.featureIndex||0,S=B.multiFeatureIndex||0,R=B.geometryIndex||0,u=B.segmentIndex||0,d=B.properties,f;switch(v.type){case"FeatureCollection":O<0&&(O=v.features.length+O),d=d||v.features[O].properties,f=v.features[O].geometry;break;case"Feature":d=d||v.properties,f=v.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":f=v;break;default:throw new Error("geojson is invalid")}if(f===null)return null;var p=f.coordinates;switch(f.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=p.length+u-1),t.lineString([p[u],p[u+1]],d,B);case"Polygon":return R<0&&(R=p.length+R),u<0&&(u=p[R].length+u-1),t.lineString([p[R][u],p[R][u+1]],d,B);case"MultiLineString":return S<0&&(S=p.length+S),u<0&&(u=p[S].length+u-1),t.lineString([p[S][u],p[S][u+1]],d,B);case"MultiPolygon":return S<0&&(S=p.length+S),R<0&&(R=p[S].length+R),u<0&&(u=p[S][R].length-u-1),t.lineString([p[S][R][u],p[S][R][u+1]],d,B)}throw new Error("geojson is invalid")}function b(v,B){if(B=B||{},!t.isObject(B))throw new Error("options is invalid");var O=B.featureIndex||0,S=B.multiFeatureIndex||0,R=B.geometryIndex||0,u=B.coordIndex||0,d=B.properties,f;switch(v.type){case"FeatureCollection":O<0&&(O=v.features.length+O),d=d||v.features[O].properties,f=v.features[O].geometry;break;case"Feature":d=d||v.properties,f=v.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":f=v;break;default:throw new Error("geojson is invalid")}if(f===null)return null;var p=f.coordinates;switch(f.type){case"Point":return t.point(p,d,B);case"MultiPoint":return S<0&&(S=p.length+S),t.point(p[S],d,B);case"LineString":return u<0&&(u=p.length+u),t.point(p[u],d,B);case"Polygon":return R<0&&(R=p.length+R),u<0&&(u=p[R].length+u),t.point(p[R][u],d,B);case"MultiLineString":return S<0&&(S=p.length+S),u<0&&(u=p[S].length+u),t.point(p[S][u],d,B);case"MultiPolygon":return S<0&&(S=p.length+S),R<0&&(R=p[S].length+R),u<0&&(u=p[S][R].length-u),t.point(p[S][R][u],d,B)}throw new Error("geojson is invalid")}e.coordAll=h,e.coordEach=i,e.coordReduce=r,e.featureEach=s,e.featureReduce=o,e.findPoint=b,e.findSegment=ue,e.flattenEach=y,e.flattenReduce=T,e.geomEach=c,e.geomReduce=x,e.lineEach=q,e.lineReduce=Y,e.propEach=n,e.propReduce=a,e.segmentEach=F,e.segmentReduce=z}),ji=N(e=>{Object.defineProperty(e,"__esModule",{value:!0});var t=Or();function i(r){var n=[1/0,1/0,-1/0,-1/0];return t.coordEach(r,function(a){n[0]>a[0]&&(n[0]=a[0]),n[1]>a[1]&&(n[1]=a[1]),n[2]<a[0]&&(n[2]=a[0]),n[3]<a[1]&&(n[3]=a[1])}),n}i.default=i,e.default=i}),jr=N((e,t)=>{var i=$t(),r=Ot(),n=Or(),a=ji().default,s=n.featureEach;n.coordEach,r.polygon;var o=r.featureCollection;function h(c){var x=new i(c);return x.insert=function(y){if(y.type!=="Feature")throw new Error("invalid feature");return y.bbox=y.bbox?y.bbox:a(y),i.prototype.insert.call(this,y)},x.load=function(y){var T=[];return Array.isArray(y)?y.forEach(function(F){if(F.type!=="Feature")throw new Error("invalid features");F.bbox=F.bbox?F.bbox:a(F),T.push(F)}):s(y,function(F){if(F.type!=="Feature")throw new Error("invalid features");F.bbox=F.bbox?F.bbox:a(F),T.push(F)}),i.prototype.load.call(this,T)},x.remove=function(y,T){if(y.type!=="Feature")throw new Error("invalid feature");return y.bbox=y.bbox?y.bbox:a(y),i.prototype.remove.call(this,y,T)},x.clear=function(){return i.prototype.clear.call(this)},x.search=function(y){var T=i.prototype.search.call(this,this.toBBox(y));return o(T)},x.collides=function(y){return i.prototype.collides.call(this,this.toBBox(y))},x.all=function(){var y=i.prototype.all.call(this);return o(y)},x.toJSON=function(){return i.prototype.toJSON.call(this)},x.fromJSON=function(y){return i.prototype.fromJSON.call(this,y)},x.toBBox=function(y){var T;if(y.bbox)T=y.bbox;else if(Array.isArray(y)&&y.length===4)T=y;else if(Array.isArray(y)&&y.length===6)T=[y[0],y[1],y[3],y[4]];else if(y.type==="Feature")T=a(y);else if(y.type==="FeatureCollection")T=a(y);else throw new Error("invalid geojson");return{minX:T[0],minY:T[1],maxX:T[2],maxY:T[3]}},x}t.exports=h,t.exports.default=h});Array.prototype.findIndex=Array.prototype.findIndex||function(e){if(this===null)throw new TypeError("Array.prototype.findIndex called on null or undefined");if(typeof e!="function")throw new TypeError("callback must be a function");for(var t=Object(this),i=t.length>>>0,r=arguments[1],n=0;n<i;n++)if(e.call(r,t[n],n,t))return n;return-1},Array.prototype.find=Array.prototype.find||function(e){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof e!="function")throw new TypeError("callback must be a function");for(var t=Object(this),i=t.length>>>0,r=arguments[1],n=0;n<i;n++){var a=t[n];if(e.call(r,a,n,t))return a}},typeof Object.assign!="function"&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var i=arguments[t];if(i!=null)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}),function(e){e.forEach(function(t){t.hasOwnProperty("remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(this==null)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(r===0)return!1;var n=t|0,a=Math.max(n>=0?n:r-Math.abs(n),0);function s(o,h){return o===h||typeof o=="number"&&typeof h=="number"&&isNaN(o)&&isNaN(h)}for(;a<r;){if(s(i[a],e))return!0;a++}return!1}});var We={version:"2.18.3"},Ii=Oe(qt()),Ir={tooltips:{placeMarker:"Click to place marker",firstVertex:"Click to place first vertex",continueLine:"Click to continue drawing",finishLine:"Click any existing marker to finish",finishPoly:"Click first marker to finish",finishRect:"Click to finish",startCircle:"Click to place circle center",finishCircle:"Click to finish circle",placeCircleMarker:"Click to place circle marker",placeText:"Click to place text",selectFirstLayerFor:"Select first layer for {action}",selectSecondLayerFor:"Select second layer for {action}"},actions:{finish:"Finish",cancel:"Cancel",removeLastVertex:"Remove Last Vertex"},buttonTitles:{drawMarkerButton:"Draw Marker",drawPolyButton:"Draw Polygons",drawLineButton:"Draw Polyline",drawCircleButton:"Draw Circle",drawRectButton:"Draw Rectangle",editButton:"Edit Layers",dragButton:"Drag Layers",cutButton:"Cut Layers",deleteButton:"Remove Layers",drawCircleMarkerButton:"Draw Circle Marker",snappingButton:"Snap dragged marker to other layers and vertices",pinningButton:"Pin shared vertices together",rotateButton:"Rotate Layers",drawTextButton:"Draw Text",scaleButton:"Scale Layers",autoTracingButton:"Auto trace Line",snapGuidesButton:"Show SnapGuides",unionButton:"Union layers",differenceButton:"Subtract layers"},measurements:{totalLength:"Length",segmentLength:"Segment length",area:"Area",radius:"Radius",perimeter:"Perimeter",height:"Height",width:"Width",coordinates:"Position",coordinatesMarker:"Position Marker"}},Nr={tooltips:{placeMarker:"Platziere den Marker mit Klick",firstVertex:"Platziere den ersten Marker mit Klick",continueLine:"Klicke, um weiter zu zeichnen",finishLine:"Beende mit Klick auf existierenden Marker",finishPoly:"Beende mit Klick auf ersten Marker",finishRect:"Beende mit Klick",startCircle:"Platziere das Kreiszentrum mit Klick",finishCircle:"Beende den Kreis mit Klick",placeCircleMarker:"Platziere den Kreismarker mit Klick",placeText:"Platziere den Text mit Klick"},actions:{finish:"Beenden",cancel:"Abbrechen",removeLastVertex:"Letzten Vertex löschen"},buttonTitles:{drawMarkerButton:"Marker zeichnen",drawPolyButton:"Polygon zeichnen",drawLineButton:"Polyline zeichnen",drawCircleButton:"Kreis zeichnen",drawRectButton:"Rechteck zeichnen",editButton:"Layer editieren",dragButton:"Layer bewegen",cutButton:"Layer schneiden",deleteButton:"Layer löschen",drawCircleMarkerButton:"Kreismarker zeichnen",snappingButton:"Bewegter Layer an andere Layer oder Vertexe einhacken",pinningButton:"Vertexe an der gleichen Position verknüpfen",rotateButton:"Layer drehen",drawTextButton:"Text zeichnen",scaleButton:"Layer skalieren",autoTracingButton:"Linie automatisch nachzeichen"},measurements:{totalLength:"Länge",segmentLength:"Segment Länge",area:"Fläche",radius:"Radius",perimeter:"Umfang",height:"Höhe",width:"Breite",coordinates:"Position",coordinatesMarker:"Position Marker"}},ar={tooltips:{placeMarker:"Clicca per posizionare un Marker",firstVertex:"Clicca per posizionare il primo vertice",continueLine:"Clicca per continuare a disegnare",finishLine:"Clicca qualsiasi marker esistente per terminare",finishPoly:"Clicca il primo marker per terminare",finishRect:"Clicca per terminare",startCircle:"Clicca per posizionare il punto centrale del cerchio",finishCircle:"Clicca per terminare il cerchio",placeCircleMarker:"Clicca per posizionare un Marker del cherchio"},actions:{finish:"Termina",cancel:"Annulla",removeLastVertex:"Rimuovi l'ultimo vertice"},buttonTitles:{drawMarkerButton:"Disegna Marker",drawPolyButton:"Disegna Poligoni",drawLineButton:"Disegna Polilinea",drawCircleButton:"Disegna Cerchio",drawRectButton:"Disegna Rettangolo",editButton:"Modifica Livelli",dragButton:"Sposta Livelli",cutButton:"Ritaglia Livelli",deleteButton:"Elimina Livelli",drawCircleMarkerButton:"Disegna Marker del Cerchio",snappingButton:"Snap ha trascinato il pennarello su altri strati e vertici",pinningButton:"Pin condiviso vertici insieme",rotateButton:"Ruota livello"}},Gr={tooltips:{placeMarker:"Klik untuk menempatkan marker",firstVertex:"Klik untuk menempatkan vertex pertama",continueLine:"Klik untuk meneruskan digitasi",finishLine:"Klik pada sembarang marker yang ada untuk mengakhiri",finishPoly:"Klik marker pertama untuk mengakhiri",finishRect:"Klik untuk mengakhiri",startCircle:"Klik untuk menempatkan titik pusat lingkaran",finishCircle:"Klik untuk mengakhiri lingkaran",placeCircleMarker:"Klik untuk menempatkan penanda lingkarann"},actions:{finish:"Selesai",cancel:"Batal",removeLastVertex:"Hilangkan Vertex Terakhir"},buttonTitles:{drawMarkerButton:"Digitasi Marker",drawPolyButton:"Digitasi Polygon",drawLineButton:"Digitasi Polyline",drawCircleButton:"Digitasi Lingkaran",drawRectButton:"Digitasi Segi Empat",editButton:"Edit Layer",dragButton:"Geser Layer",cutButton:"Potong Layer",deleteButton:"Hilangkan Layer",drawCircleMarkerButton:"Digitasi Penanda Lingkaran",snappingButton:"Jepretkan penanda yang ditarik ke lapisan dan simpul lain",pinningButton:"Sematkan simpul bersama bersama",rotateButton:"Putar lapisan"}},zr={tooltips:{placeMarker:"Adaugă un punct",firstVertex:"Apasă aici pentru a adăuga primul Vertex",continueLine:"Apasă aici pentru a continua desenul",finishLine:"Apasă pe orice obiect pentru a finisa desenul",finishPoly:"Apasă pe primul obiect pentru a finisa",finishRect:"Apasă pentru a finisa",startCircle:"Apasă pentru a desena un cerc",finishCircle:"Apasă pentru a finisa un cerc",placeCircleMarker:"Adaugă un punct"},actions:{finish:"Termină",cancel:"Anulează",removeLastVertex:"Șterge ultimul Vertex"},buttonTitles:{drawMarkerButton:"Adaugă o bulină",drawPolyButton:"Desenează un poligon",drawLineButton:"Desenează o linie",drawCircleButton:"Desenează un cerc",drawRectButton:"Desenează un dreptunghi",editButton:"Editează straturile",dragButton:"Mută straturile",cutButton:"Taie straturile",deleteButton:"Șterge straturile",drawCircleMarkerButton:"Desenează marcatorul cercului",snappingButton:"Fixați marcatorul glisat pe alte straturi și vârfuri",pinningButton:"Fixați vârfurile partajate împreună",rotateButton:"Rotiți stratul"}},Ur={tooltips:{placeMarker:"Нажмите, чтобы нанести маркер",firstVertex:"Нажмите, чтобы нанести первый объект",continueLine:"Нажмите, чтобы продолжить рисование",finishLine:"Нажмите любой существующий маркер для завершения",finishPoly:"Выберите первую точку, чтобы закончить",finishRect:"Нажмите, чтобы закончить",startCircle:"Нажмите, чтобы добавить центр круга",finishCircle:"Нажмите, чтобы задать радиус",placeCircleMarker:"Нажмите, чтобы нанести круговой маркер"},actions:{finish:"Завершить",cancel:"Отменить",removeLastVertex:"Отменить последнее действие"},buttonTitles:{drawMarkerButton:"Добавить маркер",drawPolyButton:"Рисовать полигон",drawLineButton:"Рисовать кривую",drawCircleButton:"Рисовать круг",drawRectButton:"Рисовать прямоугольник",editButton:"Редактировать слой",dragButton:"Перенести слой",cutButton:"Вырезать слой",deleteButton:"Удалить слой",drawCircleMarkerButton:"Добавить круговой маркер",snappingButton:"Привязать перетаскиваемый маркер к другим слоям и вершинам",pinningButton:"Связать общие точки вместе",rotateButton:"Поворот слоя"}},Yt={tooltips:{placeMarker:"Presiona para colocar un marcador",firstVertex:"Presiona para colocar el primer vértice",continueLine:"Presiona para continuar dibujando",finishLine:"Presiona cualquier marcador existente para finalizar",finishPoly:"Presiona el primer marcador para finalizar",finishRect:"Presiona para finalizar",startCircle:"Presiona para colocar el centro del círculo",finishCircle:"Presiona para finalizar el círculo",placeCircleMarker:"Presiona para colocar un marcador de círculo"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Eliminar último vértice"},buttonTitles:{drawMarkerButton:"Dibujar Marcador",drawPolyButton:"Dibujar Polígono",drawLineButton:"Dibujar Línea",drawCircleButton:"Dibujar Círculo",drawRectButton:"Dibujar Rectángulo",editButton:"Editar Capas",dragButton:"Arrastrar Capas",cutButton:"Cortar Capas",deleteButton:"Eliminar Capas",drawCircleMarkerButton:"Dibujar Marcador de Círculo",snappingButton:"El marcador de Snap arrastrado a otras capas y vértices",pinningButton:"Fijar juntos los vértices compartidos",rotateButton:"Rotar capa"}},kt={tooltips:{placeMarker:"Klik om een marker te plaatsen",firstVertex:"Klik om het eerste punt te plaatsen",continueLine:"Klik om te blijven tekenen",finishLine:"Klik op een bestaand punt om te beëindigen",finishPoly:"Klik op het eerst punt om te beëindigen",finishRect:"Klik om te beëindigen",startCircle:"Klik om het middelpunt te plaatsen",finishCircle:"Klik om de cirkel te beëindigen",placeCircleMarker:"Klik om een marker te plaatsen"},actions:{finish:"Bewaar",cancel:"Annuleer",removeLastVertex:"Verwijder laatste punt"},buttonTitles:{drawMarkerButton:"Plaats Marker",drawPolyButton:"Teken een vlak",drawLineButton:"Teken een lijn",drawCircleButton:"Teken een cirkel",drawRectButton:"Teken een vierkant",editButton:"Bewerk",dragButton:"Verplaats",cutButton:"Knip",deleteButton:"Verwijder",drawCircleMarkerButton:"Plaats Marker",snappingButton:"Snap gesleepte marker naar andere lagen en hoekpunten",pinningButton:"Speld gedeelde hoekpunten samen",rotateButton:"Laag roteren"}},Dn={tooltips:{placeMarker:"Cliquez pour placer un marqueur",firstVertex:"Cliquez pour placer le premier sommet",continueLine:"Cliquez pour continuer à dessiner",finishLine:"Cliquez sur n'importe quel marqueur pour terminer",finishPoly:"Cliquez sur le premier marqueur pour terminer",finishRect:"Cliquez pour terminer",startCircle:"Cliquez pour placer le centre du cercle",finishCircle:"Cliquez pour finir le cercle",placeCircleMarker:"Cliquez pour placer le marqueur circulaire"},actions:{finish:"Terminer",cancel:"Annuler",removeLastVertex:"Retirer le dernier sommet"},buttonTitles:{drawMarkerButton:"Placer des marqueurs",drawPolyButton:"Dessiner des polygones",drawLineButton:"Dessiner des polylignes",drawCircleButton:"Dessiner un cercle",drawRectButton:"Dessiner un rectangle",editButton:"Éditer des calques",dragButton:"Déplacer des calques",cutButton:"Couper des calques",deleteButton:"Supprimer des calques",drawCircleMarkerButton:"Dessiner un marqueur circulaire",snappingButton:"Glisser le marqueur vers d'autres couches et sommets",pinningButton:"Épingler ensemble les sommets partagés",rotateButton:"Tourner des calques"}},Ze={tooltips:{placeMarker:"单击放置标记",firstVertex:"单击放置首个顶点",continueLine:"单击继续绘制",finishLine:"单击任何存在的标记以完成",finishPoly:"单击第一个标记以完成",finishRect:"单击完成",startCircle:"单击放置圆心",finishCircle:"单击完成圆形",placeCircleMarker:"点击放置圆形标记"},actions:{finish:"完成",cancel:"取消",removeLastVertex:"移除最后的顶点"},buttonTitles:{drawMarkerButton:"绘制标记",drawPolyButton:"绘制多边形",drawLineButton:"绘制线段",drawCircleButton:"绘制圆形",drawRectButton:"绘制长方形",editButton:"编辑图层",dragButton:"拖拽图层",cutButton:"剪切图层",deleteButton:"删除图层",drawCircleMarkerButton:"画圆圈标记",snappingButton:"将拖动的标记捕捉到其他图层和顶点",pinningButton:"将共享顶点固定在一起",rotateButton:"旋转图层"}},sr={tooltips:{placeMarker:"單擊放置標記",firstVertex:"單擊放置第一個頂點",continueLine:"單擊繼續繪製",finishLine:"單擊任何存在的標記以完成",finishPoly:"單擊第一個標記以完成",finishRect:"單擊完成",startCircle:"單擊放置圓心",finishCircle:"單擊完成圓形",placeCircleMarker:"點擊放置圓形標記"},actions:{finish:"完成",cancel:"取消",removeLastVertex:"移除最後一個頂點"},buttonTitles:{drawMarkerButton:"放置標記",drawPolyButton:"繪製多邊形",drawLineButton:"繪製線段",drawCircleButton:"繪製圓形",drawRectButton:"繪製方形",editButton:"編輯圖形",dragButton:"移動圖形",cutButton:"裁切圖形",deleteButton:"刪除圖形",drawCircleMarkerButton:"畫圓圈標記",snappingButton:"將拖動的標記對齊到其他圖層和頂點",pinningButton:"將共享頂點固定在一起",rotateButton:"旋轉圖形"}},or={tooltips:{placeMarker:"Clique para posicionar o marcador",firstVertex:"Clique para posicionar o primeiro vértice",continueLine:"Clique para continuar desenhando",finishLine:"Clique em qualquer marcador existente para finalizar",finishPoly:"Clique no primeiro marcador para finalizar",finishRect:"Clique para finalizar",startCircle:"Clique para posicionar o centro do círculo",finishCircle:"Clique para finalizar o círculo",placeCircleMarker:"Clique para posicionar o marcador circular",placeText:"Clique para inserir texto"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Remover último vértice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Polígonos",drawLineButton:"Desenhar Linha Poligonal",drawCircleButton:"Desenhar Círculo",drawRectButton:"Desenhar Retângulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Recortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de Círculo",snappingButton:"Ajustar marcador arrastado a outras camadas e vértices",pinningButton:"Unir vértices compartilhados",rotateButton:"Rotacionar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Redimensionar Camadas",autoTracingButton:"Traçado Automático de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"Área",radius:"Raio",perimeter:"Perímetro",height:"Altura",width:"Largura",coordinates:"Posição",coordinatesMarker:"Marcador de Posição"}},Hr={tooltips:{placeMarker:"Clique para colocar marcador",firstVertex:"Clique para colocar primeiro vértice",continueLine:"Clique para continuar a desenhar",finishLine:"Clique num marcador existente para terminar",finishPoly:"Clique no primeiro marcador para terminar",finishRect:"Clique para terminar",startCircle:"Clique para colocar o centro do círculo",finishCircle:"Clique para terminar o círculo",placeCircleMarker:"Clique para colocar marcador de círculo",placeText:"Clique para colocar texto"},actions:{finish:"Terminar",cancel:"Cancelar",removeLastVertex:"Remover Último Vértice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Polígonos",drawLineButton:"Desenhar Polilinha",drawCircleButton:"Desenhar Círculo",drawRectButton:"Desenhar Retângulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Cortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de Círculo",snappingButton:"Ajustar marcador arrastado a outras camadas e vértices",pinningButton:"Unir vértices partilhados",rotateButton:"Rodar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Escalar Camadas",autoTracingButton:"Traçado Automático de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"Área",radius:"Raio",perimeter:"Perímetro",height:"Altura",width:"Largura",coordinates:"Posição",coordinatesMarker:"Marcador de Posição"}},An={tooltips:{placeMarker:"Kliknij, aby umieścić znacznik",firstVertex:"Kliknij, aby umieścić pierwszy wierzchołek",continueLine:"Kliknij, aby kontynuować rysowanie",finishLine:"Kliknij dowolny istniejący znacznik, aby zakończyć",finishPoly:"Kliknij pierwszy znacznik, aby zakończyć",finishRect:"Kliknij, aby zakończyć",startCircle:"Kliknij, aby umieścić środek okręgu",finishCircle:"Kliknij, aby zakończyć okrąg",placeCircleMarker:"Kliknij, aby umieścić znacznik okręgu",placeText:"Kliknij, aby umieścić tekst"},actions:{finish:"Zakończ",cancel:"Anuluj",removeLastVertex:"Usuń ostatni wierzchołek"},buttonTitles:{drawMarkerButton:"Rysuj znacznik",drawPolyButton:"Rysuj wielokąt",drawLineButton:"Rysuj linię",drawCircleButton:"Rysuj okrąg",drawRectButton:"Rysuj prostokąt",editButton:"Edytuj warstwy",dragButton:"Przeciągnij warstwy",cutButton:"Wytnij warstwy",deleteButton:"Usuń warstwy",drawCircleMarkerButton:"Rysuj znacznik okrągły",snappingButton:"Przyciągnij przenoszony znacznik do innych warstw i wierzchołków",pinningButton:"Przypnij wspólne wierzchołki razem",rotateButton:"Obróć warstwy",drawTextButton:"Rysuj tekst",scaleButton:"Skaluj warstwy",autoTracingButton:"Automatyczne śledzenie linii"},measurements:{totalLength:"Długość",segmentLength:"Długość odcinka",area:"Obszar",radius:"Promień",perimeter:"Obwód",height:"Wysokość",width:"Szerokość",coordinates:"Pozycja",coordinatesMarker:"Znacznik pozycji"}},Vr={tooltips:{placeMarker:"Klicka för att placera markör",firstVertex:"Klicka för att placera första hörnet",continueLine:"Klicka för att fortsätta rita",finishLine:"Klicka på en existerande punkt för att slutföra",finishPoly:"Klicka på den första punkten för att slutföra",finishRect:"Klicka för att slutföra",startCircle:"Klicka för att placera cirkelns centrum",finishCircle:"Klicka för att slutföra cirkeln",placeCircleMarker:"Klicka för att placera cirkelmarkör"},actions:{finish:"Slutför",cancel:"Avbryt",removeLastVertex:"Ta bort sista hörnet"},buttonTitles:{drawMarkerButton:"Rita Markör",drawPolyButton:"Rita Polygoner",drawLineButton:"Rita Linje",drawCircleButton:"Rita Cirkel",drawRectButton:"Rita Rektangel",editButton:"Redigera Lager",dragButton:"Dra Lager",cutButton:"Klipp i Lager",deleteButton:"Ta bort Lager",drawCircleMarkerButton:"Rita Cirkelmarkör",snappingButton:"Snäpp dra markören till andra lager och hörn",pinningButton:"Fäst delade hörn tillsammans",rotateButton:"Rotera lagret"}},Kr={tooltips:{placeMarker:"Κάντε κλικ για να τοποθετήσετε Δείκτη",firstVertex:"Κάντε κλικ για να τοποθετήσετε το πρώτο σημείο",continueLine:"Κάντε κλικ για να συνεχίσετε να σχεδιάζετε",finishLine:"Κάντε κλικ σε οποιονδήποτε υπάρχον σημείο για να ολοκληρωθεί",finishPoly:"Κάντε κλικ στο πρώτο σημείο για να τελειώσετε",finishRect:"Κάντε κλικ για να τελειώσετε",startCircle:"Κάντε κλικ για να τοποθετήσετε κέντρο Κύκλου",finishCircle:"Κάντε κλικ για να ολοκληρώσετε τον Κύκλο",placeCircleMarker:"Κάντε κλικ για να τοποθετήσετε Κυκλικό Δείκτη"},actions:{finish:"Τέλος",cancel:"Ακύρωση",removeLastVertex:"Κατάργηση τελευταίου σημείου"},buttonTitles:{drawMarkerButton:"Σχεδίαση Δείκτη",drawPolyButton:"Σχεδίαση Πολυγώνου",drawLineButton:"Σχεδίαση Γραμμής",drawCircleButton:"Σχεδίαση Κύκλου",drawRectButton:"Σχεδίαση Ορθογωνίου",editButton:"Επεξεργασία Επιπέδων",dragButton:"Μεταφορά Επιπέδων",cutButton:"Αποκοπή Επιπέδων",deleteButton:"Κατάργηση Επιπέδων",drawCircleMarkerButton:"Σχεδίαση Κυκλικού Δείκτη",snappingButton:"Προσκόλληση του Δείκτη μεταφοράς σε άλλα Επίπεδα και Κορυφές",pinningButton:"Περικοπή κοινών κορυφών μαζί",rotateButton:"Περιστρέψτε το στρώμα"}},_t={tooltips:{placeMarker:"Kattintson a jelölő elhelyezéséhez",firstVertex:"Kattintson az első pont elhelyezéséhez",continueLine:"Kattintson a következő pont elhelyezéséhez",finishLine:"A befejezéshez kattintson egy meglévő pontra",finishPoly:"A befejezéshez kattintson az első pontra",finishRect:"Kattintson a befejezéshez",startCircle:"Kattintson a kör középpontjának elhelyezéséhez",finishCircle:"Kattintson a kör befejezéséhez",placeCircleMarker:"Kattintson a körjelölő elhelyezéséhez"},actions:{finish:"Befejezés",cancel:"Mégse",removeLastVertex:"Utolsó pont eltávolítása"},buttonTitles:{drawMarkerButton:"Jelölő rajzolása",drawPolyButton:"Poligon rajzolása",drawLineButton:"Vonal rajzolása",drawCircleButton:"Kör rajzolása",drawRectButton:"Négyzet rajzolása",editButton:"Elemek szerkesztése",dragButton:"Elemek mozgatása",cutButton:"Elemek vágása",deleteButton:"Elemek törlése",drawCircleMarkerButton:"Kör jelölő rajzolása",snappingButton:"Kapcsolja a jelöltőt másik elemhez vagy ponthoz",pinningButton:"Közös pontok összekötése",rotateButton:"Fólia elforgatása"}},Pn={tooltips:{placeMarker:"Tryk for at placere en markør",firstVertex:"Tryk for at placere det første punkt",continueLine:"Tryk for at fortsætte linjen",finishLine:"Tryk på et eksisterende punkt for at afslutte",finishPoly:"Tryk på det første punkt for at afslutte",finishRect:"Tryk for at afslutte",startCircle:"Tryk for at placere cirklens center",finishCircle:"Tryk for at afslutte cirklen",placeCircleMarker:"Tryk for at placere en cirkelmarkør"},actions:{finish:"Afslut",cancel:"Afbryd",removeLastVertex:"Fjern sidste punkt"},buttonTitles:{drawMarkerButton:"Placer markør",drawPolyButton:"Tegn polygon",drawLineButton:"Tegn linje",drawCircleButton:"Tegn cirkel",drawRectButton:"Tegn firkant",editButton:"Rediger",dragButton:"Træk",cutButton:"Klip",deleteButton:"Fjern",drawCircleMarkerButton:"Tegn cirkelmarkør",snappingButton:"Fastgør trukket markør til andre elementer",pinningButton:"Sammenlæg delte elementer",rotateButton:"Roter laget"}},ui={tooltips:{placeMarker:"Klikk for å plassere punkt",firstVertex:"Klikk for å plassere første punkt",continueLine:"Klikk for å tegne videre",finishLine:"Klikk på et eksisterende punkt for å fullføre",finishPoly:"Klikk første punkt for å fullføre",finishRect:"Klikk for å fullføre",startCircle:"Klikk for å sette sirkel midtpunkt",finishCircle:"Klikk for å fullføre sirkel",placeCircleMarker:"Klikk for å plassere sirkel",placeText:"Klikk for å plassere tekst"},actions:{finish:"Fullfør",cancel:"Kanseller",removeLastVertex:"Fjern forrige punkt"},buttonTitles:{drawMarkerButton:"Tegn punkt",drawPolyButton:"Tegn flate",drawLineButton:"Tegn linje",drawCircleButton:"Tegn sirkel",drawRectButton:"Tegn rektangel",editButton:"Rediger objekter",dragButton:"Dra objekter",cutButton:"Kutt objekter",deleteButton:"Fjern objekter",drawCircleMarkerButton:"Tegn sirkel-punkt",snappingButton:"Fest dratt punkt til andre objekter og punkt",pinningButton:"Pin delte punkter sammen",rotateButton:"Rotér objekter",drawTextButton:"Tegn tekst",scaleButton:"Skalér objekter",autoTracingButton:"Automatisk sporing av linje"},measurements:{totalLength:"Lengde",segmentLength:"Segmentlengde",area:"Område",radius:"Radius",perimeter:"Omriss",height:"Høyde",width:"Bredde",coordinates:"Posisjon",coordinatesMarker:"Posisjonsmarkør"}},lr={tooltips:{placeMarker:"کلیک برای جانمایی نشان",firstVertex:"کلیک برای رسم اولین رأس",continueLine:"کلیک برای ادامه رسم",finishLine:"کلیک روی هر نشان موجود برای پایان",finishPoly:"کلیک روی اولین نشان برای پایان",finishRect:"کلیک برای پایان",startCircle:"کلیک برای رسم مرکز دایره",finishCircle:"کلیک برای پایان رسم دایره",placeCircleMarker:"کلیک برای رسم نشان دایره",placeText:"کلیک برای نوشتن متن"},actions:{finish:"پایان",cancel:"لفو",removeLastVertex:"حذف آخرین رأس"},buttonTitles:{drawMarkerButton:"درج نشان",drawPolyButton:"رسم چندضلعی",drawLineButton:"رسم خط",drawCircleButton:"رسم دایره",drawRectButton:"رسم چهارضلعی",editButton:"ویرایش لایه‌ها",dragButton:"جابجایی لایه‌ها",cutButton:"برش لایه‌ها",deleteButton:"حذف لایه‌ها",drawCircleMarkerButton:"رسم نشان دایره",snappingButton:"نشانگر را به لایه‌ها و رئوس دیگر بکشید",pinningButton:"رئوس مشترک را با هم پین کنید",rotateButton:"چرخش لایه",drawTextButton:"رسم متن",scaleButton:"مقیاس‌گذاری",autoTracingButton:"ردیاب خودکار"},measurements:{totalLength:"طول",segmentLength:"طول بخش",area:"ناحیه",radius:"شعاع",perimeter:"محیط",height:"ارتفاع",width:"عرض",coordinates:"موقعیت",coordinatesMarker:"موقعیت نشان"}},hi={tooltips:{placeMarker:"Натисніть, щоб нанести маркер",firstVertex:"Натисніть, щоб нанести першу вершину",continueLine:"Натисніть, щоб продовжити малювати",finishLine:"Натисніть будь-який існуючий маркер для завершення",finishPoly:"Виберіть перший маркер, щоб завершити",finishRect:"Натисніть, щоб завершити",startCircle:"Натисніть, щоб додати центр кола",finishCircle:"Натисніть, щоб завершити коло",placeCircleMarker:"Натисніть, щоб нанести круговий маркер"},actions:{finish:"Завершити",cancel:"Відмінити",removeLastVertex:"Видалити попередню вершину"},buttonTitles:{drawMarkerButton:"Малювати маркер",drawPolyButton:"Малювати полігон",drawLineButton:"Малювати криву",drawCircleButton:"Малювати коло",drawRectButton:"Малювати прямокутник",editButton:"Редагувати шари",dragButton:"Перенести шари",cutButton:"Вирізати шари",deleteButton:"Видалити шари",drawCircleMarkerButton:"Малювати круговий маркер",snappingButton:"Прив’язати перетягнутий маркер до інших шарів та вершин",pinningButton:"Зв'язати спільні вершини разом",rotateButton:"Повернути шар"}},Wr={tooltips:{placeMarker:"İşaretçi yerleştirmek için tıklayın",firstVertex:"İlk tepe noktasını yerleştirmek için tıklayın",continueLine:"Çizime devam etmek için tıklayın",finishLine:"Bitirmek için mevcut herhangi bir işaretçiyi tıklayın",finishPoly:"Bitirmek için ilk işaretçiyi tıklayın",finishRect:"Bitirmek için tıklayın",startCircle:"Daire merkezine yerleştirmek için tıklayın",finishCircle:"Daireyi bitirmek için tıklayın",placeCircleMarker:"Daire işaretçisi yerleştirmek için tıklayın"},actions:{finish:"Bitir",cancel:"İptal",removeLastVertex:"Son köşeyi kaldır"},buttonTitles:{drawMarkerButton:"Çizim İşaretçisi",drawPolyButton:"Çokgenler çiz",drawLineButton:"Çoklu çizgi çiz",drawCircleButton:"Çember çiz",drawRectButton:"Dikdörtgen çiz",editButton:"Katmanları düzenle",dragButton:"Katmanları sürükle",cutButton:"Katmanları kes",deleteButton:"Katmanları kaldır",drawCircleMarkerButton:"Daire işaretçisi çiz",snappingButton:"Sürüklenen işaretçiyi diğer katmanlara ve köşelere yapıştır",pinningButton:"Paylaşılan köşeleri birbirine sabitle",rotateButton:"Katmanı döndür"}},Se={tooltips:{placeMarker:"Kliknutím vytvoříte značku",firstVertex:"Kliknutím vytvoříte první objekt",continueLine:"Kliknutím pokračujte v kreslení",finishLine:"Kliknutí na libovolnou existující značku pro dokončení",finishPoly:"Vyberte první bod pro dokončení",finishRect:"Klikněte pro dokončení",startCircle:"Kliknutím přidejte střed kruhu",finishCircle:"Нажмите, чтобы задать радиус",placeCircleMarker:"Kliknutím nastavte poloměr"},actions:{finish:"Dokončit",cancel:"Zrušit",removeLastVertex:"Zrušit poslední akci"},buttonTitles:{drawMarkerButton:"Přidat značku",drawPolyButton:"Nakreslit polygon",drawLineButton:"Nakreslit křivku",drawCircleButton:"Nakreslit kruh",drawRectButton:"Nakreslit obdélník",editButton:"Upravit vrstvu",dragButton:"Přeneste vrstvu",cutButton:"Vyjmout vrstvu",deleteButton:"Smazat vrstvu",drawCircleMarkerButton:"Přidat kruhovou značku",snappingButton:"Navázat tažnou značku k dalším vrstvám a vrcholům",pinningButton:"Spojit společné body dohromady",rotateButton:"Otočte vrstvu"}},Ni={tooltips:{placeMarker:"クリックしてマーカーを配置",firstVertex:"クリックして最初の頂点を配置",continueLine:"クリックして描画を続ける",finishLine:"任意のマーカーをクリックして終了",finishPoly:"最初のマーカーをクリックして終了",finishRect:"クリックして終了",startCircle:"クリックして円の中心を配置",finishCircle:"クリックして円の描画を終了",placeCircleMarker:"クリックして円マーカーを配置",placeText:"クリックしてテキストを配置"},actions:{finish:"終了",cancel:"キャンセル",removeLastVertex:"最後の頂点を削除"},buttonTitles:{drawMarkerButton:"マーカーを描画",drawPolyButton:"ポリゴンを描画",drawLineButton:"折れ線を描画",drawCircleButton:"円を描画",drawRectButton:"矩形を描画",editButton:"レイヤーを編集",dragButton:"レイヤーをドラッグ",cutButton:"レイヤーを切り取り",deleteButton:"レイヤーを削除",drawCircleMarkerButton:"円マーカーを描画",snappingButton:"ドラッグしたマーカーを他のレイヤーや頂点にスナップする",pinningButton:"共有する頂点を同時に動かす",rotateButton:"レイヤーを回転",drawTextButton:"テキストを描画"}},Mt={tooltips:{placeMarker:"Klikkaa asettaaksesi merkin",firstVertex:"Klikkaa asettaakseni ensimmäisen osuuden",continueLine:"Klikkaa jatkaaksesi piirtämistä",finishLine:"Klikkaa olemassa olevaa merkkiä lopettaaksesi",finishPoly:"Klikkaa ensimmäistä merkkiä lopettaaksesi",finishRect:"Klikkaa lopettaaksesi",startCircle:"Klikkaa asettaaksesi ympyrän keskipisteen",finishCircle:"Klikkaa lopettaaksesi ympyrän",placeCircleMarker:"Klikkaa asettaaksesi ympyrämerkin",placeText:"Klikkaa asettaaksesi tekstin"},actions:{finish:"Valmis",cancel:"Peruuta",removeLastVertex:"Poista viimeinen osuus"},buttonTitles:{drawMarkerButton:"Piirrä merkkejä",drawPolyButton:"Piirrä monikulmioita",drawLineButton:"Piirrä viivoja",drawCircleButton:"Piirrä ympyrä",drawRectButton:"Piirrä neliskulmioita",editButton:"Muokkaa",dragButton:"Siirrä",cutButton:"Leikkaa",deleteButton:"Poista",drawCircleMarkerButton:"Piirrä ympyrämerkki",snappingButton:"Kiinnitä siirrettävä merkki toisiin muotoihin",pinningButton:"Kiinnitä jaetut muodot yhteen",rotateButton:"Käännä",drawTextButton:"Piirrä tekstiä"}},Tn={tooltips:{placeMarker:"마커 위치를 클릭하세요",firstVertex:"첫번째 꼭지점 위치을 클릭하세요",continueLine:"계속 그리려면 클릭하세요",finishLine:"끝내려면 기존 마커를 클릭하세요",finishPoly:"끝내려면 처음 마커를 클릭하세요",finishRect:"끝내려면 클릭하세요",startCircle:"원의 중심이 될 위치를 클릭하세요",finishCircle:"원을 끝내려면 클릭하세요",placeCircleMarker:"원 마커 위치를 클릭하세요",placeText:"텍스트 위치를 클릭하세요"},actions:{finish:"끝내기",cancel:"취소",removeLastVertex:"마지막 꼭지점 제거"},buttonTitles:{drawMarkerButton:"마커 그리기",drawPolyButton:"다각형 그리기",drawLineButton:"다각선 그리기",drawCircleButton:"원 그리기",drawRectButton:"직사각형 그리기",editButton:"레이어 편집하기",dragButton:"레이어 끌기",cutButton:"레이어 자르기",deleteButton:"레이어 제거하기",drawCircleMarkerButton:"원 마커 그리기",snappingButton:"잡아끈 마커를 다른 레이어 및 꼭지점에 들러붙게 하기",pinningButton:"공유 꼭지점을 함께 찍기",rotateButton:"레이어 회전하기",drawTextButton:"텍스트 그리기"}},jt={tooltips:{placeMarker:"Маркерди жайгаштыруу үчүн басыңыз",firstVertex:"Биринчи чокуну жайгаштырууну үчүн басыңыз",continueLine:"Сүрөт тартууну улантуу үчүн басыңыз",finishLine:"Аяктоо үчүн учурдагы маркерди басыңыз",finishPoly:"Бүтүрүү үчүн биринчи маркерди басыңыз",finishRect:"Бүтүрүү үчүн басыңыз",startCircle:"Айлананын борборун жайгаштырууну үчүн басыңыз",finishCircle:"Айлананы бүтүрүү үчүн басыңыз",placeCircleMarker:"Тегерек маркерди жайгаштыруу үчүн басыңыз",placeText:"Текстти жайгаштыруу үчүн басыңыз"},actions:{finish:"Аягы",cancel:"Жок кылуу",removeLastVertex:"Акыркы чокуну өчүрүү"},buttonTitles:{drawMarkerButton:"Маркерди чизуу",drawPolyButton:"Полигон чизуу",drawLineButton:"Полилиния чизуу",drawCircleButton:"Дайынды чизуу",drawRectButton:"Прямоугольник чизуу",editButton:"Слоопту түзөтүү",dragButton:"Слоопту карап сүйлөү",cutButton:"Слооптун башын кесүү",deleteButton:"Слооптун өчүрүү",drawCircleMarkerButton:"Дайынды маркерди чизуу",snappingButton:"Башка слооптордун жана вертекстердин арасына чекилдөө",pinningButton:"Бөлүшкөн вертекстерди бирге тутуштуруу",rotateButton:"Слооптун өзгөртүү",drawTextButton:"Текст чизуу",scaleButton:"Слооптун өлчөмүн өзгөртүү",autoTracingButton:"Автоматтык тизмеги чизуу"},measurements:{totalLength:"Узундук",segmentLength:"Сегмент узундугу",area:"Аймак",radius:"Радиус",perimeter:"Периметр",height:"Диаметр",width:"Кенчилик",coordinates:"Координаттар",coordinatesMarker:"Маркердин координаттары"}},De=Hr,It={en:Ir,de:Nr,it:ar,id:Gr,ro:zr,ru:Ur,es:Yt,nl:kt,fr:Dn,pt:De,pt_br:or,pt_pt:Hr,zh:Ze,zh_tw:sr,pl:An,sv:Vr,el:Kr,hu:_t,da:Pn,no:ui,fa:lr,ua:hi,tr:Wr,cz:Se,ja:Ni,fi:Mt,ko:Tn,ky:jt},Ae={_globalEditModeEnabled:!1,enableGlobalEditMode(e){let t={...e};this._globalEditModeEnabled=!0,this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),L.PM.Utils.findLayers(this.map).forEach(i=>{this._isRelevantForEdit(i)&&i.pm.enable(t)}),this.throttledReInitEdit||(this.throttledReInitEdit=L.Util.throttle(this.handleLayerAdditionInGlobalEditMode,100,this)),this._addedLayersEdit={},this.map.on("layeradd",this._layerAddedEdit,this),this.map.on("layeradd",this.throttledReInitEdit,this),this._fireGlobalEditModeToggled(!0)},disableGlobalEditMode(){this._globalEditModeEnabled=!1,L.PM.Utils.findLayers(this.map).forEach(e=>{e.pm.disable()}),this.map.off("layeradd",this._layerAddedEdit,this),this.map.off("layeradd",this.throttledReInitEdit,this),this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),this._fireGlobalEditModeToggled(!1)},globalEditEnabled(){return this.globalEditModeEnabled()},globalEditModeEnabled(){return this._globalEditModeEnabled},toggleGlobalEditMode(e=this.globalOptions){this.globalEditModeEnabled()?this.disableGlobalEditMode():this.enableGlobalEditMode(e)},handleLayerAdditionInGlobalEditMode(){let e=this._addedLayersEdit;if(this._addedLayersEdit={},this.globalEditModeEnabled())for(let t in e){let i=e[t];this._isRelevantForEdit(i)&&i.pm.enable({...this.globalOptions})}},_layerAddedEdit({layer:e}){this._addedLayersEdit[L.stamp(e)]=e},_isRelevantForEdit(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowEditing}},Nt=Ae,ur={_globalDragModeEnabled:!1,enableGlobalDragMode(){let e=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!0,this._addedLayersDrag={},e.forEach(t=>{this._isRelevantForDrag(t)&&t.pm.enableLayerDrag()}),this.throttledReInitDrag||(this.throttledReInitDrag=L.Util.throttle(this.reinitGlobalDragMode,100,this)),this.map.on("layeradd",this._layerAddedDrag,this),this.map.on("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!0)},disableGlobalDragMode(){let e=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!1,e.forEach(t=>{t.pm.disableLayerDrag()}),this.map.off("layeradd",this._layerAddedDrag,this),this.map.off("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!1)},globalDragModeEnabled(){return!!this._globalDragModeEnabled},toggleGlobalDragMode(){this.globalDragModeEnabled()?this.disableGlobalDragMode():this.enableGlobalDragMode()},reinitGlobalDragMode(){let e=this._addedLayersDrag;if(this._addedLayersDrag={},this.globalDragModeEnabled())for(let t in e){let i=e[t];this._isRelevantForDrag(i)&&i.pm.enableLayerDrag()}},_layerAddedDrag({layer:e}){this._addedLayersDrag[L.stamp(e)]=e},_isRelevantForDrag(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.draggable}},hr=ur,Gt={_globalRemovalModeEnabled:!1,enableGlobalRemovalMode(){this._globalRemovalModeEnabled=!0,this.map.eachLayer(e=>{this._isRelevantForRemoval(e)&&(e.pm.enabled()&&e.pm.disable(),e.on("click",this.removeLayer,this))}),this.throttledReInitRemoval||(this.throttledReInitRemoval=L.Util.throttle(this.handleLayerAdditionInGlobalRemovalMode,100,this)),this._addedLayersRemoval={},this.map.on("layeradd",this._layerAddedRemoval,this),this.map.on("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!0)},disableGlobalRemovalMode(){this._globalRemovalModeEnabled=!1,this.map.eachLayer(e=>{e.off("click",this.removeLayer,this)}),this.map.off("layeradd",this._layerAddedRemoval,this),this.map.off("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!1)},globalRemovalEnabled(){return this.globalRemovalModeEnabled()},globalRemovalModeEnabled(){return!!this._globalRemovalModeEnabled},toggleGlobalRemovalMode(){this.globalRemovalModeEnabled()?this.disableGlobalRemovalMode():this.enableGlobalRemovalMode()},removeLayer(e){let t=e.target;this._isRelevantForRemoval(t)&&!t.pm.dragging()&&(t.removeFrom(this.map.pm._getContainingLayer()),t.remove(),t instanceof L.LayerGroup?(this._fireRemoveLayerGroup(t),this._fireRemoveLayerGroup(this.map,t)):(t.pm._fireRemove(t),t.pm._fireRemove(this.map,t)))},_isRelevantForRemoval(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowRemoval},handleLayerAdditionInGlobalRemovalMode(){let e=this._addedLayersRemoval;if(this._addedLayersRemoval={},this.globalRemovalModeEnabled())for(let t in e){let i=e[t];this._isRelevantForRemoval(i)&&(i.pm.enabled()&&i.pm.disable(),i.on("click",this.removeLayer,this))}},_layerAddedRemoval({layer:e}){this._addedLayersRemoval[L.stamp(e)]=e}},Rn=Gt,Fn={_globalRotateModeEnabled:!1,enableGlobalRotateMode(){this._globalRotateModeEnabled=!0,L.PM.Utils.findLayers(this.map).filter(e=>e instanceof L.Polyline).forEach(e=>{this._isRelevantForRotate(e)&&e.pm.enableRotate()}),this.throttledReInitRotate||(this.throttledReInitRotate=L.Util.throttle(this.handleLayerAdditionInGlobalRotateMode,100,this)),this._addedLayersRotate={},this.map.on("layeradd",this._layerAddedRotate,this),this.map.on("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},disableGlobalRotateMode(){this._globalRotateModeEnabled=!1,L.PM.Utils.findLayers(this.map).filter(e=>e instanceof L.Polyline).forEach(e=>{e.pm.disableRotate()}),this.map.off("layeradd",this._layerAddedRotate,this),this.map.off("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},globalRotateModeEnabled(){return!!this._globalRotateModeEnabled},toggleGlobalRotateMode(){this.globalRotateModeEnabled()?this.disableGlobalRotateMode():this.enableGlobalRotateMode()},_isRelevantForRotate(e){return e.pm&&e instanceof L.Polyline&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowRotation},handleLayerAdditionInGlobalRotateMode(){let e=this._addedLayersRotate;if(this._addedLayersRotate={},this.globalRotateModeEnabled())for(let t in e){let i=e[t];this._isRelevantForRemoval(i)&&i.pm.enableRotate()}},_layerAddedRotate({layer:e}){this._addedLayersRotate[L.stamp(e)]=e}},ci=Fn,On=Oe(qt()),jn={_fireDrawStart(e="Draw",t={}){this.__fire(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer},e,t)},_fireDrawEnd(e="Draw",t={}){this.__fire(this._map,"pm:drawend",{shape:this._shape},e,t)},_fireCreate(e,t="Draw",i={}){this.__fire(this._map,"pm:create",{shape:this._shape,marker:e,layer:e},t,i)},_fireCenterPlaced(e="Draw",t={}){let i=e==="Draw"?this._layer:void 0,r=e!=="Draw"?this._layer:void 0;this.__fire(this._layer,"pm:centerplaced",{shape:this._shape,workingLayer:i,layer:r,latlng:this._layer.getLatLng()},e,t)},_fireCut(e,t,i,r="Draw",n={}){this.__fire(e,"pm:cut",{shape:this._shape,layer:t,originalLayer:i},r,n)},_fireEdit(e=this._layer,t="Edit",i={}){this.__fire(e,"pm:edit",{layer:this._layer,shape:this.getShape()},t,i)},_fireEnable(e="Edit",t={}){this.__fire(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()},e,t)},_fireDisable(e="Edit",t={}){this.__fire(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()},e,t)},_fireUpdate(e="Edit",t={}){this.__fire(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()},e,t)},_fireMarkerDragStart(e,t=void 0,i="Edit",r={}){this.__fire(this._layer,"pm:markerdragstart",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t},i,r)},_fireMarkerDrag(e,t=void 0,i="Edit",r={}){this.__fire(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t},i,r)},_fireMarkerDragEnd(e,t=void 0,i=void 0,r="Edit",n={}){this.__fire(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t,intersectionReset:i},r,n)},_fireDragStart(e="Edit",t={}){this.__fire(this._layer,"pm:dragstart",{layer:this._layer,shape:this.getShape()},e,t)},_fireDrag(e,t="Edit",i={}){this.__fire(this._layer,"pm:drag",{...e,shape:this.getShape()},t,i)},_fireDragEnd(e="Edit",t={}){this.__fire(this._layer,"pm:dragend",{layer:this._layer,shape:this.getShape()},e,t)},_fireDragEnable(e="Edit",t={}){this.__fire(this._layer,"pm:dragenable",{layer:this._layer,shape:this.getShape()},e,t)},_fireDragDisable(e="Edit",t={}){this.__fire(this._layer,"pm:dragdisable",{layer:this._layer,shape:this.getShape()},e,t)},_fireRemove(e,t=e,i="Edit",r={}){this.__fire(e,"pm:remove",{layer:t,shape:this.getShape()},i,r)},_fireVertexAdded(e,t,i,r="Edit",n={}){this.__fire(this._layer,"pm:vertexadded",{layer:this._layer,workingLayer:this._layer,marker:e,indexPath:t,latlng:i,shape:this.getShape()},r,n)},_fireVertexRemoved(e,t,i="Edit",r={}){this.__fire(this._layer,"pm:vertexremoved",{layer:this._layer,marker:e,indexPath:t,shape:this.getShape()},i,r)},_fireVertexClick(e,t,i="Edit",r={}){this.__fire(this._layer,"pm:vertexclick",{layer:this._layer,markerEvent:e,indexPath:t,shape:this.getShape()},i,r)},_fireIntersect(e,t=this._layer,i="Edit",r={}){this.__fire(t,"pm:intersect",{layer:this._layer,intersection:e,shape:this.getShape()},i,r)},_fireLayerReset(e,t,i="Edit",r={}){this.__fire(this._layer,"pm:layerreset",{layer:this._layer,markerEvent:e,indexPath:t,shape:this.getShape()},i,r)},_fireChange(e,t="Edit",i={}){this.__fire(this._layer,"pm:change",{layer:this._layer,latlngs:e,shape:this.getShape()},t,i)},_fireTextChange(e,t="Edit",i={}){this.__fire(this._layer,"pm:textchange",{layer:this._layer,text:e,shape:this.getShape()},t,i)},_fireTextFocus(e="Edit",t={}){this.__fire(this._layer,"pm:textfocus",{layer:this._layer,shape:this.getShape()},e,t)},_fireTextBlur(e="Edit",t={}){this.__fire(this._layer,"pm:textblur",{layer:this._layer,shape:this.getShape()},e,t)},_fireSnapDrag(e,t,i="Snapping",r={}){this.__fire(e,"pm:snapdrag",t,i,r)},_fireSnap(e,t,i="Snapping",r={}){this.__fire(e,"pm:snap",t,i,r)},_fireUnsnap(e,t,i="Snapping",r={}){this.__fire(e,"pm:unsnap",t,i,r)},_fireRotationEnable(e,t,i="Rotation",r={}){this.__fire(e,"pm:rotateenable",{layer:this._layer,helpLayer:this._rotatePoly,shape:this.getShape()},i,r)},_fireRotationDisable(e,t="Rotation",i={}){this.__fire(e,"pm:rotatedisable",{layer:this._layer,shape:this.getShape()},t,i)},_fireRotationStart(e,t,i="Rotation",r={}){this.__fire(e,"pm:rotatestart",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:this._startAngle,originLatLngs:t},i,r)},_fireRotation(e,t,i,r=this._rotationLayer,n="Rotation",a={}){this.__fire(e,"pm:rotate",{layer:r,helpLayer:this._layer,startAngle:this._startAngle,angle:r.pm.getAngle(),angleDiff:t,oldLatLngs:i,newLatLngs:r.getLatLngs()},n,a)},_fireRotationEnd(e,t,i,r="Rotation",n={}){this.__fire(e,"pm:rotateend",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:t,angle:this._rotationLayer.pm.getAngle(),originLatLngs:i,newLatLngs:this._rotationLayer.getLatLngs()},r,n)},_fireActionClick(e,t,i,r="Toolbar",n={}){this.__fire(this._map,"pm:actionclick",{text:e.text,action:e,btnName:t,button:i},r,n)},_fireButtonClick(e,t,i="Toolbar",r={}){this.__fire(this._map,"pm:buttonclick",{btnName:e,button:t},i,r)},_fireLangChange(e,t,i,r,n="Global",a={}){this.__fire(this.map,"pm:langchange",{oldLang:e,activeLang:t,fallback:i,translations:r},n,a)},_fireGlobalDragModeToggled(e,t="Global",i={}){this.__fire(this.map,"pm:globaldragmodetoggled",{enabled:e,map:this.map},t,i)},_fireGlobalEditModeToggled(e,t="Global",i={}){this.__fire(this.map,"pm:globaleditmodetoggled",{enabled:e,map:this.map},t,i)},_fireGlobalRemovalModeToggled(e,t="Global",i={}){this.__fire(this.map,"pm:globalremovalmodetoggled",{enabled:e,map:this.map},t,i)},_fireGlobalCutModeToggled(e="Global",t={}){this.__fire(this._map,"pm:globalcutmodetoggled",{enabled:!!this._enabled,map:this._map},e,t)},_fireGlobalDrawModeToggled(e="Global",t={}){this.__fire(this._map,"pm:globaldrawmodetoggled",{enabled:this._enabled,shape:this._shape,map:this._map},e,t)},_fireGlobalRotateModeToggled(e="Global",t={}){this.__fire(this.map,"pm:globalrotatemodetoggled",{enabled:this.globalRotateModeEnabled(),map:this.map},e,t)},_fireRemoveLayerGroup(e,t=e,i="Edit",r={}){this.__fire(e,"pm:remove",{layer:t,shape:void 0},i,r)},_fireKeyeventEvent(e,t,i,r="Global",n={}){this.__fire(this.map,"pm:keyevent",{event:e,eventType:t,focusOn:i},r,n)},__fire(e,t,i,r,n={}){i=(0,On.default)(i,n,{source:r}),L.PM.Utils._fireEvent(e,t,i)}},Gi=jn,In=()=>({_lastEvents:{keydown:void 0,keyup:void 0,current:void 0},_initKeyListener(e){this.map=e,L.DomEvent.on(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.on(window,"blur",this._onBlur,this),e.once("unload",this._unbindKeyListenerEvents,this)},_unbindKeyListenerEvents(){L.DomEvent.off(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.off(window,"blur",this._onBlur,this)},_onKeyListener(e){let t="document";this.map.getContainer().contains(e.target)&&(t="map");let i={event:e,eventType:e.type,focusOn:t};this._lastEvents[e.type]=i,this._lastEvents.current=i,this.map.pm._fireKeyeventEvent(e,e.type,t)},_onBlur(e){e.altKey=!1;let t={event:e,eventType:e.type,focusOn:"document"};this._lastEvents[e.type]=t,this._lastEvents.current=t},getLastKeyEvent(e="current"){return this._lastEvents[e]},isShiftKeyPressed(){return this._lastEvents.current?.event.shiftKey},isAltKeyPressed(){return this._lastEvents.current?.event.altKey},isCtrlKeyPressed(){return this._lastEvents.current?.event.ctrlKey},isMetaKeyPressed(){return this._lastEvents.current?.event.metaKey},getPressedKey(){return this._lastEvents.current?.event.key}}),Xt=In,cr=Oe(li());function ae(e){let t=L.PM.activeLang;return(0,cr.default)(It[t],e)||(0,cr.default)(It.en,e)||e}function Et(e){for(let t=0;t<e.length;t+=1){let i=e[t];if(Array.isArray(i)){if(Et(i))return!0}else if(i!=null&&i!=="")return!0}return!1}function zi(e){return e.reduce((t,i)=>{if(i.length!==0){let r=Array.isArray(i)?zi(i):i;Array.isArray(r)?r.length!==0&&t.push(r):t.push(r)}return t},[])}function qr(e,t,i){let r={a:L.CRS.Earth.R,b:63567523142e-4,f:.0033528106647474805},{a:n,b:a,f:s}=r,o=e.lng,h=e.lat,c=i,x=Math.PI,y=t*x/180,T=Math.sin(y),F=Math.cos(y),z=(1-s)*Math.tan(h*x/180),q=1/Math.sqrt(1+z*z),Y=z*q,ue=Math.atan2(z,F),b=q*T,v=1-b*b,B=v*(n*n-a*a)/(a*a),O=1+B/16384*(4096+B*(-768+B*(320-175*B))),S=B/1024*(256+B*(-128+B*(74-47*B))),R=c/(a*O),u=2*Math.PI,d,f,p;for(;Math.abs(R-u)>1e-12;){d=Math.cos(2*ue+R),f=Math.sin(R),p=Math.cos(R);let G=S*f*(d+S/4*(p*(-1+2*d*d)-S/6*d*(-3+4*f*f)*(-3+4*d*d)));u=R,R=c/(a*O)+G}let g=Y*f-q*p*F,m=Math.atan2(Y*p+q*f*F,(1-s)*Math.sqrt(b*b+g*g)),k=Math.atan2(f*T,q*p-Y*f*F),C=s/16*v*(4+s*(4-3*v)),E=k-(1-C)*s*b*(R+C*f*(d+C*p*(-1+2*d*d))),P=o+E*180/x,A=m*180/x;return L.latLng(P,A)}function $r(e,t,i,r,n=!0){let a,s,o,h=[];for(let c=0;c<i;c+=1){if(n)a=c*360/i+r,s=qr(e,a,t),o=L.latLng(s.lng,s.lat);else{let x=e.lat+Math.cos(2*c*Math.PI/i)*t,y=e.lng+Math.sin(2*c*Math.PI/i)*t;o=L.latLng(x,y)}h.push(o)}return h}function Nn(e,t,i){t=(t+360)%360;let r=Math.PI/180,n=180/Math.PI,{R:a}=L.CRS.Earth,s=e.lng*r,o=e.lat*r,h=t*r,c=Math.sin(o),x=Math.cos(o),y=Math.cos(i/a),T=Math.sin(i/a),F=Math.asin(c*y+x*T*Math.cos(h)),z=s+Math.atan2(Math.sin(h)*T*x,y-c*Math.sin(F));z*=n;let q=z-360,Y=z<-180?z+360:z;return z=z>180?q:Y,L.latLng([F*n,z])}function dr(e,t,i){let r=e.latLngToContainerPoint(t),n=e.latLngToContainerPoint(i),a=Math.atan2(n.y-r.y,n.x-r.x)*180/Math.PI+90;return a+=a<0?360:0,a}function Ui(e,t,i,r){let n=dr(e,t,i);return Nn(t,n,r)}function Gn(e,t,i="asc"){if(!t||Object.keys(t).length===0)return(h,c)=>h-c;let r=Object.keys(t),n,a=r.length-1,s={};for(;a>=0;)n=r[a],s[n.toLowerCase()]=t[n],a-=1;function o(h){if(h instanceof L.Marker)return"Marker";if(h instanceof L.Circle)return"Circle";if(h instanceof L.CircleMarker)return"CircleMarker";if(h instanceof L.Rectangle)return"Rectangle";if(h instanceof L.Polygon)return"Polygon";if(h instanceof L.Polyline)return"Line"}return(h,c)=>{let x,y;if(x=o(h.layer).toLowerCase(),y=o(c.layer).toLowerCase(),!x||!y)return 0;let T=x in s?s[x]:Number.MAX_SAFE_INTEGER,F=y in s?s[y]:Number.MAX_SAFE_INTEGER,z=0;return T<F?z=-1:T>F&&(z=1),i==="desc"?z*-1:z}}function rt(e,t=e.getLatLngs()){return e instanceof L.Polygon?L.polygon(t).getLatLngs():L.polyline(t).getLatLngs()}function Yr(e,t){if(t.options.crs?.projection?.MAX_LATITUDE){let i=t.options.crs?.projection?.MAX_LATITUDE;e.lat=Math.max(Math.min(i,e.lat),-i)}return e}function Zt(e){return e.options.renderer||e._map&&(e._map._getPaneRenderer(e.options.pane)||e._map.options.renderer||e._map._renderer)||e._renderer}var pr=L.Class.extend({includes:[Nt,hr,Rn,ci,Gi],initialize(e){this.map=e,this.Draw=new L.PM.Draw(e),this.Toolbar=new L.PM.Toolbar(e),this.Keyboard=Xt(),this.globalOptions={snappable:!0,layerGroup:void 0,snappingOrder:["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],panes:{vertexPane:"markerPane",layerPane:"overlayPane",markerPane:"markerPane"},draggable:!0},this.Keyboard._initKeyListener(e)},setLang(e="en",t,i="en"){if(e=e.trim().toLowerCase(),!/^[a-z]{2}$/.test(e)){let n=e.replace(/[-_\s]/g,"-").replace(/^(\w{2})$/,"$1-").match(/([a-z]{2})-?([a-z]{2})?/);if(n){let a=[`${n[1]}_${n[2]}`,`${n[1]}`];for(let s of a)if(It[s]){e=s;break}}}let r=L.PM.activeLang;t&&(It[e]=(0,Ii.default)(It[i],t)),L.PM.activeLang=e,this.map.pm.Toolbar.reinit(),this._fireLangChange(r,e,i,It[e])},addControls(e){this.Toolbar.addControls(e)},removeControls(){this.Toolbar.removeControls()},toggleControls(){this.Toolbar.toggleControls()},controlsVisible(){return this.Toolbar.isVisible},enableDraw(e="Polygon",t){e==="Poly"&&(e="Polygon"),this.Draw.enable(e,t)},disableDraw(e="Polygon"){e==="Poly"&&(e="Polygon"),this.Draw.disable(e)},setPathOptions(e,t={}){let i=t.ignoreShapes||[],r=t.merge||!1;this.map.pm.Draw.shapes.forEach(n=>{i.indexOf(n)===-1&&this.map.pm.Draw[n].setPathOptions(e,r)})},getGlobalOptions(){return this.globalOptions},setGlobalOptions(e){let t=(0,Ii.default)(this.globalOptions,e);t.editable&&(t.resizeableCircleMarker=t.editable,delete t.editable);let i=!1;this.map.pm.Draw.CircleMarker.enabled()&&!!this.map.pm.Draw.CircleMarker.options.resizeableCircleMarker!=!!t.resizeableCircleMarker&&(this.map.pm.Draw.CircleMarker.disable(),i=!0);let r=!1;this.map.pm.Draw.Circle.enabled()&&!!this.map.pm.Draw.Circle.options.resizeableCircle!=!!t.resizeableCircle&&(this.map.pm.Draw.Circle.disable(),r=!0),this.map.pm.Draw.shapes.forEach(n=>{this.map.pm.Draw[n].setOptions(t)}),i&&this.map.pm.Draw.CircleMarker.enable(),r&&this.map.pm.Draw.Circle.enable(),L.PM.Utils.findLayers(this.map).forEach(n=>{n.pm.setOptions(t)}),this.map.fire("pm:globaloptionschanged"),this.globalOptions=t,this.applyGlobalOptions()},applyGlobalOptions(){L.PM.Utils.findLayers(this.map).forEach(e=>{e.pm.enabled()&&e.pm.applyOptions()})},globalDrawModeEnabled(){return!!this.Draw.getActiveShape()},globalCutModeEnabled(){return!!this.Draw.Cut.enabled()},enableGlobalCutMode(e){return this.Draw.Cut.enable(e)},toggleGlobalCutMode(e){return this.Draw.Cut.toggle(e)},disableGlobalCutMode(){return this.Draw.Cut.disable()},getGeomanLayers(e=!1){let t=L.PM.Utils.findLayers(this.map);if(!e)return t;let i=L.featureGroup();return i._pmTempLayer=!0,t.forEach(r=>{i.addLayer(r)}),i},getGeomanDrawLayers(e=!1){let t=L.PM.Utils.findLayers(this.map).filter(r=>r._drawnByGeoman===!0);if(!e)return t;let i=L.featureGroup();return i._pmTempLayer=!0,t.forEach(r=>{i.addLayer(r)}),i},_getContainingLayer(){return this.globalOptions.layerGroup&&this.globalOptions.layerGroup instanceof L.LayerGroup?this.globalOptions.layerGroup:this.map},_isCRSSimple(){return this.map.options.crs===L.CRS.Simple},_touchEventCounter:0,_addTouchEvents(e){this._touchEventCounter===0&&(L.DomEvent.on(e,"touchmove",this._canvasTouchMove,this),L.DomEvent.on(e,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter+=1},_removeTouchEvents(e){this._touchEventCounter===1&&(L.DomEvent.off(e,"touchmove",this._canvasTouchMove,this),L.DomEvent.off(e,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter=this._touchEventCounter<=1?0:this._touchEventCounter-1},_canvasTouchMove(e){Zt(this.map)._onMouseMove(this._createMouseEvent("mousemove",e))},_canvasTouchClick(e){let t="";e.type==="touchstart"||e.type==="pointerdown"?t="mousedown":(e.type==="touchend"||e.type==="pointerup"||e.type==="touchcancel"||e.type==="pointercancel")&&(t="mouseup"),t&&Zt(this.map)._onClick(this._createMouseEvent(t,e))},_createMouseEvent(e,t){let i,r=t.touches[0]||t.changedTouches[0];try{i=new MouseEvent(e,{bubbles:t.bubbles,cancelable:t.cancelable,view:t.view,detail:r.detail,screenX:r.screenX,screenY:r.screenY,clientX:r.clientX,clientY:r.clientY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:t.button,relatedTarget:t.relatedTarget})}catch{i=document.createEvent("MouseEvents"),i.initMouseEvent(e,t.bubbles,t.cancelable,t.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget)}return i}}),zn=pr,di=L.Control.extend({includes:[Gi],options:{position:"topleft",disableByOtherButtons:!0},initialize(e){this._button=L.Util.extend({},this.options,e)},onAdd(e){return this._map=e,this._map.pm.Toolbar.options.oneBlock?this._container=this._map.pm.Toolbar._createContainer(this.options.position):this._button.tool==="edit"?this._container=this._map.pm.Toolbar.editContainer:this._button.tool==="options"?this._container=this._map.pm.Toolbar.optionsContainer:this._button.tool==="custom"?this._container=this._map.pm.Toolbar.customContainer:this._container=this._map.pm.Toolbar.drawContainer,this._renderButton(),this._container},_renderButton(){let e=this.buttonsDomNode;this.buttonsDomNode=this._makeButton(this._button),e?e.replaceWith(this.buttonsDomNode):this._container.appendChild(this.buttonsDomNode)},onRemove(){return this.buttonsDomNode.remove(),this._container},getText(){return this._button.text},getIconUrl(){return this._button.iconUrl},destroy(){this._button={},this._update()},toggle(e){return typeof e=="boolean"?this._button.toggleStatus=e:this._button.toggleStatus=!this._button.toggleStatus,this._applyStyleClasses(),this._updateActiveAction(this._button),this._button.toggleStatus},toggled(){return this._button.toggleStatus},onCreate(){this.toggle(!1)},disable(){this.toggle(!1),this._button.disabled=!0,this._updateDisabled()},enable(){this._button.disabled=!1,this._updateDisabled(),this._updateActiveAction(this._button)},_triggerClick(e){e&&e.preventDefault(),!this._button.disabled&&(this._button.onClick(e,{button:this,event:e}),this._clicked(e),this._button.afterClick(e,{button:this,event:e}))},_makeButton(e){let t=this.options.position.indexOf("right")>-1?"pos-right":"",i=L.DomUtil.create("div",`button-container  ${t}`,this._container);e.title&&i.setAttribute("title",e.title);let r=L.DomUtil.create("a","leaflet-buttons-control-button",i);r.setAttribute("role","button"),r.setAttribute("tabindex","0"),r.href="#";let n=L.DomUtil.create("div",`leaflet-pm-actions-container ${t}`,i),a=e.actions,s={cancel:{text:ae("actions.cancel"),title:ae("actions.cancel"),onClick(){this._triggerClick()}},finishMode:{text:ae("actions.finish"),title:ae("actions.finish"),onClick(){this._triggerClick()}},removeLastVertex:{text:ae("actions.removeLastVertex"),title:ae("actions.removeLastVertex"),onClick(){this._map.pm.Draw[e.jsClass]._removeLastVertex()}},finish:{text:ae("actions.finish"),title:ae("actions.finish"),onClick(h){this._map.pm.Draw[e.jsClass]._finishShape(h)}}};e._preparedActions=a.map(h=>{let c=typeof h=="string"?h:h.name,x;if(s[c])x=s[c];else if(h.text)x=h;else return x;let y=L.DomUtil.create("a",`leaflet-pm-action ${t} action-${c}`,n);if(y.setAttribute("role","button"),y.setAttribute("tabindex","0"),y.href="#",x.title&&(y.title=x.title),y.innerHTML=x.text,L.DomEvent.disableClickPropagation(y),L.DomEvent.on(y,"click",L.DomEvent.stop),x._node=y,!e.disabled&&x.onClick){let T=F=>{F.preventDefault();let z="",{buttons:q}=this._map.pm.Toolbar;for(let Y in q)if(q[Y]._button===e){z=Y;break}this._fireActionClick(x,z,e)};L.DomEvent.addListener(y,"click",T,this),L.DomEvent.addListener(y,"click",x.onClick,this),L.DomEvent.addListener(y,"click",()=>this._updateActiveAction(e))}return x}),this._updateActiveAction(e),e.toggleStatus&&L.DomUtil.addClass(i,"active");let o=L.DomUtil.create("div","control-icon",r);return e.iconUrl&&o.setAttribute("src",e.iconUrl),e.className&&L.DomUtil.addClass(o,e.className),L.DomEvent.disableClickPropagation(r),L.DomEvent.on(r,"click",L.DomEvent.stop),e.disabled||(L.DomEvent.addListener(r,"click",this._onBtnClick,this),L.DomEvent.addListener(r,"click",this._triggerClick,this)),e.disabled&&(L.DomUtil.addClass(r,"pm-disabled"),r.setAttribute("aria-disabled","true")),i},_applyStyleClasses(){this._container&&(!this._button.toggleStatus||this._button.cssToggle===!1?(L.DomUtil.removeClass(this.buttonsDomNode,"active"),L.DomUtil.removeClass(this._container,"activeChild")):(L.DomUtil.addClass(this.buttonsDomNode,"active"),L.DomUtil.addClass(this._container,"activeChild")))},_onBtnClick(){if(this._button.disabled)return;this._button.disableOtherButtons&&this._map.pm.Toolbar.triggerClickOnToggledButtons(this);let e="",{buttons:t}=this._map.pm.Toolbar;for(let i in t)if(t[i]._button===this._button){e=i;break}this._fireButtonClick(e,this._button)},_clicked(){this._button.doToggle&&this.toggle()},_updateDisabled(){if(!this._container)return;let e="pm-disabled",t=this.buttonsDomNode.children[0];this._button.disabled?(L.DomUtil.addClass(t,e),t.setAttribute("aria-disabled","true")):(L.DomUtil.removeClass(t,e),t.setAttribute("aria-disabled","false"))},_updateActiveAction(e){e._preparedActions?.forEach(t=>{t?._node&&(t.isActive&&t.isActive.call(this)?L.DomUtil.addClass(t._node,"active-action"):L.DomUtil.removeClass(t._node,"active-action"))})}}),Xr=di;L.Control.PMButton=Xr;var Zr=L.Class.extend({options:{drawMarker:!0,drawRectangle:!0,drawPolyline:!0,drawPolygon:!0,drawCircle:!0,drawCircleMarker:!0,drawText:!0,editMode:!0,dragMode:!0,cutPolygon:!0,removalMode:!0,rotateMode:!0,snappingOption:!0,drawControls:!0,editControls:!0,optionsControls:!0,customControls:!0,oneBlock:!1,position:"topleft",positions:{draw:"",edit:"",options:"",custom:""}},customButtons:[],initialize(e){this.customButtons=[],this.options.positions={draw:"",edit:"",options:"",custom:""},this.init(e)},reinit(){let e=this.isVisible;this.removeControls(),this._defineButtons(),e&&this.addControls()},init(e){this.map=e,this.buttons={},this.isVisible=!1,this.drawContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-draw leaflet-bar leaflet-control"),this.editContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-edit leaflet-bar leaflet-control"),this.optionsContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-options leaflet-bar leaflet-control"),this.customContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-custom leaflet-bar leaflet-control"),this._defineButtons()},_createContainer(e){let t=`${e}Container`;return this[t]||(this[t]=L.DomUtil.create("div",`leaflet-pm-toolbar leaflet-pm-${e} leaflet-bar leaflet-control`)),this[t]},getButtons(){return this.buttons},addControls(e=this.options){typeof e.editPolygon<"u"&&(e.editMode=e.editPolygon),typeof e.deleteLayer<"u"&&(e.removalMode=e.deleteLayer),L.Util.setOptions(this,e),this.applyIconStyle(),this.isVisible=!0,this._showHideButtons()},applyIconStyle(){let e=this.getButtons(),t={geomanIcons:{drawMarker:"control-icon leaflet-pm-icon-marker",drawPolyline:"control-icon leaflet-pm-icon-polyline",drawRectangle:"control-icon leaflet-pm-icon-rectangle",drawPolygon:"control-icon leaflet-pm-icon-polygon",drawCircle:"control-icon leaflet-pm-icon-circle",drawCircleMarker:"control-icon leaflet-pm-icon-circle-marker",editMode:"control-icon leaflet-pm-icon-edit",dragMode:"control-icon leaflet-pm-icon-drag",cutPolygon:"control-icon leaflet-pm-icon-cut",removalMode:"control-icon leaflet-pm-icon-delete",drawText:"control-icon leaflet-pm-icon-text"}};for(let i in e){let r=e[i];L.Util.setOptions(r,{className:t.geomanIcons[i]})}},removeControls(){let e=this.getButtons();for(let t in e)e[t].remove();this.isVisible=!1},toggleControls(e=this.options){this.isVisible?this.removeControls():this.addControls(e)},_addButton(e,t){return this.buttons[e]=t,this.options[e]=!!this.options[e]||!1,this.buttons[e]},triggerClickOnToggledButtons(e){for(let t in this.buttons){let i=this.buttons[t];i._button.disableByOtherButtons&&i!==e&&i.toggled()&&i._triggerClick()}},toggleButton(e,t,i=!0){e==="editPolygon"&&(e="editMode"),e==="deleteLayer"&&(e="removalMode");let r=e;return i&&this.triggerClickOnToggledButtons(this.buttons[r]),this.buttons[r]?this.buttons[r].toggle(t):!1},_defineButtons(){let e={className:"control-icon leaflet-pm-icon-marker",title:ae("buttonTitles.drawMarkerButton"),jsClass:"Marker",onClick:()=>{},afterClick:(T,F)=>{this.map.pm.Draw[F.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},t={title:ae("buttonTitles.drawPolyButton"),className:"control-icon leaflet-pm-icon-polygon",jsClass:"Polygon",onClick:()=>{},afterClick:(T,F)=>{this.map.pm.Draw[F.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},i={className:"control-icon leaflet-pm-icon-polyline",title:ae("buttonTitles.drawLineButton"),jsClass:"Line",onClick:()=>{},afterClick:(T,F)=>{this.map.pm.Draw[F.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},r={title:ae("buttonTitles.drawCircleButton"),className:"control-icon leaflet-pm-icon-circle",jsClass:"Circle",onClick:()=>{},afterClick:(T,F)=>{this.map.pm.Draw[F.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},n={title:ae("buttonTitles.drawCircleMarkerButton"),className:"control-icon leaflet-pm-icon-circle-marker",jsClass:"CircleMarker",onClick:()=>{},afterClick:(T,F)=>{this.map.pm.Draw[F.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},a={title:ae("buttonTitles.drawRectButton"),className:"control-icon leaflet-pm-icon-rectangle",jsClass:"Rectangle",onClick:()=>{},afterClick:(T,F)=>{this.map.pm.Draw[F.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},s={title:ae("buttonTitles.editButton"),className:"control-icon leaflet-pm-icon-edit",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalEditMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},o={title:ae("buttonTitles.dragButton"),className:"control-icon leaflet-pm-icon-drag",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalDragMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},h={title:ae("buttonTitles.cutButton"),className:"control-icon leaflet-pm-icon-cut",jsClass:"Cut",onClick:()=>{},afterClick:(T,F)=>{this.map.pm.Draw[F.button._button.jsClass].toggle({snappable:!0,cursorMarker:!0,allowSelfIntersection:!1})},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finish","removeLastVertex","cancel"]},c={title:ae("buttonTitles.deleteButton"),className:"control-icon leaflet-pm-icon-delete",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRemovalMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},x={title:ae("buttonTitles.rotateButton"),className:"control-icon leaflet-pm-icon-rotate",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRotateMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},y={className:"control-icon leaflet-pm-icon-text",title:ae("buttonTitles.drawTextButton"),jsClass:"Text",onClick:()=>{},afterClick:(T,F)=>{this.map.pm.Draw[F.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]};this._addButton("drawMarker",new L.Control.PMButton(e)),this._addButton("drawPolyline",new L.Control.PMButton(i)),this._addButton("drawRectangle",new L.Control.PMButton(a)),this._addButton("drawPolygon",new L.Control.PMButton(t)),this._addButton("drawCircle",new L.Control.PMButton(r)),this._addButton("drawCircleMarker",new L.Control.PMButton(n)),this._addButton("drawText",new L.Control.PMButton(y)),this._addButton("editMode",new L.Control.PMButton(s)),this._addButton("dragMode",new L.Control.PMButton(o)),this._addButton("cutPolygon",new L.Control.PMButton(h)),this._addButton("removalMode",new L.Control.PMButton(c)),this._addButton("rotateMode",new L.Control.PMButton(x))},_showHideButtons(){if(!this.isVisible)return;this.removeControls(),this.isVisible=!0;let e=this.getButtons(),t=[];this.options.drawControls===!1&&(t=t.concat(Object.keys(e).filter(i=>!e[i]._button.tool))),this.options.editControls===!1&&(t=t.concat(Object.keys(e).filter(i=>e[i]._button.tool==="edit"))),this.options.optionsControls===!1&&(t=t.concat(Object.keys(e).filter(i=>e[i]._button.tool==="options"))),this.options.customControls===!1&&(t=t.concat(Object.keys(e).filter(i=>e[i]._button.tool==="custom")));for(let i in e)if(this.options[i]&&t.indexOf(i)===-1){let r=e[i]._button.tool;r||(r="draw"),e[i].setPosition(this._getBtnPosition(r)),e[i].addTo(this.map)}},_getBtnPosition(e){return this.options.positions&&this.options.positions[e]?this.options.positions[e]:this.options.position},setBlockPosition(e,t){this.options.positions[e]=t,this._showHideButtons(),this.changeControlOrder()},getBlockPositions(){return this.options.positions},copyDrawControl(e,t){if(t)typeof t!="object"&&(t={name:t});else throw new TypeError("Button has no name");let i=this._btnNameMapping(e);if(!t.name)throw new TypeError("Button has no name");if(this.buttons[t.name])throw new TypeError("Button with this name already exists");let r=this.map.pm.Draw.createNewDrawInstance(t.name,i);t={...this.buttons[i]._button,...t};let n=this.createCustomControl(t);return{drawInstance:r,control:n}},createCustomControl(e){if(!e.name)throw new TypeError("Button has no name");if(this.buttons[e.name])throw new TypeError("Button with this name already exists");e.onClick||(e.onClick=()=>{}),e.afterClick||(e.afterClick=()=>{}),e.toggle!==!1&&(e.toggle=!0),e.block&&(e.block=e.block.toLowerCase()),(!e.block||e.block==="draw")&&(e.block=""),e.className?e.className.indexOf("control-icon")===-1&&(e.className=`control-icon ${e.className}`):e.className="control-icon";let t={tool:e.block,className:e.className,title:e.title||"",jsClass:e.name,onClick:e.onClick,afterClick:e.afterClick,doToggle:e.toggle,toggleStatus:!1,disableOtherButtons:e.disableOtherButtons??!0,disableByOtherButtons:e.disableByOtherButtons??!0,cssToggle:e.toggle,position:this.options.position,actions:e.actions||[],disabled:!!e.disabled};this.options[e.name]!==!1&&(this.options[e.name]=!0);let i=this._addButton(e.name,new L.Control.PMButton(t));return this.changeControlOrder(),i},controlExists(e){return!!this.getButton(e)},getButton(e){return this.getButtons()[e]},getButtonsInBlock(e){let t={};if(e)for(let i in this.getButtons()){let r=this.getButtons()[i];(r._button.tool===e||e==="draw"&&!r._button.tool)&&(t[i]=r)}return t},changeControlOrder(e=[]){let t=this._shapeMapping(),i=[];e.forEach(a=>{t[a]?i.push(t[a]):i.push(a)});let r=this.getButtons(),n={};i.forEach(a=>{r[a]&&(n[a]=r[a])}),Object.keys(r).filter(a=>!r[a]._button.tool||r[a]._button.tool==="draw").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="edit").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="options").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="custom").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),this.map.pm.Toolbar.buttons=n,this._showHideButtons()},getControlOrder(){let e=this.getButtons(),t=[];for(let i in e)t.push(i);return t},changeActionsOfControl(e,t){let i=this._btnNameMapping(e);if(!i)throw new TypeError("No name passed");if(!t)throw new TypeError("No actions passed");if(!this.buttons[i])throw new TypeError("Button with this name not exists");this.buttons[i]._button.actions=t,this.changeControlOrder()},setButtonDisabled(e,t){let i=this._btnNameMapping(e);t?this.buttons[i].disable():this.buttons[i].enable()},_shapeMapping(){return{Marker:"drawMarker",Circle:"drawCircle",Polygon:"drawPolygon",Rectangle:"drawRectangle",Polyline:"drawPolyline",Line:"drawPolyline",CircleMarker:"drawCircleMarker",Edit:"editMode",Drag:"dragMode",Cut:"cutPolygon",Removal:"removalMode",Rotate:"rotateMode",Text:"drawText"}},_btnNameMapping(e){let t=this._shapeMapping();return t[e]?t[e]:e}}),Un=Zr,Hn=Oe(qt()),Vn={_initSnappableMarkers(){this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,this._assignEvents(this._markers),this._layer.off("pm:dragstart",this._unsnap,this),this._layer.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){this._layer.off("pm:dragstart",this._unsnap,this)},_assignEvents(e){e.forEach(t=>{if(Array.isArray(t)){this._assignEvents(t);return}t.off("drag",this._handleSnapping,this),t.on("drag",this._handleSnapping,this),t.off("dragend",this._cleanupSnapping,this),t.on("dragend",this._cleanupSnapping,this)})},_cleanupSnapping(e){if(e){let t=e.target;t._snapped=!1}delete this._snapList,this.throttledList&&(this._map.off("layeradd",this.throttledList,this),this.throttledList=void 0),this._map.off("layerremove",this._handleSnapLayerRemoval,this),this.debugIndicatorLines&&this.debugIndicatorLines.forEach(t=>{t.remove()})},_handleThrottleSnapping(){this.throttledList&&this._createSnapList()},_handleSnapping(e){let t=e.target;if(t._snapped=!1,this.throttledList||(this.throttledList=L.Util.throttle(this._handleThrottleSnapping,100,this)),e?.originalEvent?.altKey||this._map?.pm?.Keyboard.isAltKeyPressed()||(this._snapList===void 0&&(this._createSnapList(),this._map.off("layeradd",this.throttledList,this),this._map.on("layeradd",this.throttledList,this)),this._snapList.length<=0))return!1;let i=this._calcClosestLayer(t.getLatLng(),this._snapList);if(Object.keys(i).length===0)return!1;let r=i.layer instanceof L.Marker||i.layer instanceof L.CircleMarker||!this.options.snapSegment,n;r?n=i.latlng:n=this._checkPrioritiySnapping(i);let a=this.options.snapDistance,s={marker:t,shape:this._shape,snapLatLng:n,segment:i.segment,layer:this._layer,workingLayer:this._layer,layerInteractedWith:i.layer,distance:i.distance};if(this._fireSnapDrag(s.marker,s),this._fireSnapDrag(this._layer,s),i.distance<a){t._orgLatLng=t.getLatLng(),t.setLatLng(n),t._snapped=!0,t._snapInfo=s;let o=()=>{this._snapLatLng=n,this._fireSnap(t,s),this._fireSnap(this._layer,s)},h=this._snapLatLng||{},c=n||{};(h.lat!==c.lat||h.lng!==c.lng)&&o()}else this._snapLatLng&&(this._unsnap(s),t._snapped=!1,t._snapInfo=void 0,this._fireUnsnap(s.marker,s),this._fireUnsnap(this._layer,s));return!0},_createSnapList(){let e=[],t=[],i=this._map;i.off("layerremove",this._handleSnapLayerRemoval,this),i.on("layerremove",this._handleSnapLayerRemoval,this),i.eachLayer(r=>{if((r instanceof L.Polyline||r instanceof L.Marker||r instanceof L.CircleMarker||r instanceof L.ImageOverlay)&&r.options.snapIgnore!==!0){if(r.options.snapIgnore===void 0&&(!L.PM.optIn&&r.options.pmIgnore===!0||L.PM.optIn&&r.options.pmIgnore!==!1))return;(r instanceof L.Circle||r instanceof L.CircleMarker)&&r.pm&&r.pm._hiddenPolyCircle?e.push(r.pm._hiddenPolyCircle):r instanceof L.ImageOverlay&&(r=L.rectangle(r.getBounds())),e.push(r);let n=L.polyline([],{color:"red",pmIgnore:!0});n._pmTempLayer=!0,t.push(n),(r instanceof L.Circle||r instanceof L.CircleMarker)&&t.push(n)}}),e=e.filter(r=>this._layer!==r),e=e.filter(r=>r._latlng||r._latlngs&&Et(r._latlngs)),e=e.filter(r=>!r._pmTempLayer),this._otherSnapLayers?(this._otherSnapLayers.forEach(()=>{let r=L.polyline([],{color:"red",pmIgnore:!0});r._pmTempLayer=!0,t.push(r)}),this._snapList=e.concat(this._otherSnapLayers)):this._snapList=e,this.debugIndicatorLines=t},_handleSnapLayerRemoval({layer:e}){if(!e._leaflet_id)return;let t=this._snapList.findIndex(i=>i._leaflet_id===e._leaflet_id);t>-1&&this._snapList.splice(t,1)},_calcClosestLayer(e,t){return this._calcClosestLayers(e,t,1)[0]},_calcClosestLayers(e,t,i=1){let r=[],n={};t.forEach((s,o)=>{if(s._parentCopy&&s._parentCopy===this._layer||s.getLatLngs?.().flat(5).length<2)return;let h=this._calcLayerDistances(e,s);if(h.distance=Math.floor(h.distance),this.debugIndicatorLines){if(!this.debugIndicatorLines[o]){let c=L.polyline([],{color:"red",pmIgnore:!0});c._pmTempLayer=!0,this.debugIndicatorLines[o]=c}this.debugIndicatorLines[o].setLatLngs([e,h.latlng])}i===1&&(n.distance===void 0||h.distance-5<=n.distance)?(h.distance+5<n.distance&&(r=[]),n=h,n.layer=s,r.push(n)):i!==1&&(n={},n=h,n.layer=s,r.push(n))}),i!==1&&(r=r.sort((s,o)=>s.distance-o.distance)),i===-1&&(i=r.length);let a=this._getClosestLayerByPriority(r,i);return L.Util.isArray(a)?a:[a]},_calcLayerDistances(e,t){let i=this._map,r=t instanceof L.Marker||t instanceof L.CircleMarker,n=t instanceof L.Polygon,a=e;if(r){let s=t.getLatLng();return{latlng:{...s},distance:this._getDistance(i,s,a)}}return this._calcLatLngDistances(a,t.getLatLngs(),i,n)},_calcLatLngDistances(e,t,i,r=!1){let n,a,s,o=h=>{h.forEach((c,x)=>{if(Array.isArray(c)){o(c);return}if(this.options.snapSegment){let y=c,T;r?T=x+1===h.length?0:x+1:T=x+1===h.length?void 0:x+1;let F=h[T];if(F){let z=this._getDistanceToSegment(i,e,y,F);(a===void 0||z<a)&&(a=z,s=[y,F])}}else{let y=this._getDistance(i,e,c);(a===void 0||y<a)&&(a=y,n=c)}})};return o(t),this.options.snapSegment?{latlng:{...this._getClosestPointOnSegment(i,e,s[0],s[1])},segment:s,distance:a}:{latlng:n,distance:a}},_getClosestLayerByPriority(e,t=1){e=e.sort((s,o)=>s._leaflet_id-o._leaflet_id);let i=["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],r=this._map.pm.globalOptions.snappingOrder||[],n=0,a={};return r.concat(i).forEach(s=>{a[s]||(n+=1,a[s]=n)}),e.sort(Gn("instanceofShape",a)),t===1?e[0]||{}:e.slice(0,t)},_checkPrioritiySnapping(e){let t=this._map,i=e.segment[0],r=e.segment[1],n=e.latlng,a=n;if(this.options.snapVertex){let s=this._getDistance(t,i,n),o=this._getDistance(t,r,n),h=s<o?i:r,c=s<o?s:o;if(this.options.snapMiddle){let y=L.PM.Utils.calcMiddleLatLng(t,i,r),T=this._getDistance(t,y,n);T<s&&T<o&&(h=y,c=T)}let x=this.options.snapDistance;c<x&&(a=h)}return{...a}},_unsnap(){delete this._snapLatLng},_getClosestPointOnSegment(e,t,i,r){let n=e.getMaxZoom();n===1/0&&(n=e.getZoom());let a=e.project(t,n),s=e.project(i,n),o=e.project(r,n),h=L.LineUtil.closestPointOnSegment(a,s,o);return e.unproject(h,n)},_getDistanceToSegment(e,t,i,r){let n=e.latLngToContainerPoint(t),a=e.latLngToContainerPoint(i),s=e.latLngToContainerPoint(r);return L.LineUtil.pointToSegmentDistance(n,a,s)},_getDistance(e,t,i){return e.latLngToContainerPoint(t).distanceTo(e.latLngToContainerPoint(i))}},Jr=Vn,Kn=L.Class.extend({includes:[Jr,Gi],options:{snappable:!0,snapDistance:20,snapMiddle:!1,allowSelfIntersection:!0,tooltips:!0,templineStyle:{},hintlineStyle:{color:"#3388ff",dashArray:"5,5"},pathOptions:null,cursorMarker:!0,finishOn:null,markerStyle:{draggable:!0,icon:L.icon()},hideMiddleMarkers:!1,minRadiusCircle:null,maxRadiusCircle:null,minRadiusCircleMarker:null,maxRadiusCircleMarker:null,resizeableCircleMarker:!1,resizeableCircle:!0,markerEditable:!0,continueDrawing:!1,snapSegment:!0,requireSnapToFinish:!1,rectangleAngle:0,textOptions:{text:null,focusAfterDraw:null,removeIfEmpty:null,className:null},snapVertex:!0},setOptions(e){L.Util.setOptions(this,e),this.setStyle(this.options)},setStyle(){},getOptions(){return this.options},initialize(e){let t=new L.Icon.Default;t.options.tooltipAnchor=[0,0],this.options.markerStyle.icon=t,this._map=e,this.shapes=["Marker","CircleMarker","Line","Polygon","Rectangle","Circle","Cut","Text"],this.shapes.forEach(i=>{this[i]=new L.PM.Draw[i](this._map)}),this.Marker.setOptions({continueDrawing:!0}),this.CircleMarker.setOptions({continueDrawing:!0})},setPathOptions(e,t=!1){t?this.options.pathOptions=(0,Hn.default)(this.options.pathOptions,e):this.options.pathOptions=e},getShapes(){return this.shapes},getShape(){return this._shape},enable(e,t){if(!e)throw new Error(`Error: Please pass a shape as a parameter. Possible shapes are: ${this.getShapes().join(",")}`);this.disable(),this[e].enable(t)},disable(){this.shapes.forEach(e=>{this[e].disable()})},addControls(){this.shapes.forEach(e=>{this[e].addButton()})},getActiveShape(){let e;return this.shapes.forEach(t=>{this[t]._enabled&&(e=t)}),e},_setGlobalDrawMode(){this._shape==="Cut"?this._fireGlobalCutModeToggled():this._fireGlobalDrawModeToggled();let e=[];this._map.eachLayer(t=>{(t instanceof L.Polyline||t instanceof L.Marker||t instanceof L.Circle||t instanceof L.CircleMarker||t instanceof L.ImageOverlay)&&(t._pmTempLayer||e.push(t))}),this._enabled?e.forEach(t=>{L.PM.Utils.disablePopup(t)}):e.forEach(t=>{L.PM.Utils.enablePopup(t)})},createNewDrawInstance(e,t){let i=this._getShapeFromBtnName(t);if(this[e])throw new TypeError("Draw Type already exists");if(!L.PM.Draw[i])throw new TypeError(`There is no class L.PM.Draw.${i}`);return this[e]=new L.PM.Draw[i](this._map),this[e].toolbarButtonName=e,this[e]._shape=e,this.shapes.push(e),this[t]&&this[e].setOptions(this[t].options),this[e].setOptions(this[e].options),this[e]},_getShapeFromBtnName(e){let t={drawMarker:"Marker",drawCircle:"Circle",drawPolygon:"Polygon",drawPolyline:"Line",drawRectangle:"Rectangle",drawCircleMarker:"CircleMarker",editMode:"Edit",dragMode:"Drag",cutPolygon:"Cut",removalMode:"Removal",rotateMode:"Rotate",drawText:"Text"};return t[e]?t[e]:this[e]?this[e]._shape:e},_finishLayer(e){e.pm&&(e.pm.setOptions(this.options),e.pm._shape=this._shape,e.pm._map=this._map),this._addDrawnLayerProp(e)},_addDrawnLayerProp(e){e._drawnByGeoman=!0},_setPane(e,t){t==="layerPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":t==="vertexPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":t==="markerPane"&&(e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},_isFirstLayer(){return(this._map||this._layer._map).pm.getGeomanLayers().length===0}}),Be=Kn;Be.Marker=Be.extend({initialize(e){this._map=e,this._shape="Marker",this.toolbarButtonName="drawMarker"},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),this.options.markerStyle),this._setPane(this._hintMarker,"markerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.tooltips&&this._hintMarker.bindTooltip(ae("tooltips.placeMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this.options.markerEditable&&this._map.eachLayer(t=>{this.isRelevantMarker(t)&&t.pm.enable()}),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createMarker,this),this._hintMarker.remove(),this._map.off("mousemove",this._syncHintMarker,this),this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.disable()}),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},isRelevantMarker(e){return e instanceof L.Marker&&e.pm&&!e._pmTempLayer&&!e.pm._initTextMarker},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let t=e;t.target=this._hintMarker,this._handleSnapping(t)}this._fireChange(this._hintMarker.getLatLng(),"Draw")},_createMarker(e){if(!e.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),i=new L.Marker(t,this.options.markerStyle);this._setPane(i,"markerPane"),this._finishLayer(i),i.pm||(i.options.draggable=!1),i.addTo(this._map.pm._getContainingLayer()),i.pm&&this.options.markerEditable?i.pm.enable():i.dragging&&i.dragging.disable(),this._fireCreate(i),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},setStyle(){this.options.markerStyle?.icon&&this._hintMarker?.setIcon(this.options.markerStyle.icon)}});var Ne=63710088e-1,Qr={centimeters:Ne*100,centimetres:Ne*100,degrees:Ne/111325,feet:Ne*3.28084,inches:Ne*39.37,kilometers:Ne/1e3,kilometres:Ne/1e3,meters:Ne,metres:Ne,miles:Ne/1609.344,millimeters:Ne*1e3,millimetres:Ne*1e3,nauticalmiles:Ne/1852,radians:1,yards:Ne*1.0936};function l(e,t,i){i===void 0&&(i={});var r={type:"Feature"};return(i.id===0||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=t||{},r.geometry=e,r}function M(e,t,i){if(i===void 0&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!he(e[0])||!he(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return l(r,t,i)}function w(e,t,i){if(i===void 0&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return l(r,t,i)}function D(e,t){t===void 0&&(t={});var i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function V(e,t){t===void 0&&(t="kilometers");var i=Qr[t];if(!i)throw new Error(t+" units is invalid");return e*i}function K(e,t){t===void 0&&(t="kilometers");var i=Qr[t];if(!i)throw new Error(t+" units is invalid");return e/i}function U(e){var t=e%(2*Math.PI);return t*180/Math.PI}function Z(e){var t=e%360;return t*Math.PI/180}function he(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function se(e){var t,i,r={type:"FeatureCollection",features:[]};if(e.type==="Feature"?i=e.geometry:i=e,i.type==="LineString")t=[i.coordinates];else if(i.type==="MultiLineString")t=i.coordinates;else if(i.type==="MultiPolygon")t=[].concat.apply([],i.coordinates);else if(i.type==="Polygon")t=i.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return t.forEach(function(n){t.forEach(function(a){for(var s=0;s<n.length-1;s++)for(var o=s;o<a.length-1;o++)if(!(n===a&&(Math.abs(s-o)===1||s===0&&o===n.length-2&&n[s][0]===n[n.length-1][0]&&n[s][1]===n[n.length-1][1]))){var h=nt(n[s][0],n[s][1],n[s+1][0],n[s+1][1],a[o][0],a[o][1],a[o+1][0],a[o+1][1]);h&&r.features.push(M([h[0],h[1]]))}})}),r}function nt(e,t,i,r,n,a,s,o){var h,c,x,y,T,F={x:null,y:null,onLine1:!1,onLine2:!1};return h=(o-a)*(i-e)-(s-n)*(r-t),h===0?F.x!==null&&F.y!==null?F:!1:(c=t-a,x=e-n,y=(s-n)*c-(o-a)*x,T=(i-e)*c-(r-t)*x,c=y/h,x=T/h,F.x=e+c*(i-e),F.y=t+c*(r-t),c>=0&&c<=1&&(F.onLine1=!0),x>=0&&x<=1&&(F.onLine2=!0),F.onLine1&&F.onLine2?[F.x,F.y]:!1)}Be.Line=Be.extend({initialize(e){this._map=e,this._shape="Line",this.toolbarButtonName="drawPolyline",this._doesSelfIntersect=!1},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._markers=[],this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.polyline([],{...this.options.templineStyle,pmIgnore:!1}),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._layerGroup.addLayer(this._layer),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(ae("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createVertex,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.on(this.options.finishOn,this._finishShape,this),this.options.finishOn==="dblclick"&&(this.tempMapDoubleClickZoomState=this._map.doubleClickZoom._enabled,this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.disable()),this._map.on("mousemove",this._syncHintMarker,this),this._hintMarker.on("move",this._syncHintLine,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this.isRed=!1,this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createVertex,this),this._map.off("mousemove",this._syncHintMarker,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.off(this.options.finishOn,this._finishShape,this),this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.enable(),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_syncHintLine(){let e=this._layer.getLatLngs();if(e.length>0){let t=e[e.length-1];this._hintline.setLatLngs([t,this._hintMarker.getLatLng()])}},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let i=e;i.target=this._hintMarker,this._handleSnapping(i)}this.options.allowSelfIntersection||this._handleSelfIntersection(!0,this._hintMarker.getLatLng());let t=this._layer._defaultShape().slice();t.push(this._hintMarker.getLatLng()),this._change(t)},hasSelfIntersection(){return se(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersection(e,t){let i=L.polyline(this._layer.getLatLngs());e&&(t||(t=this._hintMarker.getLatLng()),i.addLatLng(t));let r=se(i.toGeoJSON(15));this._doesSelfIntersect=r.features.length>0,this._doesSelfIntersect?this.isRed||(this.isRed=!0,this._hintline.setStyle({color:"#f00000ff"}),this._fireIntersect(r,this._map,"Draw")):this._hintline.isEmpty()||(this.isRed=!1,this._hintline.setStyle(this.options.hintlineStyle))},_createVertex(e){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,e.latlng),this._doesSelfIntersect))return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),i=this._layer.getLatLngs(),r=i[i.length-1];if(t.equals(i[0])||i.length>0&&t.equals(r)){this._finishShape();return}this._layer._latlngInfo=this._layer._latlngInfo||[],this._layer._latlngInfo.push({latlng:t,snapInfo:this._hintMarker._snapInfo}),this._layer.addLatLng(t);let n=this._createMarker(t);this._setTooltipText(),this._setHintLineAfterNewVertex(t),this._fireVertexAdded(n,void 0,t,"Draw"),this._change(this._layer.getLatLngs()),this.options.finishOn==="snap"&&this._hintMarker._snapped&&this._finishShape(e)},_setHintLineAfterNewVertex(e){this._hintline.setLatLngs([e,e])},_removeLastVertex(){let e=this._markers;if(e.length<=1){this.disable();return}let t=this._layer.getLatLngs(),i=e[e.length-1],{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(e,i);e.pop(),this._layerGroup.removeLayer(i);let n=e[e.length-1],a=t.indexOf(n.getLatLng());t=t.slice(0,a+1),this._layer.setLatLngs(t),this._layer._latlngInfo.pop(),this._syncHintLine(),this._setTooltipText(),this._fireVertexRemoved(i,r,"Draw"),this._change(this._layer.getLatLngs())},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!1),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=1)return;let t=L.polyline(e,this.options.pathOptions);this._setPane(t,"layerPane"),this._finishLayer(t),t.addTo(this._map.pm._getContainingLayer()),this._fireCreate(t),this.options.snappable&&this._cleanupSnapping();let i=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(i))},_createMarker(e){let t=new L.Marker(e,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this._layerGroup.addLayer(t),this._markers.push(t),t.on("click",this._finishShape,this),t},_setTooltipText(){let{length:e}=this._layer.getLatLngs().flat(),t="";e<=1?t=ae("tooltips.continueLine"):t=ae("tooltips.finishLine"),this._hintMarker.setTooltipContent(t)},_change(e){this._fireChange(e,"Draw")},setStyle(){this._layer?.setStyle(this.options.templineStyle),this._hintline?.setStyle(this.options.hintlineStyle)}}),Be.Polygon=Be.Line.extend({initialize(e){this._map=e,this._shape="Polygon",this.toolbarButtonName="drawPolygon"},enable(e){L.PM.Draw.Line.prototype.enable.call(this,e),this._layer.pm._shape="Polygon"},_createMarker(e){let t=new L.Marker(e,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this._layerGroup.addLayer(t),this._markers.push(t),this._layer.getLatLngs().flat().length===1?(t.on("click",this._finishShape,this),this._tempSnapLayerIndex=this._otherSnapLayers.push(t)-1,this.options.snappable&&this._cleanupSnapping()):t.on("click",()=>1),t},_setTooltipText(){let{length:e}=this._layer.getLatLngs().flat(),t="";e<=2?t=ae("tooltips.continueLine"):t=ae("tooltips.finishPoly"),this._hintMarker.setTooltipContent(t)},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=2)return;let t=L.polygon(e,this.options.pathOptions);this._setPane(t,"layerPane"),this._finishLayer(t),t.addTo(this._map.pm._getContainingLayer()),this._fireCreate(t),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex;let i=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(i))}}),Be.Rectangle=Be.extend({initialize(e){this._map=e,this._shape="Rectangle",this.toolbarButtonName="drawRectangle"},enable(e){if(L.Util.setOptions(this,e),this._enabled=!0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.rectangle([[0,0],[0,0]],this.options.pathOptions),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._startMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-start-marker"}),draggable:!1,zIndexOffset:-100,opacity:this.options.cursorMarker?1:0}),this._setPane(this._startMarker,"vertexPane"),this._startMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._startMarker),this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:150,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(ae("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this.options.cursorMarker){this._styleMarkers=[];for(let t=0;t<2;t+=1){let i=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-style-marker"}),draggable:!1,zIndexOffset:100});this._setPane(i,"vertexPane"),i._pmTempLayer=!0,this._layerGroup.addLayer(i),this._styleMarkers.push(i)}}this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._placeStartingMarkers,this),this._map.on("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._finishShape,this),this._map.off("click",this._placeStartingMarkers,this),this._map.off("mousemove",this._syncHintMarker,this),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_placeStartingMarkers(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng();L.DomUtil.addClass(this._startMarker._icon,"visible"),this._startMarker.setLatLng(t),this.options.cursorMarker&&this._styleMarkers&&this._styleMarkers.forEach(i=>{L.DomUtil.addClass(i._icon,"visible"),i.setLatLng(t)}),this._map.off("click",this._placeStartingMarkers,this),this._map.on("click",this._finishShape,this),this._hintMarker.setTooltipContent(ae("tooltips.finishRect")),this._setRectangleOrigin()},_setRectangleOrigin(){let e=this._startMarker.getLatLng();e&&(this._layerGroup.addLayer(this._layer),this._layer.setLatLngs([e,e]),this._hintMarker.on("move",this._syncRectangleSize,this))},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let i=e;i.target=this._hintMarker,this._handleSnapping(i)}let t=this._layerGroup&&this._layerGroup.hasLayer(this._layer)?this._layer.getLatLngs():[this._hintMarker.getLatLng()];this._fireChange(t,"Draw")},_syncRectangleSize(){let e=Yr(this._startMarker.getLatLng(),this._map),t=Yr(this._hintMarker.getLatLng(),this._map),i=L.PM.Utils._getRotatedRectangle(e,t,this.options.rectangleAngle||0,this._map);if(this._layer.setLatLngs(i),this.options.cursorMarker&&this._styleMarkers){let r=[];i.forEach(n=>{!n.equals(e,1e-8)&&!n.equals(t,1e-8)&&r.push(n)}),r.forEach((n,a)=>{try{this._styleMarkers[a].setLatLng(n)}catch{}})}},_findCorners(){let e=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(e[0],e[2],this.options.rectangleAngle||0,this._map)},_finishShape(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),i=this._startMarker.getLatLng();if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||i.equals(t))return;let r=L.rectangle([i,t],this.options.pathOptions);if(this.options.rectangleAngle){let a=L.PM.Utils._getRotatedRectangle(i,t,this.options.rectangleAngle||0,this._map);r.setLatLngs(a),r.pm&&r.pm._setAngle(this.options.rectangleAngle||0)}this._setPane(r,"layerPane"),this._finishLayer(r),r.addTo(this._map.pm._getContainingLayer()),this._fireCreate(r);let n=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(n))},setStyle(){this._layer?.setStyle(this.options.pathOptions)}}),Be.CircleMarker=Be.extend({initialize(e){this._map=e,this._shape="CircleMarker",this.toolbarButtonName="drawCircleMarker",this._layerIsDragging=!1,this._BaseCircleClass=L.CircleMarker,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._defaultRadius=10},enable(e){if(L.Util.setOptions(this,e),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),this._enabled=!0,this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._map.getContainer().classList.add("geoman-draw-cursor"),this.options[this._editableOption]){let t={};L.extend(t,this.options.templineStyle),t.radius=0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=new this._BaseCircleClass(this._map.getCenter(),t),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._centerMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon"}),draggable:!1,zIndexOffset:100}),this._setPane(this._centerMarker,"vertexPane"),this._centerMarker._pmTempLayer=!0,this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:110,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(ae("tooltips.startCircle"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._map.on("click",this._placeCenterMarker,this)}else this._map.on("click",this._createMarker,this),this._hintMarker=new this._BaseCircleClass(this._map.getCenter(),{radius:this._defaultRadius,...this.options.templineStyle}),this._setPane(this._hintMarker,"layerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this._layer=this._hintMarker,this.options.tooltips&&this._hintMarker.bindTooltip(ae("tooltips.placeCircleMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip();this._map.on("mousemove",this._syncHintMarker,this),this._extendingEnable(),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},_extendingEnable(){!this.options[this._editableOption]&&this.options.markerEditable&&this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.enable()}),this._layer.bringToBack()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this.options[this._editableOption]?(this._map.off("click",this._finishShape,this),this._map.off("click",this._placeCenterMarker,this),this._map.removeLayer(this._layerGroup)):(this._map.off("click",this._createMarker,this),this._extendingDisable(),this._hintMarker.remove()),this._map.off("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},_extendingDisable(){this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.disable()})},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_placeCenterMarker(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng),this._layerGroup.addLayer(this._layer),this._layerGroup.addLayer(this._centerMarker);let t=this._hintMarker.getLatLng();this._centerMarker.setLatLng(t),this._map.off("click",this._placeCenterMarker,this),this._map.on("click",this._finishShape,this),this._placeCircleCenter()},_placeCircleCenter(){let e=this._centerMarker.getLatLng();e&&(this._layer.setLatLng(e),this._hintMarker.on("move",this._syncHintLine,this),this._hintMarker.on("move",this._syncCircleRadius,this),this._hintMarker.setTooltipContent(ae("tooltips.finishCircle")),this._fireCenterPlaced(),this._fireChange(this._layer.getLatLng(),"Draw"))},_syncHintLine(){let e=this._centerMarker.getLatLng(),t=this._getNewDestinationOfHintMarker();this._hintline.setLatLngs([e,t])},_syncCircleRadius(){let e=this._centerMarker.getLatLng(),t=this._hintMarker.getLatLng(),i=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(i)},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker()),this.options.snappable){let i=e;i.target=this._hintMarker,this._handleSnapping(i)}this._handleHintMarkerSnapping();let t=this._layerGroup&&this._layerGroup.hasLayer(this._centerMarker)?this._centerMarker.getLatLng():this._hintMarker.getLatLng();this._fireChange(t,"Draw")},isRelevantMarker(e){return e instanceof L.CircleMarker&&!(e instanceof L.Circle)&&e.pm&&!e._pmTempLayer},_createMarker(e){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||!e.latlng||this._layerIsDragging)return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),i=new this._BaseCircleClass(t,{radius:this._defaultRadius,...this.options.pathOptions});this._setPane(i,"layerPane"),this._finishLayer(i),i.addTo(this._map.pm._getContainingLayer()),this._extendingCreateMarker(i),this._fireCreate(i),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},_extendingCreateMarker(e){e.pm&&this.options.markerEditable&&e.pm.enable()},_finishShape(e){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._centerMarker.getLatLng(),i=this._defaultRadius;if(this.options[this._editableOption]){let s=this._hintMarker.getLatLng();i=this._distanceCalculation(t,s),this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?i=this.options[this._minRadiusOption]:this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(i=this.options[this._maxRadiusOption])}let r={...this.options.pathOptions,radius:i},n=new this._BaseCircleClass(t,r);this._setPane(n,"layerPane"),this._finishLayer(n),n.addTo(this._map.pm._getContainingLayer()),n.pm&&n.pm._updateHiddenPolyCircle(),this._fireCreate(n);let a=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(a))},_getNewDestinationOfHintMarker(){let e=this._hintMarker.getLatLng();if(this.options[this._editableOption]){if(!this._layerGroup.hasLayer(this._centerMarker))return e;let t=this._centerMarker.getLatLng(),i=this._distanceCalculation(t,e);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?e=Ui(this._map,t,e,this._getMinDistanceInMeter()):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(e=Ui(this._map,t,e,this._getMaxDistanceInMeter()))}return e},_getMinDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,this._centerMarker.getLatLng())},_getMaxDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,this._centerMarker.getLatLng())},_handleHintMarkerSnapping(){if(this.options[this._editableOption]){if(this._hintMarker._snapped){let e=this._centerMarker.getLatLng(),t=this._hintMarker.getLatLng(),i=this._distanceCalculation(e,t);this._layerGroup.hasLayer(this._centerMarker)&&(this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._hintMarker.setLatLng(this._hintMarker._orgLatLng):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&this._hintMarker.setLatLng(this._hintMarker._orgLatLng))}this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker())}},setStyle(){let e={};L.extend(e,this.options.templineStyle),this.options[this._editableOption]&&(e.radius=0),this._layer?.setStyle(e),this._hintline?.setStyle(this.options.hintlineStyle)},_distanceCalculation(e,t){return this._map.project(e).distanceTo(this._map.project(t))}}),Be.Circle=Be.CircleMarker.extend({initialize(e){this._map=e,this._shape="Circle",this.toolbarButtonName="drawCircle",this._BaseCircleClass=L.Circle,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizeableCircle",this._defaultRadius=100},_extendingEnable(){},_extendingDisable(){},_extendingCreateMarker(){},isRelevantMarker(){},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_distanceCalculation(e,t){return this._map.distance(e,t)}});function ee(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ce(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Bt(e){return e.type==="Feature"?e.geometry:e}function Wn(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function qn(e,t,i){if(e!==null)for(var r,n,a,s,o,h,c,x=0,y=0,T,F=e.type,z=F==="FeatureCollection",q=F==="Feature",Y=z?e.features.length:1,ue=0;ue<Y;ue++){c=z?e.features[ue].geometry:q?e.geometry:e,T=c?c.type==="GeometryCollection":!1,o=T?c.geometries.length:1;for(var b=0;b<o;b++){var v=0,B=0;if(s=T?c.geometries[b]:c,s!==null){h=s.coordinates;var O=s.type;switch(x=0,O){case null:break;case"Point":if(t(h,y,ue,v,B)===!1)return!1;y++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++){if(t(h[r],y,ue,v,B)===!1)return!1;y++,O==="MultiPoint"&&v++}O==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(n=0;n<h[r].length-x;n++){if(t(h[r][n],y,ue,v,B)===!1)return!1;y++}O==="MultiLineString"&&v++,O==="Polygon"&&B++}O==="Polygon"&&v++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for(B=0,n=0;n<h[r].length;n++){for(a=0;a<h[r][n].length-x;a++){if(t(h[r][n][a],y,ue,v,B)===!1)return!1;y++}B++}v++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(qn(s.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function fr(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var i=0;i<e.features.length&&t(e.features[i],i)!==!1;i++);}function rs(e,t,i){var r=i;return fr(e,function(n,a){a===0&&i===void 0?r=n:r=t(r,n,a)}),r}function ns(e,t){var i,r,n,a,s,o,h,c,x,y,T=0,F=e.type==="FeatureCollection",z=e.type==="Feature",q=F?e.features.length:1;for(i=0;i<q;i++){for(o=F?e.features[i].geometry:z?e.geometry:e,c=F?e.features[i].properties:z?e.properties:{},x=F?e.features[i].bbox:z?e.bbox:void 0,y=F?e.features[i].id:z?e.id:void 0,h=o?o.type==="GeometryCollection":!1,s=h?o.geometries.length:1,n=0;n<s;n++){if(a=h?o.geometries[n]:o,a===null){if(t(null,T,c,x,y)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,T,c,x,y)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<a.geometries.length;r++)if(t(a.geometries[r],T,c,x,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}T++}}function $n(e,t){ns(e,function(i,r,n,a,s){var o=i===null?null:i.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return t(l(i,n,{bbox:a,id:s}),r,0)===!1?!1:void 0}var h;switch(o){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var c=0;c<i.coordinates.length;c++){var x=i.coordinates[c],y={type:h,coordinates:x};if(t(l(y,n),r,c)===!1)return!1}})}function as(e){if(!e)throw new Error("geojson is required");var t=[];return $n(e,function(i){ss(i,t)}),D(t)}function ss(e,t){var i=[],r=e.geometry;if(r!==null){switch(r.type){case"Polygon":i=Ce(r);break;case"LineString":i=[Ce(r)]}i.forEach(function(n){var a=os(n,e.properties);a.forEach(function(s){s.id=t.length,t.push(s)})})}}function os(e,t){var i=[];return e.reduce(function(r,n){var a=w([r,n],t);return a.bbox=ls(r,n),i.push(a),n}),i}function ls(e,t){var i=e[0],r=e[1],n=t[0],a=t[1],s=i<n?i:n,o=r<a?r:a,h=i>n?i:n,c=r>a?r:a;return[s,o,h,c]}var Yn=as,us=Oe(jr(),1);function hs(e,t){var i={},r=[];if(e.type==="LineString"&&(e=l(e)),t.type==="LineString"&&(t=l(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var n=_a(e,t);return n&&r.push(n),D(r)}var a=(0,us.default)();return a.load(Yn(t)),fr(Yn(e),function(s){fr(a.search(s),function(o){var h=_a(s,o);if(h){var c=Ce(h).join(",");i[c]||(i[c]=!0,r.push(h))}})}),D(r)}function _a(e,t){var i=Ce(e),r=Ce(t);if(i.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var n=i[0][0],a=i[0][1],s=i[1][0],o=i[1][1],h=r[0][0],c=r[0][1],x=r[1][0],y=r[1][1],T=(y-c)*(s-n)-(x-h)*(o-a),F=(x-h)*(a-c)-(y-c)*(n-h),z=(s-n)*(a-c)-(o-a)*(n-h);if(T===0)return null;var q=F/T,Y=z/T;if(q>=0&&q<=1&&Y>=0&&Y<=1){var ue=n+q*(s-n),b=a+q*(o-a);return M([ue,b])}return null}var pi=hs,ba=Oe(jr(),1);function cs(e,t,i){i===void 0&&(i={});var r=ee(e),n=ee(t),a=Z(n[1]-r[1]),s=Z(n[0]-r[0]),o=Z(r[1]),h=Z(n[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(o)*Math.cos(h);return V(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)}var fi=cs;function ds(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=fi(e.slice(0,2),[r,i]),s=fi(e.slice(0,2),[t,n]);if(a>=s){var o=(i+n)/2;return[t,o-(r-t)/2,r,o+(r-t)/2]}else{var h=(t+r)/2;return[h-(n-i)/2,i,h+(n-i)/2,n]}}var ps=ds;function Xn(e){var t=[1/0,1/0,-1/0,-1/0];return qn(e,function(i){t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}Xn.default=Xn;var gr=Xn;function fs(e,t){t===void 0&&(t={});var i=t.precision,r=t.coordinates,n=t.mutate;if(i=i==null||isNaN(i)?6:i,r=r==null||isNaN(r)?3:r,!e)throw new Error("<geojson> is required");if(typeof i!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(n===!1||n===void 0)&&(e=JSON.parse(JSON.stringify(e)));var a=Math.pow(10,i);return qn(e,function(s){gs(s,a,r)}),e}function gs(e,t,i){e.length>i&&e.splice(i,e.length);for(var r=0;r<e.length;r++)e[r]=Math.round(e[r]*t)/t;return e}var ms=fs;function xa(e,t,i){if(i===void 0&&(i={}),i.final===!0)return ys(e,t);var r=ee(e),n=ee(t),a=Z(r[0]),s=Z(n[0]),o=Z(r[1]),h=Z(n[1]),c=Math.sin(s-a)*Math.cos(h),x=Math.cos(o)*Math.sin(h)-Math.sin(o)*Math.cos(h)*Math.cos(s-a);return U(Math.atan2(c,x))}function ys(e,t){var i=xa(t,e);return i=(i+180)%360,i}function va(e,t,i,r){r===void 0&&(r={});var n=ee(e),a=Z(n[0]),s=Z(n[1]),o=Z(i),h=K(t,r.units),c=Math.asin(Math.sin(s)*Math.cos(h)+Math.cos(s)*Math.sin(h)*Math.cos(o)),x=a+Math.atan2(Math.sin(o)*Math.sin(h)*Math.cos(s),Math.cos(h)-Math.sin(s)*Math.sin(c)),y=U(x),T=U(c);return M([y,T],r.properties)}function _s(e,t,i){i===void 0&&(i={});var r=M([1/0,1/0],{dist:1/0}),n=0;return $n(e,function(a){for(var s=Ce(a),o=0;o<s.length-1;o++){var h=M(s[o]);h.properties.dist=fi(t,h,i);var c=M(s[o+1]);c.properties.dist=fi(t,c,i);var x=fi(h,c,i),y=Math.max(h.properties.dist,c.properties.dist),T=xa(h,c),F=va(t,y,T+90,i),z=va(t,y,T-90,i),q=pi(w([F.geometry.coordinates,z.geometry.coordinates]),w([h.geometry.coordinates,c.geometry.coordinates])),Y=null;q.features.length>0&&(Y=q.features[0],Y.properties.dist=fi(t,Y,i),Y.properties.location=n+fi(h,Y,i)),h.properties.dist<r.properties.dist&&(r=h,r.properties.index=o,r.properties.location=n),c.properties.dist<r.properties.dist&&(r=c,r.properties.index=o+1,r.properties.location=n+x),Y&&Y.properties.dist<r.properties.dist&&(r=Y,r.properties.index=o),n+=x}}),r}var bs=_s;function xs(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var i=Wn(e),r=Wn(t);if(i!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var n=ms(t,{precision:7});switch(r){case"Point":return Zn(e,n);case"MultiPoint":return La(e,n);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return La(e,pi(e,n))}}function La(e,t){var i=[],r=(0,ba.default)();return $n(t,function(n){if(i.forEach(function(o,h){o.id=h}),!i.length)i=Zn(e,n).features,i.forEach(function(o){o.bbox||(o.bbox=ps(gr(o)))}),r.load(D(i));else{var a=r.search(n);if(a.features.length){var s=Ca(n,a);i=i.filter(function(o){return o.id!==s.id}),r.remove(s),fr(Zn(s,n),function(o){i.push(o),r.insert(o)})}}}),D(i)}function Zn(e,t){var i=[],r=Ce(e)[0],n=Ce(e)[e.geometry.coordinates.length-1];if(Jn(r,ee(t))||Jn(n,ee(t)))return D([e]);var a=(0,ba.default)(),s=Yn(e);a.load(s);var o=a.search(t);if(!o.features.length)return D([e]);var h=Ca(t,o),c=[r],x=rs(s,function(y,T,F){var z=Ce(T)[1],q=ee(t);return F===h.id?(y.push(q),i.push(w(y)),Jn(q,z)?[q]:[q,z]):(y.push(z),y)},c);return x.length>1&&i.push(w(x)),D(i)}function Ca(e,t){if(!t.features.length)throw new Error("lines must contain features");if(t.features.length===1)return t.features[0];var i,r=1/0;return fr(t,function(n){var a=bs(n,e),s=a.properties.dist;s<r&&(i=n,r=s)}),i}function Jn(e,t){return e[0]===t[0]&&e[1]===t[1]}var vs=xs;function en(e,t,i){if(i===void 0&&(i={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=ee(e),n=Bt(t),a=n.type,s=t.bbox,o=n.coordinates;if(s&&Ls(r,s)===!1)return!1;a==="Polygon"&&(o=[o]);for(var h=!1,c=0;c<o.length&&!h;c++)if(ka(r,o[c][0],i.ignoreBoundary)){for(var x=!1,y=1;y<o[c].length&&!x;)ka(r,o[c][y],!i.ignoreBoundary)&&(x=!0),y++;x||(h=!0)}return h}function ka(e,t,i){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var n=0,a=t.length-1;n<t.length;a=n++){var s=t[n][0],o=t[n][1],h=t[a][0],c=t[a][1],x=e[1]*(s-h)+o*(h-e[0])+c*(e[0]-s)===0&&(s-e[0])*(h-e[0])<=0&&(o-e[1])*(c-e[1])<=0;if(x)return!i;var y=o>e[1]!=c>e[1]&&e[0]<(h-s)*(e[1]-o)/(c-o)+s;y&&(r=!r)}return r}function Ls(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function Cs(e,t,i){i===void 0&&(i={});for(var r=ee(e),n=Ce(t),a=0;a<n.length-1;a++){var s=!1;if(i.ignoreEndVertices&&(a===0&&(s="start"),a===n.length-2&&(s="end"),a===0&&a+1===n.length-1&&(s="both")),ks(n[a],n[a+1],r,s,typeof i.epsilon>"u"?null:i.epsilon))return!0}return!1}function ks(e,t,i,r,n){var a=i[0],s=i[1],o=e[0],h=e[1],c=t[0],x=t[1],y=i[0]-o,T=i[1]-h,F=c-o,z=x-h,q=y*z-T*F;if(n!==null){if(Math.abs(q)>n)return!1}else if(q!==0)return!1;if(r){if(r==="start")return Math.abs(F)>=Math.abs(z)?F>0?o<a&&a<=c:c<=a&&a<o:z>0?h<s&&s<=x:x<=s&&s<h;if(r==="end")return Math.abs(F)>=Math.abs(z)?F>0?o<=a&&a<c:c<a&&a<=o:z>0?h<=s&&s<x:x<s&&s<=h;if(r==="both")return Math.abs(F)>=Math.abs(z)?F>0?o<a&&a<c:c<a&&a<o:z>0?h<s&&s<x:x<s&&s<h}else return Math.abs(F)>=Math.abs(z)?F>0?o<=a&&a<=c:c<=a&&a<=o:z>0?h<=s&&s<=x:x<=s&&s<=h;return!1}var mr=Cs;function Ms(e,t){var i=Bt(e),r=Bt(t),n=i.type,a=r.type,s=i.coordinates,o=r.coordinates;switch(n){case"Point":switch(a){case"Point":return Qn(s,o);default:throw new Error("feature2 "+a+" geometry not supported")}case"MultiPoint":switch(a){case"Point":return Es(i,r);case"MultiPoint":return Bs(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"Point":return mr(r,i,{ignoreEndVertices:!0});case"LineString":return Ds(i,r);case"MultiPoint":return ws(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Point":return en(r,i,{ignoreBoundary:!0});case"LineString":return As(i,r);case"Polygon":return Ps(i,r);case"MultiPoint":return Ss(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function Es(e,t){var i,r=!1;for(i=0;i<e.coordinates.length;i++)if(Qn(e.coordinates[i],t.coordinates)){r=!0;break}return r}function Bs(e,t){for(var i=0,r=t.coordinates;i<r.length;i++){for(var n=r[i],a=!1,s=0,o=e.coordinates;s<o.length;s++){var h=o[s];if(Qn(n,h)){a=!0;break}}if(!a)return!1}return!0}function ws(e,t){for(var i=!1,r=0,n=t.coordinates;r<n.length;r++){var a=n[r];if(mr(a,e,{ignoreEndVertices:!0})&&(i=!0),!mr(a,e))return!1}return!!i}function Ss(e,t){for(var i=0,r=t.coordinates;i<r.length;i++){var n=r[i];if(!en(n,e,{ignoreBoundary:!0}))return!1}return!0}function Ds(e,t){for(var i=!1,r=0,n=t.coordinates;r<n.length;r++){var a=n[r];if(mr({type:"Point",coordinates:a},e,{ignoreEndVertices:!0})&&(i=!0),!mr({type:"Point",coordinates:a},e,{ignoreEndVertices:!1}))return!1}return i}function As(e,t){var i=!1,r=0,n=gr(e),a=gr(t);if(!Ma(n,a))return!1;for(r;r<t.coordinates.length-1;r++){var s=Ts(t.coordinates[r],t.coordinates[r+1]);if(en({type:"Point",coordinates:s},e,{ignoreBoundary:!0})){i=!0;break}}return i}function Ps(e,t){if(e.type==="Feature"&&e.geometry===null||t.type==="Feature"&&t.geometry===null)return!1;var i=gr(e),r=gr(t);if(!Ma(i,r))return!1;for(var n=Bt(t).coordinates,a=0,s=n;a<s.length;a++)for(var o=s[a],h=0,c=o;h<c.length;h++){var x=c[h];if(!en(x,e))return!1}return!0}function Ma(e,t){return!(e[0]>t[0]||e[2]<t[2]||e[1]>t[1]||e[3]<t[3])}function Qn(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ts(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}var Rs=Oe(li()),Ea=e=>()=>e,ea=e=>{let t=e?(i,r)=>r.minus(i).abs().isLessThanOrEqualTo(e):Ea(!1);return(i,r)=>t(i,r)?0:i.comparedTo(r)};function Fs(e){let t=e?(i,r,n,a,s)=>i.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(r).exponentiatedBy(2).plus(s.minus(n).exponentiatedBy(2)).times(e)):Ea(!1);return(i,r,n)=>{let a=i.x,s=i.y,o=n.x,h=n.y,c=s.minus(h).times(r.x.minus(o)).minus(a.minus(o).times(r.y.minus(h)));return t(c,a,s,o,h)?0:c.comparedTo(0)}}var Os=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ta=Math.ceil,ht=Math.floor,Je="[BigNumber Error] ",Ba=Je+"Number primitive has more than 15 significant digits: ",bt=1e14,re=14,ia=9007199254740991,ra=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Jt=1e7,Re=1e9;function wa(e){var t,i,r,n=b.prototype={constructor:b,toString:null,valueOf:null},a=new b(1),s=20,o=4,h=-7,c=21,x=-1e7,y=1e7,T=!1,F=1,z=0,q={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},Y="0123456789abcdefghijklmnopqrstuvwxyz",ue=!0;function b(u,d){var f,p,g,m,k,C,E,P,A=this;if(!(A instanceof b))return new b(u,d);if(d==null){if(u&&u._isBigNumber===!0){A.s=u.s,!u.c||u.e>y?A.c=A.e=null:u.e<x?A.c=[A.e=0]:(A.e=u.e,A.c=u.c.slice());return}if((C=typeof u=="number")&&u*0==0){if(A.s=1/u<0?(u=-u,-1):1,u===~~u){for(m=0,k=u;k>=10;k/=10,m++);m>y?A.c=A.e=null:(A.e=m,A.c=[u]);return}P=String(u)}else{if(!Os.test(P=String(u)))return r(A,P,C);A.s=P.charCodeAt(0)==45?(P=P.slice(1),-1):1}(m=P.indexOf("."))>-1&&(P=P.replace(".","")),(k=P.search(/e/i))>0?(m<0&&(m=k),m+=+P.slice(k+1),P=P.substring(0,k)):m<0&&(m=P.length)}else{if(Le(d,2,Y.length,"Base"),d==10&&ue)return A=new b(u),S(A,s+A.e+1,o);if(P=String(u),C=typeof u=="number"){if(u*0!=0)return r(A,P,C,d);if(A.s=1/u<0?(P=P.slice(1),-1):1,b.DEBUG&&P.replace(/^0\.0*|\./,"").length>15)throw Error(Ba+u)}else A.s=P.charCodeAt(0)===45?(P=P.slice(1),-1):1;for(f=Y.slice(0,d),m=k=0,E=P.length;k<E;k++)if(f.indexOf(p=P.charAt(k))<0){if(p=="."){if(k>m){m=E;continue}}else if(!g&&(P==P.toUpperCase()&&(P=P.toLowerCase())||P==P.toLowerCase()&&(P=P.toUpperCase()))){g=!0,k=-1,m=0;continue}return r(A,String(u),C,d)}C=!1,P=i(P,d,10,A.s),(m=P.indexOf("."))>-1?P=P.replace(".",""):m=P.length}for(k=0;P.charCodeAt(k)===48;k++);for(E=P.length;P.charCodeAt(--E)===48;);if(P=P.slice(k,++E)){if(E-=k,C&&b.DEBUG&&E>15&&(u>ia||u!==ht(u)))throw Error(Ba+A.s*u);if((m=m-k-1)>y)A.c=A.e=null;else if(m<x)A.c=[A.e=0];else{if(A.e=m,A.c=[],k=(m+1)%re,m<0&&(k+=re),k<E){for(k&&A.c.push(+P.slice(0,k)),E-=re;k<E;)A.c.push(+P.slice(k,k+=re));k=re-(P=P.slice(k)).length}else k-=E;for(;k--;P+="0");A.c.push(+P)}}else A.c=[A.e=0]}b.clone=wa,b.ROUND_UP=0,b.ROUND_DOWN=1,b.ROUND_CEIL=2,b.ROUND_FLOOR=3,b.ROUND_HALF_UP=4,b.ROUND_HALF_DOWN=5,b.ROUND_HALF_EVEN=6,b.ROUND_HALF_CEIL=7,b.ROUND_HALF_FLOOR=8,b.EUCLID=9,b.config=b.set=function(u){var d,f;if(u!=null)if(typeof u=="object"){if(u.hasOwnProperty(d="DECIMAL_PLACES")&&(f=u[d],Le(f,0,Re,d),s=f),u.hasOwnProperty(d="ROUNDING_MODE")&&(f=u[d],Le(f,0,8,d),o=f),u.hasOwnProperty(d="EXPONENTIAL_AT")&&(f=u[d],f&&f.pop?(Le(f[0],-Re,0,d),Le(f[1],0,Re,d),h=f[0],c=f[1]):(Le(f,-Re,Re,d),h=-(c=f<0?-f:f))),u.hasOwnProperty(d="RANGE"))if(f=u[d],f&&f.pop)Le(f[0],-Re,-1,d),Le(f[1],1,Re,d),x=f[0],y=f[1];else if(Le(f,-Re,Re,d),f)x=-(y=f<0?-f:f);else throw Error(Je+d+" cannot be zero: "+f);if(u.hasOwnProperty(d="CRYPTO"))if(f=u[d],f===!!f)if(f)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))T=f;else throw T=!f,Error(Je+"crypto unavailable");else T=f;else throw Error(Je+d+" not true or false: "+f);if(u.hasOwnProperty(d="MODULO_MODE")&&(f=u[d],Le(f,0,9,d),F=f),u.hasOwnProperty(d="POW_PRECISION")&&(f=u[d],Le(f,0,Re,d),z=f),u.hasOwnProperty(d="FORMAT"))if(f=u[d],typeof f=="object")q=f;else throw Error(Je+d+" not an object: "+f);if(u.hasOwnProperty(d="ALPHABET"))if(f=u[d],typeof f=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(f))ue=f.slice(0,10)=="0123456789",Y=f;else throw Error(Je+d+" invalid: "+f)}else throw Error(Je+"Object expected: "+u);return{DECIMAL_PLACES:s,ROUNDING_MODE:o,EXPONENTIAL_AT:[h,c],RANGE:[x,y],CRYPTO:T,MODULO_MODE:F,POW_PRECISION:z,FORMAT:q,ALPHABET:Y}},b.isBigNumber=function(u){if(!u||u._isBigNumber!==!0)return!1;if(!b.DEBUG)return!0;var d,f,p=u.c,g=u.e,m=u.s;e:if({}.toString.call(p)=="[object Array]"){if((m===1||m===-1)&&g>=-Re&&g<=Re&&g===ht(g)){if(p[0]===0){if(g===0&&p.length===1)return!0;break e}if(d=(g+1)%re,d<1&&(d+=re),String(p[0]).length==d){for(d=0;d<p.length;d++)if(f=p[d],f<0||f>=bt||f!==ht(f))break e;if(f!==0)return!0}}}else if(p===null&&g===null&&(m===null||m===1||m===-1))return!0;throw Error(Je+"Invalid BigNumber: "+u)},b.maximum=b.max=function(){return B(arguments,-1)},b.minimum=b.min=function(){return B(arguments,1)},b.random=function(){var u=9007199254740992,d=Math.random()*u&2097151?function(){return ht(Math.random()*u)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(f){var p,g,m,k,C,E=0,P=[],A=new b(a);if(f==null?f=s:Le(f,0,Re),k=ta(f/re),T)if(crypto.getRandomValues){for(p=crypto.getRandomValues(new Uint32Array(k*=2));E<k;)C=p[E]*131072+(p[E+1]>>>11),C>=9e15?(g=crypto.getRandomValues(new Uint32Array(2)),p[E]=g[0],p[E+1]=g[1]):(P.push(C%1e14),E+=2);E=k/2}else if(crypto.randomBytes){for(p=crypto.randomBytes(k*=7);E<k;)C=(p[E]&31)*281474976710656+p[E+1]*1099511627776+p[E+2]*4294967296+p[E+3]*16777216+(p[E+4]<<16)+(p[E+5]<<8)+p[E+6],C>=9e15?crypto.randomBytes(7).copy(p,E):(P.push(C%1e14),E+=7);E=k/7}else throw T=!1,Error(Je+"crypto unavailable");if(!T)for(;E<k;)C=d(),C<9e15&&(P[E++]=C%1e14);for(k=P[--E],f%=re,k&&f&&(C=ra[re-f],P[E]=ht(k/C)*C);P[E]===0;P.pop(),E--);if(E<0)P=[m=0];else{for(m=-1;P[0]===0;P.splice(0,1),m-=re);for(E=1,C=P[0];C>=10;C/=10,E++);E<re&&(m-=re-E)}return A.e=m,A.c=P,A}}(),b.sum=function(){for(var u=1,d=arguments,f=new b(d[0]);u<d.length;)f=f.plus(d[u++]);return f},i=function(){var u="0123456789";function d(f,p,g,m){for(var k,C=[0],E,P=0,A=f.length;P<A;){for(E=C.length;E--;C[E]*=p);for(C[0]+=m.indexOf(f.charAt(P++)),k=0;k<C.length;k++)C[k]>g-1&&(C[k+1]==null&&(C[k+1]=0),C[k+1]+=C[k]/g|0,C[k]%=g)}return C.reverse()}return function(f,p,g,m,k){var C,E,P,A,G,$,X,Q,ge=f.indexOf("."),_e=s,ce=o;for(ge>=0&&(A=z,z=0,f=f.replace(".",""),Q=new b(p),$=Q.pow(f.length-ge),z=A,Q.c=d(zt(dt($.c),$.e,"0"),10,g,u),Q.e=Q.c.length),X=d(f,p,g,k?(C=Y,u):(C=u,Y)),P=A=X.length;X[--A]==0;X.pop());if(!X[0])return C.charAt(0);if(ge<0?--P:($.c=X,$.e=P,$.s=m,$=t($,Q,_e,ce,g),X=$.c,G=$.r,P=$.e),E=P+_e+1,ge=X[E],A=g/2,G=G||E<0||X[E+1]!=null,G=ce<4?(ge!=null||G)&&(ce==0||ce==($.s<0?3:2)):ge>A||ge==A&&(ce==4||G||ce==6&&X[E-1]&1||ce==($.s<0?8:7)),E<1||!X[0])f=G?zt(C.charAt(1),-_e,C.charAt(0)):C.charAt(0);else{if(X.length=E,G)for(--g;++X[--E]>g;)X[E]=0,E||(++P,X=[1].concat(X));for(A=X.length;!X[--A];);for(ge=0,f="";ge<=A;f+=C.charAt(X[ge++]));f=zt(f,P,C.charAt(0))}return f}}(),t=function(){function u(p,g,m){var k,C,E,P,A=0,G=p.length,$=g%Jt,X=g/Jt|0;for(p=p.slice();G--;)E=p[G]%Jt,P=p[G]/Jt|0,k=X*E+P*$,C=$*E+k%Jt*Jt+A,A=(C/m|0)+(k/Jt|0)+X*P,p[G]=C%m;return A&&(p=[A].concat(p)),p}function d(p,g,m,k){var C,E;if(m!=k)E=m>k?1:-1;else for(C=E=0;C<m;C++)if(p[C]!=g[C]){E=p[C]>g[C]?1:-1;break}return E}function f(p,g,m,k){for(var C=0;m--;)p[m]-=C,C=p[m]<g[m]?1:0,p[m]=C*k+p[m]-g[m];for(;!p[0]&&p.length>1;p.splice(0,1));}return function(p,g,m,k,C){var E,P,A,G,$,X,Q,ge,_e,ce,be,He,dn,oa,la,Dt,xr,pt=p.s==g.s?1:-1,qe=p.c,ke=g.c;if(!qe||!qe[0]||!ke||!ke[0])return new b(!p.s||!g.s||(qe?ke&&qe[0]==ke[0]:!ke)?NaN:qe&&qe[0]==0||!ke?pt*0:pt/0);for(ge=new b(pt),_e=ge.c=[],P=p.e-g.e,pt=m+P+1,C||(C=bt,P=ct(p.e/re)-ct(g.e/re),pt=pt/re|0),A=0;ke[A]==(qe[A]||0);A++);if(ke[A]>(qe[A]||0)&&P--,pt<0)_e.push(1),G=!0;else{for(oa=qe.length,Dt=ke.length,A=0,pt+=2,$=ht(C/(ke[0]+1)),$>1&&(ke=u(ke,$,C),qe=u(qe,$,C),Dt=ke.length,oa=qe.length),dn=Dt,ce=qe.slice(0,Dt),be=ce.length;be<Dt;ce[be++]=0);xr=ke.slice(),xr=[0].concat(xr),la=ke[0],ke[1]>=C/2&&la++;do{if($=0,E=d(ke,ce,Dt,be),E<0){if(He=ce[0],Dt!=be&&(He=He*C+(ce[1]||0)),$=ht(He/la),$>1)for($>=C&&($=C-1),X=u(ke,$,C),Q=X.length,be=ce.length;d(X,ce,Q,be)==1;)$--,f(X,Dt<Q?xr:ke,Q,C),Q=X.length,E=1;else $==0&&(E=$=1),X=ke.slice(),Q=X.length;if(Q<be&&(X=[0].concat(X)),f(ce,X,be,C),be=ce.length,E==-1)for(;d(ke,ce,Dt,be)<1;)$++,f(ce,Dt<be?xr:ke,be,C),be=ce.length}else E===0&&($++,ce=[0]);_e[A++]=$,ce[0]?ce[be++]=qe[dn]||0:(ce=[qe[dn]],be=1)}while((dn++<oa||ce[0]!=null)&&pt--);G=ce[0]!=null,_e[0]||_e.splice(0,1)}if(C==bt){for(A=1,pt=_e[0];pt>=10;pt/=10,A++);S(ge,m+(ge.e=A+P*re-1)+1,k,G)}else ge.e=P,ge.r=+G;return ge}}();function v(u,d,f,p){var g,m,k,C,E;if(f==null?f=o:Le(f,0,8),!u.c)return u.toString();if(g=u.c[0],k=u.e,d==null)E=dt(u.c),E=p==1||p==2&&(k<=h||k>=c)?rn(E,k):zt(E,k,"0");else if(u=S(new b(u),d,f),m=u.e,E=dt(u.c),C=E.length,p==1||p==2&&(d<=m||m<=h)){for(;C<d;E+="0",C++);E=rn(E,m)}else if(d-=k,E=zt(E,m,"0"),m+1>C){if(--d>0)for(E+=".";d--;E+="0");}else if(d+=m-C,d>0)for(m+1==C&&(E+=".");d--;E+="0");return u.s<0&&g?"-"+E:E}function B(u,d){for(var f,p,g=1,m=new b(u[0]);g<u.length;g++)p=new b(u[g]),(!p.s||(f=gi(m,p))===d||f===0&&m.s===d)&&(m=p);return m}function O(u,d,f){for(var p=1,g=d.length;!d[--g];d.pop());for(g=d[0];g>=10;g/=10,p++);return(f=p+f*re-1)>y?u.c=u.e=null:f<x?u.c=[u.e=0]:(u.e=f,u.c=d),u}r=function(){var u=/^(-?)0([xbo])(?=\w[\w.]*$)/i,d=/^([^.]+)\.$/,f=/^\.([^.]+)$/,p=/^-?(Infinity|NaN)$/,g=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(m,k,C,E){var P,A=C?k:k.replace(g,"");if(p.test(A))m.s=isNaN(A)?null:A<0?-1:1;else{if(!C&&(A=A.replace(u,function(G,$,X){return P=(X=X.toLowerCase())=="x"?16:X=="b"?2:8,!E||E==P?$:G}),E&&(P=E,A=A.replace(d,"$1").replace(f,"0.$1")),k!=A))return new b(A,P);if(b.DEBUG)throw Error(Je+"Not a"+(E?" base "+E:"")+" number: "+k);m.s=null}m.c=m.e=null}}();function S(u,d,f,p){var g,m,k,C,E,P,A,G=u.c,$=ra;if(G){e:{for(g=1,C=G[0];C>=10;C/=10,g++);if(m=d-g,m<0)m+=re,k=d,E=G[P=0],A=ht(E/$[g-k-1]%10);else if(P=ta((m+1)/re),P>=G.length)if(p){for(;G.length<=P;G.push(0));E=A=0,g=1,m%=re,k=m-re+1}else break e;else{for(E=C=G[P],g=1;C>=10;C/=10,g++);m%=re,k=m-re+g,A=k<0?0:ht(E/$[g-k-1]%10)}if(p=p||d<0||G[P+1]!=null||(k<0?E:E%$[g-k-1]),p=f<4?(A||p)&&(f==0||f==(u.s<0?3:2)):A>5||A==5&&(f==4||p||f==6&&(m>0?k>0?E/$[g-k]:0:G[P-1])%10&1||f==(u.s<0?8:7)),d<1||!G[0])return G.length=0,p?(d-=u.e+1,G[0]=$[(re-d%re)%re],u.e=-d||0):G[0]=u.e=0,u;if(m==0?(G.length=P,C=1,P--):(G.length=P+1,C=$[re-m],G[P]=k>0?ht(E/$[g-k]%$[k])*C:0),p)for(;;)if(P==0){for(m=1,k=G[0];k>=10;k/=10,m++);for(k=G[0]+=C,C=1;k>=10;k/=10,C++);m!=C&&(u.e++,G[0]==bt&&(G[0]=1));break}else{if(G[P]+=C,G[P]!=bt)break;G[P--]=0,C=1}for(m=G.length;G[--m]===0;G.pop());}u.e>y?u.c=u.e=null:u.e<x&&(u.c=[u.e=0])}return u}function R(u){var d,f=u.e;return f===null?u.toString():(d=dt(u.c),d=f<=h||f>=c?rn(d,f):zt(d,f,"0"),u.s<0?"-"+d:d)}return n.absoluteValue=n.abs=function(){var u=new b(this);return u.s<0&&(u.s=1),u},n.comparedTo=function(u,d){return gi(this,new b(u,d))},n.decimalPlaces=n.dp=function(u,d){var f,p,g,m=this;if(u!=null)return Le(u,0,Re),d==null?d=o:Le(d,0,8),S(new b(m),u+m.e+1,d);if(!(f=m.c))return null;if(p=((g=f.length-1)-ct(this.e/re))*re,g=f[g])for(;g%10==0;g/=10,p--);return p<0&&(p=0),p},n.dividedBy=n.div=function(u,d){return t(this,new b(u,d),s,o)},n.dividedToIntegerBy=n.idiv=function(u,d){return t(this,new b(u,d),0,1)},n.exponentiatedBy=n.pow=function(u,d){var f,p,g,m,k,C,E,P,A,G=this;if(u=new b(u),u.c&&!u.isInteger())throw Error(Je+"Exponent not an integer: "+R(u));if(d!=null&&(d=new b(d)),C=u.e>14,!G.c||!G.c[0]||G.c[0]==1&&!G.e&&G.c.length==1||!u.c||!u.c[0])return A=new b(Math.pow(+R(G),C?u.s*(2-tn(u)):+R(u))),d?A.mod(d):A;if(E=u.s<0,d){if(d.c?!d.c[0]:!d.s)return new b(NaN);p=!E&&G.isInteger()&&d.isInteger(),p&&(G=G.mod(d))}else{if(u.e>9&&(G.e>0||G.e<-1||(G.e==0?G.c[0]>1||C&&G.c[1]>=24e7:G.c[0]<8e13||C&&G.c[0]<=9999975e7)))return m=G.s<0&&tn(u)?-0:0,G.e>-1&&(m=1/m),new b(E?1/m:m);z&&(m=ta(z/re+2))}for(C?(f=new b(.5),E&&(u.s=1),P=tn(u)):(g=Math.abs(+R(u)),P=g%2),A=new b(a);;){if(P){if(A=A.times(G),!A.c)break;m?A.c.length>m&&(A.c.length=m):p&&(A=A.mod(d))}if(g){if(g=ht(g/2),g===0)break;P=g%2}else if(u=u.times(f),S(u,u.e+1,1),u.e>14)P=tn(u);else{if(g=+R(u),g===0)break;P=g%2}G=G.times(G),m?G.c&&G.c.length>m&&(G.c.length=m):p&&(G=G.mod(d))}return p?A:(E&&(A=a.div(A)),d?A.mod(d):m?S(A,z,o,k):A)},n.integerValue=function(u){var d=new b(this);return u==null?u=o:Le(u,0,8),S(d,d.e+1,u)},n.isEqualTo=n.eq=function(u,d){return gi(this,new b(u,d))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(u,d){return gi(this,new b(u,d))>0},n.isGreaterThanOrEqualTo=n.gte=function(u,d){return(d=gi(this,new b(u,d)))===1||d===0},n.isInteger=function(){return!!this.c&&ct(this.e/re)>this.c.length-2},n.isLessThan=n.lt=function(u,d){return gi(this,new b(u,d))<0},n.isLessThanOrEqualTo=n.lte=function(u,d){return(d=gi(this,new b(u,d)))===-1||d===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(u,d){var f,p,g,m,k=this,C=k.s;if(u=new b(u,d),d=u.s,!C||!d)return new b(NaN);if(C!=d)return u.s=-d,k.plus(u);var E=k.e/re,P=u.e/re,A=k.c,G=u.c;if(!E||!P){if(!A||!G)return A?(u.s=-d,u):new b(G?k:NaN);if(!A[0]||!G[0])return G[0]?(u.s=-d,u):new b(A[0]?k:o==3?-0:0)}if(E=ct(E),P=ct(P),A=A.slice(),C=E-P){for((m=C<0)?(C=-C,g=A):(P=E,g=G),g.reverse(),d=C;d--;g.push(0));g.reverse()}else for(p=(m=(C=A.length)<(d=G.length))?C:d,C=d=0;d<p;d++)if(A[d]!=G[d]){m=A[d]<G[d];break}if(m&&(g=A,A=G,G=g,u.s=-u.s),d=(p=G.length)-(f=A.length),d>0)for(;d--;A[f++]=0);for(d=bt-1;p>C;){if(A[--p]<G[p]){for(f=p;f&&!A[--f];A[f]=d);--A[f],A[p]+=bt}A[p]-=G[p]}for(;A[0]==0;A.splice(0,1),--P);return A[0]?O(u,A,P):(u.s=o==3?-1:1,u.c=[u.e=0],u)},n.modulo=n.mod=function(u,d){var f,p,g=this;return u=new b(u,d),!g.c||!u.s||u.c&&!u.c[0]?new b(NaN):!u.c||g.c&&!g.c[0]?new b(g):(F==9?(p=u.s,u.s=1,f=t(g,u,0,3),u.s=p,f.s*=p):f=t(g,u,0,F),u=g.minus(f.times(u)),!u.c[0]&&F==1&&(u.s=g.s),u)},n.multipliedBy=n.times=function(u,d){var f,p,g,m,k,C,E,P,A,G,$,X,Q,ge,_e,ce=this,be=ce.c,He=(u=new b(u,d)).c;if(!be||!He||!be[0]||!He[0])return!ce.s||!u.s||be&&!be[0]&&!He||He&&!He[0]&&!be?u.c=u.e=u.s=null:(u.s*=ce.s,!be||!He?u.c=u.e=null:(u.c=[0],u.e=0)),u;for(p=ct(ce.e/re)+ct(u.e/re),u.s*=ce.s,E=be.length,G=He.length,E<G&&(Q=be,be=He,He=Q,g=E,E=G,G=g),g=E+G,Q=[];g--;Q.push(0));for(ge=bt,_e=Jt,g=G;--g>=0;){for(f=0,$=He[g]%_e,X=He[g]/_e|0,k=E,m=g+k;m>g;)P=be[--k]%_e,A=be[k]/_e|0,C=X*P+A*$,P=$*P+C%_e*_e+Q[m]+f,f=(P/ge|0)+(C/_e|0)+X*A,Q[m--]=P%ge;Q[m]=f}return f?++p:Q.splice(0,1),O(u,Q,p)},n.negated=function(){var u=new b(this);return u.s=-u.s||null,u},n.plus=function(u,d){var f,p=this,g=p.s;if(u=new b(u,d),d=u.s,!g||!d)return new b(NaN);if(g!=d)return u.s=-d,p.minus(u);var m=p.e/re,k=u.e/re,C=p.c,E=u.c;if(!m||!k){if(!C||!E)return new b(g/0);if(!C[0]||!E[0])return E[0]?u:new b(C[0]?p:g*0)}if(m=ct(m),k=ct(k),C=C.slice(),g=m-k){for(g>0?(k=m,f=E):(g=-g,f=C),f.reverse();g--;f.push(0));f.reverse()}for(g=C.length,d=E.length,g-d<0&&(f=E,E=C,C=f,d=g),g=0;d;)g=(C[--d]=C[d]+E[d]+g)/bt|0,C[d]=bt===C[d]?0:C[d]%bt;return g&&(C=[g].concat(C),++k),O(u,C,k)},n.precision=n.sd=function(u,d){var f,p,g,m=this;if(u!=null&&u!==!!u)return Le(u,1,Re),d==null?d=o:Le(d,0,8),S(new b(m),u,d);if(!(f=m.c))return null;if(g=f.length-1,p=g*re+1,g=f[g]){for(;g%10==0;g/=10,p--);for(g=f[0];g>=10;g/=10,p++);}return u&&m.e+1>p&&(p=m.e+1),p},n.shiftedBy=function(u){return Le(u,-ia,ia),this.times("1e"+u)},n.squareRoot=n.sqrt=function(){var u,d,f,p,g,m=this,k=m.c,C=m.s,E=m.e,P=s+4,A=new b("0.5");if(C!==1||!k||!k[0])return new b(!C||C<0&&(!k||k[0])?NaN:k?m:1/0);if(C=Math.sqrt(+R(m)),C==0||C==1/0?(d=dt(k),(d.length+E)%2==0&&(d+="0"),C=Math.sqrt(+d),E=ct((E+1)/2)-(E<0||E%2),C==1/0?d="5e"+E:(d=C.toExponential(),d=d.slice(0,d.indexOf("e")+1)+E),f=new b(d)):f=new b(C+""),f.c[0]){for(E=f.e,C=E+P,C<3&&(C=0);;)if(g=f,f=A.times(g.plus(t(m,g,P,1))),dt(g.c).slice(0,C)===(d=dt(f.c)).slice(0,C))if(f.e<E&&--C,d=d.slice(C-3,C+1),d=="9999"||!p&&d=="4999"){if(!p&&(S(g,g.e+s+2,0),g.times(g).eq(m))){f=g;break}P+=4,C+=4,p=1}else{(!+d||!+d.slice(1)&&d.charAt(0)=="5")&&(S(f,f.e+s+2,1),u=!f.times(f).eq(m));break}}return S(f,f.e+s+1,o,u)},n.toExponential=function(u,d){return u!=null&&(Le(u,0,Re),u++),v(this,u,d,1)},n.toFixed=function(u,d){return u!=null&&(Le(u,0,Re),u=u+this.e+1),v(this,u,d)},n.toFormat=function(u,d,f){var p,g=this;if(f==null)u!=null&&d&&typeof d=="object"?(f=d,d=null):u&&typeof u=="object"?(f=u,u=d=null):f=q;else if(typeof f!="object")throw Error(Je+"Argument not an object: "+f);if(p=g.toFixed(u,d),g.c){var m,k=p.split("."),C=+f.groupSize,E=+f.secondaryGroupSize,P=f.groupSeparator||"",A=k[0],G=k[1],$=g.s<0,X=$?A.slice(1):A,Q=X.length;if(E&&(m=C,C=E,E=m,Q-=m),C>0&&Q>0){for(m=Q%C||C,A=X.substr(0,m);m<Q;m+=C)A+=P+X.substr(m,C);E>0&&(A+=P+X.slice(m)),$&&(A="-"+A)}p=G?A+(f.decimalSeparator||"")+((E=+f.fractionGroupSize)?G.replace(new RegExp("\\d{"+E+"}\\B","g"),"$&"+(f.fractionGroupSeparator||"")):G):A}return(f.prefix||"")+p+(f.suffix||"")},n.toFraction=function(u){var d,f,p,g,m,k,C,E,P,A,G,$,X=this,Q=X.c;if(u!=null&&(C=new b(u),!C.isInteger()&&(C.c||C.s!==1)||C.lt(a)))throw Error(Je+"Argument "+(C.isInteger()?"out of range: ":"not an integer: ")+R(C));if(!Q)return new b(X);for(d=new b(a),P=f=new b(a),p=E=new b(a),$=dt(Q),m=d.e=$.length-X.e-1,d.c[0]=ra[(k=m%re)<0?re+k:k],u=!u||C.comparedTo(d)>0?m>0?d:P:C,k=y,y=1/0,C=new b($),E.c[0]=0;A=t(C,d,0,1),g=f.plus(A.times(p)),g.comparedTo(u)!=1;)f=p,p=g,P=E.plus(A.times(g=P)),E=g,d=C.minus(A.times(g=d)),C=g;return g=t(u.minus(f),p,0,1),E=E.plus(g.times(P)),f=f.plus(g.times(p)),E.s=P.s=X.s,m=m*2,G=t(P,p,m,o).minus(X).abs().comparedTo(t(E,f,m,o).minus(X).abs())<1?[P,p]:[E,f],y=k,G},n.toNumber=function(){return+R(this)},n.toPrecision=function(u,d){return u!=null&&Le(u,1,Re),v(this,u,d,2)},n.toString=function(u){var d,f=this,p=f.s,g=f.e;return g===null?p?(d="Infinity",p<0&&(d="-"+d)):d="NaN":(u==null?d=g<=h||g>=c?rn(dt(f.c),g):zt(dt(f.c),g,"0"):u===10&&ue?(f=S(new b(f),s+g+1,o),d=zt(dt(f.c),f.e,"0")):(Le(u,2,Y.length,"Base"),d=i(zt(dt(f.c),g,"0"),10,u,p,!0)),p<0&&f.c[0]&&(d="-"+d)),d},n.valueOf=n.toJSON=function(){return R(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,e!=null&&b.set(e),b}function ct(e){var t=e|0;return e>0||e===t?t:t-1}function dt(e){for(var t,i,r=1,n=e.length,a=e[0]+"";r<n;){for(t=e[r++]+"",i=re-t.length;i--;t="0"+t);a+=t}for(n=a.length;a.charCodeAt(--n)===48;);return a.slice(0,n+1||1)}function gi(e,t){var i,r,n=e.c,a=t.c,s=e.s,o=t.s,h=e.e,c=t.e;if(!s||!o)return null;if(i=n&&!n[0],r=a&&!a[0],i||r)return i?r?0:-o:s;if(s!=o)return s;if(i=s<0,r=h==c,!n||!a)return r?0:!n^i?1:-1;if(!r)return h>c^i?1:-1;for(o=(h=n.length)<(c=a.length)?h:c,s=0;s<o;s++)if(n[s]!=a[s])return n[s]>a[s]^i?1:-1;return h==c?0:h>c^i?1:-1}function Le(e,t,i,r){if(e<t||e>i||e!==ht(e))throw Error(Je+(r||"Argument")+(typeof e=="number"?e<t||e>i?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function tn(e){var t=e.c.length-1;return ct(e.e/re)==t&&e.c[t]%2!=0}function rn(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function zt(e,t,i){var r,n;if(t<0){for(n=i+".";++t;n+=i);e=n+e}else if(r=e.length,++t>r){for(n=i,t-=r;--t;n+=i);e+=n}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}var js=wa(),wt=js,Is=class{key;left=null;right=null;constructor(e){this.key=e}},yr=class extends Is{constructor(e){super(e)}},Ns=class{size=0;modificationCount=0;splayCount=0;splay(e){let t=this.root;if(t==null)return this.compare(e,e),-1;let i=null,r=null,n=null,a=null,s=t,o=this.compare,h;for(;;)if(h=o(s.key,e),h>0){let c=s.left;if(c==null||(h=o(c.key,e),h>0&&(s.left=c.right,c.right=s,s=c,c=s.left,c==null)))break;i==null?r=s:i.left=s,i=s,s=c}else if(h<0){let c=s.right;if(c==null||(h=o(c.key,e),h<0&&(s.right=c.left,c.left=s,s=c,c=s.right,c==null)))break;n==null?a=s:n.right=s,n=s,s=c}else break;return n!=null&&(n.right=s.left,s.left=a),i!=null&&(i.left=s.right,s.right=r),this.root!==s&&(this.root=s,this.splayCount++),h}splayMin(e){let t=e,i=t.left;for(;i!=null;){let r=i;t.left=r.right,r.right=t,t=r,i=t.left}return t}splayMax(e){let t=e,i=t.right;for(;i!=null;){let r=i;t.right=r.left,r.left=t,t=r,i=t.right}return t}_delete(e){if(this.root==null||this.splay(e)!=0)return null;let t=this.root,i=t,r=t.left;if(this.size--,r==null)this.root=t.right;else{let n=t.right;t=this.splayMax(r),t.right=n,this.root=t}return this.modificationCount++,i}addNewRoot(e,t){this.size++,this.modificationCount++;let i=this.root;if(i==null){this.root=e;return}t<0?(e.left=i,e.right=i.right,i.right=null):(e.right=i,e.left=i.left,i.left=null),this.root=e}_first(){let e=this.root;return e==null?null:(this.root=this.splayMin(e),this.root)}_last(){let e=this.root;return e==null?null:(this.root=this.splayMax(e),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(e){return this.validKey(e)&&this.splay(e)==0}defaultCompare(){return(e,t)=>e<t?-1:e>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:e=>{this.root=e},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:e=>{this.splayCount=e},splay:e=>this.splay(e),has:e=>this.has(e)}}},nn=class Mr extends Ns{root=null;compare;validKey;constructor(t,i){super(),this.compare=t??this.defaultCompare(),this.validKey=i??(r=>r!=null&&r!=null)}delete(t){return this.validKey(t)?this._delete(t)!=null:!1}deleteAll(t){for(let i of t)this.delete(i)}forEach(t){let i=this[Symbol.iterator](),r;for(;r=i.next(),!r.done;)t(r.value,r.value,this)}add(t){let i=this.splay(t);return i!=0&&this.addNewRoot(new yr(t),i),this}addAndReturn(t){let i=this.splay(t);return i!=0&&this.addNewRoot(new yr(t),i),this.root.key}addAll(t){for(let i of t)this.add(i)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let r=i.right;for(;r!=null;)i=r,r=i.right;return i.key}firstAfter(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let r=i.left;for(;r!=null;)i=r,r=i.left;return i.key}retainAll(t){let i=new Mr(this.compare,this.validKey),r=this.modificationCount;for(let n of t){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(n)&&this.splay(n)==0&&i.add(this.root.key)}i.size!=this.size&&(this.root=i.root,this.size=i.size,this.modificationCount++)}lookup(t){return!this.validKey(t)||this.splay(t)!=0?null:this.root.key}intersection(t){let i=new Mr(this.compare,this.validKey);for(let r of this)t.has(r)&&i.add(r);return i}difference(t){let i=new Mr(this.compare,this.validKey);for(let r of this)t.has(r)||i.add(r);return i}union(t){let i=this.clone();return i.addAll(t),i}clone(){let t=new Mr(this.compare,this.validKey);return t.size=this.size,t.root=this.copyNode(this.root),t}copyNode(t){if(t==null)return null;function i(n,a){let s,o;do{if(s=n.left,o=n.right,s!=null){let h=new yr(s.key);a.left=h,i(s,h)}if(o!=null){let h=new yr(o.key);a.right=h,n=o,a=h}}while(o!=null)}let r=new yr(t.key);return i(t,r),r}toSet(){return this.clone()}entries(){return new zs(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Gs(this.wrap())}[Symbol.toStringTag]="[object Set]"},Sa=class{tree;path=new Array;modificationCount=null;splayCount;constructor(e){this.tree=e,this.splayCount=e.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let e=this.path[this.path.length-1];return this.getValue(e)}rebuildPath(e){this.path.splice(0,this.path.length),this.tree.splay(e),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(e){for(;e!=null;)this.path.push(e),e=e.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let i=this.tree.getRoot();for(;i!=null;)this.path.push(i),i=i.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let e=this.path[this.path.length-1],t=e.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===e;)e=this.path.pop();return this.path.length>0}},Gs=class extends Sa{getValue(e){return e.key}},zs=class extends Sa{getValue(e){return[e.key,e.key]}},Us=e=>e,Hs=e=>{if(e){let t=new nn(ea(e)),i=new nn(ea(e)),r=(a,s)=>s.addAndReturn(a),n=a=>({x:r(a.x,t),y:r(a.y,i)});return n({x:new wt(0),y:new wt(0)}),n}return Us},na=e=>({set:t=>{Ut=na(t)},reset:()=>na(e),compare:ea(e),snap:Hs(e),orient:Fs(e)}),Ut=na(),_r=(e,t)=>e.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(e.ur.x)&&e.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(e.ur.y),aa=(e,t)=>{if(t.ur.x.isLessThan(e.ll.x)||e.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(e.ll.y)||e.ur.y.isLessThan(t.ll.y))return null;let i=e.ll.x.isLessThan(t.ll.x)?t.ll.x:e.ll.x,r=e.ur.x.isLessThan(t.ur.x)?e.ur.x:t.ur.x,n=e.ll.y.isLessThan(t.ll.y)?t.ll.y:e.ll.y,a=e.ur.y.isLessThan(t.ur.y)?e.ur.y:t.ur.y;return{ll:{x:i,y:n},ur:{x:r,y:a}}},an=(e,t)=>e.x.times(t.y).minus(e.y.times(t.x)),Da=(e,t)=>e.x.times(t.x).plus(e.y.times(t.y)),sn=e=>Da(e,e).sqrt(),Vs=(e,t,i)=>{let r={x:t.x.minus(e.x),y:t.y.minus(e.y)},n={x:i.x.minus(e.x),y:i.y.minus(e.y)};return an(n,r).div(sn(n)).div(sn(r))},Ks=(e,t,i)=>{let r={x:t.x.minus(e.x),y:t.y.minus(e.y)},n={x:i.x.minus(e.x),y:i.y.minus(e.y)};return Da(n,r).div(sn(n)).div(sn(r))},Aa=(e,t,i)=>t.y.isZero()?null:{x:e.x.plus(t.x.div(t.y).times(i.minus(e.y))),y:i},Pa=(e,t,i)=>t.x.isZero()?null:{x:i,y:e.y.plus(t.y.div(t.x).times(i.minus(e.x)))},Ws=(e,t,i,r)=>{if(t.x.isZero())return Pa(i,r,e.x);if(r.x.isZero())return Pa(e,t,i.x);if(t.y.isZero())return Aa(i,r,e.y);if(r.y.isZero())return Aa(e,t,i.y);let n=an(t,r);if(n.isZero())return null;let a={x:i.x.minus(e.x),y:i.y.minus(e.y)},s=an(a,t).div(n),o=an(a,r).div(n),h=e.x.plus(o.times(t.x)),c=i.x.plus(s.times(r.x)),x=e.y.plus(o.times(t.y)),y=i.y.plus(s.times(r.y)),T=h.plus(c).div(2),F=x.plus(y).div(2);return{x:T,y:F}},St=class Qa{point;isLeft;segment;otherSE;consumedBy;static compare(t,i){let r=Qa.comparePoints(t.point,i.point);return r!==0?r:(t.point!==i.point&&t.link(i),t.isLeft!==i.isLeft?t.isLeft?1:-1:on.compare(t.segment,i.segment))}static comparePoints(t,i){return t.x.isLessThan(i.x)?-1:t.x.isGreaterThan(i.x)?1:t.y.isLessThan(i.y)?-1:t.y.isGreaterThan(i.y)?1:0}constructor(t,i){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=i}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");let i=t.point.events;for(let r=0,n=i.length;r<n;r++){let a=i[r];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){let t=this.point.events.length;for(let i=0;i<t;i++){let r=this.point.events[i];if(r.segment.consumedBy===void 0)for(let n=i+1;n<t;n++){let a=this.point.events[n];a.consumedBy===void 0&&r.otherSE.point.events===a.otherSE.point.events&&r.segment.consume(a.segment)}}}getAvailableLinkedEvents(){let t=[];for(let i=0,r=this.point.events.length;i<r;i++){let n=this.point.events[i];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){let i=new Map,r=n=>{let a=n.otherSE;i.set(n,{sine:Vs(this.point,t.point,a.point),cosine:Ks(this.point,t.point,a.point)})};return(n,a)=>{i.has(n)||r(n),i.has(a)||r(a);let{sine:s,cosine:o}=i.get(n),{sine:h,cosine:c}=i.get(a);return s.isGreaterThanOrEqualTo(0)&&h.isGreaterThanOrEqualTo(0)?o.isLessThan(c)?1:o.isGreaterThan(c)?-1:0:s.isLessThan(0)&&h.isLessThan(0)?o.isLessThan(c)?-1:o.isGreaterThan(c)?1:0:h.isLessThan(s)?-1:h.isGreaterThan(s)?1:0}}},qs=0,on=class mn{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(t,i){let r=t.leftSE.point.x,n=i.leftSE.point.x,a=t.rightSE.point.x,s=i.rightSE.point.x;if(s.isLessThan(r))return 1;if(a.isLessThan(n))return-1;let o=t.leftSE.point.y,h=i.leftSE.point.y,c=t.rightSE.point.y,x=i.rightSE.point.y;if(r.isLessThan(n)){if(h.isLessThan(o)&&h.isLessThan(c))return 1;if(h.isGreaterThan(o)&&h.isGreaterThan(c))return-1;let y=t.comparePoint(i.leftSE.point);if(y<0)return 1;if(y>0)return-1;let T=i.comparePoint(t.rightSE.point);return T!==0?T:-1}if(r.isGreaterThan(n)){if(o.isLessThan(h)&&o.isLessThan(x))return-1;if(o.isGreaterThan(h)&&o.isGreaterThan(x))return 1;let y=i.comparePoint(t.leftSE.point);if(y!==0)return y;let T=t.comparePoint(i.rightSE.point);return T<0?1:T>0?-1:1}if(o.isLessThan(h))return-1;if(o.isGreaterThan(h))return 1;if(a.isLessThan(s)){let y=i.comparePoint(t.rightSE.point);if(y!==0)return y}if(a.isGreaterThan(s)){let y=t.comparePoint(i.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(!a.eq(s)){let y=c.minus(o),T=a.minus(r),F=x.minus(h),z=s.minus(n);if(y.isGreaterThan(T)&&F.isLessThan(z))return 1;if(y.isLessThan(T)&&F.isGreaterThan(z))return-1}return a.isGreaterThan(s)?1:a.isLessThan(s)||c.isLessThan(x)?-1:c.isGreaterThan(x)?1:t.id<i.id?-1:t.id>i.id?1:0}constructor(t,i,r,n){this.id=++qs,this.leftSE=t,t.segment=this,t.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=t,this.rings=r,this.windings=n}static fromRing(t,i,r){let n,a,s,o=St.comparePoints(t,i);if(o<0)n=t,a=i,s=1;else if(o>0)n=i,a=t,s=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);let h=new St(n,!0),c=new St(a,!1);return new mn(h,c,[r],[s])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let t=this.leftSE.point.y,i=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(i)?t:i},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(i)?t:i}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return Ut.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){let i=this.bbox(),r=t.bbox(),n=aa(i,r);if(n===null)return null;let a=this.leftSE.point,s=this.rightSE.point,o=t.leftSE.point,h=t.rightSE.point,c=_r(i,o)&&this.comparePoint(o)===0,x=_r(r,a)&&t.comparePoint(a)===0,y=_r(i,h)&&this.comparePoint(h)===0,T=_r(r,s)&&t.comparePoint(s)===0;if(x&&c)return T&&!y?s:!T&&y?h:null;if(x)return y&&a.x.eq(h.x)&&a.y.eq(h.y)?null:a;if(c)return T&&s.x.eq(o.x)&&s.y.eq(o.y)?null:o;if(T&&y)return null;if(T)return s;if(y)return h;let F=Ws(a,this.vector(),o,t.vector());return F===null||!_r(n,F)?null:Ut.snap(F)}split(t){let i=[],r=t.events!==void 0,n=new St(t,!0),a=new St(t,!1),s=this.rightSE;this.replaceRightSE(a),i.push(a),i.push(n);let o=new mn(n,s,this.rings.slice(),this.windings.slice());return St.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),St.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(n.checkForConsuming(),a.checkForConsuming()),i}swapEvents(){let t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let i=0,r=this.windings.length;i<r;i++)this.windings[i]*=-1}consume(t){let i=this,r=t;for(;i.consumedBy;)i=i.consumedBy;for(;r.consumedBy;)r=r.consumedBy;let n=mn.compare(i,r);if(n!==0){if(n>0){let a=i;i=r,r=a}if(i.prev===r){let a=i;i=r,r=a}for(let a=0,s=r.rings.length;a<s;a++){let o=r.rings[a],h=r.windings[a],c=i.rings.indexOf(o);c===-1?(i.rings.push(o),i.windings.push(h)):i.windings[c]+=h}r.rings=null,r.windings=null,r.consumedBy=i,r.leftSE.consumedBy=i.leftSE,r.rightSE.consumedBy=i.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};let i=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys;for(let o=0,h=this.rings.length;o<h;o++){let c=this.rings[o],x=this.windings[o],y=i.indexOf(c);y===-1?(i.push(c),r.push(x)):r[y]+=x}let a=[],s=[];for(let o=0,h=i.length;o<h;o++){if(r[o]===0)continue;let c=i[o],x=c.poly;if(s.indexOf(x)===-1)if(c.isExterior)a.push(x);else{s.indexOf(x)===-1&&s.push(x);let y=a.indexOf(c.poly);y!==-1&&a.splice(y,1)}}for(let o=0,h=a.length;o<h;o++){let c=a[o].multiPoly;n.indexOf(c)===-1&&n.push(c)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let t=this.beforeState().multiPolys,i=this.afterState().multiPolys;switch(ln.type){case"union":{let r=t.length===0,n=i.length===0;this._isInResult=r!==n;break}case"intersection":{let r,n;t.length<i.length?(r=t.length,n=i.length):(r=i.length,n=t.length),this._isInResult=n===ln.numMultiPolys&&r<n;break}case"xor":{let r=Math.abs(t.length-i.length);this._isInResult=r%2===1;break}case"difference":{let r=n=>n.length===1&&n[0].isSubject;this._isInResult=r(t)!==r(i);break}}return this._isInResult}},Ta=class{poly;isExterior;segments;bbox;constructor(e,t,i){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=i,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=Ut.snap({x:new wt(e[0][0]),y:new wt(e[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let n=r;for(let a=1,s=e.length;a<s;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let o=Ut.snap({x:new wt(e[a][0]),y:new wt(e[a][1])});o.x.eq(n.x)&&o.y.eq(n.y)||(this.segments.push(on.fromRing(n,o,this)),o.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=o.x),o.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=o.y),o.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=o.x),o.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=o.y),n=o)}(!r.x.eq(n.x)||!r.y.eq(n.y))&&this.segments.push(on.fromRing(n,r,this))}getSweepEvents(){let e=[];for(let t=0,i=this.segments.length;t<i;t++){let r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}},$s=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ta(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,r=e.length;i<r;i++){let n=new Ta(e[i],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){let e=this.exteriorRing.getSweepEvents();for(let t=0,i=this.interiorRings.length;t<i;t++){let r=this.interiorRings[t].getSweepEvents();for(let n=0,a=r.length;n<a;n++)e.push(r[n])}return e}},Ra=class{isSubject;polys;bbox;constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:new wt(Number.POSITIVE_INFINITY),y:new wt(Number.POSITIVE_INFINITY)},ur:{x:new wt(Number.NEGATIVE_INFINITY),y:new wt(Number.NEGATIVE_INFINITY)}};for(let i=0,r=e.length;i<r;i++){let n=new $s(e[i],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){let e=[];for(let t=0,i=this.polys.length;t<i;t++){let r=this.polys[t].getSweepEvents();for(let n=0,a=r.length;n<a;n++)e.push(r[n])}return e}},Ys=class fa{events;poly;_isExteriorRing;_enclosingRing;static factory(t){let i=[];for(let r=0,n=t.length;r<n;r++){let a=t[r];if(!a.isInResult()||a.ringOut)continue;let s=null,o=a.leftSE,h=a.rightSE,c=[o],x=o.point,y=[];for(;s=o,o=h,c.push(o),o.point!==x;)for(;;){let T=o.getAvailableLinkedEvents();if(T.length===0){let q=c[0].point,Y=c[c.length-1].point;throw new Error(`Unable to complete output ring starting at [${q.x}, ${q.y}]. Last matching segment found ends at [${Y.x}, ${Y.y}].`)}if(T.length===1){h=T[0].otherSE;break}let F=null;for(let q=0,Y=y.length;q<Y;q++)if(y[q].point===o.point){F=q;break}if(F!==null){let q=y.splice(F)[0],Y=c.splice(q.index);Y.unshift(Y[0].otherSE),i.push(new fa(Y.reverse()));continue}y.push({index:c.length,point:o.point});let z=o.getLeftmostComparator(s);h=T.sort(z)[0].otherSE;break}i.push(new fa(c))}return i}constructor(t){this.events=t;for(let i=0,r=t.length;i<r;i++)t[i].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point,i=[t];for(let c=1,x=this.events.length-1;c<x;c++){let y=this.events[c].point,T=this.events[c+1].point;Ut.orient(y,t,T)!==0&&(i.push(y),t=y)}if(i.length===1)return null;let r=i[0],n=i[1];Ut.orient(r,t,n)===0&&i.shift(),i.push(i[0]);let a=this.isExteriorRing()?1:-1,s=this.isExteriorRing()?0:i.length-1,o=this.isExteriorRing()?i.length:-1,h=[];for(let c=s;c!=o;c+=a)h.push([i[c].x.toNumber(),i[c].y.toNumber()]);return h}isExteriorRing(){if(this._isExteriorRing===void 0){let t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let n=1,a=this.events.length;n<a;n++){let s=this.events[n];St.compare(t,s)>0&&(t=s)}let i=t.segment.prevInResult(),r=i?i.prevInResult():null;for(;;){if(!i)return null;if(!r)return i.ringOut;if(r.ringOut!==i.ringOut)return r.ringOut?.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut?.enclosingRing();i=r.prevInResult(),r=i?i.prevInResult():null}}},Fa=class{exteriorRing;interiorRings;constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){let e=this.exteriorRing.getGeom();if(e===null)return null;let t=[e];for(let i=0,r=this.interiorRings.length;i<r;i++){let n=this.interiorRings[i].getGeom();n!==null&&t.push(n)}return t}},Xs=class{rings;polys;constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){let e=[];for(let t=0,i=this.polys.length;t<i;t++){let r=this.polys[t].getGeom();r!==null&&e.push(r)}return e}_composePolys(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];if(!n.poly)if(n.isExteriorRing())t.push(new Fa(n));else{let a=n.enclosingRing();a?.poly||t.push(new Fa(a)),a?.poly?.addInterior(n)}}return t}},Zs=class{queue;tree;segments;constructor(e,t=on.compare){this.queue=e,this.tree=new nn(t),this.segments=[]}process(e){let t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.delete(e.otherSE):this.tree.delete(t),i;e.isLeft&&this.tree.add(t);let r=t,n=t;do r=this.tree.lastBefore(r);while(r!=null&&r.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(e.isLeft){let a=null;if(r){let o=r.getIntersection(t);if(o!==null&&(t.isAnEndpoint(o)||(a=o),!r.isAnEndpoint(o))){let h=this._splitSafely(r,o);for(let c=0,x=h.length;c<x;c++)i.push(h[c])}}let s=null;if(n){let o=n.getIntersection(t);if(o!==null&&(t.isAnEndpoint(o)||(s=o),!n.isAnEndpoint(o))){let h=this._splitSafely(n,o);for(let c=0,x=h.length;c<x;c++)i.push(h[c])}}if(a!==null||s!==null){let o=null;a===null?o=s:s===null?o=a:o=St.comparePoints(a,s)<=0?a:s,this.queue.delete(t.rightSE),i.push(t.rightSE);let h=t.split(o);for(let c=0,x=h.length;c<x;c++)i.push(h[c])}i.length>0?(this.tree.delete(t),i.push(e)):(this.segments.push(t),t.prev=r)}else{if(r&&n){let a=r.getIntersection(n);if(a!==null){if(!r.isAnEndpoint(a)){let s=this._splitSafely(r,a);for(let o=0,h=s.length;o<h;o++)i.push(s[o])}if(!n.isAnEndpoint(a)){let s=this._splitSafely(n,a);for(let o=0,h=s.length;o<h;o++)i.push(s[o])}}}this.tree.delete(t)}return i}_splitSafely(e,t){this.tree.delete(e);let i=e.rightSE;this.queue.delete(i);let r=e.split(t);return r.push(i),e.consumedBy===void 0&&this.tree.add(e),r}},Js=class{type;numMultiPolys;run(e,t,i){br.type=e;let r=[new Ra(t,!0)];for(let h=0,c=i.length;h<c;h++)r.push(new Ra(i[h],!1));if(br.numMultiPolys=r.length,br.type==="difference"){let h=r[0],c=1;for(;c<r.length;)aa(r[c].bbox,h.bbox)!==null?c++:r.splice(c,1)}if(br.type==="intersection")for(let h=0,c=r.length;h<c;h++){let x=r[h];for(let y=h+1,T=r.length;y<T;y++)if(aa(x.bbox,r[y].bbox)===null)return[]}let n=new nn(St.compare);for(let h=0,c=r.length;h<c;h++){let x=r[h].getSweepEvents();for(let y=0,T=x.length;y<T;y++)n.add(x[y])}let a=new Zs(n),s=null;for(n.size!=0&&(s=n.first(),n.delete(s));s;){let h=a.process(s);for(let c=0,x=h.length;c<x;c++){let y=h[c];y.consumedBy===void 0&&n.add(y)}n.size!=0?(s=n.first(),n.delete(s)):s=null}Ut.reset();let o=Ys.factory(a.segments);return new Xs(o).getGeom()}},br=new Js,ln=br,Qs=(e,...t)=>ln.run("intersection",e,t),eo=(e,...t)=>ln.run("difference",e,t);Ut.set;function un(e){let t={type:"Feature"};return t.geometry=e,t}function hn(e){return e.type==="Feature"?e.geometry:e}function Oa(e){return e&&e.geometry&&e.geometry.coordinates?e.geometry.coordinates:e}function to(e){return un({type:"LineString",coordinates:e})}function io(e){return un({type:"MultiLineString",coordinates:e})}function ja(e){return un({type:"Polygon",coordinates:e})}function Ia(e){return un({type:"MultiPolygon",coordinates:e})}function ro(e,t){let i=hn(e),r=hn(t),n=Qs(i.coordinates,r.coordinates);return n.length===0?null:n.length===1?ja(n[0]):Ia(n)}function no(e,t){let i=hn(e),r=hn(t),n=eo(i.coordinates,r.coordinates);return n.length===0?null:n.length===1?ja(n[0]):Ia(n)}function Na(e){return Array.isArray(e)?1+Na(e[0]):-1}function ao(e){e instanceof L.Polyline&&(e=e.toGeoJSON(15));let t=Oa(e),i=Na(t),r=[];return i>1?t.forEach(n=>{r.push(to(n))}):r.push(e),r}function so(e){let t=[];return e.eachLayer(i=>{t.push(Oa(i.toGeoJSON(15)))}),io(t)}Be.Cut=Be.Polygon.extend({initialize(e){this._map=e,this._shape="Cut",this.toolbarButtonName="cutPolygon"},_finishShape(){if(this._editedLayers=[],!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=2)return;let t=L.polygon(e,this.options.pathOptions);t._latlngInfos=this._layer._latlngInfo,this.cut(t),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex,this._editedLayers.forEach(({layer:r,originalLayer:n})=>{this._fireCut(n,r,n),this._fireCut(this._map,r,n),n.pm._fireEdit()}),this._editedLayers=[];let i=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(i))},cut(e){let t=this._map._layers,i=e._latlngInfos||[];Object.keys(t).map(r=>t[r]).filter(r=>r.pm).filter(r=>!r._pmTempLayer).filter(r=>!L.PM.optIn&&!r.options.pmIgnore||L.PM.optIn&&r.options.pmIgnore===!1).filter(r=>r instanceof L.Polyline).filter(r=>r!==e).filter(r=>r.pm.options.allowCutting).filter(r=>this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0?this.options.layersToCut.indexOf(r)>-1:!0).filter(r=>!this._layerGroup.hasLayer(r)).filter(r=>{try{let n=!!pi(e.toGeoJSON(15),r.toGeoJSON(15)).features.length>0;return n||r instanceof L.Polyline&&!(r instanceof L.Polygon)?n:!!ro(e.toGeoJSON(15),r.toGeoJSON(15))}catch{return r instanceof L.Polygon&&console.error("You can't cut polygons with self-intersections"),!1}}).forEach(r=>{let n;if(r instanceof L.Polygon){n=L.polygon(r.getLatLngs());let h=n.getLatLngs();i.forEach(c=>{if(c&&c.snapInfo){let{latlng:x}=c,y=this._calcClosestLayer(x,[n]);if(y&&y.segment&&y.distance<this.options.snapDistance){let{segment:T}=y;if(T&&T.length===2){let{indexPath:F,parentPath:z,newIndex:q}=L.PM.Utils._getIndexFromSegment(h,T);(F.length>1?(0,Rs.default)(h,z):h).splice(q,0,x)}}}})}else n=r;let a=this._cutLayer(e,n),s=L.geoJSON(a,r.options);s.getLayers().length===1&&([s]=s.getLayers()),this._setPane(s,"layerPane");let o=s.addTo(this._map.pm._getContainingLayer());if(o.pm.enable(r.pm.options),o.pm.disable(),r._pmTempLayer=!0,e._pmTempLayer=!0,r.remove(),r.removeFrom(this._map.pm._getContainingLayer()),e.remove(),e.removeFrom(this._map.pm._getContainingLayer()),o.getLayers&&o.getLayers().length===0&&this._map.pm.removeLayer({target:o}),o instanceof L.LayerGroup?(o.eachLayer(h=>{this._addDrawnLayerProp(h)}),this._addDrawnLayerProp(o)):this._addDrawnLayerProp(o),this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0){let h=this.options.layersToCut.indexOf(r);h>-1&&this.options.layersToCut.splice(h,1)}this._editedLayers.push({layer:o,originalLayer:r})})},_cutLayer(e,t){let i=L.geoJSON(),r;if(t instanceof L.Polygon)r=no(t.toGeoJSON(15),e.toGeoJSON(15));else{let n=ao(t);n.forEach(a=>{let s=vs(a,e.toGeoJSON(15)),o;s&&s.features.length>0?o=L.geoJSON(s):o=L.geoJSON(a),o.getLayers().forEach(h=>{Ms(e.toGeoJSON(15),h.toGeoJSON(15))||h.addTo(i)})}),n.length>1?r=so(i):r=i.toGeoJSON(15)}return r},_change:L.Util.falseFn}),Be.Text=Be.extend({initialize(e){this._map=e,this._shape="Text",this.toolbarButtonName="drawText"},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(ae("tooltips.placeText"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this._map.getContainer().classList.add("geoman-draw-cursor"),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.off("click",this._createMarker,this),this._hintMarker?.remove(),this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("mousemove",this._syncHintMarker,this),this._map.off("mousemove",this._showHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let t=e;t.target=this._hintMarker,this._handleSnapping(t)}},_createMarker(e){if(!e.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng();if(this.textArea=this._createTextArea(),this.options.textOptions?.className){let n=this.options.textOptions.className.split(" ");this.textArea.classList.add(...n)}let i=this._createTextIcon(this.textArea),r=new L.Marker(t,{textMarker:!0,_textMarkerOverPM:!0,icon:i});if(this._setPane(r,"markerPane"),this._finishLayer(r),r.pm||(r.options.draggable=!1),r.addTo(this._map.pm._getContainingLayer()),r.pm){r.pm.textArea=this.textArea,L.setOptions(r.pm,{removeIfEmpty:this.options.textOptions?.removeIfEmpty??!0});let n=this.options.textOptions?.focusAfterDraw??!0;r.pm._createTextMarker(n),this.options.textOptions?.text&&r.pm.setText(this.options.textOptions.text)}this._fireCreate(r),this._cleanupSnapping(),this.disable(),this.options.continueDrawing&&this._map.once("mousemove",this._showHintMarkerAfterMoving,this)},_showHintMarkerAfterMoving(e){this.enable(),this._hintMarker.setLatLng(e.latlng)},_createTextArea(){let e=document.createElement("textarea");return e.readOnly=!0,e.classList.add("pm-textarea","pm-disabled"),e},_createTextIcon(e){return L.divIcon({className:"pm-text-marker",html:e})}});var oo={enableLayerDrag(){if(!this.options.draggable||!this._layer._map)return;this.disable(),this._layerDragEnabled=!0,this._map||(this._map=this._layer._map),(this._layer instanceof L.Marker||this._layer instanceof L.ImageOverlay)&&L.DomEvent.on(this._getDOMElem(),"dragstart",this._stopDOMImageDrag),this._layer.dragging&&this._layer.dragging.disable(),this._tempDragCoord=null,Zt(this._layer)instanceof L.Canvas?(this._layer.on("mouseout",this.removeDraggingClass,this),this._layer.on("mouseover",this.addDraggingClass,this)):this.addDraggingClass(),this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!0;let e=this._getDOMElem();e&&(Zt(this._layer)instanceof L.Canvas?(this._layer.on("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._addTouchEvents(e)):L.DomEvent.on(e,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._fireDragEnable()},disableLayerDrag(){this._layerDragEnabled=!1,Zt(this._layer)instanceof L.Canvas?(this._layer.off("mouseout",this.removeDraggingClass,this),this._layer.off("mouseover",this.addDraggingClass,this)):this.removeDraggingClass(),this._originalMapDragState&&this._dragging&&this._map.dragging.enable(),this._safeToCacheDragState=!1,this._layer.dragging&&this._layer.dragging.disable();let e=this._getDOMElem();e&&(Zt(this._layer)instanceof L.Canvas?(this._layer.off("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._removeTouchEvents(e)):L.DomEvent.off(e,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._layerDragged&&this._fireUpdate(),this._layerDragged=!1,this._fireDragDisable()},dragging(){return this._dragging},layerDragEnabled(){return!!this._layerDragEnabled},_simulateMouseDownEvent(e){let t=e.touches?e.touches[0]:e,i={originalEvent:t,target:this._layer};return i.containerPoint=this._map.mouseEventToContainerPoint(t),i.latlng=this._map.containerPointToLatLng(i.containerPoint),this._dragMixinOnMouseDown(i),!1},_simulateMouseMoveEvent(e){let t=e.touches?e.touches[0]:e,i={originalEvent:t,target:this._layer};return i.containerPoint=this._map.mouseEventToContainerPoint(t),i.latlng=this._map.containerPointToLatLng(i.containerPoint),this._dragMixinOnMouseMove(i),!1},_simulateMouseUpEvent(e){let t={originalEvent:e.touches?e.touches[0]:e,target:this._layer};return e.type.indexOf("touch")===-1&&(t.containerPoint=this._map.mouseEventToContainerPoint(e),t.latlng=this._map.containerPointToLatLng(t.containerPoint)),this._dragMixinOnMouseUp(t),!1},_dragMixinOnMouseDown(e){if(e.originalEvent.button>0)return;this._overwriteEventIfItComesFromMarker(e);let t=e._fromLayerSync,i=this._syncLayers("_dragMixinOnMouseDown",e);if(this._layer instanceof L.Marker&&(this.options.snappable&&!t&&!i?this._initSnappableMarkers():this._disableSnapping()),this._layer instanceof L.CircleMarker){let r="resizeableCircleMarker";this._layer instanceof L.Circle&&(r="resizeableCircle"),this.options.snappable&&!t&&!i?this._layer.pm.options[r]||this._initSnappableMarkersDrag():this._layer.pm.options[r]?this._layer.pm._disableSnapping():this._layer.pm._disableSnappingDrag()}this._safeToCacheDragState&&(this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!1),this._tempDragCoord=e.latlng,L.DomEvent.on(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),L.DomEvent.on(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this)},_dragMixinOnMouseMove(e){this._overwriteEventIfItComesFromMarker(e);let t=this._getDOMElem();this._syncLayers("_dragMixinOnMouseMove",e),this._dragging||(this._dragging=!0,L.DomUtil.addClass(t,"leaflet-pm-dragging"),this._layer instanceof L.Marker||this._layer.bringToFront(),this._originalMapDragState&&this._map.dragging.disable(),this._fireDragStart()),this._tempDragCoord||(this._tempDragCoord=e.latlng),this._onLayerDrag(e),this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle()},_dragMixinOnMouseUp(e){let t=this._getDOMElem();return this._syncLayers("_dragMixinOnMouseUp",e),this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0,L.DomEvent.off(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this),L.DomEvent.off(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),this._dragging?(this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle(),this._layerDragged=!0,window.setTimeout(()=>{this._dragging=!1,t&&L.DomUtil.removeClass(t,"leaflet-pm-dragging"),this._fireDragEnd(),this._fireEdit(),this._layerEdited=!0},10),!0):!1},_onLayerDrag(e){let{latlng:t}=e,i={lat:t.lat-this._tempDragCoord.lat,lng:t.lng-this._tempDragCoord.lng},r=n=>n.map(a=>{if(Array.isArray(a))return r(a);let s={lat:a.lat+i.lat,lng:a.lng+i.lng};return(a.alt||a.alt===0)&&(s.alt=a.alt),s});if(this._layer instanceof L.Circle&&this._layer.options.resizeableCircle||this._layer instanceof L.CircleMarker&&this._layer.options.resizeableCircleMarker){let n=r([this._layer.getLatLng()]);this._layer.setLatLng(n[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.CircleMarker||this._layer instanceof L.Marker){let n=this._layer.getLatLng();this._layer._snapped&&(n=this._layer._orgLatLng);let a=r([n]);this._layer.setLatLng(a[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.ImageOverlay){let n=r([this._layer.getBounds().getNorthWest(),this._layer.getBounds().getSouthEast()]);this._layer.setBounds(n),this._fireChange(this._layer.getBounds(),"Edit")}else{let n=r(this._layer.getLatLngs());this._layer.setLatLngs(n),this._fireChange(this._layer.getLatLngs(),"Edit")}this._tempDragCoord=t,e.layer=this._layer,this._fireDrag(e)},addDraggingClass(){let e=this._getDOMElem();e&&L.DomUtil.addClass(e,"leaflet-pm-draggable")},removeDraggingClass(){let e=this._getDOMElem();e&&L.DomUtil.removeClass(e,"leaflet-pm-draggable")},_getDOMElem(){let e=null;return this._layer._path?e=this._layer._path:this._layer._renderer&&this._layer._renderer._container?e=this._layer._renderer._container:this._layer._image?e=this._layer._image:this._layer._icon&&(e=this._layer._icon),e},_overwriteEventIfItComesFromMarker(e){e.target.getLatLng&&(!e.target._radius||e.target._radius<=10)&&(e.containerPoint=this._map.mouseEventToContainerPoint(e.originalEvent),e.latlng=this._map.containerPointToLatLng(e.containerPoint))},_syncLayers(e,t){if(this.enabled())return!1;if(!t._fromLayerSync&&this._layer===t.target&&this.options.syncLayersOnDrag){t._fromLayerSync=!0;let i=[];if(L.Util.isArray(this.options.syncLayersOnDrag))i=this.options.syncLayersOnDrag,this.options.syncLayersOnDrag.forEach(r=>{r instanceof L.LayerGroup&&(i=i.concat(r.pm.getLayers(!0)))});else if(this.options.syncLayersOnDrag===!0&&this._parentLayerGroup)for(let r in this._parentLayerGroup){let n=this._parentLayerGroup[r];n.pm&&(i=n.pm.getLayers(!0))}return L.Util.isArray(i)&&i.length>0&&(i=i.filter(r=>!!r.pm).filter(r=>!!r.pm.options.draggable),i.forEach(r=>{r!==this._layer&&r.pm[e]&&(r._snapped=!1,r.pm[e](t))})),i.length>0}return!1},_stopDOMImageDrag(e){return e.preventDefault(),!1}},lo=oo,uo=Oe(li());function ho(e,t,i,r){return i.unproject(t.transform(i.project(e,r)),r)}function Ga(e,t,i){let r=i.getMaxZoom();if(r===1/0&&(r=i.getZoom()),L.Util.isArray(e)){let n=[];return e.forEach(a=>{n.push(Ga(a,t,i))}),n}return e instanceof L.LatLng?ho(e,t,i,r):null}function Hi(e,t){t instanceof L.Layer&&(t=t.getLatLng());let i=e.getMaxZoom();return i===1/0&&(i=e.getZoom()),e.project(t,i)}function cn(e,t){let i=e.getMaxZoom();return i===1/0&&(i=e.getZoom()),e.unproject(t,i)}var co={_onRotateStart(e){this._preventRenderingMarkers(!0),this._rotationOriginLatLng=this._getRotationCenter().clone(),this._rotationOriginPoint=Hi(this._map,this._rotationOriginLatLng),this._rotationStartPoint=Hi(this._map,e.target.getLatLng()),this._initialRotateLatLng=rt(this._layer),this._startAngle=this.getAngle();let t=rt(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._fireRotationStart(this._rotationLayer,t),this._fireRotationStart(this._map,t)},_onRotate(e){let t=Hi(this._map,e.target.getLatLng()),i=this._rotationStartPoint,r=this._rotationOriginPoint,n=Math.atan2(t.y-r.y,t.x-r.x)-Math.atan2(i.y-r.y,i.x-r.x);this._layer.setLatLngs(this._rotateLayer(n,this._initialRotateLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let a=this;function s(x,y=[],T=-1){if(T>-1&&y.push(T),L.Util.isArray(x[0]))x.forEach((F,z)=>s(F,y.slice(),z));else{let F=y.length>0?(0,uo.default)(a._markers,y):a._markers[0];x.forEach((z,q)=>{F[q].setLatLng(z)})}}s(this._layer.getLatLngs());let o=rt(this._rotationLayer);this._rotationLayer.setLatLngs(this._rotateLayer(n,this._rotationLayer.pm._rotateOrgLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let h=n*180/Math.PI;h=h<0?h+360:h;let c=h+this._startAngle;this._setAngle(c),this._rotationLayer.pm._setAngle(c),this._fireRotation(this._rotationLayer,h,o),this._fireRotation(this._map,h,o),this._rotationLayer.pm._fireChange(this._rotationLayer.getLatLngs(),"Rotation")},_onRotateEnd(){let e=this._startAngle;delete this._rotationOriginLatLng,delete this._rotationOriginPoint,delete this._rotationStartPoint,delete this._initialRotateLatLng,delete this._startAngle;let t=rt(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._rotationLayer.pm._rotateOrgLatLng=rt(this._rotationLayer),this._fireRotationEnd(this._rotationLayer,e,t),this._fireRotationEnd(this._map,e,t),this._rotationLayer.pm._fireEdit(this._rotationLayer,"Rotation"),this._preventRenderingMarkers(!1),this._layerRotated=!0},_rotateLayer(e,t,i,r,n){let a=Hi(n,i);return this._matrix=r.clone().rotate(e,a).flip(),Ga(t,this._matrix,n)},_setAngle(e){e=e<0?e+360:e,this._angle=e%360},_getRotationCenter(){if(this._rotationCenter)return this._rotationCenter;let e=L.polygon(this._layer.getLatLngs(),{stroke:!1,fill:!1,pmIgnore:!0}).addTo(this._layer._map),t=e.getCenter();return e.removeFrom(this._layer._map),t},enableRotate(){if(!this.options.allowRotation){this.disableRotate();return}this.rotateEnabled()&&this.disableRotate(),this._layer instanceof L.Rectangle&&this._angle===void 0&&this.setInitAngle(dr(this._layer._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let e={fill:!1,stroke:!1,pmIgnore:!1,snapIgnore:!0};this._rotatePoly=L.polygon(this._layer.getLatLngs(),e),this._rotatePoly._pmTempLayer=!0,this._rotatePoly.addTo(this._layer._map),this._rotatePoly.pm._setAngle(this.getAngle()),this._rotatePoly.pm.setRotationCenter(this.getRotationCenter()),this._rotatePoly.pm.setOptions(this._layer._map.pm.getGlobalOptions()),this._rotatePoly.pm.setOptions({rotate:!0,snappable:!1,hideMiddleMarkers:!0}),this._rotatePoly.pm._rotationLayer=this._layer,this._rotatePoly.pm.enable(),this._rotateOrgLatLng=rt(this._layer),this._rotateEnabled=!0,this._layer.on("remove",this.disableRotate,this),this._fireRotationEnable(this._layer),this._fireRotationEnable(this._layer._map)},disableRotate(){this.rotateEnabled()&&(this._rotatePoly.pm._layerRotated&&this._fireUpdate(),this._rotatePoly.pm._layerRotated=!1,this._rotatePoly.pm.disable(),this._rotatePoly.remove(),this._rotatePoly.pm.setOptions({rotate:!1}),this._rotatePoly=void 0,this._rotateOrgLatLng=void 0,this._layer.off("remove",this.disableRotate,this),this._rotateEnabled=!1,this._fireRotationDisable(this._layer),this._fireRotationDisable(this._layer._map))},rotateEnabled(){return!!this._rotateEnabled},rotateLayer(e){let t=this.getAngle(),i=this._layer.getLatLngs(),r=e*(Math.PI/180);this._layer.setLatLngs(this._rotateLayer(r,this._layer.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._layer._map)),this._rotateOrgLatLng=L.polygon(this._layer.getLatLngs()).getLatLngs(),this._setAngle(this.getAngle()+e),this.rotateEnabled()&&this._rotatePoly&&this._rotatePoly.pm.enabled()&&(this._rotatePoly.setLatLngs(this._rotateLayer(r,this._rotatePoly.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._rotatePoly._map)),this._rotatePoly.pm._initMarkers());let n=this.getAngle()-t;n=n<0?n+360:n,this._startAngle=t,this._fireRotation(this._layer,n,i,this._layer),this._fireRotation(this._map||this._layer._map,n,i,this._layer),delete this._startAngle,this._fireChange(this._layer.getLatLngs(),"Rotation")},rotateLayerToAngle(e){let t=e-this.getAngle();this.rotateLayer(t)},getAngle(){return this._angle||0},setInitAngle(e){this._setAngle(e)},getRotationCenter(){return this._getRotationCenter()},setRotationCenter(e){this._rotationCenter=e,this._rotatePoly&&this._rotatePoly.pm.setRotationCenter(e)}},po=co,fo=L.Class.extend({includes:[lo,Jr,po,Gi],options:{snappable:!0,snapDistance:20,allowSelfIntersection:!0,allowSelfIntersectionEdit:!1,preventMarkerRemoval:!1,removeLayerBelowMinVertexCount:!0,limitMarkersToCount:-1,hideMiddleMarkers:!1,snapSegment:!0,syncLayersOnDrag:!1,draggable:!0,allowEditing:!0,allowRemoval:!0,allowCutting:!0,allowRotation:!0,addVertexOn:"click",removeVertexOn:"contextmenu",removeVertexValidation:void 0,addVertexValidation:void 0,moveVertexValidation:void 0,resizeableCircleMarker:!1,resizeableCircle:!0,snapMiddle:!1,snapVertex:!0},setOptions(e){L.Util.setOptions(this,e)},getOptions(){return this.options},applyOptions(){},isPolygon(){return this._layer instanceof L.Polygon},getShape(){return this._shape},_setPane(e,t){t==="layerPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":t==="vertexPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":t==="markerPane"&&(e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},remove(){(this._map||this._layer._map).pm.removeLayer({target:this._layer})},_vertexValidation(e,t){let i=t.target,r={layer:this._layer,marker:i,event:t},n="";return e==="move"?n="moveVertexValidation":e==="add"?n="addVertexValidation":e==="remove"&&(n="removeVertexValidation"),this.options[n]&&typeof this.options[n]=="function"&&!this.options[n](r)?(e==="move"&&(i._cancelDragEventChain=i.getLatLng()),!1):(i._cancelDragEventChain=null,!0)},_vertexValidationDrag(e){return e._cancelDragEventChain?(e._latlng=e._cancelDragEventChain,e.update(),!1):!0},_vertexValidationDragEnd(e){return e._cancelDragEventChain?(e._cancelDragEventChain=null,!1):!0}}),Fe=fo;Fe.LayerGroup=L.Class.extend({initialize(e){this._layerGroup=e,this._layers=this.getLayers(),this._getMap(),this._layers.forEach(r=>this._initLayer(r));let t=r=>{if(r.layer._pmTempLayer)return;this._layers=this.getLayers();let n=this._layers.filter(a=>!a.pm._parentLayerGroup||!(this._layerGroup._leaflet_id in a.pm._parentLayerGroup));n.forEach(a=>{this._initLayer(a)}),n.length>0&&this._getMap()&&this._getMap().pm.globalEditModeEnabled()&&this.enabled()&&this.enable(this.getOptions())};this._layerGroup.on("layeradd",L.Util.throttle(t,100,this),this),this._layerGroup.on("layerremove",r=>{this._removeLayerFromGroup(r.target)},this);let i=r=>{r.target._pmTempLayer||(this._layers=this.getLayers())};this._layerGroup.on("layerremove",L.Util.throttle(i,100,this),this)},enable(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this._options=e,this._layers.forEach(i=>{i instanceof L.LayerGroup?t.indexOf(i._leaflet_id)===-1&&(t.push(i._leaflet_id),i.pm.enable(e,t)):i.pm.enable(e)})},disable(e=[]){e.length===0&&(this._layers=this.getLayers()),this._layers.forEach(t=>{t instanceof L.LayerGroup?e.indexOf(t._leaflet_id)===-1&&(e.push(t._leaflet_id),t.pm.disable(e)):t.pm.disable()})},enabled(e=[]){return e.length===0&&(this._layers=this.getLayers()),!!this._layers.find(t=>t instanceof L.LayerGroup?e.indexOf(t._leaflet_id)===-1?(e.push(t._leaflet_id),t.pm.enabled(e)):!1:t.pm.enabled())},toggleEdit(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this._options=e,this._layers.forEach(i=>{i instanceof L.LayerGroup?t.indexOf(i._leaflet_id)===-1&&(t.push(i._leaflet_id),i.pm.toggleEdit(e,t)):i.pm.toggleEdit(e)})},_initLayer(e){let t=L.Util.stamp(this._layerGroup);e.pm._parentLayerGroup||(e.pm._parentLayerGroup={}),e.pm._parentLayerGroup[t]=this._layerGroup},_removeLayerFromGroup(e){if(e.pm&&e.pm._layerGroup){let t=L.Util.stamp(this._layerGroup);delete e.pm._layerGroup[t]}},dragging(){return this._layers=this.getLayers(),this._layers?!!this._layers.find(e=>e.pm.dragging()):!1},getOptions(){return this.options},_getMap(){return this._map||this._layers.find(e=>!!e._map)?._map||null},getLayers(e=!1,t=!0,i=!0,r=[]){let n=[];return e?this._layerGroup.getLayers().forEach(a=>{n.push(a),a instanceof L.LayerGroup&&r.indexOf(a._leaflet_id)===-1&&(r.push(a._leaflet_id),n=n.concat(a.pm.getLayers(!0,!0,!0,r)))}):n=this._layerGroup.getLayers(),i&&(n=n.filter(a=>!(a instanceof L.LayerGroup))),t&&(n=n.filter(a=>!!a.pm),n=n.filter(a=>!a._pmTempLayer),n=n.filter(a=>!L.PM.optIn&&!a.options.pmIgnore||L.PM.optIn&&a.options.pmIgnore===!1)),n},setOptions(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this.options=e,this._layers.forEach(i=>{i.pm&&(i instanceof L.LayerGroup?t.indexOf(i._leaflet_id)===-1&&(t.push(i._leaflet_id),i.pm.setOptions(e,t)):i.pm.setOptions(e))})}}),Fe.Marker=Fe.extend({_shape:"Marker",initialize(e){this._layer=e,this._enabled=!1,this._layer.on("dragend",this._onDragEnd,this)},enable(e={draggable:!0}){if(L.Util.setOptions(this,e),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._fireEnable()},disable(){this.enabled()&&(this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this._layer.off("contextmenu",this._removeMarker,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1)},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this.options.draggable?this.enableLayerDrag():this.disableLayerDrag(),this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_removeMarker(e){let t=e.target;t.remove(),this._fireRemove(t),this._fireRemove(this._map,t)},_onDragEnd(){this._fireEdit(),this._layerEdited=!0},_initSnappableMarkers(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)}});var Qt=Oe(li()),go={filterMarkerGroup(){this.markerCache=[],this.createCache(),this._layer.on("pm:edit",this.createCache,this),this.applyLimitFilters({}),this.throttledApplyLimitFilters||(this.throttledApplyLimitFilters=L.Util.throttle(this.applyLimitFilters,100,this)),this._layer.on("pm:disable",this._removeMarkerLimitEvents,this),this._layer.on("remove",this._removeMarkerLimitEvents,this),this.options.limitMarkersToCount>-1&&(this._layer.on("pm:vertexremoved",this._initMarkers,this),this._map.on("mousemove",this.throttledApplyLimitFilters,this))},_removeMarkerLimitEvents(){this._map.off("mousemove",this.throttledApplyLimitFilters,this),this._layer.off("pm:edit",this.createCache,this),this._layer.off("pm:disable",this._removeMarkerLimitEvents,this),this._layer.off("pm:vertexremoved",this._initMarkers,this)},createCache(){let e=[...this._markerGroup.getLayers(),...this.markerCache];this.markerCache=e.filter((t,i,r)=>r.indexOf(t)===i)},_removeFromCache(e){let t=this.markerCache.indexOf(e);t>-1&&this.markerCache.splice(t,1)},renderLimits(e){this.markerCache.forEach(t=>{e.includes(t)?this._markerGroup.addLayer(t):this._markerGroup.removeLayer(t)})},applyLimitFilters({latlng:e={lat:0,lng:0}}){if(this._preventRenderMarkers)return;let t=[...this._filterClosestMarkers(e)];this.renderLimits(t)},_filterClosestMarkers(e){let t=[...this.markerCache],i=this.options.limitMarkersToCount;return i===-1?t:(t.sort((r,n)=>{let a=r._latlng.distanceTo(e),s=n._latlng.distanceTo(e);return a-s}),t.filter((r,n)=>i>-1?n<i:!0))},_preventRenderMarkers:!1,_preventRenderingMarkers(e){this._preventRenderMarkers=!!e}},mo=go;Fe.Line=Fe.extend({includes:[mo],_shape:"Line",initialize(e){this._layer=e,this._enabled=!1},enable(e){if(L.Util.setOptions(this,e),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()&&this.disable(),this._enabled=!0,this._initMarkers(),this.applyOptions(),this._layer.on("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.on("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this),this.options.allowSelfIntersection?this.cachedColor=void 0:(this._layer.options.color!=="#f00000ff"?(this.cachedColor=this._layer.options.color,this.isRed=!1):this.isRed=!0,this._handleLayerStyle()),this._fireEnable()}},disable(){if(!this.enabled()||this._dragging)return;this._enabled=!1,this._markerGroup.clearLayers(),this._markerGroup.removeFrom(this._map),this._layer.off("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.off("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this);let e=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(e,"leaflet-pm-draggable"),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()},enabled(){return this._enabled},toggleEdit(e){return this.enabled()?this.disable():this.enable(e),this.enabled()},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initMarkers(){let e=this._map,t=this._layer.getLatLngs();this._markerGroup&&(this._markerGroup.removeFrom(e),this._markerGroup.clearLayers()),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0;let i=r=>{if(Array.isArray(r[0]))return r.map(i,this);let n=r.map(this._createMarker,this);return this.options.hideMiddleMarkers!==!0&&r.map((a,s)=>{let o=this.isPolygon()?(s+1)%r.length:s+1;return this._createMiddleMarker(n[s],n[o])}),n};this._markers=i(t),this.filterMarkerGroup(),e.addLayer(this._markerGroup)},_createMarker(e){let t=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this.options.rotate?(t.on("dragstart",this._onRotateStart,this),t.on("drag",this._onRotate,this),t.on("dragend",this._onRotateEnd,this)):(t.on("click",this._onVertexClick,this),t.on("dragstart",this._onMarkerDragStart,this),t.on("move",this._onMarkerDrag,this),t.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||t.on(this.options.removeVertexOn,this._removeMarker,this)),this._markerGroup.addLayer(t),t},_createMiddleMarker(e,t){if(!e||!t)return!1;let i=L.PM.Utils.calcMiddleLatLng(this._map,e.getLatLng(),t.getLatLng()),r=this._createMarker(i),n=L.divIcon({className:"marker-icon marker-icon-middle"});return r.setIcon(n),r.leftM=e,r.rightM=t,e._middleMarkerNext=r,t._middleMarkerPrev=r,r.on(this.options.addVertexOn,this._onMiddleMarkerClick,this),r.on("movestart",this._onMiddleMarkerMoveStart,this),r},_onMiddleMarkerClick(e){let t=e.target;if(!this._vertexValidation("add",e))return;let i=L.divIcon({className:"marker-icon"});t.setIcon(i),this._addMarker(t,t.leftM,t.rightM)},_onMiddleMarkerMoveStart(e){let t=e.target;if(t.on("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidation("add",e)){t.on("move",this._onMiddleMarkerMovePrevent,this);return}t._dragging=!0,this._addMarker(t,t.leftM,t.rightM)},_onMiddleMarkerMovePrevent(e){let t=e.target;this._vertexValidationDrag(t)},_onMiddleMarkerMoveEnd(e){let t=e.target;if(t.off("move",this._onMiddleMarkerMovePrevent,this),t.off("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidationDragEnd(t))return;let i=L.divIcon({className:"marker-icon"});t.setIcon(i),setTimeout(()=>{delete t._dragging},100)},_addMarker(e,t,i){e.off("movestart",this._onMiddleMarkerMoveStart,this),e.off(this.options.addVertexOn,this._onMiddleMarkerClick,this);let r=e.getLatLng(),n=this._layer._latlngs;delete e.leftM,delete e.rightM;let{indexPath:a,index:s,parentPath:o}=L.PM.Utils.findDeepMarkerIndex(this._markers,t),h=a.length>1?(0,Qt.default)(n,o):n,c=a.length>1?(0,Qt.default)(this._markers,o):this._markers;h.splice(s+1,0,r),c.splice(s+1,0,e),this._layer.setLatLngs(n),this.options.hideMiddleMarkers!==!0&&(this._createMiddleMarker(t,e),this._createMiddleMarker(e,i)),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit"),this._fireVertexAdded(e,L.PM.Utils.findDeepMarkerIndex(this._markers,e).indexPath,r),this.options.snappable&&this._initSnappableMarkers()},hasSelfIntersection(){return se(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersectionOnVertexRemoval(){this._handleLayerStyle(!0)&&(this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers())},_handleLayerStyle(e){let t=this._layer,i,r;if(this.options.allowSelfIntersection?i=!1:(r=se(this._layer.toGeoJSON(15)),i=r.features.length>0),i){if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!0),this.isRed)return i;e?this._flashLayer():(t.setStyle({color:"#f00000ff"}),this.isRed=!0),this._fireIntersect(r)}else t.setStyle({color:this.cachedColor}),this.isRed=!1,!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!1);return i},_flashLayer(){this.cachedColor||(this.cachedColor=this._layer.options.color),this._layer.setStyle({color:"#f00000ff"}),this.isRed=!0,window.setTimeout(()=>{this._layer.setStyle({color:this.cachedColor}),this.isRed=!1},200)},_updateDisabledMarkerStyle(e,t){e.forEach(i=>{Array.isArray(i)?this._updateDisabledMarkerStyle(i,t):i._icon&&(t&&!this._checkMarkerAllowedToDrag(i)?L.DomUtil.addClass(i._icon,"vertexmarker-disabled"):L.DomUtil.removeClass(i._icon,"vertexmarker-disabled"))})},_removeMarker(e){let t=e.target;if(!this._vertexValidation("remove",e))return;this.options.allowSelfIntersection||(this._coordsBeforeEdit=rt(this._layer,this._layer.getLatLngs()));let i=this._layer.getLatLngs(),{indexPath:r,index:n,parentPath:a}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);if(!r)return;let s=r.length>1?(0,Qt.default)(i,a):i,o=r.length>1?(0,Qt.default)(this._markers,a):this._markers,h=a[a.length-1]>0&&this._layer instanceof L.Polygon;if(!this.options.removeLayerBelowMinVertexCount&&!h&&(s.length<=2||this.isPolygon()&&s.length<=3)){this._flashLayer();return}s.splice(n,1),this._layer.setLatLngs(i),this.isPolygon()&&s.length<=2&&s.splice(0,s.length);let c=!1;if(s.length<=1&&(s.splice(0,s.length),a.length>1&&r.length>1&&(i=zi(i)),this._layer.setLatLngs(i),this._initMarkers(),c=!0),Et(i)||this._layer.remove(),i=zi(i),this._layer.setLatLngs(i),this._markers=zi(this._markers),!c&&(o=r.length>1?(0,Qt.default)(this._markers,a):this._markers,t._middleMarkerPrev&&(this._markerGroup.removeLayer(t._middleMarkerPrev),this._removeFromCache(t._middleMarkerPrev)),t._middleMarkerNext&&(this._markerGroup.removeLayer(t._middleMarkerNext),this._removeFromCache(t._middleMarkerNext)),this._markerGroup.removeLayer(t),this._removeFromCache(t),o)){let x,y;if(this.isPolygon()?(x=(n+1)%o.length,y=(n+(o.length-1))%o.length):(y=n-1<0?void 0:n-1,x=n+1>=o.length?void 0:n+1),x!==y){let T=o[y],F=o[x];this.options.hideMiddleMarkers!==!0&&this._createMiddleMarker(T,F)}o.splice(n,1)}this._fireEdit(),this._layerEdited=!0,this._fireVertexRemoved(t,r),this._fireChange(this._layer.getLatLngs(),"Edit")},updatePolygonCoordsFromMarkerDrag(e){let t=this._layer.getLatLngs(),i=e.getLatLng(),{indexPath:r,index:n,parentPath:a}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);(r.length>1?(0,Qt.default)(t,a):t).splice(n,1,i),this._layer.setLatLngs(t)},_getNeighborMarkers(e){let{indexPath:t,index:i,parentPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,e),n=t.length>1?(0,Qt.default)(this._markers,r):this._markers,a=(i+1)%n.length,s=(i+(n.length-1))%n.length,o=n[s],h=n[a];return{prevMarker:o,nextMarker:h}},_checkMarkerAllowedToDrag(e){let{prevMarker:t,nextMarker:i}=this._getNeighborMarkers(e),r=L.polyline([t.getLatLng(),e.getLatLng()]),n=L.polyline([e.getLatLng(),i.getLatLng()]),a=pi(this._layer.toGeoJSON(15),r.toGeoJSON(15)).features.length,s=pi(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length;return e.getLatLng()===this._markers[0][0].getLatLng()?s+=1:e.getLatLng()===this._markers[0][this._markers[0].length-1].getLatLng()&&(a+=1),!(a<=2&&s<=2)},_onMarkerDragStart(e){let t=e.target;if(this.cachedColor||(this.cachedColor=this._layer.options.color),!this._vertexValidation("move",e))return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragStart(e,i),this.options.allowSelfIntersection||(this._coordsBeforeEdit=rt(this._layer,this._layer.getLatLngs())),!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()?this._markerAllowedToDrag=this._checkMarkerAllowedToDrag(t):this._markerAllowedToDrag=null},_onMarkerDrag(e){let t=e.target;if(!this._vertexValidationDrag(t))return;let{indexPath:i,index:r,parentPath:n}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);if(!i)return;if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()&&this._markerAllowedToDrag===!1){this._layer.setLatLngs(this._coordsBeforeEdit),this._initMarkers(),this._handleLayerStyle();return}this.updatePolygonCoordsFromMarkerDrag(t);let a=i.length>1?(0,Qt.default)(this._markers,n):this._markers,s=(r+1)%a.length,o=(r+(a.length-1))%a.length,h=t.getLatLng(),c=a[o].getLatLng(),x=a[s].getLatLng();if(t._middleMarkerNext){let y=L.PM.Utils.calcMiddleLatLng(this._map,h,x);t._middleMarkerNext.setLatLng(y)}if(t._middleMarkerPrev){let y=L.PM.Utils.calcMiddleLatLng(this._map,h,c);t._middleMarkerPrev.setLatLng(y)}this.options.allowSelfIntersection||this._handleLayerStyle(),this._fireMarkerDrag(e,i),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(e){let t=e.target;if(!this._vertexValidationDragEnd(t))return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t),r=!this.options.allowSelfIntersection&&this.hasSelfIntersection();r&&this.options.allowSelfIntersectionEdit&&this._markerAllowedToDrag&&(r=!1);let n=!this.options.allowSelfIntersection&&r;if(this._fireMarkerDragEnd(e,i,n),n){this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers(),this.options.snappable&&this._initSnappableMarkers(),this._handleLayerStyle(),this._fireLayerReset(e,i);return}!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._handleLayerStyle(),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_onVertexClick(e){let t=e.target;if(t._dragging)return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireVertexClick(e,i)}}),Fe.Polygon=Fe.Line.extend({_shape:"Polygon",_checkMarkerAllowedToDrag(e){let{prevMarker:t,nextMarker:i}=this._getNeighborMarkers(e),r=L.polyline([t.getLatLng(),e.getLatLng()]),n=L.polyline([e.getLatLng(),i.getLatLng()]),a=pi(this._layer.toGeoJSON(15),r.toGeoJSON(15)).features.length,s=pi(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length;return!(a<=2&&s<=2)}}),Fe.Rectangle=Fe.Polygon.extend({_shape:"Rectangle",_initMarkers(){let e=this._map,t=this._findCorners();this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0,e.addLayer(this._markerGroup),this._markers=[],this._markers[0]=t.map(this._createMarker,this),[this._cornerMarkers]=this._markers,this._layer.getLatLngs()[0].forEach((i,r)=>{let n=this._cornerMarkers.find(a=>a._index===r);n&&n.setLatLng(i)})},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this._addMarkerEvents()},_createMarker(e,t){let i=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(i,"vertexPane"),i._origLatLng=e,i._index=t,i._pmTempLayer=!0,i.on("click",this._onVertexClick,this),this._markerGroup.addLayer(i),i},_addMarkerEvents(){this._markers[0].forEach(e=>{e.on("dragstart",this._onMarkerDragStart,this),e.on("drag",this._onMarkerDrag,this),e.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||e.on("contextmenu",this._removeMarker,this)})},_removeMarker(){return null},_onMarkerDragStart(e){if(!this._vertexValidation("move",e))return;let t=e.target,i=this._cornerMarkers;t._oppositeCornerLatLng=i.find(n=>n._index===(t._index+2)%4).getLatLng(),t._snapped=!1;let{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragStart(e,r)},_onMarkerDrag(e){let t=e.target;if(!this._vertexValidationDrag(t)||t._index===void 0)return;this._adjustRectangleForMarkerMove(t);let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDrag(e,i),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(e){let t=e.target;if(!this._vertexValidationDragEnd(t))return;this._cornerMarkers.forEach(r=>{delete r._oppositeCornerLatLng});let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragEnd(e,i),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_adjustRectangleForMarkerMove(e){L.extend(e._origLatLng,e._latlng);let t=L.PM.Utils._getRotatedRectangle(e.getLatLng(),e._oppositeCornerLatLng,this.getAngle(),this._map);this._layer.setLatLngs(t),this._adjustAllMarkers(e),this._layer.redraw()},_adjustAllMarkers(e){let t=this._layer.getLatLngs()[0];if(t&&t.length!==4&&t.length>0)t.forEach((i,r)=>{this._cornerMarkers[r].setLatLng(i)}),this._cornerMarkers.slice(t.length).forEach(i=>{i.setLatLng(t[0])});else if(!t||!t.length)console.error("The layer has no LatLngs");else{let i=t.findIndex(r=>e.getLatLng().equals(r));i>-1?(this._cornerMarkers[(e._index+1)%4].setLatLng(t[(i+1)%4]),this._cornerMarkers[(e._index+2)%4].setLatLng(t[(i+2)%4]),this._cornerMarkers[(e._index+3)%4].setLatLng(t[(i+3)%4])):this._cornerMarkers.forEach(r=>{r.setLatLng(t[r._index])})}},_findCorners(){this._angle===void 0&&this.setInitAngle(dr(this._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let e=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(e[0],e[2],this.getAngle(),this._map||this)}}),Fe.CircleMarker=Fe.extend({_shape:"CircleMarker",initialize(e){this._layer=e,this._enabled=!1,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._updateHiddenPolyCircle()},enable(e={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,e),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._extendingEnable(),this._updateHiddenPolyCircle(),this._fireEnable()},_extendingEnable(){this._layer.on("pm:dragstart",this._onDragStart,this),this._layer.on("pm:drag",this._onMarkerDrag,this),this._layer.on("pm:dragend",this._onMarkerDragEnd,this)},disable(){this.dragging()||(this._map||(this._map=this._layer._map),this._map&&this.enabled()&&(this.layerDragEnabled()&&this.disableLayerDrag(),this._helperLayers&&(this._helperLayers.clearLayers(),this._helperLayers.removeFrom(this._map)),this.options[this._editableOption]?(this._map.off("move",this._syncMarkers,this),this._outerMarker.off("drag",this._handleOuterMarkerSnapping,this)):this._map.off("move",this._updateHiddenPolyCircle,this),this._extendingDisable(),this._layer.off("remove",this.disable,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1))},_extendingDisable(){this._layer.off("contextmenu",this._removeMarker,this)},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options[this._editableOption]?(this._initMarkers(),this._map.on("move",this._syncMarkers,this),this.options.snappable?(this._initSnappableMarkers(),this._outerMarker.on("drag",this._handleOuterMarkerSnapping,this),this._outerMarker.on("move",this._syncHintLine,this),this._outerMarker.on("move",this._syncCircleRadius,this)):this._disableSnapping()):(this.options.draggable&&this.enableLayerDrag(),this._map.on("move",this._updateHiddenPolyCircle,this),this.options.snappable?this._initSnappableMarkersDrag():this._disableSnappingDrag()),this._extendingApplyOptions()},_extendingApplyOptions(){this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_initMarkers(){let e=this._map;this._helperLayers&&(this._helperLayers.removeFrom(e),this._helperLayers.clearLayers()),this._helperLayers=new L.FeatureGroup,this._helperLayers._pmTempLayer=!0,this._helperLayers.addTo(e);let t=this._layer.getLatLng(),i=this._layer._radius,r=this._getLatLngOnCircle(t,i);this._centerMarker=this._createCenterMarker(t),this._outerMarker=this._createOuterMarker(r),this._markers=[this._centerMarker,this._outerMarker],this._createHintLine(this._centerMarker,this._outerMarker)},_getLatLngOnCircle(e,t){let i=this._map.project(e),r=L.point(i.x+t,i.y);return this._map.unproject(r)},_createHintLine(e,t){let i=e.getLatLng(),r=t.getLatLng();this._hintline=L.polyline([i,r],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._helperLayers.addLayer(this._hintline)},_createCenterMarker(e){let t=this._createMarker(e);return this.options.draggable?(L.DomUtil.addClass(t._icon,"leaflet-pm-draggable"),t.on("move",this._moveCircle,this)):t.dragging.disable(),t},_createOuterMarker(e){let t=this._createMarker(e);return t.on("drag",this._resizeCircle,this),t},_createMarker(e){let t=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._origLatLng=e,t._pmTempLayer=!0,t.on("dragstart",this._onMarkerDragStart,this),t.on("drag",this._onMarkerDrag,this),t.on("dragend",this._onMarkerDragEnd,this),t.on("click",this._onVertexClick,this),this._helperLayers.addLayer(t),t},_moveCircle(e){if(e.target._cancelDragEventChain)return;let t=this._centerMarker.getLatLng();this._layer.setLatLng(t);let i=this._layer._radius,r=this._getLatLngOnCircle(t,i);this._outerMarker._latlng=r,this._outerMarker.update(),this._syncHintLine(),this._updateHiddenPolyCircle(),this._fireCenterPlaced("Edit"),this._fireChange(this._layer.getLatLng(),"Edit")},_syncMarkers(){let e=this._layer.getLatLng(),t=this._layer._radius,i=this._getLatLngOnCircle(e,t);this._outerMarker.setLatLng(i),this._centerMarker.setLatLng(e),this._syncHintLine(),this._updateHiddenPolyCircle()},_resizeCircle(){this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker()),this._syncHintLine(),this._syncCircleRadius()},_syncCircleRadius(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),i=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(i),this._updateHiddenPolyCircle(),this._fireChange(this._layer.getLatLng(),"Edit")},_syncHintLine(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng();this._hintline.setLatLngs([e,t])},_removeMarker(){this.options[this._editableOption]&&this.disable(),this._layer.remove(),this._fireRemove(this._layer),this._fireRemove(this._map,this._layer)},_onDragStart(){this._map.pm.Draw.CircleMarker._layerIsDragging=!0},_onMarkerDragStart(e){this._vertexValidation("move",e)&&this._fireMarkerDragStart(e)},_onMarkerDrag(e){let t=e.target;t instanceof L.Marker&&!this._vertexValidationDrag(t)||this._fireMarkerDrag(e)},_onMarkerDragEnd(e){this._extedingMarkerDragEnd();let t=e.target;this._vertexValidationDragEnd(t)&&(this.options[this._editableOption]&&(this._fireEdit(),this._layerEdited=!0),this._fireMarkerDragEnd(e))},_extedingMarkerDragEnd(){this._map.pm.Draw.CircleMarker._layerIsDragging=!1},_initSnappableMarkersDrag(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnappingDrag(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)},_updateHiddenPolyCircle(){let e=this._layer._map||this._map;if(e){let t=L.PM.Utils.pxRadiusToMeterRadius(this._layer.getRadius(),e,this._layer.getLatLng()),i=L.circle(this._layer.getLatLng(),this._layer.options);i.setRadius(t);let r=e&&e.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(i,200,!r).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(i,200,!r),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)}},_getNewDestinationOfOuterMarker(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),i=this._distanceCalculation(e,t);return this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?t=Ui(this._map,e,t,this._getMinDistanceInMeter(e)):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(t=Ui(this._map,e,t,this._getMaxDistanceInMeter(e))),t},_handleOuterMarkerSnapping(){if(this._outerMarker._snapped){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),i=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._outerMarker.setLatLng(this._outerMarker._orgLatLng):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&this._outerMarker.setLatLng(this._outerMarker._orgLatLng)}this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker())},_distanceCalculation(e,t){return this._map.project(e).distanceTo(this._map.project(t))},_getMinDistanceInMeter(e){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,e)},_getMaxDistanceInMeter(e){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,e)},_onVertexClick(e){e.target._dragging||this._fireVertexClick(e,void 0)}}),Fe.Circle=Fe.CircleMarker.extend({_shape:"Circle",initialize(e){this._layer=e,this._enabled=!1,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizeableCircle",this._updateHiddenPolyCircle()},enable(e){L.PM.Edit.CircleMarker.prototype.enable.call(this,e||{})},_extendingEnable(){},_extendingDisable(){this._layer.off("remove",this.disable,this);let e=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(e,"leaflet-pm-draggable")},_extendingApplyOptions(){},_syncMarkers(){},_removeMarker(){},_onDragStart(){},_extedingMarkerDragEnd(){},_updateHiddenPolyCircle(){let e=this._map&&this._map.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(this._layer,200,!e).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(this._layer,200,!e),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)},_distanceCalculation(e,t){return this._map.distance(e,t)},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_onVertexClick(e){e.target._dragging||this._fireVertexClick(e,void 0)}}),Fe.ImageOverlay=Fe.extend({_shape:"ImageOverlay",initialize(e){this._layer=e,this._enabled=!1},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},enabled(){return this._enabled},enable(e={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,e),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()||this.disable(),this.enableLayerDrag(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._otherSnapLayers=this._findCorners(),this._fireEnable()}},disable(){this._dragging||(this._map||(this._map=this._layer._map),this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this.enabled()||(this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()),this._enabled=!1)},_findCorners(){let e=this._layer.getBounds(),t=e.getNorthWest(),i=e.getNorthEast(),r=e.getSouthEast(),n=e.getSouthWest();return[t,i,r,n]}}),Fe.Text=Fe.extend({_shape:"Text",initialize(e){this._layer=e,this._enabled=!1},enable(e){if(L.Util.setOptions(this,e),!!this.textArea){if(!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._safeToCacheDragState=!0,this._focusChange(),this.textArea.readOnly=!1,this.textArea.classList.remove("pm-disabled"),this._layer.on("remove",this.disable,this),L.DomEvent.on(this.textArea,"input",this._autoResize,this),L.DomEvent.on(this.textArea,"focus",this._focusChange,this),L.DomEvent.on(this.textArea,"blur",this._focusChange,this),this._layer.on("dblclick",L.DomEvent.stop),L.DomEvent.off(this.textArea,"mousedown",this._preventTextSelection),this._enabled=!0,this._fireEnable()}},disable(){if(!this.enabled())return;this._layer.off("remove",this.disable,this),L.DomEvent.off(this.textArea,"input",this._autoResize,this),L.DomEvent.off(this.textArea,"focus",this._focusChange,this),L.DomEvent.off(this.textArea,"blur",this._focusChange,this),L.DomEvent.off(document,"click",this._documentClick,this),this._focusChange(),this.textArea.readOnly=!0,this.textArea.classList.add("pm-disabled");let e=document.activeElement;this.textArea.focus(),this.textArea.selectionStart=0,this.textArea.selectionEnd=0,L.DomEvent.on(this.textArea,"mousedown",this._preventTextSelection),e.focus(),this._disableOnBlurActive=!1,this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initSnappableMarkers(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)},_autoResize(){this.textArea.style.height="1px",this.textArea.style.width="1px";let e=this.textArea.scrollHeight>21?this.textArea.scrollHeight:21,t=this.textArea.scrollWidth>16?this.textArea.scrollWidth:16;this.textArea.style.height=`${e}px`,this.textArea.style.width=`${t}px`,this._layer.options.text=this.getText(),this._fireTextChange(this.getText())},_disableOnBlur(){this._disableOnBlurActive=!0,setTimeout(()=>{this.enabled()&&L.DomEvent.on(document,"click",this._documentClick,this)},100)},_documentClick(e){e.target!==this.textArea&&(this.disable(),!this.getText()&&this.options.removeIfEmpty&&this.remove())},_focusChange(e={}){let t=this._hasFocus;this._hasFocus=e.type==="focus",!t!=!this._hasFocus&&(this._hasFocus?(this._applyFocus(),this._focusText=this.getText(),this._fireTextFocus()):(this._removeFocus(),this._fireTextBlur(),this._focusText!==this.getText()&&(this._fireEdit(),this._layerEdited=!0)))},_applyFocus(){this.textArea.classList.add("pm-hasfocus"),this._map.dragging&&(this._safeToCacheDragState&&(this._originalMapDragState=this._map.dragging._enabled,this._safeToCacheDragState=!1),this._map.dragging.disable())},_removeFocus(){this._map.dragging&&(this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0),this.textArea.classList.remove("pm-hasfocus")},focus(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.focus()},blur(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.blur(),this._disableOnBlurActive&&this.disable()},hasFocus(){return this._hasFocus},getElement(){return this.textArea},setText(e){e&&(this.textArea.value=e),this._autoResize()},getText(){return this.textArea.value},_initTextMarker(){if(this.textArea=L.PM.Draw.Text.prototype._createTextArea.call(this),this.options.className){let t=this.options.className.split(" ");this.textArea.classList.add(...t)}let e=L.PM.Draw.Text.prototype._createTextIcon.call(this,this.textArea);this._layer.setIcon(e),this._layer.once("add",this._createTextMarker,this)},_createTextMarker(e=!1){this._layer.off("add",this._createTextMarker,this),this._layer.getElement().tabIndex=-1,this.textArea.wrap="off",this.textArea.style.overflow="hidden",this.textArea.style.height=L.DomUtil.getStyle(this.textArea,"font-size"),this.textArea.style.width="1px",this._layer.options.text&&this.setText(this._layer.options.text),this._autoResize(),e===!0&&(this.enable(),this.focus(),this._disableOnBlur())},_preventTextSelection(e){e.preventDefault()}});var sa=function(e,t,i,r,n,a){this._matrix=[e,t,i,r,n,a]};sa.init=()=>new L.PM.Matrix(1,0,0,1,0,0),sa.prototype={transform(e){return this._transform(e.clone())},_transform(e){let t=this._matrix,{x:i,y:r}=e;return e.x=t[0]*i+t[1]*r+t[4],e.y=t[2]*i+t[3]*r+t[5],e},untransform(e){let t=this._matrix;return new L.Point((e.x/t[0]-t[4])/t[0],(e.y/t[2]-t[5])/t[2])},clone(){let e=this._matrix;return new L.PM.Matrix(e[0],e[1],e[2],e[3],e[4],e[5])},translate(e){if(e===void 0)return new L.Point(this._matrix[4],this._matrix[5]);let t,i;return typeof e=="number"?(t=e,i=e):(t=e.x,i=e.y),this._add(1,0,0,1,t,i)},scale(e,t){if(e===void 0)return new L.Point(this._matrix[0],this._matrix[3]);let i,r;return t=t||L.point(0,0),typeof e=="number"?(i=e,r=e):(i=e.x,r=e.y),this._add(i,0,0,r,t.x,t.y)._add(1,0,0,1,-t.x,-t.y)},rotate(e,t){let i=Math.cos(e),r=Math.sin(e);return t=t||new L.Point(0,0),this._add(i,r,-r,i,t.x,t.y)._add(1,0,0,1,-t.x,-t.y)},flip(){return this._matrix[1]*=-1,this._matrix[2]*=-1,this},_add(e,t,i,r,n,a){let s=[[],[],[]],o=this._matrix,h=[[o[0],o[2],o[4]],[o[1],o[3],o[5]],[0,0,1]],c=[[e,i,n],[t,r,a],[0,0,1]],x;e&&e instanceof L.PM.Matrix&&(o=e._matrix,c=[[o[0],o[2],o[4]],[o[1],o[3],o[5]],[0,0,1]]);for(let y=0;y<3;y+=1)for(let T=0;T<3;T+=1){x=0;for(let F=0;F<3;F+=1)x+=h[y][F]*c[F][T];s[y][T]=x}return this._matrix=[s[0][0],s[1][0],s[0][1],s[1][1],s[0][2],s[1][2]],this}};var yo=sa,_o={calcMiddleLatLng(e,t,i){let r=e.project(t),n=e.project(i);return e.unproject(r._add(n)._divideBy(2))},findLayers(e){let t=[];return e.eachLayer(i=>{(i instanceof L.Polyline||i instanceof L.Marker||i instanceof L.Circle||i instanceof L.CircleMarker||i instanceof L.ImageOverlay)&&t.push(i)}),t=t.filter(i=>!!i.pm),t=t.filter(i=>!i._pmTempLayer),t=t.filter(i=>!L.PM.optIn&&!i.options.pmIgnore||L.PM.optIn&&i.options.pmIgnore===!1),t},circleToPolygon(e,t=60,i=!0){let r=e.getLatLng(),n=e.getRadius(),a=$r(r,n,t,0,i),s=[];for(let o=0;o<a.length;o+=1){let h=[a[o].lat,a[o].lng];s.push(h)}return L.polygon(s,e.options)},disablePopup(e){e.getPopup()&&(e._tempPopupCopy=e.getPopup(),e.unbindPopup())},enablePopup(e){e._tempPopupCopy&&(e.bindPopup(e._tempPopupCopy),delete e._tempPopupCopy)},_fireEvent(e,t,i,r=!1){e.fire(t,i,r);let{groups:n}=this.getAllParentGroups(e);n.forEach(a=>{a.fire(t,i,r)})},getAllParentGroups(e){let t=[],i=[],r=n=>{for(let a in n._eventParents)if(t.indexOf(a)===-1){t.push(a);let s=n._eventParents[a];i.push(s),r(s)}};return!e._pmLastGroupFetch||!e._pmLastGroupFetch.time||new Date().getTime()-e._pmLastGroupFetch.time>1e3?(r(e),e._pmLastGroupFetch={time:new Date().getTime(),groups:i,groupIds:t},{groupIds:t,groups:i}):{groups:e._pmLastGroupFetch.groups,groupIds:e._pmLastGroupFetch.groupIds}},createGeodesicPolygon:$r,getTranslation:ae,findDeepCoordIndex(e,t,i=!0){let r,n=s=>(o,h)=>{let c=s.concat(h);if(i){if(o.lat&&o.lat===t.lat&&o.lng===t.lng)return r=c,!0}else if(o.lat&&L.latLng(o).equals(t))return r=c,!0;return Array.isArray(o)&&o.some(n(c))};e.some(n([]));let a={};return r&&(a={indexPath:r,index:r[r.length-1],parentPath:r.slice(0,r.length-1)}),a},findDeepMarkerIndex(e,t){let i,r=a=>(s,o)=>{let h=a.concat(o);return s._leaflet_id===t._leaflet_id?(i=h,!0):Array.isArray(s)&&s.some(r(h))};e.some(r([]));let n={};return i&&(n={indexPath:i,index:i[i.length-1],parentPath:i.slice(0,i.length-1)}),n},_getIndexFromSegment(e,t){if(t&&t.length===2){let i=this.findDeepCoordIndex(e,t[0]),r=this.findDeepCoordIndex(e,t[1]),n=Math.max(i.index,r.index);return(i.index===0||r.index===0)&&n!==1&&(n+=1),{indexA:i,indexB:r,newIndex:n,indexPath:i.indexPath,parentPath:i.parentPath}}return null},_getRotatedRectangle(e,t,i,r){let n=Hi(r,e),a=Hi(r,t),s=i*Math.PI/180,o=Math.cos(s),h=Math.sin(s),c=(a.x-n.x)*o+(a.y-n.y)*h,x=(a.y-n.y)*o-(a.x-n.x)*h,y=c*o+n.x,T=c*h+n.y,F=-x*h+n.x,z=x*o+n.y,q=cn(r,n),Y=cn(r,{x:y,y:T}),ue=cn(r,a),b=cn(r,{x:F,y:z});return[q,Y,ue,b]},pxRadiusToMeterRadius(e,t,i){let r=t.project(i),n=L.point(r.x+e,r.y);return t.distance(t.unproject(n),i)}},bo=_o;L.PM=L.PM||{version:We.version,Map:zn,Toolbar:Un,Draw:Be,Edit:Fe,Utils:bo,Matrix:yo,activeLang:"en",optIn:!1,initialize(e){this.addInitHooks(e)},setOptIn(e){this.optIn=!!e},addInitHooks(){function e(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Map(this)):this.options.pmIgnore||(this.pm=new L.PM.Map(this)),this.pm&&this.pm.setGlobalOptions({})}L.Map.addInitHook(e);function t(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.LayerGroup(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.LayerGroup(this))}L.LayerGroup.addInitHook(t);function i(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this)):this.options.pmIgnore||(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this))}L.Marker.addInitHook(i);function r(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.CircleMarker(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.CircleMarker(this))}L.CircleMarker.addInitHook(r);function n(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Line(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Line(this))}L.Polyline.addInitHook(n);function a(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Polygon(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Polygon(this))}L.Polygon.addInitHook(a);function s(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Rectangle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Rectangle(this))}L.Rectangle.addInitHook(s);function o(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Circle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Circle(this))}L.Circle.addInitHook(o);function h(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.ImageOverlay(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.ImageOverlay(this))}L.ImageOverlay.addInitHook(h)},reInitLayer(e){e instanceof L.LayerGroup&&e.eachLayer(t=>{this.reInitLayer(t)}),e.pm||L.PM.optIn&&e.options.pmIgnore!==!1||e.options.pmIgnore||(e instanceof L.Map?e.pm=new L.PM.Map(e):e instanceof L.Marker?e.options.textMarker?(e.pm=new L.PM.Edit.Text(e),e.pm._initTextMarker(),e.pm._createTextMarker(!1)):e.pm=new L.PM.Edit.Marker(e):e instanceof L.Circle?e.pm=new L.PM.Edit.Circle(e):e instanceof L.CircleMarker?e.pm=new L.PM.Edit.CircleMarker(e):e instanceof L.Rectangle?e.pm=new L.PM.Edit.Rectangle(e):e instanceof L.Polygon?e.pm=new L.PM.Edit.Polygon(e):e instanceof L.Polyline?e.pm=new L.PM.Edit.Line(e):e instanceof L.LayerGroup?e.pm=new L.PM.Edit.LayerGroup(e):e instanceof L.ImageOverlay&&(e.pm=new L.PM.Edit.ImageOverlay(e)))}},L.version==="1.7.1"&&L.Canvas.include({_onClick(e){let t=this._map.mouseEventToLayerPoint(e),i,r;for(let n=this._drawFirst;n;n=n.next)i=n.layer,i.options.interactive&&i._containsPoint(t)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(i))&&(r=i);r&&(L.DomEvent.fakeStop(e),this._fireEvent([r],e))}}),L.PM.initialize()})()),Ka}Bo();function qa(j){const W=new Date(j),J=H=>String(H).padStart(2,"0");return`${W.getFullYear()}-${J(W.getMonth()+1)}-${J(W.getDate())}T${J(W.getHours())}:${J(W.getMinutes())}`}function $a(j){if(!j)return"";const W=typeof j.toDate=="function"?j.toDate().getTime():j instanceof Date?j.getTime():j?.seconds?j.seconds*1e3:typeof j=="number"?j:typeof j=="string"?Date.parse(j):null;return W==null||!Number.isFinite(W)?"":new Date(W).toLocaleString(void 0,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}const _n="#0066cc",es=80,wo=140,Ya=220,So=.5;function yn(j,W,J){return Math.min(J,Math.max(W,j))}function ts(j){const W=Number.isFinite(j)?j:800,J=Math.max(0,W-es),H=Math.min(wo,Math.max(96,J-Ya)),ne=Math.max(120,J-H),oe=Math.min(Ya,ne);return{available:J,minMapHeight:H,minPanelHeight:oe,maxPanelHeight:ne}}function Xa(j){const{available:W,minPanelHeight:J,maxPanelHeight:H}=ts(j),ne=W*So;return Math.round(yn(ne,J,H))}function Za(){return{center:null,radius:250,targetTagIds:["all"],name:"",color:_n,emailEnabled:!1,emailAddress:"",alertOnEntry:!0,alertOnExit:!0}}function Do(j){return!Array.isArray(j)||j.length===0?[]:j.includes("all")?["all"]:[...new Set(j.map(String))].sort()}function pa(j){const W=Number(j?.center?.lat),J=Number(j?.center?.lng);return{center:Number.isFinite(W)&&Number.isFinite(J)?{lat:Number(W.toFixed(6)),lng:Number(J.toFixed(6))}:null,radius:Math.max(1,Number(j?.radius)||0),targetTagIds:Do(j?.targetTagIds),name:j?.name??"",color:j?.color||_n,emailEnabled:!!j?.emailEnabled,emailAddress:j?.emailAddress??"",alertOnEntry:!!j?.alertOnEntry,alertOnExit:!!j?.alertOnExit}}function Ao(j,W){return!j||!W?!1:JSON.stringify(j)===JSON.stringify(W)}function ga(...j){for(const W of j){const J=Number(W);if(Number.isFinite(J))return J}return null}function ma(j,W){const J=Number(j),H=Number(W);return!Number.isFinite(J)||!Number.isFinite(H)?null:Math.abs(J)>90&&Math.abs(H)<=90?{lat:H,lng:J}:{lat:J,lng:H}}function te(j){if(!j)return null;if(Array.isArray(j)&&j.length>=2)return ma(j[0],j[1]);if(j&&typeof j.lat=="function"&&typeof j.lng=="function"){const ne=ma(j.lat(),j.lng());if(ne)return ne}const W=te(j.coordinates);if(W)return W;const J=ga(j.lat,j.latitude,j._lat,j._latitude,j.centerLat,j.centerLatitude,j.y),H=ga(j.lng,j.lon,j.long,j.longitude,j._long,j._lng,j._longitude,j.centerLng,j.centerLon,j.centerLong,j.centerLongitude,j.x);return Number.isFinite(J)&&Number.isFinite(H)?{lat:J,lng:H}:null}function bn(j,W=0,J=new Set){if(!j||W>4||typeof j!="object"||J.has(j))return null;J.add(j);const H=te(j);if(H)return H;if(Array.isArray(j)){for(const ne of j){const oe=bn(ne,W+1,J);if(oe)return oe}return null}for(const ne of Object.keys(j)){const oe=bn(j[ne],W+1,J);if(oe)return oe}return null}function ya(j,W=0,J=new Set){if(!j||W>4||typeof j!="object"||J.has(j))return null;if(J.add(j),!Array.isArray(j)){for(const[ne,oe]of Object.entries(j))if(typeof ne=="string"&&ne.toLowerCase().includes("radius")){const N=Number(oe);if(Number.isFinite(N)&&N>0)return N}}const H=Array.isArray(j)?j:Object.values(j);for(const ne of H){const oe=ya(ne,W+1,J);if(Number.isFinite(oe)&&oe>0)return oe}return null}function ti(j){if(!Array.isArray(j))return[];const W=j.filter(H=>Array.isArray(H)&&H.length>=2).map(([H,ne])=>ma(H,ne)).filter(H=>H&&Number.isFinite(H.lat)&&Number.isFinite(H.lng)).map(H=>[H.lat,H.lng]);if(W.length>=3)return W;const J=j.map(H=>te(H)).filter(H=>H&&Number.isFinite(H.lat)&&Number.isFinite(H.lng)).map(H=>[H.lat,H.lng]);if(J.length>=3)return J;for(const H of j){const ne=ti(H);if(ne.length>=3)return ne}return[]}function xn(j,W=0,J=new Set){if(!j||W>4)return[];if(Array.isArray(j)){const ne=ti(j);if(ne.length>=3)return ne;for(const oe of j){const N=xn(oe,W+1,J);if(N.length>=3)return N}return[]}if(typeof j!="object")return[];if(J.has(j))return[];J.add(j);const H=Object.values(j);for(const ne of H){const oe=xn(ne,W+1,J);if(oe.length>=3)return oe}return[]}function is(j){const W=j?.geometry||{};return te(W.center)||te(j?.center)||te(W.location)||te(j?.location)||te(W.coordinates)||te(j?.coordinates)||te([W.centerLat,W.centerLng])||te([j?.centerLat,j?.centerLng])||te(W)||te(j)||bn(W)||bn(j)}function Ja(j){try{if(!j)return null;const W=j.geometry||{},J=is(j),H=ga(W.radiusMeters,W.radius,W.radiusInMeters,j.radiusMeters,j.radius,j.radiusInMeters)??ya(W)??ya(j)??100,ne=Number.isFinite(J?.lat)&&Number.isFinite(J?.lng);if((j.type==="circle"||ne)&&ne&&Number.isFinite(H)&&H>0)return Ve.circle([J.lat,J.lng],{radius:H}).getBounds();const Me=((...Oe)=>{for(const Ye of Oe)if(Array.isArray(Ye)&&Ye.length>=3)return Ye;return[]})(ti(W.coordinates),ti(W.points),ti(W.vertices),ti(j.coordinates),ti(j.points),ti(j.vertices),xn(W),xn(j));if(Me.length>=3)return Ve.latLngBounds(Me)}catch{return null}return null}function gn(j,W,J){const H=Ve.circleMarker([W,J],{radius:10,color:"#1a1a1a",weight:2,fillColor:"#0066cc",fillOpacity:.6,opacity:.9});H.addTo(j),setTimeout(()=>{try{H.remove()}catch{}},1200)}function kr(){return _.jsxs("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[_.jsx("path",{d:"M12 22C12 22 19 15.5 19 10C19 6.13401 15.866 3 12 3C8.13401 3 5 6.13401 5 10C5 15.5 12 22 12 22Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),_.jsx("circle",{cx:"12",cy:"10",r:"2.5",fill:"currentColor"})]})}function Po({offsetX:j=0}){const W=Vi(),J=I.useRef(null);return I.useEffect(()=>{const H=Ve.control.scale({position:"bottomleft"});return H.addTo(W),J.current=H,()=>{H.remove(),J.current=null}},[W]),I.useEffect(()=>{const H=J.current?.getContainer?.();H&&(H.style.marginLeft=`${Math.max(0,Math.round(j))}px`)},[j]),null}function To(){const j=Vi();return I.useEffect(()=>{try{j.zoomControl&&j.removeControl(j.zoomControl)}catch{}const W=Ve.control.zoom({position:"topright"});return W.addTo(j),()=>{try{j.removeControl(W)}catch{}}},[j]),null}function Oo(){const W=vo(),J=I.useMemo(()=>[37.7749,-122.4194],[]),[H,ne]=I.useState("status"),[oe,N]=I.useState("12h"),[Me,Oe]=I.useState(()=>qa(Date.now()-720*60*1e3)),[Ye,Qe]=I.useState(()=>qa(Date.now())),[Ge,je]=I.useState([]),[Pe,Ht]=I.useState(""),[ze,at]=I.useState([]),[st,xt]=I.useState({}),[et,yi]=I.useState([]),[pe,de]=I.useState(!1),[le,me]=I.useState(null),[Ee,we]=I.useState({}),[ye,Te]=I.useState({}),[Ie,ve]=I.useState([]),[Ke,Vt]=I.useState(!1),[ii,vt]=I.useState(null),[Lt,At]=I.useState(""),[Pt,Ki]=I.useState(""),[Tt,Wi]=I.useState(""),[_i,vn]=I.useState(""),[bi,Ln]=I.useState("name_az"),[fe,Er]=I.useState(null),[Br,Cn]=I.useState(!1),[xi,vi]=I.useState(null),[wr,qi]=I.useState(null),$i=I.useRef(null),Li=I.useRef(null),Yi=I.useRef({}),[ri,kn]=I.useState(!0),[ot,Mn]=I.useState(!1),[ni,ai]=I.useState(!1),[Ci,ki]=I.useState(null),[Xi,Sr]=I.useState(1),[ft,Zi]=I.useState(!1),[Xe,Mi]=I.useState(null),[Rt,gt]=I.useState(250),[tt,mt]=I.useState(["all"]),[Kt,Ei]=I.useState(""),[lt,Bi]=I.useState(!1),[Ft,wi]=I.useState(""),[Si,si]=I.useState(!0),[oi,Di]=I.useState(!0),[Wt,Ai]=I.useState(_n),[it,Ji]=I.useState(null),[Qi,er]=I.useState(null),[ie,En]=I.useState(!1),[Pi,Bn]=I.useState(()=>typeof window<"u"?window.innerHeight:800),[Dr,Ar]=I.useState(()=>typeof window>"u"?360:Xa(window.innerHeight)),[tr,Pr]=I.useState(!1),Ti=I.useRef({active:!1,startY:0,startHeight:0}),[Ct,ir]=I.useState(()=>{try{const l=window.localStorage.getItem("mapPanelCollapsed");return l==="1"?!0:l!=="0"}catch{return!0}}),[Ue,Tr]=I.useState(!1),[xe,qt]=I.useState(null),[rr,Rr]=I.useState(!1),[wn,Fr]=I.useState("continue"),[Sn,Ri]=I.useState(0),[ut,Fi]=I.useState(!1),[yt,nr]=I.useState(null),[Oi,li]=I.useState(null),$t=I.useRef(null),Ot=I.useRef(null),Or=["#0066cc","#0d47a1","#1565c0","#1976d2","#0288d1","#00695c","#00796b","#00897b","#26a69a","#c62828","#d84315","#455a64","#546e7a","#607d8b","#2e7d32","#388e3c"],ji={success:{border:"#2e7d32",background:"rgba(46, 125, 50, 0.95)"},error:{border:"#c62828",background:"rgba(198, 40, 40, 0.95)"},warning:{border:"#ef6c00",background:"rgba(239, 108, 0, 0.95)"},info:{border:"#1565c0",background:"rgba(21, 101, 192, 0.95)"}},jr=l=>l&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l),We=I.useCallback((l,M="info")=>{li({message:l,tone:M}),Ot.current&&window.clearTimeout(Ot.current),Ot.current=window.setTimeout(()=>{li(null),Ot.current=null},3200)},[]),Ii=I.useMemo(()=>[{id:"status",label:"Current",shortLabel:"Current",icon:"📍"},{id:"history",label:"Location History",shortLabel:"History",icon:"🕒"},{id:"activity",label:"Recent Activity",shortLabel:"Activity",icon:"📝"},{id:"geofences",label:"Geofences",shortLabel:"Geofences",icon:"🛡️"},{id:"settings",label:"Settings",shortLabel:"Settings",icon:"⚙️"}],[]),Ir=I.useMemo(()=>({status:{title:"Current",description:"View the last known location for linked tags and center the map quickly."},history:{title:"History",description:"Select one tag and a time range to review movement and timeline playback."},activity:{title:"Recent Activity",description:"Review latest geofence entry and exit events across your linked tags."},geofences:{title:"Geofences",description:"Create and manage geofence rules, then jump straight to each zone on the map."},settings:{title:"Settings",description:"Open account settings and dashboard controls."}}),[]),Nr=Ir[H]||Ir.status,ar=I.useCallback(l=>{if(!l)return"No data";const M=l instanceof Date?l:typeof l?.toDate=="function"?l.toDate():new Date(l?.seconds?l.seconds*1e3:l);if(!(M instanceof Date)||Number.isNaN(M.getTime()))return"No data";const D=Date.now()-M.getTime();return D<60*1e3?"Just now":D<3600*1e3?`${Math.floor(D/(60*1e3))}m ago`:D<1440*60*1e3?`${Math.floor(D/(3600*1e3))}h ago`:`${Math.floor(D/(1440*60*1e3))}d ago`},[]),Gr=I.useCallback(l=>{if(!l)return null;if(l instanceof Date)return Number.isNaN(l.getTime())?null:l;if(typeof l?.toDate=="function"){const D=l.toDate();return D instanceof Date&&!Number.isNaN(D.getTime())?D:null}if(typeof l?.seconds=="number"){const D=new Date(l.seconds*1e3);return Number.isNaN(D.getTime())?null:D}const M=Number(l);if(Number.isFinite(M)&&M>0){const D=new Date(M);return Number.isNaN(D.getTime())?null:D}const w=new Date(l);return Number.isNaN(w.getTime())?null:w},[]),zr=I.useCallback(l=>l==="entry"?"Entered":l==="exit"?"Exited":"Event",[]),Ur=I.useCallback(l=>l==="entry"?"#0d9488":l==="exit"?"#dc3545":"#6c757d",[]),{timeRangeStart:Yt,timeRangeEnd:kt,isCustomRangeValid:Dn}=I.useMemo(()=>{const l=Date.now();if(oe==="12h")return{timeRangeStart:l-12*3600*1e3,timeRangeEnd:l,isCustomRangeValid:!0};if(oe==="24h")return{timeRangeStart:l-24*3600*1e3,timeRangeEnd:l,isCustomRangeValid:!0};if(oe==="7d")return{timeRangeStart:l-168*3600*1e3,timeRangeEnd:l,isCustomRangeValid:!0};if(oe==="30d")return{timeRangeStart:l-720*3600*1e3,timeRangeEnd:l,isCustomRangeValid:!0};if(oe==="custom"){const M=new Date(Me).getTime(),w=new Date(Ye).getTime();if(Number.isFinite(M)&&Number.isFinite(w)&&w>M)return{timeRangeStart:M,timeRangeEnd:w,isCustomRangeValid:!0}}return{timeRangeStart:l-12*3600*1e3,timeRangeEnd:l,isCustomRangeValid:oe!=="custom"}},[oe,Me,Ye]);I.useEffect(()=>{const l=()=>{En(window.innerWidth<=768),Bn(window.innerHeight)};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),I.useEffect(()=>{try{window.localStorage.setItem("mapPanelCollapsed",Ct?"1":"0")}catch{}},[Ct]),I.useEffect(()=>{if(!it)return;const l=Yi.current[it];l&&typeof l.scrollIntoView=="function"&&l.scrollIntoView({block:"nearest",behavior:"smooth"})},[it]);const Ze=I.useMemo(()=>ts(Pi),[Pi]);I.useEffect(()=>{ie&&Ar(l=>{const M=Number.isFinite(l)?l:Xa(Pi),w=yn(M,Ze.minPanelHeight,Ze.maxPanelHeight);return Math.round(w)})},[ie,Pi,Ze.minPanelHeight,Ze.maxPanelHeight]);const sr=yn(Dr,Ze.minPanelHeight,Ze.maxPanelHeight),or=Math.max(Ze.minMapHeight,Ze.available-sr),Hr=es+or,An=I.useCallback(l=>{ie&&(Ti.current={active:!0,startY:l,startHeight:sr},Pr(!0))},[ie,sr]),Vr=I.useCallback(l=>{const M=Ti.current;if(!M.active)return;const w=M.startY-l,D=yn(M.startHeight+w,Ze.minPanelHeight,Ze.maxPanelHeight);Ar(Math.round(D))},[Ze.minPanelHeight,Ze.maxPanelHeight]),Kr=I.useCallback(()=>{Ti.current.active&&(Ti.current.active=!1,Pr(!1))},[]);I.useEffect(()=>{if(!tr)return;const l=D=>{D.preventDefault(),Vr(D.clientY)},M=()=>{Kr()};window.addEventListener("pointermove",l,{passive:!1}),window.addEventListener("pointerup",M),window.addEventListener("pointercancel",M);const w=document.body.style.userSelect;return document.body.style.userSelect="none",()=>{window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",M),window.removeEventListener("pointercancel",M),document.body.style.userSelect=w}},[tr,Vr,Kr]);const _t=ie?0:Ct?64:360,Pn=ie?0:24,ui=!ie&&Ct,lr=ie||_t<=400,hi=ft||!!it,Wr=I.useMemo(()=>pa({center:Xe,radius:Rt,targetTagIds:tt,name:Kt,color:Wt,emailEnabled:lt,emailAddress:Ft,alertOnEntry:Si,alertOnExit:oi}),[Xe,Rt,tt,Kt,Wt,lt,Ft,Si,oi]),Se=I.useMemo(()=>{const l={};return fe||(l.auth="Please sign in to save geofences."),Xe||(l.center="Click the map to set a geofence center."),Kt.trim()||(l.name="Enter a geofence name."),tt.length===0&&(l.tags="Select at least one tag to monitor."),lt&&(!Ft.trim()||!jr(Ft))&&(l.email="Enter a valid email address to enable email notifications."),l},[fe,Xe,Kt,tt,lt,Ft]),Ni=I.useMemo(()=>!hi||!Qi?!1:!Ao(Wr,Qi),[Wr,Qi,hi]),Mt=Object.keys(Se).length===0;I.useEffect(()=>{if(!hi||!Ni)return;const l=M=>{M.preventDefault(),M.returnValue=""};return window.addEventListener("beforeunload",l),()=>{window.removeEventListener("beforeunload",l)}},[hi,Ni]),I.useEffect(()=>()=>{Ot.current&&window.clearTimeout(Ot.current)},[]);const Tn=I.useMemo(()=>({topLeft:[ie?30:_t+24,96],bottomRight:[30,ie?30:120]}),[ie,_t]),jt=()=>{const l=Li.current;if(l&&typeof l.fitBounds=="function")return l;const M=$i.current;return M&&typeof M.fitBounds=="function"?M:M?.leafletElement&&typeof M.leafletElement.fitBounds=="function"?M.leafletElement:null};I.useEffect(()=>{if(!Br)return;const l=jt();if(!l)return;const M=()=>{try{l.invalidateSize({pan:!1,animate:!1})}catch{}};M();const w=window.requestAnimationFrame(M),D=window.setTimeout(M,120),V=window.setTimeout(M,260);return()=>{window.cancelAnimationFrame(w),window.clearTimeout(D),window.clearTimeout(V)}},[Br,_t,Ct,ie,or]);const De=I.useMemo(()=>ze.filter(l=>l.status==="linked"&&l.hardwareId),[ze]),It=I.useMemo(()=>ze.map(l=>{const M=l.status==="linked"&&!!l.hardwareId,w=l.isActive!==!1,D=/^#([0-9a-fA-F]{3}){1,2}$/.test(l.color||"")?l.color:"#adb5bd",V=l.customName||`Tag ${l.id.slice(0,8)}`;let K="Not linked";return M&&w?K="Linked":M&&!w?K="Linked (inactive)":l.status==="pending_hardware"&&(K="Pending hardware"),{id:l.id,name:V,color:D,isLinked:M,isActive:w,statusLabel:K}}).sort((l,M)=>l.isLinked!==M.isLinked?l.isLinked?-1:1:l.name.localeCompare(M.name)),[ze]),Ae=I.useMemo(()=>De.find(l=>l.id===Pe)||null,[De,Pe]),Nt=I.useMemo(()=>{const l=new Map(Ge.map(D=>[D.id,D.name||"Unknown"])),M=new Map(ze.map(D=>[D.id,D.customName||`Tag ${D.id.slice(-4)}`])),w=Ie.map((D,V)=>{const K=D?.tagId||"",U=D?.geofenceId||"",Z=String(D?.eventType||"").toLowerCase(),he=Z==="entry"?"entry":Z==="exit"?"exit":Z.includes("enter")?"entry":Z.includes("exit")?"exit":"unknown",se=Gr(D?.timestamp),nt=te(D?.location)||te(D?.lastLocation)||te(ye[K])||null;return{id:D?.id||`${K||"tag"}-${U||"geofence"}-${se?.getTime?.()||0}-${V}`,tagId:K,geofenceId:U,eventType:he,timestamp:se,timestampMs:se instanceof Date?se.getTime():0,location:nt,tagName:D?.tagName||M.get(K)||`Tag ${String(K).slice(-4)}`,geofenceName:D?.geofenceName||l.get(U)||"Unknown"}});return w.sort((D,V)=>V.timestampMs-D.timestampMs),w},[Ie,Ge,ze,Gr,ye]),ur=I.useMemo(()=>{const l=new Set;return Nt.filter(M=>!M.tagId||l.has(M.tagId)?!1:(l.add(M.tagId),!0)).map(M=>({id:M.tagId,name:M.tagName||`Tag ${String(M.tagId).slice(-4)}`})).sort((M,w)=>(M.name||"").localeCompare(w.name||""))},[Nt]),hr=I.useMemo(()=>{const l=new Set;return Nt.filter(M=>!M.geofenceId||l.has(M.geofenceId)?!1:(l.add(M.geofenceId),!0)).map(M=>({id:M.geofenceId,name:M.geofenceName||"Unknown"})).sort((M,w)=>(M.name||"").localeCompare(w.name||""))},[Nt]),Gt=I.useMemo(()=>Nt.filter(l=>!(Lt&&l.eventType!==Lt||Pt&&l.tagId!==Pt||Tt&&l.geofenceId!==Tt)),[Nt,Lt,Pt,Tt]),Rn=I.useMemo(()=>{const l=De.length,M=Ge.filter(D=>D.active!==!1).length,w=et.filter(D=>D.currentState==="inside").length;return[{label:"Linked tags",value:l,border:"#6ea8ff",tint:"rgba(13, 110, 253, 0.12)"},{label:"Inside geofence",value:w,border:"#52d8a5",tint:"rgba(25, 135, 84, 0.14)"},{label:"Geofences",value:M,border:"#b69cff",tint:"rgba(111, 66, 193, 0.14)"}]},[De,Ge,et]),Fn=(l,M=null)=>{try{const w=jt();if(!w)return!1;const D=M||Ja(l),V=!!(D&&D.isValid&&D.isValid()),K=is(l);Ri(Date.now()+2e4);let U=null;if(V){U=D.getCenter();try{w.fitBounds(D,{paddingTopLeft:[ie?30:_t+24,96],paddingBottomRight:[30,ie?30:120],animate:!0,duration:.8,maxZoom:14})}catch{if(U&&Number.isFinite(U.lat)&&Number.isFinite(U.lng)){const Z=Math.max(11,Math.min(13,Number(w.getZoom())||0));w.setView([U.lat,U.lng],Z,{animate:!0})}else if(K&&Number.isFinite(K.lat)&&Number.isFinite(K.lng))w.setView([K.lat,K.lng],12,{animate:!0}),U=K;else return!1}}else if(K&&Number.isFinite(K.lat)&&Number.isFinite(K.lng)){U=K;const Z=12;typeof w.flyTo=="function"?w.flyTo([K.lat,K.lng],Z,{animate:!0,duration:.8}):w.setView([K.lat,K.lng],Z,{animate:!0})}else return!1;return U&&Number.isFinite(U.lat)&&Number.isFinite(U.lng)&&gn(w,U.lat,U.lng),!0}catch{return!1}},ci=(l,M=14)=>{const w=jt();if(!w)return!1;const D=te(l);if(!D||!Number.isFinite(D.lat)||!Number.isFinite(D.lng))return!1;Ri(Date.now()+2e4);try{return typeof w.flyTo=="function"?w.flyTo([D.lat,D.lng],Math.max(M,w.getZoom()||0),{animate:!0,duration:.8}):w.setView([D.lat,D.lng],Math.max(M,w.getZoom()||0),{animate:!0}),gn(w,D.lat,D.lng),!0}catch{return!1}},On=l=>{const M=De.find(D=>D.id===l);return M?.hardwareId?M.hardwareId:ze.find(D=>D.id===l)?.hardwareId||null},jn=async l=>{const M=te(ye[l]);if(M)return M;const w=On(l);if(!w)return null;try{const D=await fn(mi($e,"airtags",w));if(!D.exists())return null;const V=D.data()||{},K=Number(V.lastLocationTs);if(Number.isFinite(K)&&K>0){const nt=await fn(mi($e,"airtags",w,"locations",String(K)));if(nt.exists()){const ee=nt.data()||{},Ce=te(ee.lastLocation)||te({lat:ee.lat,lng:ee.lng,latitude:ee.latitude,longitude:ee.longitude})||te(ee);if(Ce)return Ce}}const U=vr(ei($e,"airtags",w,"locations"),Lr("timestampMs","desc"),ua(1)),he=(await Va(U)).docs[0];if(!he)return null;const se=he.data()||{};return te(se.lastLocation)||te({lat:se.lat,lng:se.lng,latitude:se.latitude,longitude:se.longitude})||te(se)}catch{return null}},Gi=async(l,M=null)=>{if(!jt())return!1;const D=Array.isArray(st[l])?st[l]:[],V=D.length?D[D.length-1]:null,K=[M,Xt.lastLocationByTag[l],ye[l],V];for(const Z of K)if(ci(Z,14))return!0;const U=await jn(l);return U?ci(U,14):!1},In=l=>{const M=jt();if(!M)return;const w=Array.isArray(st[l])?st[l]:[],D=w.length?w[w.length-1]:null,V=Xt.lastLocationByTag[l],K=te(V)||te(ye[l]);if(!D||!Number.isFinite(D.lat)||!Number.isFinite(D.lng)){K&&ci(K,14);return}const U=Math.max(14,M.getZoom()||0);try{Ri(Date.now()+2e4),typeof M.flyTo=="function"?M.flyTo([D.lat,D.lng],U,{animate:!0,duration:.8}):M.setView([D.lat,D.lng],U,{animate:!0})}catch{return}try{gn(M,D.lat,D.lng)}catch{}};I.useEffect(()=>{if(!fe||H!=="history"){xt({});return}const l=Yt,M=kt;try{if(!Ae||!Ae.hardwareId){xt({});return}console.log(`📊 Loading single-tag history for ${Ae.id}`);const w=ei($e,"airtags",Ae.hardwareId,"locations"),D=vr(w,za("timestampMs",">=",l),za("timestampMs","<=",M),Lr("timestampMs","asc")),V=Cr(D,K=>{qi(null);const U=K.docs.map(Z=>{const he=Z.data(),se=Number(he.timestampMs);return{lat:Number(he.latitude),lng:Number(he.longitude),ts:new Date(se),timestampMs:se}}).filter(Z=>Number.isFinite(Z.lat)&&Number.isFinite(Z.lng)&&Number.isFinite(Z.timestampMs));xt({[Ae.id]:U})},K=>{console.error(`❌ locations subscribe error for hardware ${Ae.hardwareId}`,K),qi(K)});return()=>V()}catch(w){console.error("airtags subscribe setup failed",w),qi(w)}},[fe,H,Ae,Yt,kt]),I.useEffect(()=>{},[wr]),I.useEffect(()=>{const l=document.body.style.overflow,M=document.body.style.height,w=document.body.style.minHeight;return document.body.style.overflow="visible",document.body.style.height="100vh",document.body.style.minHeight="100vh",()=>{document.body.style.overflow=l,document.body.style.height=M,document.body.style.minHeight=w}},[]),I.useEffect(()=>{if(!fe){at([]);return}try{const l=ei($e,"users",fe,"tags"),M=Cr(l,w=>{const D=w.docs.map(V=>({id:V.id,...V.data()||{}}));at(D)},()=>at([]));return()=>M()}catch{at([])}},[fe]),I.useEffect(()=>{const l=De.map(M=>M.id);if(!l.length){Pe&&Ht("");return}l.includes(Pe)||Ht(l[0])},[De,Pe]),I.useEffect(()=>{const l=Ua.currentUser;l&&Er(l.uid);const M=Lo(Ua,w=>Er(w?w.uid:null));return()=>M()},[]),I.useEffect(()=>{if(!fe){je([]);return}try{const l=ei($e,"users",fe,"geofences"),M=vr(l,Lr("createdAt","asc")),w=Cr(M,D=>{const V=D.docs.map(K=>({id:K.id,...K.data()}));je(V),vi(null)},D=>{console.error("Firebase error:",D),vi("Failed to load geofences. Please check your connection."),je([])});return()=>w()}catch(l){console.error("Firebase setup error:",l),vi("Failed to connect to database."),je([])}},[fe]),I.useEffect(()=>{if(!fe){yi([]),de(!1),me(null);return}de(!0);const l=ei($e,"users",fe,"geofenceStates"),M=Cr(l,w=>{const D=w.docs.map(V=>({id:V.id,...V.data()||{}}));yi(D),de(!1),me(null)},w=>{console.error("Failed to load geofence status states",w),de(!1),me("Unable to load current location status."),yi([])});return()=>M()},[fe]),I.useEffect(()=>{if(!fe){ve([]),Vt(!1),vt(null),At(""),Ki(""),Wi("");return}Vt(!0);const l=vr(ei($e,"users",fe,"geofenceEvents"),Lr("timestamp","desc"),ua(30)),M=Cr(l,w=>{const D=w.docs.map(V=>({id:V.id,...V.data()||{}}));ve(D),Vt(!1),vt(null)},w=>{console.error("Failed to load recent geofence activity",w),ve([]),Vt(!1),vt("Unable to load recent activity right now.")});return()=>M()},[fe]),I.useEffect(()=>{Pt&&!ur.some(l=>l.id===Pt)&&Ki(""),Tt&&!hr.some(l=>l.id===Tt)&&Wi("")},[Pt,Tt,ur,hr]),I.useEffect(()=>{if(!fe||De.length===0){we({}),Te({});return}let l=!1;return(async()=>{try{const w=await Promise.all(De.map(async D=>{if(!D.hardwareId)return[D.id,null];const V=await fn(mi($e,"airtags",D.hardwareId));if(!V.exists())return[D.id,null,null];const K=V.data()||{},U=Number(K.lastLocationTs);let Z=te(K.lastLocation)||te(K.location)||te({lat:K.lat,lng:K.lng,latitude:K.latitude,longitude:K.longitude});if(!Z&&Number.isFinite(U)&&U>0){const he=await fn(mi($e,"airtags",D.hardwareId,"locations",String(U)));if(he.exists()){const se=he.data()||{};Z=te(se.lastLocation)||te({lat:se.lat,lng:se.lng,latitude:se.latitude,longitude:se.longitude})||te(se)}}if(!Z){const he=vr(ei($e,"airtags",D.hardwareId,"locations"),Lr("timestampMs","desc"),ua(1)),nt=(await Va(he)).docs[0];if(nt){const ee=nt.data()||{};Z=te(ee.lastLocation)||te({lat:ee.lat,lng:ee.lng,latitude:ee.latitude,longitude:ee.longitude})||te(ee)}}return[D.id,Number.isFinite(U)?new Date(U):null,Z||null]}));if(l)return;we(Object.fromEntries(w.map(([D,V])=>[D,V]))),Te(Object.fromEntries(w.map(([D,,V])=>[D,V])))}catch{}})(),()=>{l=!0}},[fe,De]);const Xt=I.useMemo(()=>{const l=De.filter(U=>U.isActive!==!1),M=Ge.filter(U=>U.active!==!1).map(U=>({id:U.id,name:U.name||"Unnamed geofence",color:U.color||"#0066cc",tags:[]})),w=new Map(M.map(U=>[U.id,U])),D=new Map,V={};et.forEach(U=>{U?.tagId&&(D.has(U.tagId)||D.set(U.tagId,[]),D.get(U.tagId).push(U))});const K=[];return l.forEach(U=>{const Z=te(ye[U.id]),he=(D.get(U.id)||[]).map(ee=>{const Ce=ee.lastChecked?.toDate?ee.lastChecked.toDate():new Date(ee.lastChecked?.seconds?ee.lastChecked.seconds*1e3:ee.lastChecked),Bt=te(ee.lastLocation)||te(ee.location)||te(ee.lastKnownLocation)||te(ee);return Bt&&(V[U.id]=Bt),{...ee,checked:Ce,location:Bt}}).sort((ee,Ce)=>{const Bt=ee.checked instanceof Date&&!Number.isNaN(ee.checked.getTime())?ee.checked.getTime():0;return(Ce.checked instanceof Date&&!Number.isNaN(Ce.checked.getTime())?Ce.checked.getTime():0)-Bt});!V[U.id]&&Z&&(V[U.id]=Z);const se=he.filter(ee=>ee.currentState==="inside"&&w.has(ee.geofenceId)),nt={tagId:U.id,tagName:U.customName||`Tag ${U.id.slice(-4)}`,tagColor:/^#([0-9a-fA-F]{3}){1,2}$/.test(U.color||"")?U.color:"#0066cc",lastSeen:Ee[U.id]||null};if(se.length>0)se.forEach(ee=>{const Ce=w.get(ee.geofenceId);Ce&&Ce.tags.push({...nt,state:"inside",lastChecked:ee.checked||null,location:ee.location||Z||null})});else{const ee=he[0]||null;K.push({...nt,state:ee?.currentState||"unknown",lastChecked:ee?.checked||null,location:ee?.location||Z||null})}}),M.forEach(U=>{U.tags.sort((Z,he)=>{const se=Z.lastSeen instanceof Date?Z.lastSeen.getTime():0;return(he.lastSeen instanceof Date?he.lastSeen.getTime():0)-se})}),K.sort((U,Z)=>{const he=U.lastSeen instanceof Date?U.lastSeen.getTime():0;return(Z.lastSeen instanceof Date?Z.lastSeen.getTime():0)-he}),{geofenceBuckets:M,outsideTags:K,lastLocationByTag:V}},[De,Ge,et,Ee,ye]),cr=I.useMemo(()=>{const l=new Map;return et.forEach(M=>{if(!M?.tagId)return;const w=M.lastChecked?.toDate?M.lastChecked.toDate():new Date(M.lastChecked?.seconds?M.lastChecked.seconds*1e3:M.lastChecked),D=w instanceof Date&&!Number.isNaN(w.getTime())?w.getTime():0,V=l.get(M.tagId);(!V||D>V.checkedMs)&&l.set(M.tagId,{state:M,checked:w,checkedMs:D})}),l},[et]),ae=I.useMemo(()=>De.map(M=>{const w=cr.get(M.id),D=te(Xt.lastLocationByTag[M.id])||te(ye[M.id])||te(w?.state?.lastLocation)||te(w?.state?.location)||null,V=Ee[M.id]||null,K=V instanceof Date?V.getTime():0,U=w?.checked instanceof Date&&!Number.isNaN(w.checked.getTime())?w.checked.getTime():0;return{tagId:M.id,tagName:M.customName||`Tag ${M.id.slice(-4)}`,tagColor:/^#([0-9a-fA-F]{3}){1,2}$/.test(M.color||"")?M.color:"#0066cc",isActive:M.isActive!==!1,location:D,lastSeen:V,lastChecked:w?.checked||null,sortTs:Math.max(K,U),lastSeenMs:K,lastCheckedMs:U}}),[De,cr,Xt.lastLocationByTag,ye,Ee]),Et=I.useMemo(()=>{const l=_i.trim().toLowerCase();let M=[...ae];return l&&(M=M.filter(w=>w.tagName.toLowerCase().includes(l))),M.sort((w,D)=>bi==="name_az"?w.tagName.localeCompare(D.tagName):bi==="name_za"?D.tagName.localeCompare(w.tagName):w.tagName.localeCompare(D.tagName)),M},[ae,_i,bi]),zi=I.useCallback(()=>{const l=jt();if(!l)return!1;const M=Et.map(w=>te(w.location)).filter(w=>w&&Number.isFinite(w.lat)&&Number.isFinite(w.lng)).map(w=>[w.lat,w.lng]);if(M.length===0)return!1;Ri(Date.now()+2e4);try{if(M.length===1){const[w,D]=M[0],V=Math.max(14,l.getZoom()||0);return typeof l.flyTo=="function"?l.flyTo([w,D],V,{animate:!0,duration:.8}):l.setView([w,D],V,{animate:!0}),gn(l,w,D),!0}return l.fitBounds(M,{paddingTopLeft:[ie?30:_t+24,96],paddingBottomRight:[30,ie?30:120],animate:!0,duration:.8,maxZoom:14}),!0}catch{return!1}},[Et,_t,ie]),qr=I.useMemo(()=>{const l={};return De.forEach(M=>{const w=te(Xt.lastLocationByTag[M.id])||te(ye[M.id]);if(!w)return;const D=Ee[M.id],V=D instanceof Date?D.getTime():null;l[M.id]=[{lat:w.lat,lng:w.lng,ts:D||null,timestampMs:Number.isFinite(V)?V:null}]}),l},[De,Xt.lastLocationByTag,ye,Ee]),$r=I.useMemo(()=>H==="status"?qr:H==="history"?st:{},[H,qr,st]);function Nn({enabled:l,onPickCenter:M}){const w=Vi();return I.useEffect(()=>{if(!l)return;const D=V=>M&&M(V.latlng);return w.getContainer().style.cursor="crosshair",w.on("click",D),()=>{w.off("click",D),w.getContainer().style.cursor=""}},[w,l,M]),null}function dr({center:l,radius:M,color:w="#0066cc"}){const D=Vi(),V=I.useRef(null);return I.useEffect(()=>{const K=Number(l?.lat),U=Number(l?.lng),Z=Number(M);if(!l||!Number.isFinite(K)||!Number.isFinite(U)||!Number.isFinite(Z)||Z<=0){V.current&&(V.current.remove(),V.current=null);return}V.current?(V.current.setLatLng([K,U]),V.current.setRadius(Z)):V.current=Ve.circle([K,U],{radius:Z,color:w,fillColor:w,fillOpacity:.1,weight:2,dashArray:"4,3"}).addTo(D)},[D,l,M,w]),I.useEffect(()=>()=>{V.current&&(V.current.remove(),V.current=null)},[D]),null}function Ui(){return I.useEffect(()=>{const l=document.querySelector(".global-header"),M=l?l.getBoundingClientRect().height:80,w=document.querySelectorAll(".leaflet-top");return w.forEach(D=>{D.style.marginTop=`${M+12}px`}),()=>{w.forEach(D=>{D.style.marginTop=""})}},[]),null}const Gn=()=>{const l=Za();Mi(l.center),gt(l.radius),mt(l.targetTagIds),Ei(l.name),Ai(l.color),Bi(l.emailEnabled),wi(l.emailAddress),si(l.alertOnEntry),Di(l.alertOnExit),er(null),Fi(!1)},rt=()=>{Zi(!1),Ji(null),Gn()},Yr=()=>{const l=Za();Zi(!0),Ji(null),Mi(l.center),gt(l.radius),mt(l.targetTagIds),Ei(l.name),Ai(l.color),Bi(l.emailEnabled),wi(l.emailAddress),si(l.alertOnEntry),Di(l.alertOnExit),er(pa(l)),Fi(!1)},Zt=l=>{const M={center:l.geometry?.center?{lat:Number(l.geometry.center.lat),lng:Number(l.geometry.center.lng)}:null,radius:Number(l.geometry?.radiusMeters||250),targetTagIds:Array.isArray(l.targetTagIds)&&l.targetTagIds.length>0?l.targetTagIds:["all"],name:l.name||"",color:l.color||_n,emailEnabled:!!l.alertPreferences?.emailEnabled,emailAddress:l.alertPreferences?.emailAddress||"",alertOnEntry:l.alertPreferences?.onEntry!==!1,alertOnExit:l.alertPreferences?.onExit!==!1};Zi(!1),Ji(l.id),Mi(M.center),gt(M.radius),mt(M.targetTagIds),Ei(M.name),Ai(M.color),Bi(M.emailEnabled),wi(M.emailAddress),si(M.alertOnEntry),Di(M.alertOnExit),er(pa(M)),Fi(!1)},pr=()=>{Rr(!1),Fr("continue")},zn=()=>{const l=$t.current;$t.current=null,typeof l=="function"&&l()},di=(l,M="continue")=>{if(!Ue){if(hi&&Ni){$t.current=l,Fr(M),Rr(!0);return}l()}},Xr=()=>{di(()=>{rt()},"cancel editing")},Zr=async()=>{if(Ue)return!1;try{if(Fi(!0),!Mt){const w=Object.values(Se)[0];return w&&We(w,"warning"),!1}Tr(!0);const l=!!it,M={name:Kt.trim(),color:Wt,updatedAt:ha(),geometry:{center:{lat:Xe.lat,lng:Xe.lng},radiusMeters:Rt},targetTagIds:tt,alertPreferences:{onEntry:Si,onExit:oi,emailEnabled:lt,emailAddress:lt?Ft.trim():null}};if(l){const w=mi($e,"users",fe,"geofences",it);await Ha(w,M),ca("edit_geofence",{method:"circle"}),da("edit_geofence"),We("Geofence updated.","success")}else{const w=ei($e,"users",fe,"geofences");await Mo(w,{active:!0,createdAt:ha(),type:"circle",...M}),ca("create_geofence",{method:"circle"}),da("create_geofence"),We("Geofence created.","success")}return rt(),!0}catch(l){return console.error("Failed to save geofence:",l),We("Failed to save geofence. Please try again.","error"),!1}finally{Tr(!1)}},Un=()=>{$t.current=null,pr()},Hn=()=>{pr(),rt(),zn()},Vn=async()=>{const l=$t.current;$t.current=null,pr(),await Zr()&&typeof l=="function"&&l()},Jr=()=>{xe||nr(null)},Kn=async()=>{if(!fe||!yt||xe)return;const{id:l}=yt;qt(l);try{await Eo(mi($e,"users",fe,"geofences",l)),it===l&&rt(),ca("delete_geofence",{}),da("delete_geofence"),We("Geofence deleted.","success")}catch(M){console.error("Failed to delete geofence:",M),We("Failed to delete geofence. Please try again.","error")}finally{qt(null),nr(null)}},Be=l=>{const M=!ie&&Ct;if(H===l){M&&ir(!1);return}di(()=>{M&&ir(!1),ne(l)},"switch sections")},Ne=_.jsxs("div",{style:{display:"grid",gap:10,width:"100%",minWidth:0,overflow:"hidden"},children:[ut&&Se.auth&&_.jsx("div",{style:{fontSize:12,color:"#b02a37",fontWeight:600},children:Se.auth}),_.jsxs("div",{style:{display:"grid",gap:6,minWidth:0},children:[_.jsx("input",{type:"text",placeholder:"Geofence name",value:Kt,onChange:l=>Ei(l.target.value),style:{width:"100%",maxWidth:"100%",boxSizing:"border-box",padding:8,borderRadius:8,border:ut&&Se.name?"1px solid #dc3545":"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a"}}),ut&&Se.name&&_.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Se.name}),_.jsx("span",{style:{color:"#6c757d",fontSize:12,lineHeight:1.35},children:"Click the map to set or adjust the geofence center."}),ut&&Se.center&&_.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Se.center})]}),_.jsxs("div",{style:{display:"grid",gap:6,minWidth:0},children:[_.jsx("span",{style:{color:"#495057",fontSize:13,fontWeight:600},children:"Radius (meters)"}),_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 90px",gap:8,alignItems:"center",minWidth:0},children:[_.jsx("input",{type:"range",min:25,max:5e3,step:25,value:Rt,onChange:l=>gt(Number(l.target.value)),style:{width:"100%"}}),_.jsx("input",{type:"number",min:1,value:Rt,onChange:l=>gt(Math.max(1,Number(l.target.value)||0)),style:{width:"100%",maxWidth:"100%",boxSizing:"border-box",padding:8,borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a"}})]})]}),_.jsxs("div",{style:{display:"grid",gap:6,minWidth:0},children:[_.jsx("span",{style:{color:"#495057",fontSize:13,fontWeight:600},children:"Monitor tags"}),_.jsxs("select",{value:tt.includes("all")?"all":"specific",onChange:l=>{l.target.value==="all"?mt(["all"]):mt([])},style:{width:"100%",maxWidth:"100%",boxSizing:"border-box",padding:8,borderRadius:8,border:ut&&Se.tags?"1px solid #dc3545":"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a"},children:[_.jsx("option",{value:"all",children:"All tags"}),_.jsx("option",{value:"specific",children:"Specific tags"})]}),ut&&Se.tags&&tt.includes("all")&&_.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Se.tags})]}),!tt.includes("all")&&_.jsx("div",{style:{border:ut&&Se.tags?"1px solid #dc3545":"1px solid #dee2e6",borderRadius:8,padding:8,maxHeight:120,overflowY:"auto",background:"#f8f9fa",minWidth:0},children:ze.map(l=>_.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 0",cursor:"pointer",fontSize:13,color:"#1a1a1a",minWidth:0},children:[_.jsx("input",{type:"checkbox",checked:tt.includes(l.id),onChange:M=>{M.target.checked?mt(w=>[...w,l.id]):mt(w=>w.filter(D=>D!==l.id))}}),_.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:l.color||"#0066cc",marginRight:"4px",flexShrink:0}}),_.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.customName||`Tag ${l.id.slice(0,8)}`})]},l.id))}),ut&&Se.tags&&!tt.includes("all")&&_.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Se.tags}),_.jsxs("div",{style:{display:"grid",gap:8,marginTop:2,minWidth:0},children:[_.jsx("span",{style:{color:"#495057",fontSize:13,fontWeight:600},children:"Geofence color"}),_.jsx("div",{role:"radiogroup","aria-label":"Geofence color",style:{display:"flex",gap:ie?4:6,flexWrap:"wrap",minWidth:0},children:Or.map(l=>_.jsx("button",{type:"button",onClick:()=>Ai(l),role:"radio","aria-checked":Wt===l,"aria-label":`Set geofence color ${l}`,style:{width:ie?20:24,height:ie?20:24,borderRadius:"50%",background:l,border:Wt===l?"2px solid #1a1a1a":"1px solid #adb5bd",cursor:"pointer",transform:Wt===l?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",flexShrink:0,padding:0},title:l},l))})]}),_.jsxs("div",{style:{display:"grid",gap:8,marginTop:2,minWidth:0},children:[_.jsx("span",{style:{color:"#495057",fontSize:13,fontWeight:600},children:"Email alerts"}),_.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",color:"#1a1a1a",minWidth:0},children:[_.jsx("input",{type:"checkbox",checked:lt,onChange:l=>Bi(l.target.checked),style:{width:16,height:16}}),_.jsx("span",{style:{fontSize:13,lineHeight:1.3},children:"Enable email notifications"})]})]}),lt&&_.jsxs(_.Fragment,{children:[_.jsx("input",{type:"email",placeholder:"Email address",value:Ft,onChange:l=>wi(l.target.value),required:lt,style:{width:"100%",maxWidth:"100%",boxSizing:"border-box",padding:8,borderRadius:8,border:ut&&Se.email?"1px solid #dc3545":"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a"}}),ut&&Se.email&&_.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Se.email}),_.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center",flexWrap:"wrap"},children:[_.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[_.jsx("input",{type:"checkbox",checked:Si,onChange:l=>si(l.target.checked),style:{width:14,height:14}}),_.jsx("span",{style:{color:"#1a1a1a",fontSize:13},children:"Alert on entry"})]}),_.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",color:"#1a1a1a"},children:[_.jsx("input",{type:"checkbox",checked:oi,onChange:l=>Di(l.target.checked),style:{width:14,height:14}}),_.jsx("span",{style:{fontSize:13},children:"Alert on exit"})]})]})]}),Ni&&_.jsx("div",{style:{fontSize:12,color:"#b02a37",fontWeight:600},children:"Unsaved changes"}),_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:6},children:[_.jsx("button",{onClick:Zr,disabled:Ue,style:{width:"100%",padding:ie?"8px 12px":"8px 14px",minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:Ue?"#666":Mt?"#0066cc":"#e9ecef",color:Ue||Mt?"#fff":"#6c757d",fontWeight:700,fontSize:15,cursor:Ue?"not-allowed":"pointer",opacity:Ue?.7:1,outline:"none"},children:Ue?"Saving...":it?"Update":"Save"}),_.jsx("button",{onClick:Xr,style:{width:"100%",padding:ie?"8px 12px":"8px 14px",minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:"#e9ecef",color:"#1a1a1a",fontSize:15,fontWeight:600,cursor:"pointer",outline:"none"},children:"Cancel"})]})]});function Qr({items:l}){const M=Vi(),w=I.useRef(null);return I.useEffect(()=>{w.current||(w.current=Ve.layerGroup().addTo(M));const D=w.current;return D.clearLayers(),l.forEach(V=>{if(V.active!==!1){if(V.type==="circle"&&V.geometry?.center){const K=Number(V.geometry.center.lat),U=Number(V.geometry.center.lng),Z=Number(V.geometry.radiusMeters||100);if(!Number.isFinite(K)||!Number.isFinite(U)||!Number.isFinite(Z)||Z<=0)return;Ve.circle([K,U],{radius:Z,color:V.color||"#0066cc",fillColor:V.color||"#0066cc",fillOpacity:.1,weight:2}).addTo(D)}else if(V.type==="polygon"&&V.geometry){const K=V.geometry;let U=[];try{K&&Array.isArray(K.coordinates)&&(K.type==="Polygon"?U=Array.isArray(K.coordinates[0])?K.coordinates[0]:[]:K.type==="MultiPolygon"&&(U=Array.isArray(K.coordinates[0])&&Array.isArray(K.coordinates[0][0])?K.coordinates[0][0]:[]))}catch{U=[]}const Z=Array.isArray(U)?U.filter(he=>Array.isArray(he)&&he.length>=2).map(([he,se])=>[Number(se),Number(he)]).filter(([he,se])=>Number.isFinite(he)&&Number.isFinite(se)):[];Z.length>=3&&Ve.polygon(Z,{color:V.color||"#0066cc",fillColor:V.color||"#0066cc",fillOpacity:.1,weight:2}).addTo(D)}}}),()=>{D.clearLayers()}},[M,l]),null}return I.useEffect(()=>{if(!ni||!ot)return;const l=setInterval(()=>{ki(M=>{if(!M)return Yt;const w=M+1e3*60*Xi;return w>=kt?(ai(!1),kt):w})},100);return()=>clearInterval(l)},[ni,ot,Xi,Yt,kt]),_.jsxs("div",{style:{height:"100vh",width:"100%",background:"#f0f0f0",position:"relative",overflow:"hidden"},children:[xi&&_.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(255,165,0,0.9)",color:"white",padding:"12px 20px",borderRadius:"8px",zIndex:4e3,textAlign:"center",maxWidth:"400px"},children:[_.jsx("div",{style:{fontSize:"14px"},children:xi}),_.jsx("div",{style:{fontSize:"12px",marginTop:"4px",opacity:.8},children:"Map will still work, but geofences may not load."})]}),_.jsx("div",{style:{height:ie?`${or}px`:"100%",width:"100%",position:"absolute",top:ie?"5rem":0,left:0,zIndex:1},children:_.jsxs(Co,{ref:$i,center:J,zoom:5,minZoom:1,maxZoom:19,zoomSnap:1,zoomDelta:1,style:{height:"100%",width:"100%"},zoomControl:!1,scrollWheelZoom:!0,zoomAnimation:!1,fadeAnimation:!1,inertia:!1,whenReady:l=>{console.log("MapContainer ready"),l?.target&&typeof l.target.fitBounds=="function"&&(Li.current=l.target),Cn(!0),window.__mapContainerReady=!0,setTimeout(()=>{jt()?.invalidateSize()},100)},children:[_.jsx(ko,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"© OpenStreetMap contributors & CartoDB",maxZoom:19,minZoom:1}),_.jsx(To,{}),_.jsx(Po,{offsetX:ie?0:_t+24}),_.jsx(Ui,{}),_.jsx(Qr,{items:Ge}),_.jsx(Nn,{enabled:ft||!!it,onPickCenter:Mi}),_.jsx(dr,{center:Xe,radius:Rt}),_.jsx(Ro,{pathsByTag:$r,myTags:ze,showPathLines:H==="history"?ri:!1,renderPointTrail:H==="history",maxTimestamp:H==="history"&&ot?Ci:null,fitBoundsPadding:Tn,manualViewportUntil:Sn})]})}),!ie&&_.jsx("div",{style:{position:"fixed",bottom:16,right:12,zIndex:3100,display:"grid",width:`min(560px, calc(100% - ${Pn+24}px))`,gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:12},children:Rn.map(l=>_.jsxs("div",{style:{borderRadius:12,border:`1px solid ${l.border}`,background:l.tint,backdropFilter:"blur(6px)",padding:"10px 14px",display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:64,gap:10},children:[_.jsx("span",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a",lineHeight:1.2},children:l.label}),_.jsx("span",{style:{fontSize:30,lineHeight:1,fontWeight:700,color:"#1a1a1a"},children:l.value})]},l.label))}),_.jsxs("div",{id:"map-ui",style:{position:"fixed",...ie?{top:`${Hr}px`,left:0,right:0,bottom:0,width:"100%",borderRadius:0,display:"flex",flexDirection:"column",touchAction:"pan-y"}:{top:"calc(5rem + 12px)",left:12,bottom:12,width:`${_t}px`,borderRadius:14,display:"flex",flexDirection:"column"},background:"rgba(255,255,255,0.98)",border:"1px solid #dee2e6",color:"#1a1a1a",zIndex:3e3,backdropFilter:"blur(6px)",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",overflow:"hidden"},children:[ie&&_.jsx("div",{role:"separator","aria-label":"Resize panel","aria-orientation":"horizontal",onPointerDown:l=>{l.pointerType==="mouse"&&l.button!==0||(l.preventDefault(),An(l.clientY))},style:{padding:"6px 0 4px",borderBottom:"1px solid #edf0f2",display:"grid",placeItems:"center",cursor:tr?"row-resize":"ns-resize",touchAction:"none",background:"#fff",flexShrink:0},children:_.jsx("span",{style:{width:54,height:5,borderRadius:9999,background:"#c7ced6"}})}),_.jsxs("div",{style:{padding:ui?"8px 6px":"10px 10px 8px 10px",borderBottom:"1px solid #edf0f2"},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:ui?"center":"space-between",gap:8},children:[!ui&&_.jsx("div",{style:{fontSize:11,fontWeight:800,letterSpacing:"0.08em",color:"#6c757d"},children:"ASSETS & CONTROLS"}),!ie&&_.jsx("button",{onClick:()=>ir(l=>!l),"aria-label":Ct?"Expand sidebar":"Collapse sidebar",title:Ct?"Expand sidebar":"Collapse sidebar",style:{width:38,height:38,borderRadius:10,border:"1px solid #d3d9df",background:"#f8f9fa",color:"#1a1a1a",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",flexShrink:0,padding:0,outline:"none"},children:_.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[_.jsx("path",{d:"M4 6H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),_.jsx("path",{d:"M4 12H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),_.jsx("path",{d:"M4 18H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})})]}),!ui&&ie&&_.jsx("div",{style:{display:"flex",gap:6,marginTop:8,overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",paddingBottom:2},children:Ii.map(l=>_.jsx("button",{onClick:()=>Be(l.id),style:{minHeight:34,padding:"6px 12px",borderRadius:9999,border:H===l.id?"1px solid #0066cc":"1px solid #dee2e6",background:H===l.id?"#0066cc":"#e9ecef",color:H===l.id?"#fff":"#1a1a1a",fontWeight:700,fontSize:12,lineHeight:1,cursor:"pointer",outline:"none",whiteSpace:"nowrap",flex:"0 0 auto"},children:l.shortLabel},l.id))})]}),ui?_.jsx("div",{style:{flex:1,display:"grid",alignContent:"start",justifyItems:"center",gap:8,padding:"10px 0"},children:Ii.map(l=>_.jsx("button",{onClick:()=>Be(l.id),title:l.label,"aria-label":l.label,style:{width:42,minHeight:42,height:42,borderRadius:10,border:"1px solid #d3d9df",background:H===l.id?"#0066cc":"#f8f9fa",color:H===l.id?"#fff":"#1a1a1a",fontSize:16,cursor:"pointer",outline:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:1,padding:0,overflow:"hidden"},children:l.icon},l.id))}):_.jsxs("div",{style:{...ie?{flex:1,minHeight:0,overflow:"hidden",display:"flex",flexDirection:"column",padding:"0 12px 12px 12px",touchAction:"pan-y"}:{flex:1,minHeight:0,display:"grid",gridTemplateColumns:"46px minmax(0, 1fr)",gap:10,padding:"8px 10px 12px 10px",overflow:"hidden"}},children:[!ie&&_.jsx("div",{style:{padding:"10px 0",display:"grid",alignContent:"start",justifyItems:"center",gap:8,overflowY:"auto"},children:Ii.map(l=>_.jsx("button",{onClick:()=>Be(l.id),title:l.label,"aria-label":l.label,style:{width:42,minHeight:42,height:42,borderRadius:10,border:"1px solid #d3d9df",background:H===l.id?"#0066cc":"#f8f9fa",color:H===l.id?"#fff":"#1a1a1a",fontSize:16,cursor:"pointer",outline:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:1,padding:0,overflow:"hidden"},children:l.icon},l.id))}),_.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"},children:[!ie&&_.jsxs("div",{style:{padding:"2px 2px 8px 2px",flexShrink:0},children:[_.jsx("div",{style:{fontSize:18,fontWeight:800,color:"#1a1a1a",lineHeight:1.2},children:Nr.title}),_.jsx("div",{style:{marginTop:2,fontSize:12,color:"#6c757d",lineHeight:1.35},children:Nr.description})]}),H==="status"&&_.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",gap:8,...ie?{overflowY:"auto",overflowX:"hidden",paddingRight:2,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}:{overflow:"hidden"}},children:[le&&_.jsx("div",{style:{fontSize:12,color:"#b02a37",fontWeight:600},children:le}),pe?_.jsx("div",{style:{flex:1,minHeight:140,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",display:"grid",placeItems:"center",color:"#6c757d",fontSize:13},children:"Loading current locations..."}):_.jsxs("div",{style:{...ie?{border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",overflow:"hidden",display:"flex",flexDirection:"column",flexShrink:0}:{flex:1,minHeight:0,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",overflow:"hidden",display:"flex",flexDirection:"column"}},children:[_.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px solid #dee2e6",fontWeight:700,color:"#1a1a1a",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[_.jsx("span",{children:"Tags"}),_.jsxs("span",{style:{fontSize:12,color:"#6c757d"},children:[Et.length,_i.trim()?` / ${ae.length}`:""]})]}),_.jsxs("div",{style:{borderBottom:"1px solid #dee2e6",padding:10,display:"grid",gap:8},children:[_.jsx("input",{type:"text",value:_i,onChange:l=>vn(l.target.value),placeholder:"Search tags",style:{width:"100%",minHeight:36,padding:"8px 10px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:13,boxSizing:"border-box"}}),_.jsxs("div",{style:{display:"grid",gap:8,alignItems:"center",...ie?{gridTemplateColumns:"minmax(0, 1fr) auto"}:{gridTemplateColumns:"minmax(110px, 1fr) auto"}},children:[_.jsxs("select",{value:bi,onChange:l=>Ln(l.target.value),style:{width:"100%",minWidth:110,minHeight:34,padding:"6px 8px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12},children:[_.jsx("option",{value:"name_az",children:"Name A-Z"}),_.jsx("option",{value:"name_za",children:"Name Z-A"})]}),_.jsx("button",{onClick:()=>{zi()||We("No visible tag locations to fit on the map.","warning")},style:{minWidth:78,minHeight:34,padding:"6px 10px",borderRadius:8,border:"1px solid #0066cc",background:"#0066cc",color:"#fff",fontSize:12,fontWeight:700,cursor:"pointer",whiteSpace:"nowrap"},children:"Fit all"})]})]}),_.jsx("div",{style:{...ie?{maxHeight:"42vh",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}:{flex:1,minHeight:0,overflowY:"auto"}},children:ae.length===0?_.jsx("div",{style:{padding:10,fontSize:12,color:"#6c757d"},children:"No linked tags are available yet."}):Et.length===0?_.jsx("div",{style:{padding:10,fontSize:12,color:"#6c757d"},children:"No tags match the current filters."}):_.jsx("ul",{style:{listStyle:"none",margin:0,padding:0},children:Et.map((l,M)=>_.jsxs("li",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:8,padding:"10px 10px",borderBottom:M<Et.length-1?"1px solid #e8ecef":"none"},children:[_.jsxs("div",{style:{minWidth:0},children:[_.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:7,maxWidth:"100%"},children:[_.jsx("span",{style:{width:8,height:8,borderRadius:9999,background:l.tagColor,flexShrink:0}}),_.jsx("span",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.tagName}),!l.isActive&&_.jsx("span",{style:{fontSize:10,fontWeight:700,color:"#6c757d",background:"#e9ecef",borderRadius:9999,padding:"2px 6px",flexShrink:0},children:"Inactive"})]}),_.jsxs("div",{style:{fontSize:12,color:"#6c757d",marginTop:2},children:["Last seen ",ar(l.lastSeen||l.lastChecked)]})]}),_.jsx("button",{onClick:async()=>{await Gi(l.tagId,l.location)||We("No location available for this tag yet.","warning")},style:{width:32,minHeight:32,borderRadius:8,border:"none",background:"transparent",color:"#0066cc",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:0},title:"Center map on this tag","aria-label":`Center map on ${l.tagName}`,children:_.jsx(kr,{})})]},`location-list-${l.tagId}`))})})]})]}),H==="history"&&_.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",overflowY:"auto",overflowX:"hidden",paddingRight:2,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:[_.jsxs("div",{style:{marginBottom:10,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",padding:10,display:"grid",gap:8,flexShrink:0},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[_.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a"},children:"Tag selector"}),Ae&&_.jsx("button",{onClick:()=>In(Ae.id),style:{width:30,minHeight:30,borderRadius:8,border:"none",background:"transparent",color:"#0066cc",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:0},"aria-label":"Center map on selected history tag",title:`Center map on ${Ae.customName||`Tag ${Ae.id.slice(0,8)}`}`,children:_.jsx(kr,{})})]}),_.jsxs("select",{value:Pe,onChange:l=>{const M=l.target.value,w=It.find(D=>D.id===M);w&&!w.isLinked||(Ht(M),ki(null),ai(!1))},style:{width:"100%",minHeight:44,padding:"8px 12px",borderRadius:10,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:14,lineHeight:1.2,minWidth:0},children:[_.jsx("option",{value:"",children:"Select a linked tag"}),It.map(l=>_.jsx("option",{value:l.id,disabled:!l.isLinked,children:l.name},l.id))]})]}),De.length===0&&_.jsx("div",{style:{marginBottom:10,padding:"10px 12px",borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",fontSize:12,color:"#6c757d",lineHeight:1.4},children:"No linked tags yet. Activate a tag in Settings to view location history."}),_.jsxs("div",{style:{marginBottom:10,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",padding:10,display:"grid",gap:8,flexShrink:0},children:[_.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a"},children:"Time Range"}),_.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[{value:"12h",label:"12h"},{value:"24h",label:"24h"},{value:"7d",label:"7d"},{value:"30d",label:"30d"},{value:"custom",label:"Custom"}].map(l=>{const M=oe===l.value;return _.jsx("button",{onClick:()=>N(l.value),disabled:!Ae,style:{minHeight:36,padding:"8px 10px",borderRadius:9999,border:M?"1px solid #0066cc":"1px solid #dee2e6",background:M?"#0066cc":"#f8f9fa",color:M?"#fff":Ae?"#1a1a1a":"#6c757d",fontSize:12,fontWeight:700,cursor:Ae?"pointer":"not-allowed",opacity:Ae?1:.72},children:l.label},`time-range-${l.value}`)})}),oe==="custom"&&Ae&&_.jsxs("div",{style:{marginTop:2,padding:10,border:"1px solid #d4dbe2",borderRadius:8,background:"#fff"},children:[_.jsxs("div",{style:{display:"grid",gap:8,gridTemplateColumns:ie?"1fr":"repeat(2, minmax(0, 1fr))"},children:[_.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["Start",_.jsx("input",{type:"datetime-local",value:Me,max:Ye||void 0,onChange:l=>Oe(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",padding:8,borderRadius:6,border:"1px solid #dee2e6",background:"#fff",color:"#1a1a1a"}})]}),_.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["End",_.jsx("input",{type:"datetime-local",value:Ye,min:Me||void 0,onChange:l=>Qe(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",padding:8,borderRadius:6,border:"1px solid #dee2e6",background:"#fff",color:"#1a1a1a"}})]})]}),!Dn&&_.jsx("div",{style:{marginTop:8,fontSize:12,color:"#dc3545"},children:"Choose a valid range where the end time is after the start time."})]})]}),_.jsx("div",{style:{marginBottom:10,padding:"10px 12px",borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",fontSize:12,color:"#6c757d",flexShrink:0},children:De.length===0?"Link and activate a tag to begin history playback.":Pe?`${(st[Pe]||[]).length} points loaded for selected range.`:"Select a tag and time range to load history."}),Ae?_.jsxs(_.Fragment,{children:[_.jsxs("div",{style:{marginTop:10,marginBottom:10,padding:"10px 12px",borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,color:"#1a1a1a",flexShrink:0},children:[_.jsx("span",{style:{lineHeight:1.2,fontSize:13,fontWeight:600},children:"Show path lines"}),_.jsx("button",{type:"button","aria-pressed":ri,onClick:()=>kn(l=>!l),style:{width:44,height:24,borderRadius:9999,border:"1px solid #adb5bd",background:ri?"#0066cc":"#e9ecef",position:"relative",cursor:"pointer",padding:0},title:ri?"Hide path lines":"Show path lines",children:_.jsx("span",{style:{position:"absolute",top:1,left:ri?22:1,width:20,height:20,borderRadius:9999,background:"#fff",boxShadow:"0 1px 2px rgba(0,0,0,0.2)"}})})]}),_.jsxs("div",{style:{marginBottom:8,padding:"10px 12px",background:"#f8f9fa",borderRadius:8,border:"1px solid #dee2e6",flexShrink:0},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,minWidth:0},children:[_.jsx("span",{style:{color:"#1a1a1a",fontWeight:600,fontSize:13},children:"Timeline playback"}),_.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,flexShrink:0},children:[_.jsx("span",{style:{fontSize:12,color:ot?"#0f5132":"#6c757d",fontWeight:700},children:ot?"On":"Off"}),_.jsx("button",{type:"button","aria-pressed":ot,onClick:()=>Mn(!ot),style:{width:44,height:24,borderRadius:9999,border:"1px solid #adb5bd",background:ot?"#0066cc":"#e9ecef",position:"relative",cursor:"pointer",padding:0},children:_.jsx("span",{style:{position:"absolute",top:1,left:ot?22:1,width:20,height:20,borderRadius:9999,background:"#fff",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",transition:"left 0.2s ease"}})})]})]}),_.jsx("div",{style:{marginTop:6,fontSize:12,color:"#6c757d",lineHeight:1.35},children:"Animate tag movement through the selected time range."})]}),ot&&_.jsxs("div",{style:{marginTop:8,marginBottom:12,padding:"12px",background:"#f8f9fa",borderRadius:8,border:"1px solid #dee2e6",flexShrink:0},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,flexWrap:"wrap"},children:[_.jsx("button",{onClick:()=>ai(!ni),style:{padding:"6px 12px",borderRadius:6,border:"1px solid #dee2e6",background:ni?"#dc3545":"#0066cc",color:"#fff",fontWeight:600,cursor:"pointer"},children:ni?"⏸ Pause":"▶ Play"}),_.jsx("button",{onClick:()=>{ki(null),ai(!1)},style:{padding:"6px 12px",borderRadius:6,border:"1px solid #dee2e6",background:"#e9ecef",color:"#1a1a1a",fontWeight:600,cursor:"pointer"},children:"Reset"}),_.jsxs("select",{value:Xi,onChange:l=>Sr(Number(l.target.value)),style:{padding:"6px 8px",borderRadius:6,border:"1px solid #dee2e6",background:"#fff",color:"#1a1a1a"},children:[_.jsx("option",{value:.5,children:"0.5x"}),_.jsx("option",{value:1,children:"1x"}),_.jsx("option",{value:2,children:"2x"}),_.jsx("option",{value:4,children:"4x"})]})]}),_.jsx("input",{type:"range",min:Yt,max:kt,value:Ci||kt,onChange:l=>{ki(Number(l.target.value)),ai(!1)},style:{width:"100%",height:8,cursor:"pointer",accentColor:"#0066cc"}}),_.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#6c757d",marginTop:4},children:[_.jsx("span",{children:new Date(Yt).toLocaleString()}),_.jsx("span",{children:Ci?new Date(Ci).toLocaleString():oe==="custom"?new Date(kt).toLocaleString():"Live"})]})]})]}):_.jsx("div",{style:{marginTop:8,fontSize:12,color:"#6c757d",flexShrink:0},children:"Select a tag to enable path lines and timeline playback."})]}),H==="activity"&&_.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",gap:8,...ie?{overflowY:"auto",overflowX:"hidden",paddingRight:2,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}:{overflow:"hidden"}},children:[ii&&_.jsx("div",{style:{fontSize:12,color:"#b02a37",fontWeight:600},children:ii}),_.jsxs("div",{style:{padding:"8px 10px",border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",fontSize:12,color:"#6c757d",lineHeight:1.35,flexShrink:0},children:["Latest geofence entry and exit events from your tags",Ie.length>0?` (${Gt.length}${Gt.length!==Ie.length?` of ${Ie.length}`:""})`:""]}),_.jsxs("div",{style:{padding:10,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",display:"grid",gap:8,flexShrink:0},children:[_.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a"},children:"Filters"}),_.jsxs("div",{style:{display:"grid",gap:8,gridTemplateColumns:lr?"1fr":"repeat(3, minmax(0, 1fr))"},children:[_.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["Event",_.jsxs("select",{value:Lt,onChange:l=>At(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",minHeight:34,padding:"6px 8px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12},children:[_.jsx("option",{value:"",children:"All"}),_.jsx("option",{value:"entry",children:"Entered"}),_.jsx("option",{value:"exit",children:"Exited"})]})]}),_.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["Tag",_.jsxs("select",{value:Pt,onChange:l=>Ki(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",minHeight:34,padding:"6px 8px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12},children:[_.jsx("option",{value:"",children:"All"}),ur.map(l=>_.jsx("option",{value:l.id,children:l.name},`activity-tag-${l.id}`))]})]}),_.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["Geofence",_.jsxs("select",{value:Tt,onChange:l=>Wi(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",minHeight:34,padding:"6px 8px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12},children:[_.jsx("option",{value:"",children:"All"}),hr.map(l=>_.jsx("option",{value:l.id,children:l.name},`activity-geofence-${l.id}`))]})]})]})]}),Ke?_.jsx("div",{style:{flex:1,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",display:"grid",placeItems:"center",color:"#6c757d",fontSize:13},children:"Loading recent activity..."}):_.jsxs("div",{style:{...ie?{border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",overflow:"hidden",display:"flex",flexDirection:"column",flexShrink:0}:{flex:1,minHeight:0,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",overflow:"hidden",display:"flex",flexDirection:"column"}},children:[_.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px solid #dee2e6",fontWeight:700,color:"#1a1a1a",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[_.jsx("span",{children:"Events"}),_.jsx("span",{style:{fontSize:12,color:"#6c757d"},children:Gt.length})]}),_.jsx("div",{style:{...ie?{overflowY:"visible",overflowX:"hidden"}:{flex:1,minHeight:0,overflowY:"auto",overflowX:lr?"hidden":"auto"}},children:Nt.length===0?_.jsx("div",{style:{padding:10,fontSize:12,color:"#6c757d"},children:"No recent geofence activity."}):Gt.length===0?_.jsx("div",{style:{padding:10,fontSize:12,color:"#6c757d"},children:"No events match the selected filters."}):lr?_.jsx("ul",{style:{listStyle:"none",margin:0,padding:0},children:Gt.map((l,M)=>{const w=!!te(l.location);return _.jsxs("li",{style:{padding:"10px 10px",borderBottom:M<Gt.length-1?"1px solid #e8ecef":"none",display:"grid",gap:8},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[_.jsx("span",{style:{background:Ur(l.eventType),color:"#fff",padding:"3px 8px",borderRadius:6,fontSize:11,fontWeight:700},children:zr(l.eventType)}),_.jsx("span",{style:{fontSize:11,color:"#6c757d"},children:l.timestamp?ar(l.timestamp):"Unknown"})]}),_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:8},children:[_.jsxs("div",{style:{minWidth:0},children:[_.jsx("div",{style:{fontSize:13,color:"#1a1a1a",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.tagName}),_.jsx("div",{style:{marginTop:2,fontSize:12,color:"#6c757d",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.geofenceName})]}),_.jsx("button",{onClick:()=>{ci(l.location,14)||We("No location available for this event.","warning")},disabled:!w,style:{width:30,minHeight:30,borderRadius:8,border:"none",background:"transparent",color:w?"#0066cc":"#9aa3ad",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:w?"pointer":"not-allowed",padding:0},title:w?"Center map on this event":"No event location available","aria-label":w?`Center map on ${l.tagName} event`:`No location for ${l.tagName} event`,children:_.jsx(kr,{})})]})]},l.id)})}):_.jsxs("table",{style:{width:"100%",minWidth:560,borderCollapse:"collapse"},children:[_.jsx("thead",{children:_.jsxs("tr",{style:{background:"#f1f3f5",borderBottom:"1px solid #dee2e6"},children:[_.jsx("th",{style:{padding:"10px 12px",textAlign:"left",color:"#495057",fontSize:12,fontWeight:700},children:"Event"}),_.jsx("th",{style:{padding:"10px 12px",textAlign:"left",color:"#495057",fontSize:12,fontWeight:700},children:"Tag"}),_.jsx("th",{style:{padding:"10px 12px",textAlign:"left",color:"#495057",fontSize:12,fontWeight:700},children:"Geofence"}),_.jsx("th",{style:{padding:"10px 12px",textAlign:"right",color:"#495057",fontSize:12,fontWeight:700},children:"Time"}),_.jsx("th",{style:{padding:"10px 12px",textAlign:"right",color:"#495057",fontSize:12,fontWeight:700},children:"Map"})]})}),_.jsx("tbody",{children:Gt.map((l,M)=>{const w=!!te(l.location);return _.jsxs("tr",{style:{borderBottom:"1px solid #e8ecef",background:M%2===0?"#fff":"#fafbfc"},children:[_.jsx("td",{style:{padding:"10px 12px"},children:_.jsx("span",{style:{background:Ur(l.eventType),color:"#fff",padding:"3px 8px",borderRadius:6,fontSize:11,fontWeight:700},children:zr(l.eventType)})}),_.jsx("td",{style:{padding:"10px 12px",fontSize:13,color:"#1a1a1a",fontWeight:600},children:l.tagName}),_.jsx("td",{style:{padding:"10px 12px",fontSize:13,color:"#1a1a1a"},children:l.geofenceName}),_.jsx("td",{style:{padding:"10px 12px",textAlign:"right",fontSize:12,color:"#6c757d"},children:l.timestamp?ar(l.timestamp):"Unknown"}),_.jsx("td",{style:{padding:"10px 12px",textAlign:"right"},children:_.jsx("button",{onClick:()=>{ci(l.location,14)||We("No location available for this event.","warning")},disabled:!w,style:{width:30,minHeight:30,borderRadius:8,border:"none",background:"transparent",color:w?"#0066cc":"#9aa3ad",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:w?"pointer":"not-allowed",padding:0},title:w?"Center map on this event":"No event location available","aria-label":w?`Center map on ${l.tagName} event`:`No location for ${l.tagName} event`,children:_.jsx(kr,{})})})]},l.id)})})]})})]})]}),H==="settings"&&_.jsxs("div",{style:{flex:1,minHeight:0,display:"grid",gap:10,alignContent:"start"},children:[_.jsx("button",{onClick:()=>W("/settings"),style:{minHeight:42,borderRadius:10,border:"1px solid #0066cc",background:"#0066cc",color:"#fff",fontWeight:700,fontSize:14,cursor:"pointer",outline:"none"},children:"Open Settings"}),_.jsx("button",{onClick:()=>W("/dashboard"),style:{minHeight:42,borderRadius:10,border:"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a",fontWeight:700,fontSize:14,cursor:"pointer",outline:"none"},children:"Open Full Dashboard"})]}),H==="geofences"&&_.jsxs("div",{style:{...ie?{flex:1,padding:"0 12px 12px 12px"}:{flex:1,minHeight:0,display:"flex",flexDirection:"column"},display:"flex",flexDirection:"column",gap:8,minHeight:0},children:[_.jsx("div",{style:{display:"flex",gap:8,alignItems:"center"},children:_.jsx("button",{onClick:()=>{ft?Xr():di(()=>{Yr()},"start a new geofence")},style:{padding:"8px 14px",minHeight:40,borderRadius:10,border:"1px solid #0066cc",background:ft?"#e9ecef":"#0066cc",color:ft?"#1a1a1a":"#fff",fontWeight:700,fontSize:15,lineHeight:1,cursor:"pointer",outline:"none"},children:ft?"Cancel new geofence":"Add Circle"})}),xi&&_.jsxs("div",{style:{marginBottom:8,fontSize:12,color:"#ff6b6b"},children:["⚠️ ",xi]}),_.jsx("div",{style:{flex:1,minHeight:0,overflowY:"auto",paddingRight:2,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:_.jsxs("ul",{style:{listStyle:"none",padding:0,margin:0,display:"grid",gap:8},children:[ft&&_.jsx("li",{style:{border:"1px solid #dee2e6",borderRadius:10,padding:10,background:"#f8f9fa"},children:Ne}),Ge.length===0&&!ft&&_.jsx("li",{style:{color:"#6c757d"},children:"No geofences yet"}),Ge.map(l=>{const M=l.targetTagIds?.includes("all")?"All tags":l.targetTagIds?.map(K=>{const U=ze.find(he=>he.id===K);return U?.customName||U?.name||`Tag ${K.slice(0,8)}`}).join(", ")||"No tags",w=it===l.id,D=Ja(l),V=!!(D&&D.isValid&&D.isValid());return _.jsxs("li",{ref:K=>{K&&(Yi.current[l.id]=K)},style:{border:"1px solid #dee2e6",borderRadius:10,padding:10,background:"#f8f9fa"},children:[_.jsx("div",{style:{display:"flex",alignItems:"flex-start",gap:8,marginBottom:8},children:_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:[_.jsx("span",{style:{width:10,height:10,background:l.color||"#0066cc",borderRadius:2}}),_.jsxs("div",{style:{minWidth:0},children:[_.jsx("div",{style:{fontWeight:700,color:"#1a1a1a",lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.name||l.type}),_.jsxs("div",{style:{fontSize:12,color:"#6c757d",marginTop:2,lineHeight:1.25},children:[l.geometry?.radiusMeters,"m radius • ",M]})]})]})}),_.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[_.jsx("button",{disabled:xe===l.id,style:{padding:"8px 12px",minHeight:36,borderRadius:8,border:"1px solid #dee2e6",background:xe===l.id?"#666":l.active?"#e9ecef":"#0066cc",color:xe===l.id?"#fff":l.active?"#1a1a1a":"#fff",cursor:xe===l.id?"not-allowed":"pointer",fontSize:15,fontWeight:600,lineHeight:1,opacity:xe===l.id?.7:1,outline:"none"},onClick:async()=>{if(!(!fe||xe===l.id)){qt(l.id);try{await Ha(mi($e,"users",fe,"geofences",l.id),{active:!l.active,updatedAt:ha()}),We(l.active?"Geofence deactivated.":"Geofence activated.","success")}catch(K){console.error("Failed to update geofence:",K),We("Failed to update geofence. Please try again.","error")}finally{qt(null)}}},children:xe===l.id?"Updating...":l.active?"Deactivate":"Activate"}),_.jsx("button",{disabled:w,style:{padding:"8px 12px",minHeight:36,borderRadius:8,border:w?"1px solid #9cbce4":"1px solid #0066cc",background:w?"#dce9f8":"#0066cc",color:w?"#1f4f87":"#fff",cursor:w?"default":"pointer",fontSize:15,fontWeight:600,lineHeight:1,outline:"none",opacity:w?.9:1},onClick:()=>{w||di(()=>{Zt(l)},"edit a different geofence")},children:w?"Editing":"Edit"}),_.jsx("button",{disabled:xe===l.id,style:{padding:"8px 12px",minHeight:36,borderRadius:8,border:"1px solid #dee2e6",background:xe===l.id?"#666":"#e9ecef",color:xe===l.id?"#fff":"#1a1a1a",cursor:xe===l.id?"not-allowed":"pointer",fontSize:15,fontWeight:600,lineHeight:1,opacity:xe===l.id?.7:1,outline:"none"},onClick:()=>{!fe||xe===l.id||di(()=>{nr({id:l.id,name:l.name||l.id})},"delete a geofence")},children:xe===l.id?"Deleting...":"Delete"}),_.jsx("button",{onClick:()=>{Fn(l,D)||We("Unable to locate this geofence on the map. Edit and save it to refresh coordinates.","warning")},style:{width:34,minHeight:34,marginLeft:"auto",borderRadius:8,border:"none",background:"transparent",color:V?"#0066cc":"#9aa3ad",cursor:"pointer",fontSize:14,lineHeight:1,outline:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:0,opacity:V?1:.75},"aria-label":`Center map on geofence ${l.name||l.id}`,title:V?"Center map on this geofence":"Geofence location may be missing. Click to retry.",children:_.jsx(kr,{})})]}),w&&_.jsx("div",{style:{marginTop:10,paddingTop:10,borderTop:"1px solid #dee2e6"},children:Ne})]},l.id)})]})})]})]})]})]}),rr&&_.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(20, 24, 28, 0.45)",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:_.jsxs("div",{style:{width:"min(100%, 440px)",background:"#fff",borderRadius:14,border:"1px solid #dee2e6",boxShadow:"0 20px 50px rgba(0,0,0,0.22)",padding:16,display:"grid",gap:10},children:[_.jsx("div",{style:{fontWeight:800,fontSize:20,color:"#1a1a1a",lineHeight:1.2},children:"Unsaved geofence changes"}),_.jsxs("div",{style:{fontSize:14,color:"#495057",lineHeight:1.45},children:["You have unsaved edits. Save your changes before you ",wn,"?"]}),!Mt&&_.jsx("div",{style:{fontSize:12,color:"#6c757d"},children:"Some required fields are incomplete. You can keep editing or discard changes."}),_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginTop:4},children:[_.jsx("button",{onClick:Un,style:{minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a",fontSize:14,fontWeight:600,cursor:"pointer",outline:"none"},children:"Keep editing"}),_.jsx("button",{onClick:Hn,style:{minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:"#e9ecef",color:"#1a1a1a",fontSize:14,fontWeight:700,cursor:"pointer",outline:"none"},children:"Discard changes"}),_.jsx("button",{onClick:Vn,disabled:Ue||!Mt,style:{minHeight:38,borderRadius:8,border:"1px solid #0066cc",background:Ue?"#666":Mt?"#0066cc":"#dce3eb",color:Ue||Mt?"#fff":"#6c757d",fontSize:14,fontWeight:700,cursor:Ue?"not-allowed":Mt?"pointer":"not-allowed",opacity:Ue?.8:1,outline:"none"},children:Ue?"Saving...":"Save changes"})]})]})}),yt&&_.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(20, 24, 28, 0.45)",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:_.jsxs("div",{style:{width:"min(100%, 440px)",background:"#fff",borderRadius:14,border:"1px solid #dee2e6",boxShadow:"0 20px 50px rgba(0,0,0,0.22)",padding:16,display:"grid",gap:10},children:[_.jsx("div",{style:{fontWeight:800,fontSize:20,color:"#1a1a1a",lineHeight:1.2},children:"Delete geofence?"}),_.jsxs("div",{style:{fontSize:14,color:"#495057",lineHeight:1.45},children:["Delete ",_.jsx("strong",{children:yt.name}),"? This action cannot be undone."]}),_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:4},children:[_.jsx("button",{onClick:Jr,disabled:!!xe,style:{minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a",fontSize:14,fontWeight:600,cursor:xe?"not-allowed":"pointer",outline:"none",opacity:xe?.8:1},children:"Cancel"}),_.jsx("button",{onClick:Kn,disabled:xe===yt.id,style:{minHeight:38,borderRadius:8,border:"1px solid #c62828",background:xe===yt.id?"#666":"#c62828",color:"#fff",fontSize:14,fontWeight:700,cursor:xe===yt.id?"not-allowed":"pointer",outline:"none",opacity:xe===yt.id?.85:1},children:xe===yt.id?"Deleting...":"Delete"})]})]})}),Oi&&_.jsx("div",{role:"status","aria-live":"polite",style:{position:"fixed",right:16,bottom:ie?16:96,zIndex:5200,maxWidth:"min(92vw, 420px)",borderRadius:10,border:`1px solid ${(ji[Oi.tone]||ji.info).border}`,background:(ji[Oi.tone]||ji.info).background,color:"#fff",boxShadow:"0 10px 28px rgba(0,0,0,0.28)",padding:"10px 12px",fontSize:13,fontWeight:600,lineHeight:1.35},children:Oi.message})]})}function Ro({pathsByTag:j,myTags:W,showPathLines:J,renderPointTrail:H=!0,maxTimestamp:ne=null,fitBoundsPadding:oe=null,manualViewportUntil:N=0}){const Me=Vi(),Oe=I.useRef(null),Ye=I.useRef(""),[Qe,Ge]=I.useState(()=>Math.round(Me.getZoom()));return I.useEffect(()=>{const je=()=>{const Pe=Number(Me.getZoom());Number.isFinite(Pe)&&Ge(Math.round(Pe))};return je(),Me.on("zoomend",je),()=>{Me.off("zoomend",je)}},[Me]),I.useEffect(()=>{Oe.current||(Oe.current=Ve.layerGroup().addTo(Me));const je=Oe.current;je.clearLayers();const Pe=pe=>{const le=W.find(me=>me.id===pe)?.color;return/^#([0-9a-fA-F]{3}){1,2}$/.test(le||"")?le:"#0066cc"},Ht=pe=>W.find(de=>de.id===pe)?.customName||`Tag ${String(pe).slice(0,8)}`,ze=pe=>{const de=Ve.circleMarker([pe.lat,pe.lng],{radius:H?6:7,color:"#1a1a1a",weight:2,fillColor:pe.color,fillOpacity:1}),le=$a(pe.ts),me=le?`${pe.label} · ${le}`:pe.label;de.bindTooltip(me),de.addTo(je)},at=ne?Object.fromEntries(Object.entries(j||{}).map(([pe,de])=>[pe,de.filter(le=>(le.ts&&typeof le.ts.toDate=="function"?le.ts.toDate().getTime():le.ts?.seconds?le.ts.seconds*1e3:le.ts)<=ne)])):j||{},st=Object.entries(at).map(([pe,de])=>{const le=Array.isArray(de)?de:[],me=le[0],Ee=le[le.length-1],we=Number(me?.lat),ye=Number(me?.lng),Te=Number(Ee?.lat),Ie=Number(Ee?.lng),ve=Number(Ee?.timestampMs),Ke=Number.isFinite(ve)?ve:0;return[pe,le.length,Number.isFinite(we)?we.toFixed(4):"na",Number.isFinite(ye)?ye.toFixed(4):"na",Number.isFinite(Te)?Te.toFixed(4):"na",Number.isFinite(Ie)?Ie.toFixed(4):"na",String(Ke)].join(":")}).sort().join("|"),xt=[],et=[];if(Object.entries(at).forEach(([pe,de])=>{if(!Array.isArray(de)||de.length===0)return;const le=de.map(ve=>[Number(ve.lat),Number(ve.lng),ve.ts]).filter(([ve,Ke])=>Number.isFinite(ve)&&Number.isFinite(Ke));if(le.length===0)return;const me=le.map(([ve,Ke])=>[ve,Ke]);xt.push(...me),J&&me.length>1&&Ve.polyline(me,{color:Pe(pe),weight:3,opacity:.9}).addTo(je);const Ee=le[le.length-1];if(!Ee)return;const[we,ye,Te]=Ee,Ie={tagId:pe,lat:we,lng:ye,ts:Te||null,label:Ht(pe),color:Pe(pe)};et.push(Ie),H&&(ze(Ie),le.slice(0,-1).forEach(([ve,Ke,Vt])=>{const ii=Ve.circleMarker([ve,Ke],{radius:3,color:Pe(pe),weight:1,fillColor:Pe(pe),fillOpacity:.9}),vt=$a(Vt),Lt=Ht(pe),At=vt?`${Lt} · ${vt}`:Lt;ii.bindTooltip(At),ii.addTo(je)}))}),!H&&et.length>0)if(!(Qe<=11))et.forEach(de=>ze(de));else{const de=Qe<=5?110:Qe<=7?90:Qe<=9?74:58,le=new Map;et.forEach(me=>{const Ee=Me.project(Ve.latLng(me.lat,me.lng),Qe),we=`${Math.floor(Ee.x/de)}:${Math.floor(Ee.y/de)}`;le.has(we)||le.set(we,[]),le.get(we).push(me)}),le.forEach(me=>{if(me.length===1){ze(me[0]);return}const Ee=me.reduce((ve,Ke)=>ve+Ke.lat,0)/me.length,we=me.reduce((ve,Ke)=>ve+Ke.lng,0)/me.length,ye=me.length,Te=ye>=20?38:ye>=10?34:30,Ie=Ve.marker([Ee,we],{icon:Ve.divIcon({className:"",html:`<div style="width:${Te}px;height:${Te}px;border-radius:9999px;background:#0066cc;border:2px solid #ffffff;color:#fff;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,0.25);">${ye}</div>`,iconSize:[Te,Te],iconAnchor:[Te/2,Te/2]}),keyboard:!1});Ie.bindTooltip(`${ye} tags in this area`),Ie.on("click",()=>{const ve=Math.min((Me.getZoom()||0)+2,19);Me.setView([Ee,we],ve,{animate:!0})}),Ie.addTo(je)})}if(xt.length>0&&ne===null&&Date.now()>=N&&st!==Ye.current)try{Me.fitBounds(xt,{paddingTopLeft:oe?.topLeft||[30,30],paddingBottomRight:oe?.bottomRight||[30,30]}),Ye.current=st}catch{}else xt.length===0&&(Ye.current="");return()=>{je.clearLayers()}},[Me,Qe,j,W,J,H,ne,oe,N]),null}export{Oo as default};
