import{u as Lo,c as bn,a as Co,r as I,b as li,d as We,q as Sr,w as Xa,o as Dr,e as Ar,f as Za,g as ko,l as _a,h as ui,s as Mo,t as xn,i as vn,j as y,M as Eo,T as Bo,k as Ja,m as ba,n as Ln,p as Qa,v as qe,x as wo,y as So}from"./index-wLJlKf5c.js";function er(){return Lo().map}var es={},ts;function Do(){return ts||(ts=1,(()=>{var F=Object.create,W=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,H=Object.getOwnPropertyNames,re=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty,N=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ve=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of H(t))!ae.call(e,n)&&n!==i&&W(e,n,{get:()=>t[n],enumerable:!(r=Y(t,n))||r.enumerable});return e},Se=(e,t,i)=>(i=e!=null?F(re(e)):{},ve(t||!e||!e.__esModule?W(i,"default",{value:e,enumerable:!0}):i,e)),ze=N((e,t)=>{function i(){this.__data__=[],this.size=0}t.exports=i}),$e=N((e,t)=>{function i(r,n){return r===n||r!==r&&n!==n}t.exports=i}),Ue=N((e,t)=>{var i=$e();function r(n,a){for(var s=n.length;s--;)if(i(n[s][0],a))return s;return-1}t.exports=r}),Ge=N((e,t)=>{var i=Ue(),r=Array.prototype,n=r.splice;function a(s){var o=this.__data__,h=i(o,s);if(h<0)return!1;var c=o.length-1;return h==c?o.pop():n.call(o,h,1),--this.size,!0}t.exports=a}),Re=N((e,t)=>{var i=Ue();function r(n){var a=this.__data__,s=i(a,n);return s<0?void 0:a[s][1]}t.exports=r}),Zt=N((e,t)=>{var i=Ue();function r(n){return i(this.__data__,n)>-1}t.exports=r}),Fe=N((e,t)=>{var i=Ue();function r(n,a){var s=this.__data__,o=i(s,n);return o<0?(++this.size,s.push([n,a])):s[o][1]=a,this}t.exports=r}),ot=N((e,t)=>{var i=ze(),r=Ge(),n=Re(),a=Zt(),s=Fe();function o(h){var c=-1,x=h==null?0:h.length;for(this.clear();++c<x;){var _=h[c];this.set(_[0],_[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),lt=N((e,t)=>{var i=ot();function r(){this.__data__=new i,this.size=0}t.exports=r}),Ct=N((e,t)=>{function i(r){var n=this.__data__,a=n.delete(r);return this.size=n.size,a}t.exports=i}),et=N((e,t)=>{function i(r){return this.__data__.get(r)}t.exports=i}),wi=N((e,t)=>{function i(r){return this.__data__.has(r)}t.exports=i}),pe=N((e,t)=>{var i=typeof bn=="object"&&bn&&bn.Object===Object&&bn;t.exports=i}),de=N((e,t)=>{var i=pe(),r=typeof self=="object"&&self&&self.Object===Object&&self,n=i||r||Function("return this")();t.exports=n}),se=N((e,t)=>{var i=de(),r=i.Symbol;t.exports=r}),me=N((e,t)=>{var i=se(),r=Object.prototype,n=r.hasOwnProperty,a=r.toString,s=i?i.toStringTag:void 0;function o(h){var c=n.call(h,s),x=h[s];try{h[s]=void 0;var _=!0}catch{}var T=a.call(h);return _&&(c?h[s]=x:delete h[s]),T}t.exports=o}),Ce=N((e,t)=>{var i=Object.prototype,r=i.toString;function n(a){return r.call(a)}t.exports=n}),Me=N((e,t)=>{var i=se(),r=me(),n=Ce(),a="[object Null]",s="[object Undefined]",o=i?i.toStringTag:void 0;function h(c){return c==null?c===void 0?s:a:o&&o in Object(c)?r(c):n(c)}t.exports=h}),Ee=N((e,t)=>{function i(r){var n=typeof r;return r!=null&&(n=="object"||n=="function")}t.exports=i}),De=N((e,t)=>{var i=Me(),r=Ee(),n="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",o="[object Proxy]";function h(c){if(!r(c))return!1;var x=i(c);return x==a||x==s||x==n||x==o}t.exports=h}),Ye=N((e,t)=>{var i=de(),r=i["__core-js_shared__"];t.exports=r}),xe=N((e,t)=>{var i=Ye(),r=function(){var a=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}();function n(a){return!!r&&r in a}t.exports=n}),He=N((e,t)=>{var i=Function.prototype,r=i.toString;function n(a){if(a!=null){try{return r.call(a)}catch{}try{return a+""}catch{}}return""}t.exports=n}),ci=N((e,t)=>{var i=De(),r=xe(),n=Ee(),a=He(),s=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,h=Function.prototype,c=Object.prototype,x=h.toString,_=c.hasOwnProperty,T=RegExp("^"+x.call(_).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function j(z){if(!n(z)||r(z))return!1;var q=i(z)?T:o;return q.test(a(z))}t.exports=j}),ut=N((e,t)=>{function i(r,n){return r?.[n]}t.exports=i}),Nt=N((e,t)=>{var i=ci(),r=ut();function n(a,s){var o=r(a,s);return i(o)?o:void 0}t.exports=n}),je=N((e,t)=>{var i=Nt(),r=de(),n=i(r,"Map");t.exports=n}),Gt=N((e,t)=>{var i=Nt(),r=i(Object,"create");t.exports=r}),kt=N((e,t)=>{var i=Gt();function r(){this.__data__=i?i(null):{},this.size=0}t.exports=r}),tr=N((e,t)=>{function i(r){var n=this.has(r)&&delete this.__data__[r];return this.size-=n?1:0,n}t.exports=i}),Dn=N((e,t)=>{var i=Gt(),r="__lodash_hash_undefined__",n=Object.prototype,a=n.hasOwnProperty;function s(o){var h=this.__data__;if(i){var c=h[o];return c===r?void 0:c}return a.call(h,o)?h[o]:void 0}t.exports=s}),Si=N((e,t)=>{var i=Gt(),r=Object.prototype,n=r.hasOwnProperty;function a(s){var o=this.__data__;return i?o[s]!==void 0:n.call(o,s)}t.exports=a}),Rr=N((e,t)=>{var i=Gt(),r="__lodash_hash_undefined__";function n(a,s){var o=this.__data__;return this.size+=this.has(a)?0:1,o[a]=i&&s===void 0?r:s,this}t.exports=n}),ir=N((e,t)=>{var i=kt(),r=tr(),n=Dn(),a=Si(),s=Rr();function o(h){var c=-1,x=h==null?0:h.length;for(this.clear();++c<x;){var _=h[c];this.set(_[0],_[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),Di=N((e,t)=>{var i=ir(),r=ot(),n=je();function a(){this.size=0,this.__data__={hash:new i,map:new(n||r),string:new i}}t.exports=a}),Fr=N((e,t)=>{function i(r){var n=typeof r;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?r!=="__proto__":r===null}t.exports=i}),ht=N((e,t)=>{var i=Fr();function r(n,a){var s=n.__data__;return i(a)?s[typeof a=="string"?"string":"hash"]:s.map}t.exports=r}),rr=N((e,t)=>{var i=ht();function r(n){var a=i(this,n).delete(n);return this.size-=a?1:0,a}t.exports=r}),zt=N((e,t)=>{var i=ht();function r(n){return i(this,n).get(n)}t.exports=r}),nr=N((e,t)=>{var i=ht();function r(n){return i(this,n).has(n)}t.exports=r}),Ai=N((e,t)=>{var i=ht();function r(n,a){var s=i(this,n),o=s.size;return s.set(n,a),this.size+=s.size==o?0:1,this}t.exports=r}),jr=N((e,t)=>{var i=Di(),r=rr(),n=zt(),a=nr(),s=Ai();function o(h){var c=-1,x=h==null?0:h.length;for(this.clear();++c<x;){var _=h[c];this.set(_[0],_[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=n,o.prototype.has=a,o.prototype.set=s,t.exports=o}),Pi=N((e,t)=>{var i=ot(),r=je(),n=jr(),a=200;function s(o,h){var c=this.__data__;if(c instanceof i){var x=c.__data__;if(!r||x.length<a-1)return x.push([o,h]),this.size=++c.size,this;c=this.__data__=new n(x)}return c.set(o,h),this.size=c.size,this}t.exports=s}),An=N((e,t)=>{var i=ot(),r=lt(),n=Ct(),a=et(),s=wi(),o=Pi();function h(c){var x=this.__data__=new i(c);this.size=x.size}h.prototype.clear=r,h.prototype.delete=n,h.prototype.get=a,h.prototype.has=s,h.prototype.set=o,t.exports=h}),fe=N((e,t)=>{var i=Nt(),r=function(){try{var n=i(Object,"defineProperty");return n({},"",{}),n}catch{}}();t.exports=r}),Ti=N((e,t)=>{var i=fe();function r(n,a,s){a=="__proto__"&&i?i(n,a,{configurable:!0,enumerable:!0,value:s,writable:!0}):n[a]=s}t.exports=r}),ar=N((e,t)=>{var i=Ti(),r=$e();function n(a,s,o){(o!==void 0&&!r(a[s],o)||o===void 0&&!(s in a))&&i(a,s,o)}t.exports=n}),Pn=N((e,t)=>{function i(r){return function(n,a,s){for(var o=-1,h=Object(n),c=s(n),x=c.length;x--;){var _=c[r?x:++o];if(a(h[_],_,h)===!1)break}return n}}t.exports=i}),Ri=N((e,t)=>{var i=Pn(),r=i();t.exports=r}),sr=N((e,t)=>{var i=de(),r=typeof e=="object"&&e&&!e.nodeType&&e,n=r&&typeof t=="object"&&t&&!t.nodeType&&t,a=n&&n.exports===r,s=a?i.Buffer:void 0,o=s?s.allocUnsafe:void 0;function h(c,x){if(x)return c.slice();var _=c.length,T=o?o(_):new c.constructor(_);return c.copy(T),T}t.exports=h}),Or=N((e,t)=>{var i=de(),r=i.Uint8Array;t.exports=r}),or=N((e,t)=>{var i=Or();function r(n){var a=new n.constructor(n.byteLength);return new i(a).set(new i(n)),a}t.exports=r}),Ir=N((e,t)=>{var i=or();function r(n,a){var s=a?i(n.buffer):n.buffer;return new n.constructor(s,n.byteOffset,n.length)}t.exports=r}),Nr=N((e,t)=>{function i(r,n){var a=-1,s=r.length;for(n||(n=Array(s));++a<s;)n[a]=r[a];return n}t.exports=i}),Gr=N((e,t)=>{var i=Ee(),r=Object.create,n=function(){function a(){}return function(s){if(!i(s))return{};if(r)return r(s);a.prototype=s;var o=new a;return a.prototype=void 0,o}}();t.exports=n}),di=N((e,t)=>{function i(r,n){return function(a){return r(n(a))}}t.exports=i}),zr=N((e,t)=>{var i=di(),r=i(Object.getPrototypeOf,Object);t.exports=r}),tt=N((e,t)=>{var i=Object.prototype;function r(n){var a=n&&n.constructor,s=typeof a=="function"&&a.prototype||i;return n===s}t.exports=r}),Tn=N((e,t)=>{var i=Gr(),r=zr(),n=tt();function a(s){return typeof s.constructor=="function"&&!n(s)?i(r(s)):{}}t.exports=a}),ct=N((e,t)=>{function i(r){return r!=null&&typeof r=="object"}t.exports=i}),pi=N((e,t)=>{var i=Me(),r=ct(),n="[object Arguments]";function a(s){return r(s)&&i(s)==n}t.exports=a}),fi=N((e,t)=>{var i=pi(),r=ct(),n=Object.prototype,a=n.hasOwnProperty,s=n.propertyIsEnumerable,o=i(function(){return arguments}())?i:function(h){return r(h)&&a.call(h,"callee")&&!s.call(h,"callee")};t.exports=o}),Mt=N((e,t)=>{var i=Array.isArray;t.exports=i}),Fi=N((e,t)=>{var i=9007199254740991;function r(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=i}t.exports=r}),lr=N((e,t)=>{var i=De(),r=Fi();function n(a){return a!=null&&r(a.length)&&!i(a)}t.exports=n}),Et=N((e,t)=>{var i=lr(),r=ct();function n(a){return r(a)&&i(a)}t.exports=n}),ur=N((e,t)=>{function i(){return!1}t.exports=i}),Bt=N((e,t)=>{var i=de(),r=ur(),n=typeof e=="object"&&e&&!e.nodeType&&e,a=n&&typeof t=="object"&&t&&!t.nodeType&&t,s=a&&a.exports===n,o=s?i.Buffer:void 0,h=o?o.isBuffer:void 0,c=h||r;t.exports=c}),ji=N((e,t)=>{var i=Me(),r=zr(),n=ct(),a="[object Object]",s=Function.prototype,o=Object.prototype,h=s.toString,c=o.hasOwnProperty,x=h.call(Object);function _(T){if(!n(T)||i(T)!=a)return!1;var j=r(T);if(j===null)return!0;var z=c.call(j,"constructor")&&j.constructor;return typeof z=="function"&&z instanceof z&&h.call(z)==x}t.exports=_}),Jt=N((e,t)=>{var i=Me(),r=Fi(),n=ct(),a="[object Arguments]",s="[object Array]",o="[object Boolean]",h="[object Date]",c="[object Error]",x="[object Function]",_="[object Map]",T="[object Number]",j="[object Object]",z="[object RegExp]",q="[object Set]",X="[object String]",le="[object WeakMap]",b="[object ArrayBuffer]",C="[object DataView]",w="[object Float32Array]",O="[object Float64Array]",S="[object Int8Array]",R="[object Int16Array]",u="[object Int32Array]",d="[object Uint8Array]",f="[object Uint8ClampedArray]",p="[object Uint16Array]",g="[object Uint32Array]",m={};m[w]=m[O]=m[S]=m[R]=m[u]=m[d]=m[f]=m[p]=m[g]=!0,m[a]=m[s]=m[b]=m[o]=m[C]=m[h]=m[c]=m[x]=m[_]=m[T]=m[j]=m[z]=m[q]=m[X]=m[le]=!1;function M(k){return n(k)&&r(k.length)&&!!m[i(k)]}t.exports=M}),gi=N((e,t)=>{function i(r){return function(n){return r(n)}}t.exports=i}),dt=N((e,t)=>{var i=pe(),r=typeof e=="object"&&e&&!e.nodeType&&e,n=r&&typeof t=="object"&&t&&!t.nodeType&&t,a=n&&n.exports===r,s=a&&i.process,o=function(){try{var h=n&&n.require&&n.require("util").types;return h||s&&s.binding&&s.binding("util")}catch{}}();t.exports=o}),wt=N((e,t)=>{var i=Jt(),r=gi(),n=dt(),a=n&&n.isTypedArray,s=a?r(a):i;t.exports=s}),Ut=N((e,t)=>{function i(r,n){if(!(n==="constructor"&&typeof r[n]=="function")&&n!="__proto__")return r[n]}t.exports=i}),Oi=N((e,t)=>{var i=Ti(),r=$e(),n=Object.prototype,a=n.hasOwnProperty;function s(o,h,c){var x=o[h];(!(a.call(o,h)&&r(x,c))||c===void 0&&!(h in o))&&i(o,h,c)}t.exports=s}),xt=N((e,t)=>{var i=Oi(),r=Ti();function n(a,s,o,h){var c=!o;o||(o={});for(var x=-1,_=s.length;++x<_;){var T=s[x],j=h?h(o[T],a[T],T,o,a):void 0;j===void 0&&(j=a[T]),c?r(o,T,j):i(o,T,j)}return o}t.exports=n}),Ii=N((e,t)=>{function i(r,n){for(var a=-1,s=Array(r);++a<r;)s[a]=n(a);return s}t.exports=i}),St=N((e,t)=>{var i=9007199254740991,r=/^(?:0|[1-9]\d*)$/;function n(a,s){var o=typeof a;return s=s??i,!!s&&(o=="number"||o!="symbol"&&r.test(a))&&a>-1&&a%1==0&&a<s}t.exports=n}),Ni=N((e,t)=>{var i=Ii(),r=fi(),n=Mt(),a=Bt(),s=St(),o=wt(),h=Object.prototype,c=h.hasOwnProperty;function x(_,T){var j=n(_),z=!j&&r(_),q=!j&&!z&&a(_),X=!j&&!z&&!q&&o(_),le=j||z||q||X,b=le?i(_.length,String):[],C=b.length;for(var w in _)(T||c.call(_,w))&&!(le&&(w=="length"||q&&(w=="offset"||w=="parent")||X&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||s(w,C)))&&b.push(w);return b}t.exports=x}),Gi=N((e,t)=>{function i(r){var n=[];if(r!=null)for(var a in Object(r))n.push(a);return n}t.exports=i}),zi=N((e,t)=>{var i=Ee(),r=tt(),n=Gi(),a=Object.prototype,s=a.hasOwnProperty;function o(h){if(!i(h))return n(h);var c=r(h),x=[];for(var _ in h)_=="constructor"&&(c||!s.call(h,_))||x.push(_);return x}t.exports=o}),mi=N((e,t)=>{var i=Ni(),r=zi(),n=lr();function a(s){return n(s)?i(s,!0):r(s)}t.exports=a}),Ui=N((e,t)=>{var i=xt(),r=mi();function n(a){return i(a,r(a))}t.exports=n}),Qt=N((e,t)=>{var i=ar(),r=sr(),n=Ir(),a=Nr(),s=Tn(),o=fi(),h=Mt(),c=Et(),x=Bt(),_=De(),T=Ee(),j=ji(),z=wt(),q=Ut(),X=Ui();function le(b,C,w,O,S,R,u){var d=q(b,w),f=q(C,w),p=u.get(f);if(p){i(b,w,p);return}var g=R?R(d,f,w+"",b,C,u):void 0,m=g===void 0;if(m){var M=h(f),k=!M&&x(f),E=!M&&!k&&z(f);g=f,M||k||E?h(d)?g=d:c(d)?g=a(d):k?(m=!1,g=r(f,!0)):E?(m=!1,g=n(f,!0)):g=[]:j(f)||o(f)?(g=d,o(d)?g=X(d):(!T(d)||_(d))&&(g=s(f))):m=!1}m&&(u.set(f,g),S(g,f,O,R,u),u.delete(f)),i(b,w,g)}t.exports=le}),Hi=N((e,t)=>{var i=An(),r=ar(),n=Ri(),a=Qt(),s=Ee(),o=mi(),h=Ut();function c(x,_,T,j,z){x!==_&&n(_,function(q,X){if(z||(z=new i),s(q))a(x,_,X,T,c,j,z);else{var le=j?j(h(x,X),q,X+"",x,_,z):void 0;le===void 0&&(le=q),r(x,X,le)}},o)}t.exports=c}),it=N((e,t)=>{function i(r){return r}t.exports=i}),hr=N((e,t)=>{function i(r,n,a){switch(a.length){case 0:return r.call(n);case 1:return r.call(n,a[0]);case 2:return r.call(n,a[0],a[1]);case 3:return r.call(n,a[0],a[1],a[2])}return r.apply(n,a)}t.exports=i}),cr=N((e,t)=>{var i=hr(),r=Math.max;function n(a,s,o){return s=r(s===void 0?a.length-1:s,0),function(){for(var h=arguments,c=-1,x=r(h.length-s,0),_=Array(x);++c<x;)_[c]=h[s+c];c=-1;for(var T=Array(s+1);++c<s;)T[c]=h[c];return T[s]=o(_),i(a,this,T)}}t.exports=n}),dr=N((e,t)=>{function i(r){return function(){return r}}t.exports=i}),te=N((e,t)=>{var i=dr(),r=fe(),n=it(),a=r?function(s,o){return r(s,"toString",{configurable:!0,enumerable:!1,value:i(o),writable:!0})}:n;t.exports=a}),Rn=N((e,t)=>{var i=800,r=16,n=Date.now;function a(s){var o=0,h=0;return function(){var c=n(),x=r-(c-h);if(h=c,x>0){if(++o>=i)return arguments[0]}else o=0;return s.apply(void 0,arguments)}}t.exports=a}),Vi=N((e,t)=>{var i=te(),r=Rn(),n=r(i);t.exports=n}),Fn=N((e,t)=>{var i=it(),r=cr(),n=Vi();function a(s,o){return n(r(s,o,i),s+"")}t.exports=a}),jn=N((e,t)=>{var i=$e(),r=lr(),n=St(),a=Ee();function s(o,h,c){if(!a(c))return!1;var x=typeof h;return(x=="number"?r(c)&&n(h,c.length):x=="string"&&h in c)?i(c[h],o):!1}t.exports=s}),Ur=N((e,t)=>{var i=Fn(),r=jn();function n(a){return i(function(s,o){var h=-1,c=o.length,x=c>1?o[c-1]:void 0,_=c>2?o[2]:void 0;for(x=a.length>3&&typeof x=="function"?(c--,x):void 0,_&&r(o[0],o[1],_)&&(x=c<3?void 0:x,c=1),s=Object(s);++h<c;){var T=o[h];T&&a(s,T,h,x)}return s})}t.exports=n}),yi=N((e,t)=>{var i=Hi(),r=Ur(),n=r(function(a,s,o){i(a,s,o)});t.exports=n}),Ki=N((e,t)=>{var i=Me(),r=ct(),n="[object Symbol]";function a(s){return typeof s=="symbol"||r(s)&&i(s)==n}t.exports=a}),Wi=N((e,t)=>{var i=Mt(),r=Ki(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;function s(o,h){if(i(o))return!1;var c=typeof o;return c=="number"||c=="symbol"||c=="boolean"||o==null||r(o)?!0:a.test(o)||!n.test(o)||h!=null&&o in Object(h)}t.exports=s}),Dt=N((e,t)=>{var i=jr(),r="Expected a function";function n(a,s){if(typeof a!="function"||s!=null&&typeof s!="function")throw new TypeError(r);var o=function(){var h=arguments,c=s?s.apply(this,h):h[0],x=o.cache;if(x.has(c))return x.get(c);var _=a.apply(this,h);return o.cache=x.set(c,_)||x,_};return o.cache=new(n.Cache||i),o}n.Cache=i,t.exports=n}),pr=N((e,t)=>{var i=Dt(),r=500;function n(a){var s=i(a,function(h){return o.size===r&&o.clear(),h}),o=s.cache;return s}t.exports=n}),Ve=N((e,t)=>{var i=pr(),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,a=i(function(s){var o=[];return s.charCodeAt(0)===46&&o.push(""),s.replace(r,function(h,c,x,_){o.push(x?_.replace(n,"$1"):c||h)}),o});t.exports=a}),Hr=N((e,t)=>{function i(r,n){for(var a=-1,s=r==null?0:r.length,o=Array(s);++a<s;)o[a]=n(r[a],a,r);return o}t.exports=i}),be=N((e,t)=>{var i=se(),r=Hr(),n=Mt(),a=Ki(),s=i?i.prototype:void 0,o=s?s.toString:void 0;function h(c){if(typeof c=="string")return c;if(n(c))return r(c,h)+"";if(a(c))return o?o.call(c):"";var x=c+"";return x=="0"&&1/c==-1/0?"-0":x}t.exports=h}),qi=N((e,t)=>{var i=be();function r(n){return n==null?"":i(n)}t.exports=r}),On=N((e,t)=>{var i=Mt(),r=Wi(),n=Ve(),a=qi();function s(o,h){return i(o)?o:r(o,h)?[o]:n(a(o))}t.exports=s}),Vr=N((e,t)=>{var i=Ki();function r(n){if(typeof n=="string"||i(n))return n;var a=n+"";return a=="0"&&1/n==-1/0?"-0":a}t.exports=r}),In=N((e,t)=>{var i=On(),r=Vr();function n(a,s){s=i(s,a);for(var o=0,h=s.length;a!=null&&o<h;)a=a[r(s[o++])];return o&&o==h?a:void 0}t.exports=n}),_i=N((e,t)=>{var i=In();function r(n,a,s){var o=n==null?void 0:i(n,a);return o===void 0?s:o}t.exports=r}),Nn=N((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?t.exports=r():(i=i||self).RBush=r()})(e,function(){function i(b,C,w,O,S){(function R(u,d,f,p,g){for(;p>f;){if(p-f>600){var m=p-f+1,M=d-f+1,k=Math.log(m),E=.5*Math.exp(2*k/3),P=.5*Math.sqrt(k*E*(m-E)/m)*(M-m/2<0?-1:1),A=Math.max(f,Math.floor(d-M*E/m+P)),G=Math.min(p,Math.floor(d+(m-M)*E/m+P));R(u,d,A,G,g)}var $=u[d],Z=f,J=p;for(r(u,f,d),g(u[p],$)>0&&r(u,f,p);Z<J;){for(r(u,Z,J),Z++,J--;g(u[Z],$)<0;)Z++;for(;g(u[J],$)>0;)J--}g(u[f],$)===0?r(u,f,J):r(u,++J,p),J<=d&&(f=J+1),d<=J&&(p=J-1)}})(b,C,w||0,O||b.length-1,S||n)}function r(b,C,w){var O=b[C];b[C]=b[w],b[w]=O}function n(b,C){return b<C?-1:b>C?1:0}var a=function(b){b===void 0&&(b=9),this._maxEntries=Math.max(4,b),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(b,C,w){if(!w)return C.indexOf(b);for(var O=0;O<C.length;O++)if(w(b,C[O]))return O;return-1}function o(b,C){h(b,0,b.children.length,C,b)}function h(b,C,w,O,S){S||(S=X(null)),S.minX=1/0,S.minY=1/0,S.maxX=-1/0,S.maxY=-1/0;for(var R=C;R<w;R++){var u=b.children[R];c(S,b.leaf?O(u):u)}return S}function c(b,C){return b.minX=Math.min(b.minX,C.minX),b.minY=Math.min(b.minY,C.minY),b.maxX=Math.max(b.maxX,C.maxX),b.maxY=Math.max(b.maxY,C.maxY),b}function x(b,C){return b.minX-C.minX}function _(b,C){return b.minY-C.minY}function T(b){return(b.maxX-b.minX)*(b.maxY-b.minY)}function j(b){return b.maxX-b.minX+(b.maxY-b.minY)}function z(b,C){return b.minX<=C.minX&&b.minY<=C.minY&&C.maxX<=b.maxX&&C.maxY<=b.maxY}function q(b,C){return C.minX<=b.maxX&&C.minY<=b.maxY&&C.maxX>=b.minX&&C.maxY>=b.minY}function X(b){return{children:b,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function le(b,C,w,O,S){for(var R=[C,w];R.length;)if(!((w=R.pop())-(C=R.pop())<=O)){var u=C+Math.ceil((w-C)/O/2)*O;i(b,u,C,w,S),R.push(C,u,u,w)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(b){var C=this.data,w=[];if(!q(b,C))return w;for(var O=this.toBBox,S=[];C;){for(var R=0;R<C.children.length;R++){var u=C.children[R],d=C.leaf?O(u):u;q(b,d)&&(C.leaf?w.push(u):z(b,d)?this._all(u,w):S.push(u))}C=S.pop()}return w},a.prototype.collides=function(b){var C=this.data;if(!q(b,C))return!1;for(var w=[];C;){for(var O=0;O<C.children.length;O++){var S=C.children[O],R=C.leaf?this.toBBox(S):S;if(q(b,R)){if(C.leaf||z(b,R))return!0;w.push(S)}}C=w.pop()}return!1},a.prototype.load=function(b){if(!b||!b.length)return this;if(b.length<this._minEntries){for(var C=0;C<b.length;C++)this.insert(b[C]);return this}var w=this._build(b.slice(),0,b.length-1,0);if(this.data.children.length)if(this.data.height===w.height)this._splitRoot(this.data,w);else{if(this.data.height<w.height){var O=this.data;this.data=w,w=O}this._insert(w,this.data.height-w.height-1,!0)}else this.data=w;return this},a.prototype.insert=function(b){return b&&this._insert(b,this.data.height-1),this},a.prototype.clear=function(){return this.data=X([]),this},a.prototype.remove=function(b,C){if(!b)return this;for(var w,O,S,R=this.data,u=this.toBBox(b),d=[],f=[];R||d.length;){if(R||(R=d.pop(),O=d[d.length-1],w=f.pop(),S=!0),R.leaf){var p=s(b,R.children,C);if(p!==-1)return R.children.splice(p,1),d.push(R),this._condense(d),this}S||R.leaf||!z(R,u)?O?(w++,R=O.children[w],S=!1):R=null:(d.push(R),f.push(w),w=0,O=R,R=R.children[0])}return this},a.prototype.toBBox=function(b){return b},a.prototype.compareMinX=function(b,C){return b.minX-C.minX},a.prototype.compareMinY=function(b,C){return b.minY-C.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(b){return this.data=b,this},a.prototype._all=function(b,C){for(var w=[];b;)b.leaf?C.push.apply(C,b.children):w.push.apply(w,b.children),b=w.pop();return C},a.prototype._build=function(b,C,w,O){var S,R=w-C+1,u=this._maxEntries;if(R<=u)return o(S=X(b.slice(C,w+1)),this.toBBox),S;O||(O=Math.ceil(Math.log(R)/Math.log(u)),u=Math.ceil(R/Math.pow(u,O-1))),(S=X([])).leaf=!1,S.height=O;var d=Math.ceil(R/u),f=d*Math.ceil(Math.sqrt(u));le(b,C,w,f,this.compareMinX);for(var p=C;p<=w;p+=f){var g=Math.min(p+f-1,w);le(b,p,g,d,this.compareMinY);for(var m=p;m<=g;m+=d){var M=Math.min(m+d-1,g);S.children.push(this._build(b,m,M,O-1))}}return o(S,this.toBBox),S},a.prototype._chooseSubtree=function(b,C,w,O){for(;O.push(C),!C.leaf&&O.length-1!==w;){for(var S=1/0,R=1/0,u=void 0,d=0;d<C.children.length;d++){var f=C.children[d],p=T(f),g=(m=b,M=f,(Math.max(M.maxX,m.maxX)-Math.min(M.minX,m.minX))*(Math.max(M.maxY,m.maxY)-Math.min(M.minY,m.minY))-p);g<R?(R=g,S=p<S?p:S,u=f):g===R&&p<S&&(S=p,u=f)}C=u||C.children[0]}var m,M;return C},a.prototype._insert=function(b,C,w){var O=w?b:this.toBBox(b),S=[],R=this._chooseSubtree(O,this.data,C,S);for(R.children.push(b),c(R,O);C>=0&&S[C].children.length>this._maxEntries;)this._split(S,C),C--;this._adjustParentBBoxes(O,S,C)},a.prototype._split=function(b,C){var w=b[C],O=w.children.length,S=this._minEntries;this._chooseSplitAxis(w,S,O);var R=this._chooseSplitIndex(w,S,O),u=X(w.children.splice(R,w.children.length-R));u.height=w.height,u.leaf=w.leaf,o(w,this.toBBox),o(u,this.toBBox),C?b[C-1].children.push(u):this._splitRoot(w,u)},a.prototype._splitRoot=function(b,C){this.data=X([b,C]),this.data.height=b.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(b,C,w){for(var O,S,R,u,d,f,p,g=1/0,m=1/0,M=C;M<=w-C;M++){var k=h(b,0,M,this.toBBox),E=h(b,M,w,this.toBBox),P=(S=k,R=E,u=void 0,d=void 0,f=void 0,p=void 0,u=Math.max(S.minX,R.minX),d=Math.max(S.minY,R.minY),f=Math.min(S.maxX,R.maxX),p=Math.min(S.maxY,R.maxY),Math.max(0,f-u)*Math.max(0,p-d)),A=T(k)+T(E);P<g?(g=P,O=M,m=A<m?A:m):P===g&&A<m&&(m=A,O=M)}return O||w-C},a.prototype._chooseSplitAxis=function(b,C,w){var O=b.leaf?this.compareMinX:x,S=b.leaf?this.compareMinY:_;this._allDistMargin(b,C,w,O)<this._allDistMargin(b,C,w,S)&&b.children.sort(O)},a.prototype._allDistMargin=function(b,C,w,O){b.children.sort(O);for(var S=this.toBBox,R=h(b,0,C,S),u=h(b,w-C,w,S),d=j(R)+j(u),f=C;f<w-C;f++){var p=b.children[f];c(R,b.leaf?S(p):p),d+=j(R)}for(var g=w-C-1;g>=C;g--){var m=b.children[g];c(u,b.leaf?S(m):m),d+=j(u)}return d},a.prototype._adjustParentBBoxes=function(b,C,w){for(var O=w;O>=0;O--)c(C[O],b)},a.prototype._condense=function(b){for(var C=b.length-1,w=void 0;C>=0;C--)b[C].children.length===0?C>0?(w=b[C-1].children).splice(w.indexOf(b[C]),1):this.clear():o(b[C],this.toBBox)},a})}),bi=N(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=63710088e-1,e.factors={centimeters:e.earthRadius*100,centimetres:e.earthRadius*100,degrees:e.earthRadius/111325,feet:e.earthRadius*3.28084,inches:e.earthRadius*39.37,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:e.earthRadius*1e3,millimetres:e.earthRadius*1e3,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius*1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function t(p,g,m){m===void 0&&(m={});var M={type:"Feature"};return(m.id===0||m.id)&&(M.id=m.id),m.bbox&&(M.bbox=m.bbox),M.properties=g||{},M.geometry=p,M}e.feature=t;function i(p,g,m){switch(p){case"Point":return r(g).geometry;case"LineString":return o(g).geometry;case"Polygon":return a(g).geometry;case"MultiPoint":return _(g).geometry;case"MultiLineString":return x(g).geometry;case"MultiPolygon":return T(g).geometry;default:throw new Error(p+" is invalid")}}e.geometry=i;function r(p,g,m){if(m===void 0&&(m={}),!p)throw new Error("coordinates is required");if(!Array.isArray(p))throw new Error("coordinates must be an Array");if(p.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!R(p[0])||!R(p[1]))throw new Error("coordinates must contain numbers");var M={type:"Point",coordinates:p};return t(M,g,m)}e.point=r;function n(p,g,m){return m===void 0&&(m={}),c(p.map(function(M){return r(M,g)}),m)}e.points=n;function a(p,g,m){m===void 0&&(m={});for(var M=0,k=p;M<k.length;M++){var E=k[M];if(E.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var P=0;P<E[E.length-1].length;P++)if(E[E.length-1][P]!==E[0][P])throw new Error("First and last Position are not equivalent.")}var A={type:"Polygon",coordinates:p};return t(A,g,m)}e.polygon=a;function s(p,g,m){return m===void 0&&(m={}),c(p.map(function(M){return a(M,g)}),m)}e.polygons=s;function o(p,g,m){if(m===void 0&&(m={}),p.length<2)throw new Error("coordinates must be an array of two or more positions");var M={type:"LineString",coordinates:p};return t(M,g,m)}e.lineString=o;function h(p,g,m){return m===void 0&&(m={}),c(p.map(function(M){return o(M,g)}),m)}e.lineStrings=h;function c(p,g){g===void 0&&(g={});var m={type:"FeatureCollection"};return g.id&&(m.id=g.id),g.bbox&&(m.bbox=g.bbox),m.features=p,m}e.featureCollection=c;function x(p,g,m){m===void 0&&(m={});var M={type:"MultiLineString",coordinates:p};return t(M,g,m)}e.multiLineString=x;function _(p,g,m){m===void 0&&(m={});var M={type:"MultiPoint",coordinates:p};return t(M,g,m)}e.multiPoint=_;function T(p,g,m){m===void 0&&(m={});var M={type:"MultiPolygon",coordinates:p};return t(M,g,m)}e.multiPolygon=T;function j(p,g,m){m===void 0&&(m={});var M={type:"GeometryCollection",geometries:p};return t(M,g,m)}e.geometryCollection=j;function z(p,g){if(g===void 0&&(g=0),g&&!(g>=0))throw new Error("precision must be a positive number");var m=Math.pow(10,g||0);return Math.round(p*m)/m}e.round=z;function q(p,g){g===void 0&&(g="kilometers");var m=e.factors[g];if(!m)throw new Error(g+" units is invalid");return p*m}e.radiansToLength=q;function X(p,g){g===void 0&&(g="kilometers");var m=e.factors[g];if(!m)throw new Error(g+" units is invalid");return p/m}e.lengthToRadians=X;function le(p,g){return C(X(p,g))}e.lengthToDegrees=le;function b(p){var g=p%360;return g<0&&(g+=360),g}e.bearingToAzimuth=b;function C(p){var g=p%(2*Math.PI);return g*180/Math.PI}e.radiansToDegrees=C;function w(p){var g=p%360;return g*Math.PI/180}e.degreesToRadians=w;function O(p,g,m){if(g===void 0&&(g="kilometers"),m===void 0&&(m="kilometers"),!(p>=0))throw new Error("length must be a positive number");return q(X(p,g),m)}e.convertLength=O;function S(p,g,m){if(g===void 0&&(g="meters"),m===void 0&&(m="kilometers"),!(p>=0))throw new Error("area must be a positive number");var M=e.areaFactors[g];if(!M)throw new Error("invalid original units");var k=e.areaFactors[m];if(!k)throw new Error("invalid final units");return p/M*k}e.convertArea=S;function R(p){return!isNaN(p)&&p!==null&&!Array.isArray(p)}e.isNumber=R;function u(p){return!!p&&p.constructor===Object}e.isObject=u;function d(p){if(!p)throw new Error("bbox is required");if(!Array.isArray(p))throw new Error("bbox must be an Array");if(p.length!==4&&p.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");p.forEach(function(g){if(!R(g))throw new Error("bbox must only contain numbers")})}e.validateBBox=d;function f(p){if(!p)throw new Error("id is required");if(["string","number"].indexOf(typeof p)===-1)throw new Error("id must be a number or a string")}e.validateId=f}),rt=N(e=>{Object.defineProperty(e,"__esModule",{value:!0});var t=bi();function i(C,w,O){if(C!==null)for(var S,R,u,d,f,p,g,m=0,M=0,k,E=C.type,P=E==="FeatureCollection",A=E==="Feature",G=P?C.features.length:1,$=0;$<G;$++){g=P?C.features[$].geometry:A?C.geometry:C,k=g?g.type==="GeometryCollection":!1,f=k?g.geometries.length:1;for(var Z=0;Z<f;Z++){var J=0,ge=0;if(d=k?g.geometries[Z]:g,d!==null){p=d.coordinates;var ye=d.type;switch(m=O&&(ye==="Polygon"||ye==="MultiPolygon")?1:0,ye){case null:break;case"Point":if(w(p,M,$,J,ge)===!1)return!1;M++,J++;break;case"LineString":case"MultiPoint":for(S=0;S<p.length;S++){if(w(p[S],M,$,J,ge)===!1)return!1;M++,ye==="MultiPoint"&&J++}ye==="LineString"&&J++;break;case"Polygon":case"MultiLineString":for(S=0;S<p.length;S++){for(R=0;R<p[S].length-m;R++){if(w(p[S][R],M,$,J,ge)===!1)return!1;M++}ye==="MultiLineString"&&J++,ye==="Polygon"&&ge++}ye==="Polygon"&&J++;break;case"MultiPolygon":for(S=0;S<p.length;S++){for(ge=0,R=0;R<p[S].length;R++){for(u=0;u<p[S][R].length-m;u++){if(w(p[S][R][u],M,$,J,ge)===!1)return!1;M++}ge++}J++}break;case"GeometryCollection":for(S=0;S<d.geometries.length;S++)if(i(d.geometries[S],w,O)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function r(C,w,O,S){var R=O;return i(C,function(u,d,f,p,g){d===0&&O===void 0?R=u:R=w(R,u,d,f,p,g)},S),R}function n(C,w){var O;switch(C.type){case"FeatureCollection":for(O=0;O<C.features.length&&w(C.features[O].properties,O)!==!1;O++);break;case"Feature":w(C.properties,0);break}}function a(C,w,O){var S=O;return n(C,function(R,u){u===0&&O===void 0?S=R:S=w(S,R,u)}),S}function s(C,w){if(C.type==="Feature")w(C,0);else if(C.type==="FeatureCollection")for(var O=0;O<C.features.length&&w(C.features[O],O)!==!1;O++);}function o(C,w,O){var S=O;return s(C,function(R,u){u===0&&O===void 0?S=R:S=w(S,R,u)}),S}function h(C){var w=[];return i(C,function(O){w.push(O)}),w}function c(C,w){var O,S,R,u,d,f,p,g,m,M,k=0,E=C.type==="FeatureCollection",P=C.type==="Feature",A=E?C.features.length:1;for(O=0;O<A;O++){for(f=E?C.features[O].geometry:P?C.geometry:C,g=E?C.features[O].properties:P?C.properties:{},m=E?C.features[O].bbox:P?C.bbox:void 0,M=E?C.features[O].id:P?C.id:void 0,p=f?f.type==="GeometryCollection":!1,d=p?f.geometries.length:1,R=0;R<d;R++){if(u=p?f.geometries[R]:f,u===null){if(w(null,k,g,m,M)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(w(u,k,g,m,M)===!1)return!1;break}case"GeometryCollection":{for(S=0;S<u.geometries.length;S++)if(w(u.geometries[S],k,g,m,M)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function x(C,w,O){var S=O;return c(C,function(R,u,d,f,p){u===0&&O===void 0?S=R:S=w(S,R,u,d,f,p)}),S}function _(C,w){c(C,function(O,S,R,u,d){var f=O===null?null:O.type;switch(f){case null:case"Point":case"LineString":case"Polygon":return w(t.feature(O,R,{bbox:u,id:d}),S,0)===!1?!1:void 0}var p;switch(f){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var g=0;g<O.coordinates.length;g++){var m=O.coordinates[g],M={type:p,coordinates:m};if(w(t.feature(M,R),S,g)===!1)return!1}})}function T(C,w,O){var S=O;return _(C,function(R,u,d){u===0&&d===0&&O===void 0?S=R:S=w(S,R,u,d)}),S}function j(C,w){_(C,function(O,S,R){var u=0;if(O.geometry){var d=O.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var f,p=0,g=0,m=0;if(i(O,function(M,k,E,P,A){if(f===void 0||S>p||P>g||A>m){f=M,p=S,g=P,m=A,u=0;return}var G=t.lineString([f,M],O.properties);if(w(G,S,R,A,u)===!1)return!1;u++,f=M})===!1)return!1}}})}function z(C,w,O){var S=O,R=!1;return j(C,function(u,d,f,p,g){R===!1&&O===void 0?S=u:S=w(S,u,d,f,p,g),R=!0}),S}function q(C,w){if(!C)throw new Error("geojson is required");_(C,function(O,S,R){if(O.geometry!==null){var u=O.geometry.type,d=O.geometry.coordinates;switch(u){case"LineString":if(w(O,S,R,0,0)===!1)return!1;break;case"Polygon":for(var f=0;f<d.length;f++)if(w(t.lineString(d[f],O.properties),S,R,f)===!1)return!1;break}}})}function X(C,w,O){var S=O;return q(C,function(R,u,d,f){u===0&&O===void 0?S=R:S=w(S,R,u,d,f)}),S}function le(C,w){if(w=w||{},!t.isObject(w))throw new Error("options is invalid");var O=w.featureIndex||0,S=w.multiFeatureIndex||0,R=w.geometryIndex||0,u=w.segmentIndex||0,d=w.properties,f;switch(C.type){case"FeatureCollection":O<0&&(O=C.features.length+O),d=d||C.features[O].properties,f=C.features[O].geometry;break;case"Feature":d=d||C.properties,f=C.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":f=C;break;default:throw new Error("geojson is invalid")}if(f===null)return null;var p=f.coordinates;switch(f.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=p.length+u-1),t.lineString([p[u],p[u+1]],d,w);case"Polygon":return R<0&&(R=p.length+R),u<0&&(u=p[R].length+u-1),t.lineString([p[R][u],p[R][u+1]],d,w);case"MultiLineString":return S<0&&(S=p.length+S),u<0&&(u=p[S].length+u-1),t.lineString([p[S][u],p[S][u+1]],d,w);case"MultiPolygon":return S<0&&(S=p.length+S),R<0&&(R=p[S].length+R),u<0&&(u=p[S][R].length-u-1),t.lineString([p[S][R][u],p[S][R][u+1]],d,w)}throw new Error("geojson is invalid")}function b(C,w){if(w=w||{},!t.isObject(w))throw new Error("options is invalid");var O=w.featureIndex||0,S=w.multiFeatureIndex||0,R=w.geometryIndex||0,u=w.coordIndex||0,d=w.properties,f;switch(C.type){case"FeatureCollection":O<0&&(O=C.features.length+O),d=d||C.features[O].properties,f=C.features[O].geometry;break;case"Feature":d=d||C.properties,f=C.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":f=C;break;default:throw new Error("geojson is invalid")}if(f===null)return null;var p=f.coordinates;switch(f.type){case"Point":return t.point(p,d,w);case"MultiPoint":return S<0&&(S=p.length+S),t.point(p[S],d,w);case"LineString":return u<0&&(u=p.length+u),t.point(p[u],d,w);case"Polygon":return R<0&&(R=p.length+R),u<0&&(u=p[R].length+u),t.point(p[R][u],d,w);case"MultiLineString":return S<0&&(S=p.length+S),u<0&&(u=p[S].length+u),t.point(p[S][u],d,w);case"MultiPolygon":return S<0&&(S=p.length+S),R<0&&(R=p[S].length+R),u<0&&(u=p[S][R].length-u),t.point(p[S][R][u],d,w)}throw new Error("geojson is invalid")}e.coordAll=h,e.coordEach=i,e.coordReduce=r,e.featureEach=s,e.featureReduce=o,e.findPoint=b,e.findSegment=le,e.flattenEach=_,e.flattenReduce=T,e.geomEach=c,e.geomReduce=x,e.lineEach=q,e.lineReduce=X,e.propEach=n,e.propReduce=a,e.segmentEach=j,e.segmentReduce=z}),$i=N(e=>{Object.defineProperty(e,"__esModule",{value:!0});var t=rt();function i(r){var n=[1/0,1/0,-1/0,-1/0];return t.coordEach(r,function(a){n[0]>a[0]&&(n[0]=a[0]),n[1]>a[1]&&(n[1]=a[1]),n[2]<a[0]&&(n[2]=a[0]),n[3]<a[1]&&(n[3]=a[1])}),n}i.default=i,e.default=i}),pt=N((e,t)=>{var i=Nn(),r=bi(),n=rt(),a=$i().default,s=n.featureEach;n.coordEach,r.polygon;var o=r.featureCollection;function h(c){var x=new i(c);return x.insert=function(_){if(_.type!=="Feature")throw new Error("invalid feature");return _.bbox=_.bbox?_.bbox:a(_),i.prototype.insert.call(this,_)},x.load=function(_){var T=[];return Array.isArray(_)?_.forEach(function(j){if(j.type!=="Feature")throw new Error("invalid features");j.bbox=j.bbox?j.bbox:a(j),T.push(j)}):s(_,function(j){if(j.type!=="Feature")throw new Error("invalid features");j.bbox=j.bbox?j.bbox:a(j),T.push(j)}),i.prototype.load.call(this,T)},x.remove=function(_,T){if(_.type!=="Feature")throw new Error("invalid feature");return _.bbox=_.bbox?_.bbox:a(_),i.prototype.remove.call(this,_,T)},x.clear=function(){return i.prototype.clear.call(this)},x.search=function(_){var T=i.prototype.search.call(this,this.toBBox(_));return o(T)},x.collides=function(_){return i.prototype.collides.call(this,this.toBBox(_))},x.all=function(){var _=i.prototype.all.call(this);return o(_)},x.toJSON=function(){return i.prototype.toJSON.call(this)},x.fromJSON=function(_){return i.prototype.fromJSON.call(this,_)},x.toBBox=function(_){var T;if(_.bbox)T=_.bbox;else if(Array.isArray(_)&&_.length===4)T=_;else if(Array.isArray(_)&&_.length===6)T=[_[0],_[1],_[3],_[4]];else if(_.type==="Feature")T=a(_);else if(_.type==="FeatureCollection")T=a(_);else throw new Error("invalid geojson");return{minX:T[0],minY:T[1],maxX:T[2],maxY:T[3]}},x}t.exports=h,t.exports.default=h});Array.prototype.findIndex=Array.prototype.findIndex||function(e){if(this===null)throw new TypeError("Array.prototype.findIndex called on null or undefined");if(typeof e!="function")throw new TypeError("callback must be a function");for(var t=Object(this),i=t.length>>>0,r=arguments[1],n=0;n<i;n++)if(e.call(r,t[n],n,t))return n;return-1},Array.prototype.find=Array.prototype.find||function(e){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof e!="function")throw new TypeError("callback must be a function");for(var t=Object(this),i=t.length>>>0,r=arguments[1],n=0;n<i;n++){var a=t[n];if(e.call(r,a,n,t))return a}},typeof Object.assign!="function"&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var i=arguments[t];if(i!=null)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}),function(e){e.forEach(function(t){t.hasOwnProperty("remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(this==null)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(r===0)return!1;var n=t|0,a=Math.max(n>=0?n:r-Math.abs(n),0);function s(o,h){return o===h||typeof o=="number"&&typeof h=="number"&&isNaN(o)&&isNaN(h)}for(;a<r;){if(s(i[a],e))return!0;a++}return!1}});var fr={version:"2.18.3"},xi=Se(yi()),Kr={tooltips:{placeMarker:"Click to place marker",firstVertex:"Click to place first vertex",continueLine:"Click to continue drawing",finishLine:"Click any existing marker to finish",finishPoly:"Click first marker to finish",finishRect:"Click to finish",startCircle:"Click to place circle center",finishCircle:"Click to finish circle",placeCircleMarker:"Click to place circle marker",placeText:"Click to place text",selectFirstLayerFor:"Select first layer for {action}",selectSecondLayerFor:"Select second layer for {action}"},actions:{finish:"Finish",cancel:"Cancel",removeLastVertex:"Remove Last Vertex"},buttonTitles:{drawMarkerButton:"Draw Marker",drawPolyButton:"Draw Polygons",drawLineButton:"Draw Polyline",drawCircleButton:"Draw Circle",drawRectButton:"Draw Rectangle",editButton:"Edit Layers",dragButton:"Drag Layers",cutButton:"Cut Layers",deleteButton:"Remove Layers",drawCircleMarkerButton:"Draw Circle Marker",snappingButton:"Snap dragged marker to other layers and vertices",pinningButton:"Pin shared vertices together",rotateButton:"Rotate Layers",drawTextButton:"Draw Text",scaleButton:"Scale Layers",autoTracingButton:"Auto trace Line",snapGuidesButton:"Show SnapGuides",unionButton:"Union layers",differenceButton:"Subtract layers"},measurements:{totalLength:"Length",segmentLength:"Segment length",area:"Area",radius:"Radius",perimeter:"Perimeter",height:"Height",width:"Width",coordinates:"Position",coordinatesMarker:"Position Marker"}},ei={tooltips:{placeMarker:"Platziere den Marker mit Klick",firstVertex:"Platziere den ersten Marker mit Klick",continueLine:"Klicke, um weiter zu zeichnen",finishLine:"Beende mit Klick auf existierenden Marker",finishPoly:"Beende mit Klick auf ersten Marker",finishRect:"Beende mit Klick",startCircle:"Platziere das Kreiszentrum mit Klick",finishCircle:"Beende den Kreis mit Klick",placeCircleMarker:"Platziere den Kreismarker mit Klick",placeText:"Platziere den Text mit Klick"},actions:{finish:"Beenden",cancel:"Abbrechen",removeLastVertex:"Letzten Vertex löschen"},buttonTitles:{drawMarkerButton:"Marker zeichnen",drawPolyButton:"Polygon zeichnen",drawLineButton:"Polyline zeichnen",drawCircleButton:"Kreis zeichnen",drawRectButton:"Rechteck zeichnen",editButton:"Layer editieren",dragButton:"Layer bewegen",cutButton:"Layer schneiden",deleteButton:"Layer löschen",drawCircleMarkerButton:"Kreismarker zeichnen",snappingButton:"Bewegter Layer an andere Layer oder Vertexe einhacken",pinningButton:"Vertexe an der gleichen Position verknüpfen",rotateButton:"Layer drehen",drawTextButton:"Text zeichnen",scaleButton:"Layer skalieren",autoTracingButton:"Linie automatisch nachzeichen"},measurements:{totalLength:"Länge",segmentLength:"Segment Länge",area:"Fläche",radius:"Radius",perimeter:"Umfang",height:"Höhe",width:"Breite",coordinates:"Position",coordinatesMarker:"Position Marker"}},ti={tooltips:{placeMarker:"Clicca per posizionare un Marker",firstVertex:"Clicca per posizionare il primo vertice",continueLine:"Clicca per continuare a disegnare",finishLine:"Clicca qualsiasi marker esistente per terminare",finishPoly:"Clicca il primo marker per terminare",finishRect:"Clicca per terminare",startCircle:"Clicca per posizionare il punto centrale del cerchio",finishCircle:"Clicca per terminare il cerchio",placeCircleMarker:"Clicca per posizionare un Marker del cherchio"},actions:{finish:"Termina",cancel:"Annulla",removeLastVertex:"Rimuovi l'ultimo vertice"},buttonTitles:{drawMarkerButton:"Disegna Marker",drawPolyButton:"Disegna Poligoni",drawLineButton:"Disegna Polilinea",drawCircleButton:"Disegna Cerchio",drawRectButton:"Disegna Rettangolo",editButton:"Modifica Livelli",dragButton:"Sposta Livelli",cutButton:"Ritaglia Livelli",deleteButton:"Elimina Livelli",drawCircleMarkerButton:"Disegna Marker del Cerchio",snappingButton:"Snap ha trascinato il pennarello su altri strati e vertici",pinningButton:"Pin condiviso vertici insieme",rotateButton:"Ruota livello"}},Wr={tooltips:{placeMarker:"Klik untuk menempatkan marker",firstVertex:"Klik untuk menempatkan vertex pertama",continueLine:"Klik untuk meneruskan digitasi",finishLine:"Klik pada sembarang marker yang ada untuk mengakhiri",finishPoly:"Klik marker pertama untuk mengakhiri",finishRect:"Klik untuk mengakhiri",startCircle:"Klik untuk menempatkan titik pusat lingkaran",finishCircle:"Klik untuk mengakhiri lingkaran",placeCircleMarker:"Klik untuk menempatkan penanda lingkarann"},actions:{finish:"Selesai",cancel:"Batal",removeLastVertex:"Hilangkan Vertex Terakhir"},buttonTitles:{drawMarkerButton:"Digitasi Marker",drawPolyButton:"Digitasi Polygon",drawLineButton:"Digitasi Polyline",drawCircleButton:"Digitasi Lingkaran",drawRectButton:"Digitasi Segi Empat",editButton:"Edit Layer",dragButton:"Geser Layer",cutButton:"Potong Layer",deleteButton:"Hilangkan Layer",drawCircleMarkerButton:"Digitasi Penanda Lingkaran",snappingButton:"Jepretkan penanda yang ditarik ke lapisan dan simpul lain",pinningButton:"Sematkan simpul bersama bersama",rotateButton:"Putar lapisan"}},Yi={tooltips:{placeMarker:"Adaugă un punct",firstVertex:"Apasă aici pentru a adăuga primul Vertex",continueLine:"Apasă aici pentru a continua desenul",finishLine:"Apasă pe orice obiect pentru a finisa desenul",finishPoly:"Apasă pe primul obiect pentru a finisa",finishRect:"Apasă pentru a finisa",startCircle:"Apasă pentru a desena un cerc",finishCircle:"Apasă pentru a finisa un cerc",placeCircleMarker:"Adaugă un punct"},actions:{finish:"Termină",cancel:"Anulează",removeLastVertex:"Șterge ultimul Vertex"},buttonTitles:{drawMarkerButton:"Adaugă o bulină",drawPolyButton:"Desenează un poligon",drawLineButton:"Desenează o linie",drawCircleButton:"Desenează un cerc",drawRectButton:"Desenează un dreptunghi",editButton:"Editează straturile",dragButton:"Mută straturile",cutButton:"Taie straturile",deleteButton:"Șterge straturile",drawCircleMarkerButton:"Desenează marcatorul cercului",snappingButton:"Fixați marcatorul glisat pe alte straturi și vârfuri",pinningButton:"Fixați vârfurile partajate împreună",rotateButton:"Rotiți stratul"}},Gn={tooltips:{placeMarker:"Нажмите, чтобы нанести маркер",firstVertex:"Нажмите, чтобы нанести первый объект",continueLine:"Нажмите, чтобы продолжить рисование",finishLine:"Нажмите любой существующий маркер для завершения",finishPoly:"Выберите первую точку, чтобы закончить",finishRect:"Нажмите, чтобы закончить",startCircle:"Нажмите, чтобы добавить центр круга",finishCircle:"Нажмите, чтобы задать радиус",placeCircleMarker:"Нажмите, чтобы нанести круговой маркер"},actions:{finish:"Завершить",cancel:"Отменить",removeLastVertex:"Отменить последнее действие"},buttonTitles:{drawMarkerButton:"Добавить маркер",drawPolyButton:"Рисовать полигон",drawLineButton:"Рисовать кривую",drawCircleButton:"Рисовать круг",drawRectButton:"Рисовать прямоугольник",editButton:"Редактировать слой",dragButton:"Перенести слой",cutButton:"Вырезать слой",deleteButton:"Удалить слой",drawCircleMarkerButton:"Добавить круговой маркер",snappingButton:"Привязать перетаскиваемый маркер к другим слоям и вершинам",pinningButton:"Связать общие точки вместе",rotateButton:"Поворот слоя"}},Ae={tooltips:{placeMarker:"Presiona para colocar un marcador",firstVertex:"Presiona para colocar el primer vértice",continueLine:"Presiona para continuar dibujando",finishLine:"Presiona cualquier marcador existente para finalizar",finishPoly:"Presiona el primer marcador para finalizar",finishRect:"Presiona para finalizar",startCircle:"Presiona para colocar el centro del círculo",finishCircle:"Presiona para finalizar el círculo",placeCircleMarker:"Presiona para colocar un marcador de círculo"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Eliminar último vértice"},buttonTitles:{drawMarkerButton:"Dibujar Marcador",drawPolyButton:"Dibujar Polígono",drawLineButton:"Dibujar Línea",drawCircleButton:"Dibujar Círculo",drawRectButton:"Dibujar Rectángulo",editButton:"Editar Capas",dragButton:"Arrastrar Capas",cutButton:"Cortar Capas",deleteButton:"Eliminar Capas",drawCircleMarkerButton:"Dibujar Marcador de Círculo",snappingButton:"El marcador de Snap arrastrado a otras capas y vértices",pinningButton:"Fijar juntos los vértices compartidos",rotateButton:"Rotar capa"}},gr={tooltips:{placeMarker:"Klik om een marker te plaatsen",firstVertex:"Klik om het eerste punt te plaatsen",continueLine:"Klik om te blijven tekenen",finishLine:"Klik op een bestaand punt om te beëindigen",finishPoly:"Klik op het eerst punt om te beëindigen",finishRect:"Klik om te beëindigen",startCircle:"Klik om het middelpunt te plaatsen",finishCircle:"Klik om de cirkel te beëindigen",placeCircleMarker:"Klik om een marker te plaatsen"},actions:{finish:"Bewaar",cancel:"Annuleer",removeLastVertex:"Verwijder laatste punt"},buttonTitles:{drawMarkerButton:"Plaats Marker",drawPolyButton:"Teken een vlak",drawLineButton:"Teken een lijn",drawCircleButton:"Teken een cirkel",drawRectButton:"Teken een vierkant",editButton:"Bewerk",dragButton:"Verplaats",cutButton:"Knip",deleteButton:"Verwijder",drawCircleMarkerButton:"Plaats Marker",snappingButton:"Snap gesleepte marker naar andere lagen en hoekpunten",pinningButton:"Speld gedeelde hoekpunten samen",rotateButton:"Laag roteren"}},qr={tooltips:{placeMarker:"Cliquez pour placer un marqueur",firstVertex:"Cliquez pour placer le premier sommet",continueLine:"Cliquez pour continuer à dessiner",finishLine:"Cliquez sur n'importe quel marqueur pour terminer",finishPoly:"Cliquez sur le premier marqueur pour terminer",finishRect:"Cliquez pour terminer",startCircle:"Cliquez pour placer le centre du cercle",finishCircle:"Cliquez pour finir le cercle",placeCircleMarker:"Cliquez pour placer le marqueur circulaire"},actions:{finish:"Terminer",cancel:"Annuler",removeLastVertex:"Retirer le dernier sommet"},buttonTitles:{drawMarkerButton:"Placer des marqueurs",drawPolyButton:"Dessiner des polygones",drawLineButton:"Dessiner des polylignes",drawCircleButton:"Dessiner un cercle",drawRectButton:"Dessiner un rectangle",editButton:"Éditer des calques",dragButton:"Déplacer des calques",cutButton:"Couper des calques",deleteButton:"Supprimer des calques",drawCircleMarkerButton:"Dessiner un marqueur circulaire",snappingButton:"Glisser le marqueur vers d'autres couches et sommets",pinningButton:"Épingler ensemble les sommets partagés",rotateButton:"Tourner des calques"}},$r={tooltips:{placeMarker:"单击放置标记",firstVertex:"单击放置首个顶点",continueLine:"单击继续绘制",finishLine:"单击任何存在的标记以完成",finishPoly:"单击第一个标记以完成",finishRect:"单击完成",startCircle:"单击放置圆心",finishCircle:"单击完成圆形",placeCircleMarker:"点击放置圆形标记"},actions:{finish:"完成",cancel:"取消",removeLastVertex:"移除最后的顶点"},buttonTitles:{drawMarkerButton:"绘制标记",drawPolyButton:"绘制多边形",drawLineButton:"绘制线段",drawCircleButton:"绘制圆形",drawRectButton:"绘制长方形",editButton:"编辑图层",dragButton:"拖拽图层",cutButton:"剪切图层",deleteButton:"删除图层",drawCircleMarkerButton:"画圆圈标记",snappingButton:"将拖动的标记捕捉到其他图层和顶点",pinningButton:"将共享顶点固定在一起",rotateButton:"旋转图层"}},mr={tooltips:{placeMarker:"單擊放置標記",firstVertex:"單擊放置第一個頂點",continueLine:"單擊繼續繪製",finishLine:"單擊任何存在的標記以完成",finishPoly:"單擊第一個標記以完成",finishRect:"單擊完成",startCircle:"單擊放置圓心",finishCircle:"單擊完成圓形",placeCircleMarker:"點擊放置圓形標記"},actions:{finish:"完成",cancel:"取消",removeLastVertex:"移除最後一個頂點"},buttonTitles:{drawMarkerButton:"放置標記",drawPolyButton:"繪製多邊形",drawLineButton:"繪製線段",drawCircleButton:"繪製圓形",drawRectButton:"繪製方形",editButton:"編輯圖形",dragButton:"移動圖形",cutButton:"裁切圖形",deleteButton:"刪除圖形",drawCircleMarkerButton:"畫圓圈標記",snappingButton:"將拖動的標記對齊到其他圖層和頂點",pinningButton:"將共享頂點固定在一起",rotateButton:"旋轉圖形"}},Yr={tooltips:{placeMarker:"Clique para posicionar o marcador",firstVertex:"Clique para posicionar o primeiro vértice",continueLine:"Clique para continuar desenhando",finishLine:"Clique em qualquer marcador existente para finalizar",finishPoly:"Clique no primeiro marcador para finalizar",finishRect:"Clique para finalizar",startCircle:"Clique para posicionar o centro do círculo",finishCircle:"Clique para finalizar o círculo",placeCircleMarker:"Clique para posicionar o marcador circular",placeText:"Clique para inserir texto"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Remover último vértice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Polígonos",drawLineButton:"Desenhar Linha Poligonal",drawCircleButton:"Desenhar Círculo",drawRectButton:"Desenhar Retângulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Recortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de Círculo",snappingButton:"Ajustar marcador arrastado a outras camadas e vértices",pinningButton:"Unir vértices compartilhados",rotateButton:"Rotacionar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Redimensionar Camadas",autoTracingButton:"Traçado Automático de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"Área",radius:"Raio",perimeter:"Perímetro",height:"Altura",width:"Largura",coordinates:"Posição",coordinatesMarker:"Marcador de Posição"}},yr={tooltips:{placeMarker:"Clique para colocar marcador",firstVertex:"Clique para colocar primeiro vértice",continueLine:"Clique para continuar a desenhar",finishLine:"Clique num marcador existente para terminar",finishPoly:"Clique no primeiro marcador para terminar",finishRect:"Clique para terminar",startCircle:"Clique para colocar o centro do círculo",finishCircle:"Clique para terminar o círculo",placeCircleMarker:"Clique para colocar marcador de círculo",placeText:"Clique para colocar texto"},actions:{finish:"Terminar",cancel:"Cancelar",removeLastVertex:"Remover Último Vértice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Polígonos",drawLineButton:"Desenhar Polilinha",drawCircleButton:"Desenhar Círculo",drawRectButton:"Desenhar Retângulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Cortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de Círculo",snappingButton:"Ajustar marcador arrastado a outras camadas e vértices",pinningButton:"Unir vértices partilhados",rotateButton:"Rodar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Escalar Camadas",autoTracingButton:"Traçado Automático de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"Área",radius:"Raio",perimeter:"Perímetro",height:"Altura",width:"Largura",coordinates:"Posição",coordinatesMarker:"Marcador de Posição"}},Xr={tooltips:{placeMarker:"Kliknij, aby umieścić znacznik",firstVertex:"Kliknij, aby umieścić pierwszy wierzchołek",continueLine:"Kliknij, aby kontynuować rysowanie",finishLine:"Kliknij dowolny istniejący znacznik, aby zakończyć",finishPoly:"Kliknij pierwszy znacznik, aby zakończyć",finishRect:"Kliknij, aby zakończyć",startCircle:"Kliknij, aby umieścić środek okręgu",finishCircle:"Kliknij, aby zakończyć okrąg",placeCircleMarker:"Kliknij, aby umieścić znacznik okręgu",placeText:"Kliknij, aby umieścić tekst"},actions:{finish:"Zakończ",cancel:"Anuluj",removeLastVertex:"Usuń ostatni wierzchołek"},buttonTitles:{drawMarkerButton:"Rysuj znacznik",drawPolyButton:"Rysuj wielokąt",drawLineButton:"Rysuj linię",drawCircleButton:"Rysuj okrąg",drawRectButton:"Rysuj prostokąt",editButton:"Edytuj warstwy",dragButton:"Przeciągnij warstwy",cutButton:"Wytnij warstwy",deleteButton:"Usuń warstwy",drawCircleMarkerButton:"Rysuj znacznik okrągły",snappingButton:"Przyciągnij przenoszony znacznik do innych warstw i wierzchołków",pinningButton:"Przypnij wspólne wierzchołki razem",rotateButton:"Obróć warstwy",drawTextButton:"Rysuj tekst",scaleButton:"Skaluj warstwy",autoTracingButton:"Automatyczne śledzenie linii"},measurements:{totalLength:"Długość",segmentLength:"Długość odcinka",area:"Obszar",radius:"Promień",perimeter:"Obwód",height:"Wysokość",width:"Szerokość",coordinates:"Pozycja",coordinatesMarker:"Znacznik pozycji"}},ii={tooltips:{placeMarker:"Klicka för att placera markör",firstVertex:"Klicka för att placera första hörnet",continueLine:"Klicka för att fortsätta rita",finishLine:"Klicka på en existerande punkt för att slutföra",finishPoly:"Klicka på den första punkten för att slutföra",finishRect:"Klicka för att slutföra",startCircle:"Klicka för att placera cirkelns centrum",finishCircle:"Klicka för att slutföra cirkeln",placeCircleMarker:"Klicka för att placera cirkelmarkör"},actions:{finish:"Slutför",cancel:"Avbryt",removeLastVertex:"Ta bort sista hörnet"},buttonTitles:{drawMarkerButton:"Rita Markör",drawPolyButton:"Rita Polygoner",drawLineButton:"Rita Linje",drawCircleButton:"Rita Cirkel",drawRectButton:"Rita Rektangel",editButton:"Redigera Lager",dragButton:"Dra Lager",cutButton:"Klipp i Lager",deleteButton:"Ta bort Lager",drawCircleMarkerButton:"Rita Cirkelmarkör",snappingButton:"Snäpp dra markören till andra lager och hörn",pinningButton:"Fäst delade hörn tillsammans",rotateButton:"Rotera lagret"}},At={tooltips:{placeMarker:"Κάντε κλικ για να τοποθετήσετε Δείκτη",firstVertex:"Κάντε κλικ για να τοποθετήσετε το πρώτο σημείο",continueLine:"Κάντε κλικ για να συνεχίσετε να σχεδιάζετε",finishLine:"Κάντε κλικ σε οποιονδήποτε υπάρχον σημείο για να ολοκληρωθεί",finishPoly:"Κάντε κλικ στο πρώτο σημείο για να τελειώσετε",finishRect:"Κάντε κλικ για να τελειώσετε",startCircle:"Κάντε κλικ για να τοποθετήσετε κέντρο Κύκλου",finishCircle:"Κάντε κλικ για να ολοκληρώσετε τον Κύκλο",placeCircleMarker:"Κάντε κλικ για να τοποθετήσετε Κυκλικό Δείκτη"},actions:{finish:"Τέλος",cancel:"Ακύρωση",removeLastVertex:"Κατάργηση τελευταίου σημείου"},buttonTitles:{drawMarkerButton:"Σχεδίαση Δείκτη",drawPolyButton:"Σχεδίαση Πολυγώνου",drawLineButton:"Σχεδίαση Γραμμής",drawCircleButton:"Σχεδίαση Κύκλου",drawRectButton:"Σχεδίαση Ορθογωνίου",editButton:"Επεξεργασία Επιπέδων",dragButton:"Μεταφορά Επιπέδων",cutButton:"Αποκοπή Επιπέδων",deleteButton:"Κατάργηση Επιπέδων",drawCircleMarkerButton:"Σχεδίαση Κυκλικού Δείκτη",snappingButton:"Προσκόλληση του Δείκτη μεταφοράς σε άλλα Επίπεδα και Κορυφές",pinningButton:"Περικοπή κοινών κορυφών μαζί",rotateButton:"Περιστρέψτε το στρώμα"}},zn={tooltips:{placeMarker:"Kattintson a jelölő elhelyezéséhez",firstVertex:"Kattintson az első pont elhelyezéséhez",continueLine:"Kattintson a következő pont elhelyezéséhez",finishLine:"A befejezéshez kattintson egy meglévő pontra",finishPoly:"A befejezéshez kattintson az első pontra",finishRect:"Kattintson a befejezéshez",startCircle:"Kattintson a kör középpontjának elhelyezéséhez",finishCircle:"Kattintson a kör befejezéséhez",placeCircleMarker:"Kattintson a körjelölő elhelyezéséhez"},actions:{finish:"Befejezés",cancel:"Mégse",removeLastVertex:"Utolsó pont eltávolítása"},buttonTitles:{drawMarkerButton:"Jelölő rajzolása",drawPolyButton:"Poligon rajzolása",drawLineButton:"Vonal rajzolása",drawCircleButton:"Kör rajzolása",drawRectButton:"Négyzet rajzolása",editButton:"Elemek szerkesztése",dragButton:"Elemek mozgatása",cutButton:"Elemek vágása",deleteButton:"Elemek törlése",drawCircleMarkerButton:"Kör jelölő rajzolása",snappingButton:"Kapcsolja a jelöltőt másik elemhez vagy ponthoz",pinningButton:"Közös pontok összekötése",rotateButton:"Fólia elforgatása"}},Je={tooltips:{placeMarker:"Tryk for at placere en markør",firstVertex:"Tryk for at placere det første punkt",continueLine:"Tryk for at fortsætte linjen",finishLine:"Tryk på et eksisterende punkt for at afslutte",finishPoly:"Tryk på det første punkt for at afslutte",finishRect:"Tryk for at afslutte",startCircle:"Tryk for at placere cirklens center",finishCircle:"Tryk for at afslutte cirklen",placeCircleMarker:"Tryk for at placere en cirkelmarkør"},actions:{finish:"Afslut",cancel:"Afbryd",removeLastVertex:"Fjern sidste punkt"},buttonTitles:{drawMarkerButton:"Placer markør",drawPolyButton:"Tegn polygon",drawLineButton:"Tegn linje",drawCircleButton:"Tegn cirkel",drawRectButton:"Tegn firkant",editButton:"Rediger",dragButton:"Træk",cutButton:"Klip",deleteButton:"Fjern",drawCircleMarkerButton:"Tegn cirkelmarkør",snappingButton:"Fastgør trukket markør til andre elementer",pinningButton:"Sammenlæg delte elementer",rotateButton:"Roter laget"}},_r={tooltips:{placeMarker:"Klikk for å plassere punkt",firstVertex:"Klikk for å plassere første punkt",continueLine:"Klikk for å tegne videre",finishLine:"Klikk på et eksisterende punkt for å fullføre",finishPoly:"Klikk første punkt for å fullføre",finishRect:"Klikk for å fullføre",startCircle:"Klikk for å sette sirkel midtpunkt",finishCircle:"Klikk for å fullføre sirkel",placeCircleMarker:"Klikk for å plassere sirkel",placeText:"Klikk for å plassere tekst"},actions:{finish:"Fullfør",cancel:"Kanseller",removeLastVertex:"Fjern forrige punkt"},buttonTitles:{drawMarkerButton:"Tegn punkt",drawPolyButton:"Tegn flate",drawLineButton:"Tegn linje",drawCircleButton:"Tegn sirkel",drawRectButton:"Tegn rektangel",editButton:"Rediger objekter",dragButton:"Dra objekter",cutButton:"Kutt objekter",deleteButton:"Fjern objekter",drawCircleMarkerButton:"Tegn sirkel-punkt",snappingButton:"Fest dratt punkt til andre objekter og punkt",pinningButton:"Pin delte punkter sammen",rotateButton:"Rotér objekter",drawTextButton:"Tegn tekst",scaleButton:"Skalér objekter",autoTracingButton:"Automatisk sporing av linje"},measurements:{totalLength:"Lengde",segmentLength:"Segmentlengde",area:"Område",radius:"Radius",perimeter:"Omriss",height:"Høyde",width:"Bredde",coordinates:"Posisjon",coordinatesMarker:"Posisjonsmarkør"}},br={tooltips:{placeMarker:"کلیک برای جانمایی نشان",firstVertex:"کلیک برای رسم اولین رأس",continueLine:"کلیک برای ادامه رسم",finishLine:"کلیک روی هر نشان موجود برای پایان",finishPoly:"کلیک روی اولین نشان برای پایان",finishRect:"کلیک برای پایان",startCircle:"کلیک برای رسم مرکز دایره",finishCircle:"کلیک برای پایان رسم دایره",placeCircleMarker:"کلیک برای رسم نشان دایره",placeText:"کلیک برای نوشتن متن"},actions:{finish:"پایان",cancel:"لفو",removeLastVertex:"حذف آخرین رأس"},buttonTitles:{drawMarkerButton:"درج نشان",drawPolyButton:"رسم چندضلعی",drawLineButton:"رسم خط",drawCircleButton:"رسم دایره",drawRectButton:"رسم چهارضلعی",editButton:"ویرایش لایه‌ها",dragButton:"جابجایی لایه‌ها",cutButton:"برش لایه‌ها",deleteButton:"حذف لایه‌ها",drawCircleMarkerButton:"رسم نشان دایره",snappingButton:"نشانگر را به لایه‌ها و رئوس دیگر بکشید",pinningButton:"رئوس مشترک را با هم پین کنید",rotateButton:"چرخش لایه",drawTextButton:"رسم متن",scaleButton:"مقیاس‌گذاری",autoTracingButton:"ردیاب خودکار"},measurements:{totalLength:"طول",segmentLength:"طول بخش",area:"ناحیه",radius:"شعاع",perimeter:"محیط",height:"ارتفاع",width:"عرض",coordinates:"موقعیت",coordinatesMarker:"موقعیت نشان"}},Un={tooltips:{placeMarker:"Натисніть, щоб нанести маркер",firstVertex:"Натисніть, щоб нанести першу вершину",continueLine:"Натисніть, щоб продовжити малювати",finishLine:"Натисніть будь-який існуючий маркер для завершення",finishPoly:"Виберіть перший маркер, щоб завершити",finishRect:"Натисніть, щоб завершити",startCircle:"Натисніть, щоб додати центр кола",finishCircle:"Натисніть, щоб завершити коло",placeCircleMarker:"Натисніть, щоб нанести круговий маркер"},actions:{finish:"Завершити",cancel:"Відмінити",removeLastVertex:"Видалити попередню вершину"},buttonTitles:{drawMarkerButton:"Малювати маркер",drawPolyButton:"Малювати полігон",drawLineButton:"Малювати криву",drawCircleButton:"Малювати коло",drawRectButton:"Малювати прямокутник",editButton:"Редагувати шари",dragButton:"Перенести шари",cutButton:"Вирізати шари",deleteButton:"Видалити шари",drawCircleMarkerButton:"Малювати круговий маркер",snappingButton:"Прив’язати перетягнутий маркер до інших шарів та вершин",pinningButton:"Зв'язати спільні вершини разом",rotateButton:"Повернути шар"}},Hn={tooltips:{placeMarker:"İşaretçi yerleştirmek için tıklayın",firstVertex:"İlk tepe noktasını yerleştirmek için tıklayın",continueLine:"Çizime devam etmek için tıklayın",finishLine:"Bitirmek için mevcut herhangi bir işaretçiyi tıklayın",finishPoly:"Bitirmek için ilk işaretçiyi tıklayın",finishRect:"Bitirmek için tıklayın",startCircle:"Daire merkezine yerleştirmek için tıklayın",finishCircle:"Daireyi bitirmek için tıklayın",placeCircleMarker:"Daire işaretçisi yerleştirmek için tıklayın"},actions:{finish:"Bitir",cancel:"İptal",removeLastVertex:"Son köşeyi kaldır"},buttonTitles:{drawMarkerButton:"Çizim İşaretçisi",drawPolyButton:"Çokgenler çiz",drawLineButton:"Çoklu çizgi çiz",drawCircleButton:"Çember çiz",drawRectButton:"Dikdörtgen çiz",editButton:"Katmanları düzenle",dragButton:"Katmanları sürükle",cutButton:"Katmanları kes",deleteButton:"Katmanları kaldır",drawCircleMarkerButton:"Daire işaretçisi çiz",snappingButton:"Sürüklenen işaretçiyi diğer katmanlara ve köşelere yapıştır",pinningButton:"Paylaşılan köşeleri birbirine sabitle",rotateButton:"Katmanı döndür"}},Zr={tooltips:{placeMarker:"Kliknutím vytvoříte značku",firstVertex:"Kliknutím vytvoříte první objekt",continueLine:"Kliknutím pokračujte v kreslení",finishLine:"Kliknutí na libovolnou existující značku pro dokončení",finishPoly:"Vyberte první bod pro dokončení",finishRect:"Klikněte pro dokončení",startCircle:"Kliknutím přidejte střed kruhu",finishCircle:"Нажмите, чтобы задать радиус",placeCircleMarker:"Kliknutím nastavte poloměr"},actions:{finish:"Dokončit",cancel:"Zrušit",removeLastVertex:"Zrušit poslední akci"},buttonTitles:{drawMarkerButton:"Přidat značku",drawPolyButton:"Nakreslit polygon",drawLineButton:"Nakreslit křivku",drawCircleButton:"Nakreslit kruh",drawRectButton:"Nakreslit obdélník",editButton:"Upravit vrstvu",dragButton:"Přeneste vrstvu",cutButton:"Vyjmout vrstvu",deleteButton:"Smazat vrstvu",drawCircleMarkerButton:"Přidat kruhovou značku",snappingButton:"Navázat tažnou značku k dalším vrstvám a vrcholům",pinningButton:"Spojit společné body dohromady",rotateButton:"Otočte vrstvu"}},Jr={tooltips:{placeMarker:"クリックしてマーカーを配置",firstVertex:"クリックして最初の頂点を配置",continueLine:"クリックして描画を続ける",finishLine:"任意のマーカーをクリックして終了",finishPoly:"最初のマーカーをクリックして終了",finishRect:"クリックして終了",startCircle:"クリックして円の中心を配置",finishCircle:"クリックして円の描画を終了",placeCircleMarker:"クリックして円マーカーを配置",placeText:"クリックしてテキストを配置"},actions:{finish:"終了",cancel:"キャンセル",removeLastVertex:"最後の頂点を削除"},buttonTitles:{drawMarkerButton:"マーカーを描画",drawPolyButton:"ポリゴンを描画",drawLineButton:"折れ線を描画",drawCircleButton:"円を描画",drawRectButton:"矩形を描画",editButton:"レイヤーを編集",dragButton:"レイヤーをドラッグ",cutButton:"レイヤーを切り取り",deleteButton:"レイヤーを削除",drawCircleMarkerButton:"円マーカーを描画",snappingButton:"ドラッグしたマーカーを他のレイヤーや頂点にスナップする",pinningButton:"共有する頂点を同時に動かす",rotateButton:"レイヤーを回転",drawTextButton:"テキストを描画"}},vt={tooltips:{placeMarker:"Klikkaa asettaaksesi merkin",firstVertex:"Klikkaa asettaakseni ensimmäisen osuuden",continueLine:"Klikkaa jatkaaksesi piirtämistä",finishLine:"Klikkaa olemassa olevaa merkkiä lopettaaksesi",finishPoly:"Klikkaa ensimmäistä merkkiä lopettaaksesi",finishRect:"Klikkaa lopettaaksesi",startCircle:"Klikkaa asettaaksesi ympyrän keskipisteen",finishCircle:"Klikkaa lopettaaksesi ympyrän",placeCircleMarker:"Klikkaa asettaaksesi ympyrämerkin",placeText:"Klikkaa asettaaksesi tekstin"},actions:{finish:"Valmis",cancel:"Peruuta",removeLastVertex:"Poista viimeinen osuus"},buttonTitles:{drawMarkerButton:"Piirrä merkkejä",drawPolyButton:"Piirrä monikulmioita",drawLineButton:"Piirrä viivoja",drawCircleButton:"Piirrä ympyrä",drawRectButton:"Piirrä neliskulmioita",editButton:"Muokkaa",dragButton:"Siirrä",cutButton:"Leikkaa",deleteButton:"Poista",drawCircleMarkerButton:"Piirrä ympyrämerkki",snappingButton:"Kiinnitä siirrettävä merkki toisiin muotoihin",pinningButton:"Kiinnitä jaetut muodot yhteen",rotateButton:"Käännä",drawTextButton:"Piirrä tekstiä"}},Vn={tooltips:{placeMarker:"마커 위치를 클릭하세요",firstVertex:"첫번째 꼭지점 위치을 클릭하세요",continueLine:"계속 그리려면 클릭하세요",finishLine:"끝내려면 기존 마커를 클릭하세요",finishPoly:"끝내려면 처음 마커를 클릭하세요",finishRect:"끝내려면 클릭하세요",startCircle:"원의 중심이 될 위치를 클릭하세요",finishCircle:"원을 끝내려면 클릭하세요",placeCircleMarker:"원 마커 위치를 클릭하세요",placeText:"텍스트 위치를 클릭하세요"},actions:{finish:"끝내기",cancel:"취소",removeLastVertex:"마지막 꼭지점 제거"},buttonTitles:{drawMarkerButton:"마커 그리기",drawPolyButton:"다각형 그리기",drawLineButton:"다각선 그리기",drawCircleButton:"원 그리기",drawRectButton:"직사각형 그리기",editButton:"레이어 편집하기",dragButton:"레이어 끌기",cutButton:"레이어 자르기",deleteButton:"레이어 제거하기",drawCircleMarkerButton:"원 마커 그리기",snappingButton:"잡아끈 마커를 다른 레이어 및 꼭지점에 들러붙게 하기",pinningButton:"공유 꼭지점을 함께 찍기",rotateButton:"레이어 회전하기",drawTextButton:"텍스트 그리기"}},vi={tooltips:{placeMarker:"Маркерди жайгаштыруу үчүн басыңыз",firstVertex:"Биринчи чокуну жайгаштырууну үчүн басыңыз",continueLine:"Сүрөт тартууну улантуу үчүн басыңыз",finishLine:"Аяктоо үчүн учурдагы маркерди басыңыз",finishPoly:"Бүтүрүү үчүн биринчи маркерди басыңыз",finishRect:"Бүтүрүү үчүн басыңыз",startCircle:"Айлананын борборун жайгаштырууну үчүн басыңыз",finishCircle:"Айлананы бүтүрүү үчүн басыңыз",placeCircleMarker:"Тегерек маркерди жайгаштыруу үчүн басыңыз",placeText:"Текстти жайгаштыруу үчүн басыңыз"},actions:{finish:"Аягы",cancel:"Жок кылуу",removeLastVertex:"Акыркы чокуну өчүрүү"},buttonTitles:{drawMarkerButton:"Маркерди чизуу",drawPolyButton:"Полигон чизуу",drawLineButton:"Полилиния чизуу",drawCircleButton:"Дайынды чизуу",drawRectButton:"Прямоугольник чизуу",editButton:"Слоопту түзөтүү",dragButton:"Слоопту карап сүйлөү",cutButton:"Слооптун башын кесүү",deleteButton:"Слооптун өчүрүү",drawCircleMarkerButton:"Дайынды маркерди чизуу",snappingButton:"Башка слооптордун жана вертекстердин арасына чекилдөө",pinningButton:"Бөлүшкөн вертекстерди бирге тутуштуруу",rotateButton:"Слооптун өзгөртүү",drawTextButton:"Текст чизуу",scaleButton:"Слооптун өлчөмүн өзгөртүү",autoTracingButton:"Автоматтык тизмеги чизуу"},measurements:{totalLength:"Узундук",segmentLength:"Сегмент узундугу",area:"Аймак",radius:"Радиус",perimeter:"Периметр",height:"Диаметр",width:"Кенчилик",coordinates:"Координаттар",coordinatesMarker:"Маркердин координаттары"}},xr=yr,ft={en:Kr,de:ei,it:ti,id:Wr,ro:Yi,ru:Gn,es:Ae,nl:gr,fr:qr,pt:xr,pt_br:Yr,pt_pt:yr,zh:$r,zh_tw:mr,pl:Xr,sv:ii,el:At,hu:zn,da:Je,no:_r,fa:br,ua:Un,tr:Hn,cz:Zr,ja:Jr,fi:vt,ko:Vn,ky:vi},Qr={_globalEditModeEnabled:!1,enableGlobalEditMode(e){let t={...e};this._globalEditModeEnabled=!0,this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),L.PM.Utils.findLayers(this.map).forEach(i=>{this._isRelevantForEdit(i)&&i.pm.enable(t)}),this.throttledReInitEdit||(this.throttledReInitEdit=L.Util.throttle(this.handleLayerAdditionInGlobalEditMode,100,this)),this._addedLayersEdit={},this.map.on("layeradd",this._layerAddedEdit,this),this.map.on("layeradd",this.throttledReInitEdit,this),this._fireGlobalEditModeToggled(!0)},disableGlobalEditMode(){this._globalEditModeEnabled=!1,L.PM.Utils.findLayers(this.map).forEach(e=>{e.pm.disable()}),this.map.off("layeradd",this._layerAddedEdit,this),this.map.off("layeradd",this.throttledReInitEdit,this),this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),this._fireGlobalEditModeToggled(!1)},globalEditEnabled(){return this.globalEditModeEnabled()},globalEditModeEnabled(){return this._globalEditModeEnabled},toggleGlobalEditMode(e=this.globalOptions){this.globalEditModeEnabled()?this.disableGlobalEditMode():this.enableGlobalEditMode(e)},handleLayerAdditionInGlobalEditMode(){let e=this._addedLayersEdit;if(this._addedLayersEdit={},this.globalEditModeEnabled())for(let t in e){let i=e[t];this._isRelevantForEdit(i)&&i.pm.enable({...this.globalOptions})}},_layerAddedEdit({layer:e}){this._addedLayersEdit[L.stamp(e)]=e},_isRelevantForEdit(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowEditing}},Be=Qr,Xi={_globalDragModeEnabled:!1,enableGlobalDragMode(){let e=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!0,this._addedLayersDrag={},e.forEach(t=>{this._isRelevantForDrag(t)&&t.pm.enableLayerDrag()}),this.throttledReInitDrag||(this.throttledReInitDrag=L.Util.throttle(this.reinitGlobalDragMode,100,this)),this.map.on("layeradd",this._layerAddedDrag,this),this.map.on("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!0)},disableGlobalDragMode(){let e=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!1,e.forEach(t=>{t.pm.disableLayerDrag()}),this.map.off("layeradd",this._layerAddedDrag,this),this.map.off("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!1)},globalDragModeEnabled(){return!!this._globalDragModeEnabled},toggleGlobalDragMode(){this.globalDragModeEnabled()?this.disableGlobalDragMode():this.enableGlobalDragMode()},reinitGlobalDragMode(){let e=this._addedLayersDrag;if(this._addedLayersDrag={},this.globalDragModeEnabled())for(let t in e){let i=e[t];this._isRelevantForDrag(i)&&i.pm.enableLayerDrag()}},_layerAddedDrag({layer:e}){this._addedLayersDrag[L.stamp(e)]=e},_isRelevantForDrag(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.draggable}},Pt=Xi,Kn={_globalRemovalModeEnabled:!1,enableGlobalRemovalMode(){this._globalRemovalModeEnabled=!0,this.map.eachLayer(e=>{this._isRelevantForRemoval(e)&&(e.pm.enabled()&&e.pm.disable(),e.on("click",this.removeLayer,this))}),this.throttledReInitRemoval||(this.throttledReInitRemoval=L.Util.throttle(this.handleLayerAdditionInGlobalRemovalMode,100,this)),this._addedLayersRemoval={},this.map.on("layeradd",this._layerAddedRemoval,this),this.map.on("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!0)},disableGlobalRemovalMode(){this._globalRemovalModeEnabled=!1,this.map.eachLayer(e=>{e.off("click",this.removeLayer,this)}),this.map.off("layeradd",this._layerAddedRemoval,this),this.map.off("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!1)},globalRemovalEnabled(){return this.globalRemovalModeEnabled()},globalRemovalModeEnabled(){return!!this._globalRemovalModeEnabled},toggleGlobalRemovalMode(){this.globalRemovalModeEnabled()?this.disableGlobalRemovalMode():this.enableGlobalRemovalMode()},removeLayer(e){let t=e.target;this._isRelevantForRemoval(t)&&!t.pm.dragging()&&(t.removeFrom(this.map.pm._getContainingLayer()),t.remove(),t instanceof L.LayerGroup?(this._fireRemoveLayerGroup(t),this._fireRemoveLayerGroup(this.map,t)):(t.pm._fireRemove(t),t.pm._fireRemove(this.map,t)))},_isRelevantForRemoval(e){return e.pm&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowRemoval},handleLayerAdditionInGlobalRemovalMode(){let e=this._addedLayersRemoval;if(this._addedLayersRemoval={},this.globalRemovalModeEnabled())for(let t in e){let i=e[t];this._isRelevantForRemoval(i)&&(i.pm.enabled()&&i.pm.disable(),i.on("click",this.removeLayer,this))}},_layerAddedRemoval({layer:e}){this._addedLayersRemoval[L.stamp(e)]=e}},Ht=Kn,we={_globalRotateModeEnabled:!1,enableGlobalRotateMode(){this._globalRotateModeEnabled=!0,L.PM.Utils.findLayers(this.map).filter(e=>e instanceof L.Polyline).forEach(e=>{this._isRelevantForRotate(e)&&e.pm.enableRotate()}),this.throttledReInitRotate||(this.throttledReInitRotate=L.Util.throttle(this.handleLayerAdditionInGlobalRotateMode,100,this)),this._addedLayersRotate={},this.map.on("layeradd",this._layerAddedRotate,this),this.map.on("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},disableGlobalRotateMode(){this._globalRotateModeEnabled=!1,L.PM.Utils.findLayers(this.map).filter(e=>e instanceof L.Polyline).forEach(e=>{e.pm.disableRotate()}),this.map.off("layeradd",this._layerAddedRotate,this),this.map.off("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},globalRotateModeEnabled(){return!!this._globalRotateModeEnabled},toggleGlobalRotateMode(){this.globalRotateModeEnabled()?this.disableGlobalRotateMode():this.enableGlobalRotateMode()},_isRelevantForRotate(e){return e.pm&&e instanceof L.Polyline&&!(e instanceof L.LayerGroup)&&(!L.PM.optIn&&!e.options.pmIgnore||L.PM.optIn&&e.options.pmIgnore===!1)&&!e._pmTempLayer&&e.pm.options.allowRotation},handleLayerAdditionInGlobalRotateMode(){let e=this._addedLayersRotate;if(this._addedLayersRotate={},this.globalRotateModeEnabled())for(let t in e){let i=e[t];this._isRelevantForRemoval(i)&&i.pm.enableRotate()}},_layerAddedRotate({layer:e}){this._addedLayersRotate[L.stamp(e)]=e}},en=we,Pe=Se(yi()),Vt={_fireDrawStart(e="Draw",t={}){this.__fire(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer},e,t)},_fireDrawEnd(e="Draw",t={}){this.__fire(this._map,"pm:drawend",{shape:this._shape},e,t)},_fireCreate(e,t="Draw",i={}){this.__fire(this._map,"pm:create",{shape:this._shape,marker:e,layer:e},t,i)},_fireCenterPlaced(e="Draw",t={}){let i=e==="Draw"?this._layer:void 0,r=e!=="Draw"?this._layer:void 0;this.__fire(this._layer,"pm:centerplaced",{shape:this._shape,workingLayer:i,layer:r,latlng:this._layer.getLatLng()},e,t)},_fireCut(e,t,i,r="Draw",n={}){this.__fire(e,"pm:cut",{shape:this._shape,layer:t,originalLayer:i},r,n)},_fireEdit(e=this._layer,t="Edit",i={}){this.__fire(e,"pm:edit",{layer:this._layer,shape:this.getShape()},t,i)},_fireEnable(e="Edit",t={}){this.__fire(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()},e,t)},_fireDisable(e="Edit",t={}){this.__fire(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()},e,t)},_fireUpdate(e="Edit",t={}){this.__fire(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()},e,t)},_fireMarkerDragStart(e,t=void 0,i="Edit",r={}){this.__fire(this._layer,"pm:markerdragstart",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t},i,r)},_fireMarkerDrag(e,t=void 0,i="Edit",r={}){this.__fire(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t},i,r)},_fireMarkerDragEnd(e,t=void 0,i=void 0,r="Edit",n={}){this.__fire(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:e,shape:this.getShape(),indexPath:t,intersectionReset:i},r,n)},_fireDragStart(e="Edit",t={}){this.__fire(this._layer,"pm:dragstart",{layer:this._layer,shape:this.getShape()},e,t)},_fireDrag(e,t="Edit",i={}){this.__fire(this._layer,"pm:drag",{...e,shape:this.getShape()},t,i)},_fireDragEnd(e="Edit",t={}){this.__fire(this._layer,"pm:dragend",{layer:this._layer,shape:this.getShape()},e,t)},_fireDragEnable(e="Edit",t={}){this.__fire(this._layer,"pm:dragenable",{layer:this._layer,shape:this.getShape()},e,t)},_fireDragDisable(e="Edit",t={}){this.__fire(this._layer,"pm:dragdisable",{layer:this._layer,shape:this.getShape()},e,t)},_fireRemove(e,t=e,i="Edit",r={}){this.__fire(e,"pm:remove",{layer:t,shape:this.getShape()},i,r)},_fireVertexAdded(e,t,i,r="Edit",n={}){this.__fire(this._layer,"pm:vertexadded",{layer:this._layer,workingLayer:this._layer,marker:e,indexPath:t,latlng:i,shape:this.getShape()},r,n)},_fireVertexRemoved(e,t,i="Edit",r={}){this.__fire(this._layer,"pm:vertexremoved",{layer:this._layer,marker:e,indexPath:t,shape:this.getShape()},i,r)},_fireVertexClick(e,t,i="Edit",r={}){this.__fire(this._layer,"pm:vertexclick",{layer:this._layer,markerEvent:e,indexPath:t,shape:this.getShape()},i,r)},_fireIntersect(e,t=this._layer,i="Edit",r={}){this.__fire(t,"pm:intersect",{layer:this._layer,intersection:e,shape:this.getShape()},i,r)},_fireLayerReset(e,t,i="Edit",r={}){this.__fire(this._layer,"pm:layerreset",{layer:this._layer,markerEvent:e,indexPath:t,shape:this.getShape()},i,r)},_fireChange(e,t="Edit",i={}){this.__fire(this._layer,"pm:change",{layer:this._layer,latlngs:e,shape:this.getShape()},t,i)},_fireTextChange(e,t="Edit",i={}){this.__fire(this._layer,"pm:textchange",{layer:this._layer,text:e,shape:this.getShape()},t,i)},_fireTextFocus(e="Edit",t={}){this.__fire(this._layer,"pm:textfocus",{layer:this._layer,shape:this.getShape()},e,t)},_fireTextBlur(e="Edit",t={}){this.__fire(this._layer,"pm:textblur",{layer:this._layer,shape:this.getShape()},e,t)},_fireSnapDrag(e,t,i="Snapping",r={}){this.__fire(e,"pm:snapdrag",t,i,r)},_fireSnap(e,t,i="Snapping",r={}){this.__fire(e,"pm:snap",t,i,r)},_fireUnsnap(e,t,i="Snapping",r={}){this.__fire(e,"pm:unsnap",t,i,r)},_fireRotationEnable(e,t,i="Rotation",r={}){this.__fire(e,"pm:rotateenable",{layer:this._layer,helpLayer:this._rotatePoly,shape:this.getShape()},i,r)},_fireRotationDisable(e,t="Rotation",i={}){this.__fire(e,"pm:rotatedisable",{layer:this._layer,shape:this.getShape()},t,i)},_fireRotationStart(e,t,i="Rotation",r={}){this.__fire(e,"pm:rotatestart",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:this._startAngle,originLatLngs:t},i,r)},_fireRotation(e,t,i,r=this._rotationLayer,n="Rotation",a={}){this.__fire(e,"pm:rotate",{layer:r,helpLayer:this._layer,startAngle:this._startAngle,angle:r.pm.getAngle(),angleDiff:t,oldLatLngs:i,newLatLngs:r.getLatLngs()},n,a)},_fireRotationEnd(e,t,i,r="Rotation",n={}){this.__fire(e,"pm:rotateend",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:t,angle:this._rotationLayer.pm.getAngle(),originLatLngs:i,newLatLngs:this._rotationLayer.getLatLngs()},r,n)},_fireActionClick(e,t,i,r="Toolbar",n={}){this.__fire(this._map,"pm:actionclick",{text:e.text,action:e,btnName:t,button:i},r,n)},_fireButtonClick(e,t,i="Toolbar",r={}){this.__fire(this._map,"pm:buttonclick",{btnName:e,button:t},i,r)},_fireLangChange(e,t,i,r,n="Global",a={}){this.__fire(this.map,"pm:langchange",{oldLang:e,activeLang:t,fallback:i,translations:r},n,a)},_fireGlobalDragModeToggled(e,t="Global",i={}){this.__fire(this.map,"pm:globaldragmodetoggled",{enabled:e,map:this.map},t,i)},_fireGlobalEditModeToggled(e,t="Global",i={}){this.__fire(this.map,"pm:globaleditmodetoggled",{enabled:e,map:this.map},t,i)},_fireGlobalRemovalModeToggled(e,t="Global",i={}){this.__fire(this.map,"pm:globalremovalmodetoggled",{enabled:e,map:this.map},t,i)},_fireGlobalCutModeToggled(e="Global",t={}){this.__fire(this._map,"pm:globalcutmodetoggled",{enabled:!!this._enabled,map:this._map},e,t)},_fireGlobalDrawModeToggled(e="Global",t={}){this.__fire(this._map,"pm:globaldrawmodetoggled",{enabled:this._enabled,shape:this._shape,map:this._map},e,t)},_fireGlobalRotateModeToggled(e="Global",t={}){this.__fire(this.map,"pm:globalrotatemodetoggled",{enabled:this.globalRotateModeEnabled(),map:this.map},e,t)},_fireRemoveLayerGroup(e,t=e,i="Edit",r={}){this.__fire(e,"pm:remove",{layer:t,shape:void 0},i,r)},_fireKeyeventEvent(e,t,i,r="Global",n={}){this.__fire(this.map,"pm:keyevent",{event:e,eventType:t,focusOn:i},r,n)},__fire(e,t,i,r,n={}){i=(0,Pe.default)(i,n,{source:r}),L.PM.Utils._fireEvent(e,t,i)}},ri=Vt,vr=()=>({_lastEvents:{keydown:void 0,keyup:void 0,current:void 0},_initKeyListener(e){this.map=e,L.DomEvent.on(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.on(window,"blur",this._onBlur,this),e.once("unload",this._unbindKeyListenerEvents,this)},_unbindKeyListenerEvents(){L.DomEvent.off(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.off(window,"blur",this._onBlur,this)},_onKeyListener(e){let t="document";this.map.getContainer().contains(e.target)&&(t="map");let i={event:e,eventType:e.type,focusOn:t};this._lastEvents[e.type]=i,this._lastEvents.current=i,this.map.pm._fireKeyeventEvent(e,e.type,t)},_onBlur(e){e.altKey=!1;let t={event:e,eventType:e.type,focusOn:"document"};this._lastEvents[e.type]=t,this._lastEvents.current=t},getLastKeyEvent(e="current"){return this._lastEvents[e]},isShiftKeyPressed(){return this._lastEvents.current?.event.shiftKey},isAltKeyPressed(){return this._lastEvents.current?.event.altKey},isCtrlKeyPressed(){return this._lastEvents.current?.event.ctrlKey},isMetaKeyPressed(){return this._lastEvents.current?.event.metaKey},getPressedKey(){return this._lastEvents.current?.event.key}}),Kt=vr,tn=Se(_i());function oe(e){let t=L.PM.activeLang;return(0,tn.default)(ft[t],e)||(0,tn.default)(ft.en,e)||e}function Wt(e){for(let t=0;t<e.length;t+=1){let i=e[t];if(Array.isArray(i)){if(Wt(i))return!0}else if(i!=null&&i!=="")return!0}return!1}function Zi(e){return e.reduce((t,i)=>{if(i.length!==0){let r=Array.isArray(i)?Zi(i):i;Array.isArray(r)?r.length!==0&&t.push(r):t.push(r)}return t},[])}function Wn(e,t,i){let r={a:L.CRS.Earth.R,b:63567523142e-4,f:.0033528106647474805},{a:n,b:a,f:s}=r,o=e.lng,h=e.lat,c=i,x=Math.PI,_=t*x/180,T=Math.sin(_),j=Math.cos(_),z=(1-s)*Math.tan(h*x/180),q=1/Math.sqrt(1+z*z),X=z*q,le=Math.atan2(z,j),b=q*T,C=1-b*b,w=C*(n*n-a*a)/(a*a),O=1+w/16384*(4096+w*(-768+w*(320-175*w))),S=w/1024*(256+w*(-128+w*(74-47*w))),R=c/(a*O),u=2*Math.PI,d,f,p;for(;Math.abs(R-u)>1e-12;){d=Math.cos(2*le+R),f=Math.sin(R),p=Math.cos(R);let G=S*f*(d+S/4*(p*(-1+2*d*d)-S/6*d*(-3+4*f*f)*(-3+4*d*d)));u=R,R=c/(a*O)+G}let g=X*f-q*p*j,m=Math.atan2(X*p+q*f*j,(1-s)*Math.sqrt(b*b+g*g)),M=Math.atan2(f*T,q*p-X*f*j),k=s/16*C*(4+s*(4-3*C)),E=M-(1-k)*s*b*(R+k*f*(d+k*p*(-1+2*d*d))),P=o+E*180/x,A=m*180/x;return L.latLng(P,A)}function rn(e,t,i,r,n=!0){let a,s,o,h=[];for(let c=0;c<i;c+=1){if(n)a=c*360/i+r,s=Wn(e,a,t),o=L.latLng(s.lng,s.lat);else{let x=e.lat+Math.cos(2*c*Math.PI/i)*t,_=e.lng+Math.sin(2*c*Math.PI/i)*t;o=L.latLng(x,_)}h.push(o)}return h}function qn(e,t,i){t=(t+360)%360;let r=Math.PI/180,n=180/Math.PI,{R:a}=L.CRS.Earth,s=e.lng*r,o=e.lat*r,h=t*r,c=Math.sin(o),x=Math.cos(o),_=Math.cos(i/a),T=Math.sin(i/a),j=Math.asin(c*_+x*T*Math.cos(h)),z=s+Math.atan2(Math.sin(h)*T*x,_-c*Math.sin(j));z*=n;let q=z-360,X=z<-180?z+360:z;return z=z>180?q:X,L.latLng([j*n,z])}function Tt(e,t,i){let r=e.latLngToContainerPoint(t),n=e.latLngToContainerPoint(i),a=Math.atan2(n.y-r.y,n.x-r.x)*180/Math.PI+90;return a+=a<0?360:0,a}function Li(e,t,i,r){let n=Tt(e,t,i);return qn(t,n,r)}function ni(e,t,i="asc"){if(!t||Object.keys(t).length===0)return(h,c)=>h-c;let r=Object.keys(t),n,a=r.length-1,s={};for(;a>=0;)n=r[a],s[n.toLowerCase()]=t[n],a-=1;function o(h){if(h instanceof L.Marker)return"Marker";if(h instanceof L.Circle)return"Circle";if(h instanceof L.CircleMarker)return"CircleMarker";if(h instanceof L.Rectangle)return"Rectangle";if(h instanceof L.Polygon)return"Polygon";if(h instanceof L.Polyline)return"Line"}return(h,c)=>{let x,_;if(x=o(h.layer).toLowerCase(),_=o(c.layer).toLowerCase(),!x||!_)return 0;let T=x in s?s[x]:Number.MAX_SAFE_INTEGER,j=_ in s?s[_]:Number.MAX_SAFE_INTEGER,z=0;return T<j?z=-1:T>j&&(z=1),i==="desc"?z*-1:z}}function Xe(e,t=e.getLatLngs()){return e instanceof L.Polygon?L.polygon(t).getLatLngs():L.polyline(t).getLatLngs()}function nn(e,t){if(t.options.crs?.projection?.MAX_LATITUDE){let i=t.options.crs?.projection?.MAX_LATITUDE;e.lat=Math.max(Math.min(i,e.lat),-i)}return e}function Rt(e){return e.options.renderer||e._map&&(e._map._getPaneRenderer(e.options.pane)||e._map.options.renderer||e._map._renderer)||e._renderer}var $n=L.Class.extend({includes:[Be,Pt,Ht,en,ri],initialize(e){this.map=e,this.Draw=new L.PM.Draw(e),this.Toolbar=new L.PM.Toolbar(e),this.Keyboard=Kt(),this.globalOptions={snappable:!0,layerGroup:void 0,snappingOrder:["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],panes:{vertexPane:"markerPane",layerPane:"overlayPane",markerPane:"markerPane"},draggable:!0},this.Keyboard._initKeyListener(e)},setLang(e="en",t,i="en"){if(e=e.trim().toLowerCase(),!/^[a-z]{2}$/.test(e)){let n=e.replace(/[-_\s]/g,"-").replace(/^(\w{2})$/,"$1-").match(/([a-z]{2})-?([a-z]{2})?/);if(n){let a=[`${n[1]}_${n[2]}`,`${n[1]}`];for(let s of a)if(ft[s]){e=s;break}}}let r=L.PM.activeLang;t&&(ft[e]=(0,xi.default)(ft[i],t)),L.PM.activeLang=e,this.map.pm.Toolbar.reinit(),this._fireLangChange(r,e,i,ft[e])},addControls(e){this.Toolbar.addControls(e)},removeControls(){this.Toolbar.removeControls()},toggleControls(){this.Toolbar.toggleControls()},controlsVisible(){return this.Toolbar.isVisible},enableDraw(e="Polygon",t){e==="Poly"&&(e="Polygon"),this.Draw.enable(e,t)},disableDraw(e="Polygon"){e==="Poly"&&(e="Polygon"),this.Draw.disable(e)},setPathOptions(e,t={}){let i=t.ignoreShapes||[],r=t.merge||!1;this.map.pm.Draw.shapes.forEach(n=>{i.indexOf(n)===-1&&this.map.pm.Draw[n].setPathOptions(e,r)})},getGlobalOptions(){return this.globalOptions},setGlobalOptions(e){let t=(0,xi.default)(this.globalOptions,e);t.editable&&(t.resizeableCircleMarker=t.editable,delete t.editable);let i=!1;this.map.pm.Draw.CircleMarker.enabled()&&!!this.map.pm.Draw.CircleMarker.options.resizeableCircleMarker!=!!t.resizeableCircleMarker&&(this.map.pm.Draw.CircleMarker.disable(),i=!0);let r=!1;this.map.pm.Draw.Circle.enabled()&&!!this.map.pm.Draw.Circle.options.resizeableCircle!=!!t.resizeableCircle&&(this.map.pm.Draw.Circle.disable(),r=!0),this.map.pm.Draw.shapes.forEach(n=>{this.map.pm.Draw[n].setOptions(t)}),i&&this.map.pm.Draw.CircleMarker.enable(),r&&this.map.pm.Draw.Circle.enable(),L.PM.Utils.findLayers(this.map).forEach(n=>{n.pm.setOptions(t)}),this.map.fire("pm:globaloptionschanged"),this.globalOptions=t,this.applyGlobalOptions()},applyGlobalOptions(){L.PM.Utils.findLayers(this.map).forEach(e=>{e.pm.enabled()&&e.pm.applyOptions()})},globalDrawModeEnabled(){return!!this.Draw.getActiveShape()},globalCutModeEnabled(){return!!this.Draw.Cut.enabled()},enableGlobalCutMode(e){return this.Draw.Cut.enable(e)},toggleGlobalCutMode(e){return this.Draw.Cut.toggle(e)},disableGlobalCutMode(){return this.Draw.Cut.disable()},getGeomanLayers(e=!1){let t=L.PM.Utils.findLayers(this.map);if(!e)return t;let i=L.featureGroup();return i._pmTempLayer=!0,t.forEach(r=>{i.addLayer(r)}),i},getGeomanDrawLayers(e=!1){let t=L.PM.Utils.findLayers(this.map).filter(r=>r._drawnByGeoman===!0);if(!e)return t;let i=L.featureGroup();return i._pmTempLayer=!0,t.forEach(r=>{i.addLayer(r)}),i},_getContainingLayer(){return this.globalOptions.layerGroup&&this.globalOptions.layerGroup instanceof L.LayerGroup?this.globalOptions.layerGroup:this.map},_isCRSSimple(){return this.map.options.crs===L.CRS.Simple},_touchEventCounter:0,_addTouchEvents(e){this._touchEventCounter===0&&(L.DomEvent.on(e,"touchmove",this._canvasTouchMove,this),L.DomEvent.on(e,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter+=1},_removeTouchEvents(e){this._touchEventCounter===1&&(L.DomEvent.off(e,"touchmove",this._canvasTouchMove,this),L.DomEvent.off(e,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter=this._touchEventCounter<=1?0:this._touchEventCounter-1},_canvasTouchMove(e){Rt(this.map)._onMouseMove(this._createMouseEvent("mousemove",e))},_canvasTouchClick(e){let t="";e.type==="touchstart"||e.type==="pointerdown"?t="mousedown":(e.type==="touchend"||e.type==="pointerup"||e.type==="touchcancel"||e.type==="pointercancel")&&(t="mouseup"),t&&Rt(this.map)._onClick(this._createMouseEvent(t,e))},_createMouseEvent(e,t){let i,r=t.touches[0]||t.changedTouches[0];try{i=new MouseEvent(e,{bubbles:t.bubbles,cancelable:t.cancelable,view:t.view,detail:r.detail,screenX:r.screenX,screenY:r.screenY,clientX:r.clientX,clientY:r.clientY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,button:t.button,relatedTarget:t.relatedTarget})}catch{i=document.createEvent("MouseEvents"),i.initMouseEvent(e,t.bubbles,t.cancelable,t.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget)}return i}}),Yn=$n,an=L.Control.extend({includes:[ri],options:{position:"topleft",disableByOtherButtons:!0},initialize(e){this._button=L.Util.extend({},this.options,e)},onAdd(e){return this._map=e,this._map.pm.Toolbar.options.oneBlock?this._container=this._map.pm.Toolbar._createContainer(this.options.position):this._button.tool==="edit"?this._container=this._map.pm.Toolbar.editContainer:this._button.tool==="options"?this._container=this._map.pm.Toolbar.optionsContainer:this._button.tool==="custom"?this._container=this._map.pm.Toolbar.customContainer:this._container=this._map.pm.Toolbar.drawContainer,this._renderButton(),this._container},_renderButton(){let e=this.buttonsDomNode;this.buttonsDomNode=this._makeButton(this._button),e?e.replaceWith(this.buttonsDomNode):this._container.appendChild(this.buttonsDomNode)},onRemove(){return this.buttonsDomNode.remove(),this._container},getText(){return this._button.text},getIconUrl(){return this._button.iconUrl},destroy(){this._button={},this._update()},toggle(e){return typeof e=="boolean"?this._button.toggleStatus=e:this._button.toggleStatus=!this._button.toggleStatus,this._applyStyleClasses(),this._updateActiveAction(this._button),this._button.toggleStatus},toggled(){return this._button.toggleStatus},onCreate(){this.toggle(!1)},disable(){this.toggle(!1),this._button.disabled=!0,this._updateDisabled()},enable(){this._button.disabled=!1,this._updateDisabled(),this._updateActiveAction(this._button)},_triggerClick(e){e&&e.preventDefault(),!this._button.disabled&&(this._button.onClick(e,{button:this,event:e}),this._clicked(e),this._button.afterClick(e,{button:this,event:e}))},_makeButton(e){let t=this.options.position.indexOf("right")>-1?"pos-right":"",i=L.DomUtil.create("div",`button-container  ${t}`,this._container);e.title&&i.setAttribute("title",e.title);let r=L.DomUtil.create("a","leaflet-buttons-control-button",i);r.setAttribute("role","button"),r.setAttribute("tabindex","0"),r.href="#";let n=L.DomUtil.create("div",`leaflet-pm-actions-container ${t}`,i),a=e.actions,s={cancel:{text:oe("actions.cancel"),title:oe("actions.cancel"),onClick(){this._triggerClick()}},finishMode:{text:oe("actions.finish"),title:oe("actions.finish"),onClick(){this._triggerClick()}},removeLastVertex:{text:oe("actions.removeLastVertex"),title:oe("actions.removeLastVertex"),onClick(){this._map.pm.Draw[e.jsClass]._removeLastVertex()}},finish:{text:oe("actions.finish"),title:oe("actions.finish"),onClick(h){this._map.pm.Draw[e.jsClass]._finishShape(h)}}};e._preparedActions=a.map(h=>{let c=typeof h=="string"?h:h.name,x;if(s[c])x=s[c];else if(h.text)x=h;else return x;let _=L.DomUtil.create("a",`leaflet-pm-action ${t} action-${c}`,n);if(_.setAttribute("role","button"),_.setAttribute("tabindex","0"),_.href="#",x.title&&(_.title=x.title),_.innerHTML=x.text,L.DomEvent.disableClickPropagation(_),L.DomEvent.on(_,"click",L.DomEvent.stop),x._node=_,!e.disabled&&x.onClick){let T=j=>{j.preventDefault();let z="",{buttons:q}=this._map.pm.Toolbar;for(let X in q)if(q[X]._button===e){z=X;break}this._fireActionClick(x,z,e)};L.DomEvent.addListener(_,"click",T,this),L.DomEvent.addListener(_,"click",x.onClick,this),L.DomEvent.addListener(_,"click",()=>this._updateActiveAction(e))}return x}),this._updateActiveAction(e),e.toggleStatus&&L.DomUtil.addClass(i,"active");let o=L.DomUtil.create("div","control-icon",r);return e.iconUrl&&o.setAttribute("src",e.iconUrl),e.className&&L.DomUtil.addClass(o,e.className),L.DomEvent.disableClickPropagation(r),L.DomEvent.on(r,"click",L.DomEvent.stop),e.disabled||(L.DomEvent.addListener(r,"click",this._onBtnClick,this),L.DomEvent.addListener(r,"click",this._triggerClick,this)),e.disabled&&(L.DomUtil.addClass(r,"pm-disabled"),r.setAttribute("aria-disabled","true")),i},_applyStyleClasses(){this._container&&(!this._button.toggleStatus||this._button.cssToggle===!1?(L.DomUtil.removeClass(this.buttonsDomNode,"active"),L.DomUtil.removeClass(this._container,"activeChild")):(L.DomUtil.addClass(this.buttonsDomNode,"active"),L.DomUtil.addClass(this._container,"activeChild")))},_onBtnClick(){if(this._button.disabled)return;this._button.disableOtherButtons&&this._map.pm.Toolbar.triggerClickOnToggledButtons(this);let e="",{buttons:t}=this._map.pm.Toolbar;for(let i in t)if(t[i]._button===this._button){e=i;break}this._fireButtonClick(e,this._button)},_clicked(){this._button.doToggle&&this.toggle()},_updateDisabled(){if(!this._container)return;let e="pm-disabled",t=this.buttonsDomNode.children[0];this._button.disabled?(L.DomUtil.addClass(t,e),t.setAttribute("aria-disabled","true")):(L.DomUtil.removeClass(t,e),t.setAttribute("aria-disabled","false"))},_updateActiveAction(e){e._preparedActions?.forEach(t=>{t?._node&&(t.isActive&&t.isActive.call(this)?L.DomUtil.addClass(t._node,"active-action"):L.DomUtil.removeClass(t._node,"active-action"))})}}),Xn=an;L.Control.PMButton=Xn;var Zn=L.Class.extend({options:{drawMarker:!0,drawRectangle:!0,drawPolyline:!0,drawPolygon:!0,drawCircle:!0,drawCircleMarker:!0,drawText:!0,editMode:!0,dragMode:!0,cutPolygon:!0,removalMode:!0,rotateMode:!0,snappingOption:!0,drawControls:!0,editControls:!0,optionsControls:!0,customControls:!0,oneBlock:!1,position:"topleft",positions:{draw:"",edit:"",options:"",custom:""}},customButtons:[],initialize(e){this.customButtons=[],this.options.positions={draw:"",edit:"",options:"",custom:""},this.init(e)},reinit(){let e=this.isVisible;this.removeControls(),this._defineButtons(),e&&this.addControls()},init(e){this.map=e,this.buttons={},this.isVisible=!1,this.drawContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-draw leaflet-bar leaflet-control"),this.editContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-edit leaflet-bar leaflet-control"),this.optionsContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-options leaflet-bar leaflet-control"),this.customContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-custom leaflet-bar leaflet-control"),this._defineButtons()},_createContainer(e){let t=`${e}Container`;return this[t]||(this[t]=L.DomUtil.create("div",`leaflet-pm-toolbar leaflet-pm-${e} leaflet-bar leaflet-control`)),this[t]},getButtons(){return this.buttons},addControls(e=this.options){typeof e.editPolygon<"u"&&(e.editMode=e.editPolygon),typeof e.deleteLayer<"u"&&(e.removalMode=e.deleteLayer),L.Util.setOptions(this,e),this.applyIconStyle(),this.isVisible=!0,this._showHideButtons()},applyIconStyle(){let e=this.getButtons(),t={geomanIcons:{drawMarker:"control-icon leaflet-pm-icon-marker",drawPolyline:"control-icon leaflet-pm-icon-polyline",drawRectangle:"control-icon leaflet-pm-icon-rectangle",drawPolygon:"control-icon leaflet-pm-icon-polygon",drawCircle:"control-icon leaflet-pm-icon-circle",drawCircleMarker:"control-icon leaflet-pm-icon-circle-marker",editMode:"control-icon leaflet-pm-icon-edit",dragMode:"control-icon leaflet-pm-icon-drag",cutPolygon:"control-icon leaflet-pm-icon-cut",removalMode:"control-icon leaflet-pm-icon-delete",drawText:"control-icon leaflet-pm-icon-text"}};for(let i in e){let r=e[i];L.Util.setOptions(r,{className:t.geomanIcons[i]})}},removeControls(){let e=this.getButtons();for(let t in e)e[t].remove();this.isVisible=!1},toggleControls(e=this.options){this.isVisible?this.removeControls():this.addControls(e)},_addButton(e,t){return this.buttons[e]=t,this.options[e]=!!this.options[e]||!1,this.buttons[e]},triggerClickOnToggledButtons(e){for(let t in this.buttons){let i=this.buttons[t];i._button.disableByOtherButtons&&i!==e&&i.toggled()&&i._triggerClick()}},toggleButton(e,t,i=!0){e==="editPolygon"&&(e="editMode"),e==="deleteLayer"&&(e="removalMode");let r=e;return i&&this.triggerClickOnToggledButtons(this.buttons[r]),this.buttons[r]?this.buttons[r].toggle(t):!1},_defineButtons(){let e={className:"control-icon leaflet-pm-icon-marker",title:oe("buttonTitles.drawMarkerButton"),jsClass:"Marker",onClick:()=>{},afterClick:(T,j)=>{this.map.pm.Draw[j.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},t={title:oe("buttonTitles.drawPolyButton"),className:"control-icon leaflet-pm-icon-polygon",jsClass:"Polygon",onClick:()=>{},afterClick:(T,j)=>{this.map.pm.Draw[j.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},i={className:"control-icon leaflet-pm-icon-polyline",title:oe("buttonTitles.drawLineButton"),jsClass:"Line",onClick:()=>{},afterClick:(T,j)=>{this.map.pm.Draw[j.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},r={title:oe("buttonTitles.drawCircleButton"),className:"control-icon leaflet-pm-icon-circle",jsClass:"Circle",onClick:()=>{},afterClick:(T,j)=>{this.map.pm.Draw[j.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},n={title:oe("buttonTitles.drawCircleMarkerButton"),className:"control-icon leaflet-pm-icon-circle-marker",jsClass:"CircleMarker",onClick:()=>{},afterClick:(T,j)=>{this.map.pm.Draw[j.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},a={title:oe("buttonTitles.drawRectButton"),className:"control-icon leaflet-pm-icon-rectangle",jsClass:"Rectangle",onClick:()=>{},afterClick:(T,j)=>{this.map.pm.Draw[j.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},s={title:oe("buttonTitles.editButton"),className:"control-icon leaflet-pm-icon-edit",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalEditMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},o={title:oe("buttonTitles.dragButton"),className:"control-icon leaflet-pm-icon-drag",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalDragMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},h={title:oe("buttonTitles.cutButton"),className:"control-icon leaflet-pm-icon-cut",jsClass:"Cut",onClick:()=>{},afterClick:(T,j)=>{this.map.pm.Draw[j.button._button.jsClass].toggle({snappable:!0,cursorMarker:!0,allowSelfIntersection:!1})},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finish","removeLastVertex","cancel"]},c={title:oe("buttonTitles.deleteButton"),className:"control-icon leaflet-pm-icon-delete",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRemovalMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},x={title:oe("buttonTitles.rotateButton"),className:"control-icon leaflet-pm-icon-rotate",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRotateMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},_={className:"control-icon leaflet-pm-icon-text",title:oe("buttonTitles.drawTextButton"),jsClass:"Text",onClick:()=>{},afterClick:(T,j)=>{this.map.pm.Draw[j.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]};this._addButton("drawMarker",new L.Control.PMButton(e)),this._addButton("drawPolyline",new L.Control.PMButton(i)),this._addButton("drawRectangle",new L.Control.PMButton(a)),this._addButton("drawPolygon",new L.Control.PMButton(t)),this._addButton("drawCircle",new L.Control.PMButton(r)),this._addButton("drawCircleMarker",new L.Control.PMButton(n)),this._addButton("drawText",new L.Control.PMButton(_)),this._addButton("editMode",new L.Control.PMButton(s)),this._addButton("dragMode",new L.Control.PMButton(o)),this._addButton("cutPolygon",new L.Control.PMButton(h)),this._addButton("removalMode",new L.Control.PMButton(c)),this._addButton("rotateMode",new L.Control.PMButton(x))},_showHideButtons(){if(!this.isVisible)return;this.removeControls(),this.isVisible=!0;let e=this.getButtons(),t=[];this.options.drawControls===!1&&(t=t.concat(Object.keys(e).filter(i=>!e[i]._button.tool))),this.options.editControls===!1&&(t=t.concat(Object.keys(e).filter(i=>e[i]._button.tool==="edit"))),this.options.optionsControls===!1&&(t=t.concat(Object.keys(e).filter(i=>e[i]._button.tool==="options"))),this.options.customControls===!1&&(t=t.concat(Object.keys(e).filter(i=>e[i]._button.tool==="custom")));for(let i in e)if(this.options[i]&&t.indexOf(i)===-1){let r=e[i]._button.tool;r||(r="draw"),e[i].setPosition(this._getBtnPosition(r)),e[i].addTo(this.map)}},_getBtnPosition(e){return this.options.positions&&this.options.positions[e]?this.options.positions[e]:this.options.position},setBlockPosition(e,t){this.options.positions[e]=t,this._showHideButtons(),this.changeControlOrder()},getBlockPositions(){return this.options.positions},copyDrawControl(e,t){if(t)typeof t!="object"&&(t={name:t});else throw new TypeError("Button has no name");let i=this._btnNameMapping(e);if(!t.name)throw new TypeError("Button has no name");if(this.buttons[t.name])throw new TypeError("Button with this name already exists");let r=this.map.pm.Draw.createNewDrawInstance(t.name,i);t={...this.buttons[i]._button,...t};let n=this.createCustomControl(t);return{drawInstance:r,control:n}},createCustomControl(e){if(!e.name)throw new TypeError("Button has no name");if(this.buttons[e.name])throw new TypeError("Button with this name already exists");e.onClick||(e.onClick=()=>{}),e.afterClick||(e.afterClick=()=>{}),e.toggle!==!1&&(e.toggle=!0),e.block&&(e.block=e.block.toLowerCase()),(!e.block||e.block==="draw")&&(e.block=""),e.className?e.className.indexOf("control-icon")===-1&&(e.className=`control-icon ${e.className}`):e.className="control-icon";let t={tool:e.block,className:e.className,title:e.title||"",jsClass:e.name,onClick:e.onClick,afterClick:e.afterClick,doToggle:e.toggle,toggleStatus:!1,disableOtherButtons:e.disableOtherButtons??!0,disableByOtherButtons:e.disableByOtherButtons??!0,cssToggle:e.toggle,position:this.options.position,actions:e.actions||[],disabled:!!e.disabled};this.options[e.name]!==!1&&(this.options[e.name]=!0);let i=this._addButton(e.name,new L.Control.PMButton(t));return this.changeControlOrder(),i},controlExists(e){return!!this.getButton(e)},getButton(e){return this.getButtons()[e]},getButtonsInBlock(e){let t={};if(e)for(let i in this.getButtons()){let r=this.getButtons()[i];(r._button.tool===e||e==="draw"&&!r._button.tool)&&(t[i]=r)}return t},changeControlOrder(e=[]){let t=this._shapeMapping(),i=[];e.forEach(a=>{t[a]?i.push(t[a]):i.push(a)});let r=this.getButtons(),n={};i.forEach(a=>{r[a]&&(n[a]=r[a])}),Object.keys(r).filter(a=>!r[a]._button.tool||r[a]._button.tool==="draw").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="edit").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="options").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).filter(a=>r[a]._button.tool==="custom").forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),Object.keys(r).forEach(a=>{i.indexOf(a)===-1&&(n[a]=r[a])}),this.map.pm.Toolbar.buttons=n,this._showHideButtons()},getControlOrder(){let e=this.getButtons(),t=[];for(let i in e)t.push(i);return t},changeActionsOfControl(e,t){let i=this._btnNameMapping(e);if(!i)throw new TypeError("No name passed");if(!t)throw new TypeError("No actions passed");if(!this.buttons[i])throw new TypeError("Button with this name not exists");this.buttons[i]._button.actions=t,this.changeControlOrder()},setButtonDisabled(e,t){let i=this._btnNameMapping(e);t?this.buttons[i].disable():this.buttons[i].enable()},_shapeMapping(){return{Marker:"drawMarker",Circle:"drawCircle",Polygon:"drawPolygon",Rectangle:"drawRectangle",Polyline:"drawPolyline",Line:"drawPolyline",CircleMarker:"drawCircleMarker",Edit:"editMode",Drag:"dragMode",Cut:"cutPolygon",Removal:"removalMode",Rotate:"rotateMode",Text:"drawText"}},_btnNameMapping(e){let t=this._shapeMapping();return t[e]?t[e]:e}}),Jn=Zn,Qn=Se(yi()),ea={_initSnappableMarkers(){this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,this._assignEvents(this._markers),this._layer.off("pm:dragstart",this._unsnap,this),this._layer.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){this._layer.off("pm:dragstart",this._unsnap,this)},_assignEvents(e){e.forEach(t=>{if(Array.isArray(t)){this._assignEvents(t);return}t.off("drag",this._handleSnapping,this),t.on("drag",this._handleSnapping,this),t.off("dragend",this._cleanupSnapping,this),t.on("dragend",this._cleanupSnapping,this)})},_cleanupSnapping(e){if(e){let t=e.target;t._snapped=!1}delete this._snapList,this.throttledList&&(this._map.off("layeradd",this.throttledList,this),this.throttledList=void 0),this._map.off("layerremove",this._handleSnapLayerRemoval,this),this.debugIndicatorLines&&this.debugIndicatorLines.forEach(t=>{t.remove()})},_handleThrottleSnapping(){this.throttledList&&this._createSnapList()},_handleSnapping(e){let t=e.target;if(t._snapped=!1,this.throttledList||(this.throttledList=L.Util.throttle(this._handleThrottleSnapping,100,this)),e?.originalEvent?.altKey||this._map?.pm?.Keyboard.isAltKeyPressed()||(this._snapList===void 0&&(this._createSnapList(),this._map.off("layeradd",this.throttledList,this),this._map.on("layeradd",this.throttledList,this)),this._snapList.length<=0))return!1;let i=this._calcClosestLayer(t.getLatLng(),this._snapList);if(Object.keys(i).length===0)return!1;let r=i.layer instanceof L.Marker||i.layer instanceof L.CircleMarker||!this.options.snapSegment,n;r?n=i.latlng:n=this._checkPrioritiySnapping(i);let a=this.options.snapDistance,s={marker:t,shape:this._shape,snapLatLng:n,segment:i.segment,layer:this._layer,workingLayer:this._layer,layerInteractedWith:i.layer,distance:i.distance};if(this._fireSnapDrag(s.marker,s),this._fireSnapDrag(this._layer,s),i.distance<a){t._orgLatLng=t.getLatLng(),t.setLatLng(n),t._snapped=!0,t._snapInfo=s;let o=()=>{this._snapLatLng=n,this._fireSnap(t,s),this._fireSnap(this._layer,s)},h=this._snapLatLng||{},c=n||{};(h.lat!==c.lat||h.lng!==c.lng)&&o()}else this._snapLatLng&&(this._unsnap(s),t._snapped=!1,t._snapInfo=void 0,this._fireUnsnap(s.marker,s),this._fireUnsnap(this._layer,s));return!0},_createSnapList(){let e=[],t=[],i=this._map;i.off("layerremove",this._handleSnapLayerRemoval,this),i.on("layerremove",this._handleSnapLayerRemoval,this),i.eachLayer(r=>{if((r instanceof L.Polyline||r instanceof L.Marker||r instanceof L.CircleMarker||r instanceof L.ImageOverlay)&&r.options.snapIgnore!==!0){if(r.options.snapIgnore===void 0&&(!L.PM.optIn&&r.options.pmIgnore===!0||L.PM.optIn&&r.options.pmIgnore!==!1))return;(r instanceof L.Circle||r instanceof L.CircleMarker)&&r.pm&&r.pm._hiddenPolyCircle?e.push(r.pm._hiddenPolyCircle):r instanceof L.ImageOverlay&&(r=L.rectangle(r.getBounds())),e.push(r);let n=L.polyline([],{color:"red",pmIgnore:!0});n._pmTempLayer=!0,t.push(n),(r instanceof L.Circle||r instanceof L.CircleMarker)&&t.push(n)}}),e=e.filter(r=>this._layer!==r),e=e.filter(r=>r._latlng||r._latlngs&&Wt(r._latlngs)),e=e.filter(r=>!r._pmTempLayer),this._otherSnapLayers?(this._otherSnapLayers.forEach(()=>{let r=L.polyline([],{color:"red",pmIgnore:!0});r._pmTempLayer=!0,t.push(r)}),this._snapList=e.concat(this._otherSnapLayers)):this._snapList=e,this.debugIndicatorLines=t},_handleSnapLayerRemoval({layer:e}){if(!e._leaflet_id)return;let t=this._snapList.findIndex(i=>i._leaflet_id===e._leaflet_id);t>-1&&this._snapList.splice(t,1)},_calcClosestLayer(e,t){return this._calcClosestLayers(e,t,1)[0]},_calcClosestLayers(e,t,i=1){let r=[],n={};t.forEach((s,o)=>{if(s._parentCopy&&s._parentCopy===this._layer||s.getLatLngs?.().flat(5).length<2)return;let h=this._calcLayerDistances(e,s);if(h.distance=Math.floor(h.distance),this.debugIndicatorLines){if(!this.debugIndicatorLines[o]){let c=L.polyline([],{color:"red",pmIgnore:!0});c._pmTempLayer=!0,this.debugIndicatorLines[o]=c}this.debugIndicatorLines[o].setLatLngs([e,h.latlng])}i===1&&(n.distance===void 0||h.distance-5<=n.distance)?(h.distance+5<n.distance&&(r=[]),n=h,n.layer=s,r.push(n)):i!==1&&(n={},n=h,n.layer=s,r.push(n))}),i!==1&&(r=r.sort((s,o)=>s.distance-o.distance)),i===-1&&(i=r.length);let a=this._getClosestLayerByPriority(r,i);return L.Util.isArray(a)?a:[a]},_calcLayerDistances(e,t){let i=this._map,r=t instanceof L.Marker||t instanceof L.CircleMarker,n=t instanceof L.Polygon,a=e;if(r){let s=t.getLatLng();return{latlng:{...s},distance:this._getDistance(i,s,a)}}return this._calcLatLngDistances(a,t.getLatLngs(),i,n)},_calcLatLngDistances(e,t,i,r=!1){let n,a,s,o=h=>{h.forEach((c,x)=>{if(Array.isArray(c)){o(c);return}if(this.options.snapSegment){let _=c,T;r?T=x+1===h.length?0:x+1:T=x+1===h.length?void 0:x+1;let j=h[T];if(j){let z=this._getDistanceToSegment(i,e,_,j);(a===void 0||z<a)&&(a=z,s=[_,j])}}else{let _=this._getDistance(i,e,c);(a===void 0||_<a)&&(a=_,n=c)}})};return o(t),this.options.snapSegment?{latlng:{...this._getClosestPointOnSegment(i,e,s[0],s[1])},segment:s,distance:a}:{latlng:n,distance:a}},_getClosestLayerByPriority(e,t=1){e=e.sort((s,o)=>s._leaflet_id-o._leaflet_id);let i=["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],r=this._map.pm.globalOptions.snappingOrder||[],n=0,a={};return r.concat(i).forEach(s=>{a[s]||(n+=1,a[s]=n)}),e.sort(ni("instanceofShape",a)),t===1?e[0]||{}:e.slice(0,t)},_checkPrioritiySnapping(e){let t=this._map,i=e.segment[0],r=e.segment[1],n=e.latlng,a=n;if(this.options.snapVertex){let s=this._getDistance(t,i,n),o=this._getDistance(t,r,n),h=s<o?i:r,c=s<o?s:o;if(this.options.snapMiddle){let _=L.PM.Utils.calcMiddleLatLng(t,i,r),T=this._getDistance(t,_,n);T<s&&T<o&&(h=_,c=T)}let x=this.options.snapDistance;c<x&&(a=h)}return{...a}},_unsnap(){delete this._snapLatLng},_getClosestPointOnSegment(e,t,i,r){let n=e.getMaxZoom();n===1/0&&(n=e.getZoom());let a=e.project(t,n),s=e.project(i,n),o=e.project(r,n),h=L.LineUtil.closestPointOnSegment(a,s,o);return e.unproject(h,n)},_getDistanceToSegment(e,t,i,r){let n=e.latLngToContainerPoint(t),a=e.latLngToContainerPoint(i),s=e.latLngToContainerPoint(r);return L.LineUtil.pointToSegmentDistance(n,a,s)},_getDistance(e,t,i){return e.latLngToContainerPoint(t).distanceTo(e.latLngToContainerPoint(i))}},Ci=ea,ta=L.Class.extend({includes:[Ci,ri],options:{snappable:!0,snapDistance:20,snapMiddle:!1,allowSelfIntersection:!0,tooltips:!0,templineStyle:{},hintlineStyle:{color:"#3388ff",dashArray:"5,5"},pathOptions:null,cursorMarker:!0,finishOn:null,markerStyle:{draggable:!0,icon:L.icon()},hideMiddleMarkers:!1,minRadiusCircle:null,maxRadiusCircle:null,minRadiusCircleMarker:null,maxRadiusCircleMarker:null,resizeableCircleMarker:!1,resizeableCircle:!0,markerEditable:!0,continueDrawing:!1,snapSegment:!0,requireSnapToFinish:!1,rectangleAngle:0,textOptions:{text:null,focusAfterDraw:null,removeIfEmpty:null,className:null},snapVertex:!0},setOptions(e){L.Util.setOptions(this,e),this.setStyle(this.options)},setStyle(){},getOptions(){return this.options},initialize(e){let t=new L.Icon.Default;t.options.tooltipAnchor=[0,0],this.options.markerStyle.icon=t,this._map=e,this.shapes=["Marker","CircleMarker","Line","Polygon","Rectangle","Circle","Cut","Text"],this.shapes.forEach(i=>{this[i]=new L.PM.Draw[i](this._map)}),this.Marker.setOptions({continueDrawing:!0}),this.CircleMarker.setOptions({continueDrawing:!0})},setPathOptions(e,t=!1){t?this.options.pathOptions=(0,Qn.default)(this.options.pathOptions,e):this.options.pathOptions=e},getShapes(){return this.shapes},getShape(){return this._shape},enable(e,t){if(!e)throw new Error(`Error: Please pass a shape as a parameter. Possible shapes are: ${this.getShapes().join(",")}`);this.disable(),this[e].enable(t)},disable(){this.shapes.forEach(e=>{this[e].disable()})},addControls(){this.shapes.forEach(e=>{this[e].addButton()})},getActiveShape(){let e;return this.shapes.forEach(t=>{this[t]._enabled&&(e=t)}),e},_setGlobalDrawMode(){this._shape==="Cut"?this._fireGlobalCutModeToggled():this._fireGlobalDrawModeToggled();let e=[];this._map.eachLayer(t=>{(t instanceof L.Polyline||t instanceof L.Marker||t instanceof L.Circle||t instanceof L.CircleMarker||t instanceof L.ImageOverlay)&&(t._pmTempLayer||e.push(t))}),this._enabled?e.forEach(t=>{L.PM.Utils.disablePopup(t)}):e.forEach(t=>{L.PM.Utils.enablePopup(t)})},createNewDrawInstance(e,t){let i=this._getShapeFromBtnName(t);if(this[e])throw new TypeError("Draw Type already exists");if(!L.PM.Draw[i])throw new TypeError(`There is no class L.PM.Draw.${i}`);return this[e]=new L.PM.Draw[i](this._map),this[e].toolbarButtonName=e,this[e]._shape=e,this.shapes.push(e),this[t]&&this[e].setOptions(this[t].options),this[e].setOptions(this[e].options),this[e]},_getShapeFromBtnName(e){let t={drawMarker:"Marker",drawCircle:"Circle",drawPolygon:"Polygon",drawPolyline:"Line",drawRectangle:"Rectangle",drawCircleMarker:"CircleMarker",editMode:"Edit",dragMode:"Drag",cutPolygon:"Cut",removalMode:"Removal",rotateMode:"Rotate",drawText:"Text"};return t[e]?t[e]:this[e]?this[e]._shape:e},_finishLayer(e){e.pm&&(e.pm.setOptions(this.options),e.pm._shape=this._shape,e.pm._map=this._map),this._addDrawnLayerProp(e)},_addDrawnLayerProp(e){e._drawnByGeoman=!0},_setPane(e,t){t==="layerPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":t==="vertexPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":t==="markerPane"&&(e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},_isFirstLayer(){return(this._map||this._layer._map).pm.getGeomanLayers().length===0}}),Te=ta;Te.Marker=Te.extend({initialize(e){this._map=e,this._shape="Marker",this.toolbarButtonName="drawMarker"},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),this.options.markerStyle),this._setPane(this._hintMarker,"markerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.tooltips&&this._hintMarker.bindTooltip(oe("tooltips.placeMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this.options.markerEditable&&this._map.eachLayer(t=>{this.isRelevantMarker(t)&&t.pm.enable()}),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createMarker,this),this._hintMarker.remove(),this._map.off("mousemove",this._syncHintMarker,this),this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.disable()}),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},isRelevantMarker(e){return e instanceof L.Marker&&e.pm&&!e._pmTempLayer&&!e.pm._initTextMarker},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let t=e;t.target=this._hintMarker,this._handleSnapping(t)}this._fireChange(this._hintMarker.getLatLng(),"Draw")},_createMarker(e){if(!e.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),i=new L.Marker(t,this.options.markerStyle);this._setPane(i,"markerPane"),this._finishLayer(i),i.pm||(i.options.draggable=!1),i.addTo(this._map.pm._getContainingLayer()),i.pm&&this.options.markerEditable?i.pm.enable():i.dragging&&i.dragging.disable(),this._fireCreate(i),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},setStyle(){this.options.markerStyle?.icon&&this._hintMarker?.setIcon(this.options.markerStyle.icon)}});var Oe=63710088e-1,sn={centimeters:Oe*100,centimetres:Oe*100,degrees:Oe/111325,feet:Oe*3.28084,inches:Oe*39.37,kilometers:Oe/1e3,kilometres:Oe/1e3,meters:Oe,metres:Oe,miles:Oe/1609.344,millimeters:Oe*1e3,millimetres:Oe*1e3,nauticalmiles:Oe/1852,radians:1,yards:Oe*1.0936};function gt(e,t,i){i===void 0&&(i={});var r={type:"Feature"};return(i.id===0||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=t||{},r.geometry=e,r}function qt(e,t,i){if(i===void 0&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ji(e[0])||!Ji(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return gt(r,t,i)}function ai(e,t,i){if(i===void 0&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return gt(r,t,i)}function Ft(e,t){t===void 0&&(t={});var i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function ia(e,t){t===void 0&&(t="kilometers");var i=sn[t];if(!i)throw new Error(t+" units is invalid");return e*i}function ra(e,t){t===void 0&&(t="kilometers");var i=sn[t];if(!i)throw new Error(t+" units is invalid");return e/i}function Lr(e){var t=e%(2*Math.PI);return t*180/Math.PI}function nt(e){var t=e%360;return t*Math.PI/180}function Ji(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function ki(e){var t,i,r={type:"FeatureCollection",features:[]};if(e.type==="Feature"?i=e.geometry:i=e,i.type==="LineString")t=[i.coordinates];else if(i.type==="MultiLineString")t=i.coordinates;else if(i.type==="MultiPolygon")t=[].concat.apply([],i.coordinates);else if(i.type==="Polygon")t=i.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return t.forEach(function(n){t.forEach(function(a){for(var s=0;s<n.length-1;s++)for(var o=s;o<a.length-1;o++)if(!(n===a&&(Math.abs(s-o)===1||s===0&&o===n.length-2&&n[s][0]===n[n.length-1][0]&&n[s][1]===n[n.length-1][1]))){var h=na(n[s][0],n[s][1],n[s+1][0],n[s+1][1],a[o][0],a[o][1],a[o+1][0],a[o+1][1]);h&&r.features.push(qt([h[0],h[1]]))}})}),r}function na(e,t,i,r,n,a,s,o){var h,c,x,_,T,j={x:null,y:null,onLine1:!1,onLine2:!1};return h=(o-a)*(i-e)-(s-n)*(r-t),h===0?j.x!==null&&j.y!==null?j:!1:(c=t-a,x=e-n,_=(s-n)*c-(o-a)*x,T=(i-e)*c-(r-t)*x,c=_/h,x=T/h,j.x=e+c*(i-e),j.y=t+c*(r-t),c>=0&&c<=1&&(j.onLine1=!0),x>=0&&x<=1&&(j.onLine2=!0),j.onLine1&&j.onLine2?[j.x,j.y]:!1)}Te.Line=Te.extend({initialize(e){this._map=e,this._shape="Line",this.toolbarButtonName="drawPolyline",this._doesSelfIntersect=!1},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._markers=[],this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.polyline([],{...this.options.templineStyle,pmIgnore:!1}),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._layerGroup.addLayer(this._layer),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(oe("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createVertex,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.on(this.options.finishOn,this._finishShape,this),this.options.finishOn==="dblclick"&&(this.tempMapDoubleClickZoomState=this._map.doubleClickZoom._enabled,this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.disable()),this._map.on("mousemove",this._syncHintMarker,this),this._hintMarker.on("move",this._syncHintLine,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this.isRed=!1,this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createVertex,this),this._map.off("mousemove",this._syncHintMarker,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.off(this.options.finishOn,this._finishShape,this),this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.enable(),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_syncHintLine(){let e=this._layer.getLatLngs();if(e.length>0){let t=e[e.length-1];this._hintline.setLatLngs([t,this._hintMarker.getLatLng()])}},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let i=e;i.target=this._hintMarker,this._handleSnapping(i)}this.options.allowSelfIntersection||this._handleSelfIntersection(!0,this._hintMarker.getLatLng());let t=this._layer._defaultShape().slice();t.push(this._hintMarker.getLatLng()),this._change(t)},hasSelfIntersection(){return ki(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersection(e,t){let i=L.polyline(this._layer.getLatLngs());e&&(t||(t=this._hintMarker.getLatLng()),i.addLatLng(t));let r=ki(i.toGeoJSON(15));this._doesSelfIntersect=r.features.length>0,this._doesSelfIntersect?this.isRed||(this.isRed=!0,this._hintline.setStyle({color:"#f00000ff"}),this._fireIntersect(r,this._map,"Draw")):this._hintline.isEmpty()||(this.isRed=!1,this._hintline.setStyle(this.options.hintlineStyle))},_createVertex(e){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,e.latlng),this._doesSelfIntersect))return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),i=this._layer.getLatLngs(),r=i[i.length-1];if(t.equals(i[0])||i.length>0&&t.equals(r)){this._finishShape();return}this._layer._latlngInfo=this._layer._latlngInfo||[],this._layer._latlngInfo.push({latlng:t,snapInfo:this._hintMarker._snapInfo}),this._layer.addLatLng(t);let n=this._createMarker(t);this._setTooltipText(),this._setHintLineAfterNewVertex(t),this._fireVertexAdded(n,void 0,t,"Draw"),this._change(this._layer.getLatLngs()),this.options.finishOn==="snap"&&this._hintMarker._snapped&&this._finishShape(e)},_setHintLineAfterNewVertex(e){this._hintline.setLatLngs([e,e])},_removeLastVertex(){let e=this._markers;if(e.length<=1){this.disable();return}let t=this._layer.getLatLngs(),i=e[e.length-1],{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(e,i);e.pop(),this._layerGroup.removeLayer(i);let n=e[e.length-1],a=t.indexOf(n.getLatLng());t=t.slice(0,a+1),this._layer.setLatLngs(t),this._layer._latlngInfo.pop(),this._syncHintLine(),this._setTooltipText(),this._fireVertexRemoved(i,r,"Draw"),this._change(this._layer.getLatLngs())},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!1),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=1)return;let t=L.polyline(e,this.options.pathOptions);this._setPane(t,"layerPane"),this._finishLayer(t),t.addTo(this._map.pm._getContainingLayer()),this._fireCreate(t),this.options.snappable&&this._cleanupSnapping();let i=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(i))},_createMarker(e){let t=new L.Marker(e,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this._layerGroup.addLayer(t),this._markers.push(t),t.on("click",this._finishShape,this),t},_setTooltipText(){let{length:e}=this._layer.getLatLngs().flat(),t="";e<=1?t=oe("tooltips.continueLine"):t=oe("tooltips.finishLine"),this._hintMarker.setTooltipContent(t)},_change(e){this._fireChange(e,"Draw")},setStyle(){this._layer?.setStyle(this.options.templineStyle),this._hintline?.setStyle(this.options.hintlineStyle)}}),Te.Polygon=Te.Line.extend({initialize(e){this._map=e,this._shape="Polygon",this.toolbarButtonName="drawPolygon"},enable(e){L.PM.Draw.Line.prototype.enable.call(this,e),this._layer.pm._shape="Polygon"},_createMarker(e){let t=new L.Marker(e,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this._layerGroup.addLayer(t),this._markers.push(t),this._layer.getLatLngs().flat().length===1?(t.on("click",this._finishShape,this),this._tempSnapLayerIndex=this._otherSnapLayers.push(t)-1,this.options.snappable&&this._cleanupSnapping()):t.on("click",()=>1),t},_setTooltipText(){let{length:e}=this._layer.getLatLngs().flat(),t="";e<=2?t=oe("tooltips.continueLine"):t=oe("tooltips.finishPoly"),this._hintMarker.setTooltipContent(t)},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=2)return;let t=L.polygon(e,this.options.pathOptions);this._setPane(t,"layerPane"),this._finishLayer(t),t.addTo(this._map.pm._getContainingLayer()),this._fireCreate(t),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex;let i=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(i))}}),Te.Rectangle=Te.extend({initialize(e){this._map=e,this._shape="Rectangle",this.toolbarButtonName="drawRectangle"},enable(e){if(L.Util.setOptions(this,e),this._enabled=!0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.rectangle([[0,0],[0,0]],this.options.pathOptions),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._startMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-start-marker"}),draggable:!1,zIndexOffset:-100,opacity:this.options.cursorMarker?1:0}),this._setPane(this._startMarker,"vertexPane"),this._startMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._startMarker),this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:150,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(oe("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this.options.cursorMarker){this._styleMarkers=[];for(let t=0;t<2;t+=1){let i=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-style-marker"}),draggable:!1,zIndexOffset:100});this._setPane(i,"vertexPane"),i._pmTempLayer=!0,this._layerGroup.addLayer(i),this._styleMarkers.push(i)}}this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._placeStartingMarkers,this),this._map.on("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._finishShape,this),this._map.off("click",this._placeStartingMarkers,this),this._map.off("mousemove",this._syncHintMarker,this),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_placeStartingMarkers(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng();L.DomUtil.addClass(this._startMarker._icon,"visible"),this._startMarker.setLatLng(t),this.options.cursorMarker&&this._styleMarkers&&this._styleMarkers.forEach(i=>{L.DomUtil.addClass(i._icon,"visible"),i.setLatLng(t)}),this._map.off("click",this._placeStartingMarkers,this),this._map.on("click",this._finishShape,this),this._hintMarker.setTooltipContent(oe("tooltips.finishRect")),this._setRectangleOrigin()},_setRectangleOrigin(){let e=this._startMarker.getLatLng();e&&(this._layerGroup.addLayer(this._layer),this._layer.setLatLngs([e,e]),this._hintMarker.on("move",this._syncRectangleSize,this))},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let i=e;i.target=this._hintMarker,this._handleSnapping(i)}let t=this._layerGroup&&this._layerGroup.hasLayer(this._layer)?this._layer.getLatLngs():[this._hintMarker.getLatLng()];this._fireChange(t,"Draw")},_syncRectangleSize(){let e=nn(this._startMarker.getLatLng(),this._map),t=nn(this._hintMarker.getLatLng(),this._map),i=L.PM.Utils._getRotatedRectangle(e,t,this.options.rectangleAngle||0,this._map);if(this._layer.setLatLngs(i),this.options.cursorMarker&&this._styleMarkers){let r=[];i.forEach(n=>{!n.equals(e,1e-8)&&!n.equals(t,1e-8)&&r.push(n)}),r.forEach((n,a)=>{try{this._styleMarkers[a].setLatLng(n)}catch{}})}},_findCorners(){let e=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(e[0],e[2],this.options.rectangleAngle||0,this._map)},_finishShape(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),i=this._startMarker.getLatLng();if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||i.equals(t))return;let r=L.rectangle([i,t],this.options.pathOptions);if(this.options.rectangleAngle){let a=L.PM.Utils._getRotatedRectangle(i,t,this.options.rectangleAngle||0,this._map);r.setLatLngs(a),r.pm&&r.pm._setAngle(this.options.rectangleAngle||0)}this._setPane(r,"layerPane"),this._finishLayer(r),r.addTo(this._map.pm._getContainingLayer()),this._fireCreate(r);let n=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(n))},setStyle(){this._layer?.setStyle(this.options.pathOptions)}}),Te.CircleMarker=Te.extend({initialize(e){this._map=e,this._shape="CircleMarker",this.toolbarButtonName="drawCircleMarker",this._layerIsDragging=!1,this._BaseCircleClass=L.CircleMarker,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._defaultRadius=10},enable(e){if(L.Util.setOptions(this,e),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),this._enabled=!0,this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._map.getContainer().classList.add("geoman-draw-cursor"),this.options[this._editableOption]){let t={};L.extend(t,this.options.templineStyle),t.radius=0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=new this._BaseCircleClass(this._map.getCenter(),t),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._centerMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon"}),draggable:!1,zIndexOffset:100}),this._setPane(this._centerMarker,"vertexPane"),this._centerMarker._pmTempLayer=!0,this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:110,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(oe("tooltips.startCircle"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._map.on("click",this._placeCenterMarker,this)}else this._map.on("click",this._createMarker,this),this._hintMarker=new this._BaseCircleClass(this._map.getCenter(),{radius:this._defaultRadius,...this.options.templineStyle}),this._setPane(this._hintMarker,"layerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this._layer=this._hintMarker,this.options.tooltips&&this._hintMarker.bindTooltip(oe("tooltips.placeCircleMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip();this._map.on("mousemove",this._syncHintMarker,this),this._extendingEnable(),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},_extendingEnable(){!this.options[this._editableOption]&&this.options.markerEditable&&this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.enable()}),this._layer.bringToBack()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this.options[this._editableOption]?(this._map.off("click",this._finishShape,this),this._map.off("click",this._placeCenterMarker,this),this._map.removeLayer(this._layerGroup)):(this._map.off("click",this._createMarker,this),this._extendingDisable(),this._hintMarker.remove()),this._map.off("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},_extendingDisable(){this._map.eachLayer(e=>{this.isRelevantMarker(e)&&e.pm.disable()})},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_placeCenterMarker(e){this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng),this._layerGroup.addLayer(this._layer),this._layerGroup.addLayer(this._centerMarker);let t=this._hintMarker.getLatLng();this._centerMarker.setLatLng(t),this._map.off("click",this._placeCenterMarker,this),this._map.on("click",this._finishShape,this),this._placeCircleCenter()},_placeCircleCenter(){let e=this._centerMarker.getLatLng();e&&(this._layer.setLatLng(e),this._hintMarker.on("move",this._syncHintLine,this),this._hintMarker.on("move",this._syncCircleRadius,this),this._hintMarker.setTooltipContent(oe("tooltips.finishCircle")),this._fireCenterPlaced(),this._fireChange(this._layer.getLatLng(),"Draw"))},_syncHintLine(){let e=this._centerMarker.getLatLng(),t=this._getNewDestinationOfHintMarker();this._hintline.setLatLngs([e,t])},_syncCircleRadius(){let e=this._centerMarker.getLatLng(),t=this._hintMarker.getLatLng(),i=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(i)},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker()),this.options.snappable){let i=e;i.target=this._hintMarker,this._handleSnapping(i)}this._handleHintMarkerSnapping();let t=this._layerGroup&&this._layerGroup.hasLayer(this._centerMarker)?this._centerMarker.getLatLng():this._hintMarker.getLatLng();this._fireChange(t,"Draw")},isRelevantMarker(e){return e instanceof L.CircleMarker&&!(e instanceof L.Circle)&&e.pm&&!e._pmTempLayer},_createMarker(e){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||!e.latlng||this._layerIsDragging)return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng(),i=new this._BaseCircleClass(t,{radius:this._defaultRadius,...this.options.pathOptions});this._setPane(i,"layerPane"),this._finishLayer(i),i.addTo(this._map.pm._getContainingLayer()),this._extendingCreateMarker(i),this._fireCreate(i),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},_extendingCreateMarker(e){e.pm&&this.options.markerEditable&&e.pm.enable()},_finishShape(e){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._centerMarker.getLatLng(),i=this._defaultRadius;if(this.options[this._editableOption]){let s=this._hintMarker.getLatLng();i=this._distanceCalculation(t,s),this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?i=this.options[this._minRadiusOption]:this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(i=this.options[this._maxRadiusOption])}let r={...this.options.pathOptions,radius:i},n=new this._BaseCircleClass(t,r);this._setPane(n,"layerPane"),this._finishLayer(n),n.addTo(this._map.pm._getContainingLayer()),n.pm&&n.pm._updateHiddenPolyCircle(),this._fireCreate(n);let a=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(a))},_getNewDestinationOfHintMarker(){let e=this._hintMarker.getLatLng();if(this.options[this._editableOption]){if(!this._layerGroup.hasLayer(this._centerMarker))return e;let t=this._centerMarker.getLatLng(),i=this._distanceCalculation(t,e);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?e=Li(this._map,t,e,this._getMinDistanceInMeter()):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(e=Li(this._map,t,e,this._getMaxDistanceInMeter()))}return e},_getMinDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,this._centerMarker.getLatLng())},_getMaxDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,this._centerMarker.getLatLng())},_handleHintMarkerSnapping(){if(this.options[this._editableOption]){if(this._hintMarker._snapped){let e=this._centerMarker.getLatLng(),t=this._hintMarker.getLatLng(),i=this._distanceCalculation(e,t);this._layerGroup.hasLayer(this._centerMarker)&&(this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._hintMarker.setLatLng(this._hintMarker._orgLatLng):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&this._hintMarker.setLatLng(this._hintMarker._orgLatLng))}this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker())}},setStyle(){let e={};L.extend(e,this.options.templineStyle),this.options[this._editableOption]&&(e.radius=0),this._layer?.setStyle(e),this._hintline?.setStyle(this.options.hintlineStyle)},_distanceCalculation(e,t){return this._map.project(e).distanceTo(this._map.project(t))}}),Te.Circle=Te.CircleMarker.extend({initialize(e){this._map=e,this._shape="Circle",this.toolbarButtonName="drawCircle",this._BaseCircleClass=L.Circle,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizeableCircle",this._defaultRadius=100},_extendingEnable(){},_extendingDisable(){},_extendingCreateMarker(){},isRelevantMarker(){},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_distanceCalculation(e,t){return this._map.distance(e,t)}});function l(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function v(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function B(e){return e.type==="Feature"?e.geometry:e}function D(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function U(e,t,i){if(e!==null)for(var r,n,a,s,o,h,c,x=0,_=0,T,j=e.type,z=j==="FeatureCollection",q=j==="Feature",X=z?e.features.length:1,le=0;le<X;le++){c=z?e.features[le].geometry:q?e.geometry:e,T=c?c.type==="GeometryCollection":!1,o=T?c.geometries.length:1;for(var b=0;b<o;b++){var C=0,w=0;if(s=T?c.geometries[b]:c,s!==null){h=s.coordinates;var O=s.type;switch(x=0,O){case null:break;case"Point":if(t(h,_,le,C,w)===!1)return!1;_++,C++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++){if(t(h[r],_,le,C,w)===!1)return!1;_++,O==="MultiPoint"&&C++}O==="LineString"&&C++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(n=0;n<h[r].length-x;n++){if(t(h[r][n],_,le,C,w)===!1)return!1;_++}O==="MultiLineString"&&C++,O==="Polygon"&&w++}O==="Polygon"&&C++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for(w=0,n=0;n<h[r].length;n++){for(a=0;a<h[r][n].length-x;a++){if(t(h[r][n][a],_,le,C,w)===!1)return!1;_++}w++}C++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(U(s.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function V(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var i=0;i<e.features.length&&t(e.features[i],i)!==!1;i++);}function K(e,t,i){var r=i;return V(e,function(n,a){a===0&&i===void 0?r=n:r=t(r,n,a)}),r}function Q(e,t){var i,r,n,a,s,o,h,c,x,_,T=0,j=e.type==="FeatureCollection",z=e.type==="Feature",q=j?e.features.length:1;for(i=0;i<q;i++){for(o=j?e.features[i].geometry:z?e.geometry:e,c=j?e.features[i].properties:z?e.properties:{},x=j?e.features[i].bbox:z?e.bbox:void 0,_=j?e.features[i].id:z?e.id:void 0,h=o?o.type==="GeometryCollection":!1,s=h?o.geometries.length:1,n=0;n<s;n++){if(a=h?o.geometries[n]:o,a===null){if(t(null,T,c,x,_)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,T,c,x,_)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<a.geometries.length;r++)if(t(a.geometries[r],T,c,x,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}T++}}function ue(e,t){Q(e,function(i,r,n,a,s){var o=i===null?null:i.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return t(gt(i,n,{bbox:a,id:s}),r,0)===!1?!1:void 0}var h;switch(o){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var c=0;c<i.coordinates.length;c++){var x=i.coordinates[c],_={type:h,coordinates:x};if(t(gt(_,n),r,c)===!1)return!1}})}function he(e){if(!e)throw new Error("geojson is required");var t=[];return ue(e,function(i){at(i,t)}),Ft(t)}function at(e,t){var i=[],r=e.geometry;if(r!==null){switch(r.type){case"Polygon":i=v(r);break;case"LineString":i=[v(r)]}i.forEach(function(n){var a=ne(n,e.properties);a.forEach(function(s){s.id=t.length,t.push(s)})})}}function ne(e,t){var i=[];return e.reduce(function(r,n){var a=ai([r,n],t);return a.bbox=st(r,n),i.push(a),n}),i}function st(e,t){var i=e[0],r=e[1],n=t[0],a=t[1],s=i<n?i:n,o=r<a?r:a,h=i>n?i:n,c=r>a?r:a;return[s,o,h,c]}var $t=he,Ea=Se(pt(),1);function ds(e,t){var i={},r=[];if(e.type==="LineString"&&(e=gt(e)),t.type==="LineString"&&(t=gt(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var n=Ba(e,t);return n&&r.push(n),Ft(r)}var a=(0,Ea.default)();return a.load($t(t)),V($t(e),function(s){V(a.search(s),function(o){var h=Ba(s,o);if(h){var c=v(h).join(",");i[c]||(i[c]=!0,r.push(h))}})}),Ft(r)}function Ba(e,t){var i=v(e),r=v(t);if(i.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var n=i[0][0],a=i[0][1],s=i[1][0],o=i[1][1],h=r[0][0],c=r[0][1],x=r[1][0],_=r[1][1],T=(_-c)*(s-n)-(x-h)*(o-a),j=(x-h)*(a-c)-(_-c)*(n-h),z=(s-n)*(a-c)-(o-a)*(n-h);if(T===0)return null;var q=j/T,X=z/T;if(q>=0&&q<=1&&X>=0&&X<=1){var le=n+q*(s-n),b=a+q*(o-a);return qt([le,b])}return null}var Mi=ds,wa=Se(pt(),1);function ps(e,t,i){i===void 0&&(i={});var r=l(e),n=l(t),a=nt(n[1]-r[1]),s=nt(n[0]-r[0]),o=nt(r[1]),h=nt(n[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(o)*Math.cos(h);return ia(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)}var Ei=ps;function fs(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=Ei(e.slice(0,2),[r,i]),s=Ei(e.slice(0,2),[t,n]);if(a>=s){var o=(i+n)/2;return[t,o-(r-t)/2,r,o+(r-t)/2]}else{var h=(t+r)/2;return[h-(n-i)/2,i,h+(n-i)/2,n]}}var gs=fs;function aa(e){var t=[1/0,1/0,-1/0,-1/0];return U(e,function(i){t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}aa.default=aa;var Cr=aa;function ms(e,t){t===void 0&&(t={});var i=t.precision,r=t.coordinates,n=t.mutate;if(i=i==null||isNaN(i)?6:i,r=r==null||isNaN(r)?3:r,!e)throw new Error("<geojson> is required");if(typeof i!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(n===!1||n===void 0)&&(e=JSON.parse(JSON.stringify(e)));var a=Math.pow(10,i);return U(e,function(s){ys(s,a,r)}),e}function ys(e,t,i){e.length>i&&e.splice(i,e.length);for(var r=0;r<e.length;r++)e[r]=Math.round(e[r]*t)/t;return e}var _s=ms;function Sa(e,t,i){if(i===void 0&&(i={}),i.final===!0)return bs(e,t);var r=l(e),n=l(t),a=nt(r[0]),s=nt(n[0]),o=nt(r[1]),h=nt(n[1]),c=Math.sin(s-a)*Math.cos(h),x=Math.cos(o)*Math.sin(h)-Math.sin(o)*Math.cos(h)*Math.cos(s-a);return Lr(Math.atan2(c,x))}function bs(e,t){var i=Sa(t,e);return i=(i+180)%360,i}function Da(e,t,i,r){r===void 0&&(r={});var n=l(e),a=nt(n[0]),s=nt(n[1]),o=nt(i),h=ra(t,r.units),c=Math.asin(Math.sin(s)*Math.cos(h)+Math.cos(s)*Math.sin(h)*Math.cos(o)),x=a+Math.atan2(Math.sin(o)*Math.sin(h)*Math.cos(s),Math.cos(h)-Math.sin(s)*Math.sin(c)),_=Lr(x),T=Lr(c);return qt([_,T],r.properties)}function xs(e,t,i){i===void 0&&(i={});var r=qt([1/0,1/0],{dist:1/0}),n=0;return ue(e,function(a){for(var s=v(a),o=0;o<s.length-1;o++){var h=qt(s[o]);h.properties.dist=Ei(t,h,i);var c=qt(s[o+1]);c.properties.dist=Ei(t,c,i);var x=Ei(h,c,i),_=Math.max(h.properties.dist,c.properties.dist),T=Sa(h,c),j=Da(t,_,T+90,i),z=Da(t,_,T-90,i),q=Mi(ai([j.geometry.coordinates,z.geometry.coordinates]),ai([h.geometry.coordinates,c.geometry.coordinates])),X=null;q.features.length>0&&(X=q.features[0],X.properties.dist=Ei(t,X,i),X.properties.location=n+Ei(h,X,i)),h.properties.dist<r.properties.dist&&(r=h,r.properties.index=o,r.properties.location=n),c.properties.dist<r.properties.dist&&(r=c,r.properties.index=o+1,r.properties.location=n+x),X&&X.properties.dist<r.properties.dist&&(r=X,r.properties.index=o),n+=x}}),r}var vs=xs;function Ls(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var i=D(e),r=D(t);if(i!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var n=_s(t,{precision:7});switch(r){case"Point":return sa(e,n);case"MultiPoint":return Aa(e,n);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Aa(e,Mi(e,n))}}function Aa(e,t){var i=[],r=(0,wa.default)();return ue(t,function(n){if(i.forEach(function(o,h){o.id=h}),!i.length)i=sa(e,n).features,i.forEach(function(o){o.bbox||(o.bbox=gs(Cr(o)))}),r.load(Ft(i));else{var a=r.search(n);if(a.features.length){var s=Pa(n,a);i=i.filter(function(o){return o.id!==s.id}),r.remove(s),V(sa(s,n),function(o){i.push(o),r.insert(o)})}}}),Ft(i)}function sa(e,t){var i=[],r=v(e)[0],n=v(e)[e.geometry.coordinates.length-1];if(oa(r,l(t))||oa(n,l(t)))return Ft([e]);var a=(0,wa.default)(),s=$t(e);a.load(s);var o=a.search(t);if(!o.features.length)return Ft([e]);var h=Pa(t,o),c=[r],x=K(s,function(_,T,j){var z=v(T)[1],q=l(t);return j===h.id?(_.push(q),i.push(ai(_)),oa(q,z)?[q]:[q,z]):(_.push(z),_)},c);return x.length>1&&i.push(ai(x)),Ft(i)}function Pa(e,t){if(!t.features.length)throw new Error("lines must contain features");if(t.features.length===1)return t.features[0];var i,r=1/0;return V(t,function(n){var a=vs(n,e),s=a.properties.dist;s<r&&(i=n,r=s)}),i}function oa(e,t){return e[0]===t[0]&&e[1]===t[1]}var Cs=Ls;function on(e,t,i){if(i===void 0&&(i={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=l(e),n=B(t),a=n.type,s=t.bbox,o=n.coordinates;if(s&&ks(r,s)===!1)return!1;a==="Polygon"&&(o=[o]);for(var h=!1,c=0;c<o.length&&!h;c++)if(Ta(r,o[c][0],i.ignoreBoundary)){for(var x=!1,_=1;_<o[c].length&&!x;)Ta(r,o[c][_],!i.ignoreBoundary)&&(x=!0),_++;x||(h=!0)}return h}function Ta(e,t,i){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var n=0,a=t.length-1;n<t.length;a=n++){var s=t[n][0],o=t[n][1],h=t[a][0],c=t[a][1],x=e[1]*(s-h)+o*(h-e[0])+c*(e[0]-s)===0&&(s-e[0])*(h-e[0])<=0&&(o-e[1])*(c-e[1])<=0;if(x)return!i;var _=o>e[1]!=c>e[1]&&e[0]<(h-s)*(e[1]-o)/(c-o)+s;_&&(r=!r)}return r}function ks(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}function Ms(e,t,i){i===void 0&&(i={});for(var r=l(e),n=v(t),a=0;a<n.length-1;a++){var s=!1;if(i.ignoreEndVertices&&(a===0&&(s="start"),a===n.length-2&&(s="end"),a===0&&a+1===n.length-1&&(s="both")),Es(n[a],n[a+1],r,s,typeof i.epsilon>"u"?null:i.epsilon))return!0}return!1}function Es(e,t,i,r,n){var a=i[0],s=i[1],o=e[0],h=e[1],c=t[0],x=t[1],_=i[0]-o,T=i[1]-h,j=c-o,z=x-h,q=_*z-T*j;if(n!==null){if(Math.abs(q)>n)return!1}else if(q!==0)return!1;if(r){if(r==="start")return Math.abs(j)>=Math.abs(z)?j>0?o<a&&a<=c:c<=a&&a<o:z>0?h<s&&s<=x:x<=s&&s<h;if(r==="end")return Math.abs(j)>=Math.abs(z)?j>0?o<=a&&a<c:c<a&&a<=o:z>0?h<=s&&s<x:x<s&&s<=h;if(r==="both")return Math.abs(j)>=Math.abs(z)?j>0?o<a&&a<c:c<a&&a<o:z>0?h<s&&s<x:x<s&&s<h}else return Math.abs(j)>=Math.abs(z)?j>0?o<=a&&a<=c:c<=a&&a<=o:z>0?h<=s&&s<=x:x<=s&&s<=h;return!1}var kr=Ms;function Bs(e,t){var i=B(e),r=B(t),n=i.type,a=r.type,s=i.coordinates,o=r.coordinates;switch(n){case"Point":switch(a){case"Point":return la(s,o);default:throw new Error("feature2 "+a+" geometry not supported")}case"MultiPoint":switch(a){case"Point":return ws(i,r);case"MultiPoint":return Ss(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"Point":return kr(r,i,{ignoreEndVertices:!0});case"LineString":return Ps(i,r);case"MultiPoint":return Ds(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Point":return on(r,i,{ignoreBoundary:!0});case"LineString":return Ts(i,r);case"Polygon":return Rs(i,r);case"MultiPoint":return As(i,r);default:throw new Error("feature2 "+a+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function ws(e,t){var i,r=!1;for(i=0;i<e.coordinates.length;i++)if(la(e.coordinates[i],t.coordinates)){r=!0;break}return r}function Ss(e,t){for(var i=0,r=t.coordinates;i<r.length;i++){for(var n=r[i],a=!1,s=0,o=e.coordinates;s<o.length;s++){var h=o[s];if(la(n,h)){a=!0;break}}if(!a)return!1}return!0}function Ds(e,t){for(var i=!1,r=0,n=t.coordinates;r<n.length;r++){var a=n[r];if(kr(a,e,{ignoreEndVertices:!0})&&(i=!0),!kr(a,e))return!1}return!!i}function As(e,t){for(var i=0,r=t.coordinates;i<r.length;i++){var n=r[i];if(!on(n,e,{ignoreBoundary:!0}))return!1}return!0}function Ps(e,t){for(var i=!1,r=0,n=t.coordinates;r<n.length;r++){var a=n[r];if(kr({type:"Point",coordinates:a},e,{ignoreEndVertices:!0})&&(i=!0),!kr({type:"Point",coordinates:a},e,{ignoreEndVertices:!1}))return!1}return i}function Ts(e,t){var i=!1,r=0,n=Cr(e),a=Cr(t);if(!Ra(n,a))return!1;for(r;r<t.coordinates.length-1;r++){var s=Fs(t.coordinates[r],t.coordinates[r+1]);if(on({type:"Point",coordinates:s},e,{ignoreBoundary:!0})){i=!0;break}}return i}function Rs(e,t){if(e.type==="Feature"&&e.geometry===null||t.type==="Feature"&&t.geometry===null)return!1;var i=Cr(e),r=Cr(t);if(!Ra(i,r))return!1;for(var n=B(t).coordinates,a=0,s=n;a<s.length;a++)for(var o=s[a],h=0,c=o;h<c.length;h++){var x=c[h];if(!on(x,e))return!1}return!0}function Ra(e,t){return!(e[0]>t[0]||e[2]<t[2]||e[1]>t[1]||e[3]<t[3])}function la(e,t){return e[0]===t[0]&&e[1]===t[1]}function Fs(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}var js=Se(_i()),Fa=e=>()=>e,ua=e=>{let t=e?(i,r)=>r.minus(i).abs().isLessThanOrEqualTo(e):Fa(!1);return(i,r)=>t(i,r)?0:i.comparedTo(r)};function Os(e){let t=e?(i,r,n,a,s)=>i.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(r).exponentiatedBy(2).plus(s.minus(n).exponentiatedBy(2)).times(e)):Fa(!1);return(i,r,n)=>{let a=i.x,s=i.y,o=n.x,h=n.y,c=s.minus(h).times(r.x.minus(o)).minus(a.minus(o).times(r.y.minus(h)));return t(c,a,s,o,h)?0:c.comparedTo(0)}}var Is=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ha=Math.ceil,mt=Math.floor,Qe="[BigNumber Error] ",ja=Qe+"Number primitive has more than 15 significant digits: ",Lt=1e14,ie=14,ca=9007199254740991,da=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],si=1e7,Ie=1e9;function Oa(e){var t,i,r,n=b.prototype={constructor:b,toString:null,valueOf:null},a=new b(1),s=20,o=4,h=-7,c=21,x=-1e7,_=1e7,T=!1,j=1,z=0,q={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},X="0123456789abcdefghijklmnopqrstuvwxyz",le=!0;function b(u,d){var f,p,g,m,M,k,E,P,A=this;if(!(A instanceof b))return new b(u,d);if(d==null){if(u&&u._isBigNumber===!0){A.s=u.s,!u.c||u.e>_?A.c=A.e=null:u.e<x?A.c=[A.e=0]:(A.e=u.e,A.c=u.c.slice());return}if((k=typeof u=="number")&&u*0==0){if(A.s=1/u<0?(u=-u,-1):1,u===~~u){for(m=0,M=u;M>=10;M/=10,m++);m>_?A.c=A.e=null:(A.e=m,A.c=[u]);return}P=String(u)}else{if(!Is.test(P=String(u)))return r(A,P,k);A.s=P.charCodeAt(0)==45?(P=P.slice(1),-1):1}(m=P.indexOf("."))>-1&&(P=P.replace(".","")),(M=P.search(/e/i))>0?(m<0&&(m=M),m+=+P.slice(M+1),P=P.substring(0,M)):m<0&&(m=P.length)}else{if(Le(d,2,X.length,"Base"),d==10&&le)return A=new b(u),S(A,s+A.e+1,o);if(P=String(u),k=typeof u=="number"){if(u*0!=0)return r(A,P,k,d);if(A.s=1/u<0?(P=P.slice(1),-1):1,b.DEBUG&&P.replace(/^0\.0*|\./,"").length>15)throw Error(ja+u)}else A.s=P.charCodeAt(0)===45?(P=P.slice(1),-1):1;for(f=X.slice(0,d),m=M=0,E=P.length;M<E;M++)if(f.indexOf(p=P.charAt(M))<0){if(p=="."){if(M>m){m=E;continue}}else if(!g&&(P==P.toUpperCase()&&(P=P.toLowerCase())||P==P.toLowerCase()&&(P=P.toUpperCase()))){g=!0,M=-1,m=0;continue}return r(A,String(u),k,d)}k=!1,P=i(P,d,10,A.s),(m=P.indexOf("."))>-1?P=P.replace(".",""):m=P.length}for(M=0;P.charCodeAt(M)===48;M++);for(E=P.length;P.charCodeAt(--E)===48;);if(P=P.slice(M,++E)){if(E-=M,k&&b.DEBUG&&E>15&&(u>ca||u!==mt(u)))throw Error(ja+A.s*u);if((m=m-M-1)>_)A.c=A.e=null;else if(m<x)A.c=[A.e=0];else{if(A.e=m,A.c=[],M=(m+1)%ie,m<0&&(M+=ie),M<E){for(M&&A.c.push(+P.slice(0,M)),E-=ie;M<E;)A.c.push(+P.slice(M,M+=ie));M=ie-(P=P.slice(M)).length}else M-=E;for(;M--;P+="0");A.c.push(+P)}}else A.c=[A.e=0]}b.clone=Oa,b.ROUND_UP=0,b.ROUND_DOWN=1,b.ROUND_CEIL=2,b.ROUND_FLOOR=3,b.ROUND_HALF_UP=4,b.ROUND_HALF_DOWN=5,b.ROUND_HALF_EVEN=6,b.ROUND_HALF_CEIL=7,b.ROUND_HALF_FLOOR=8,b.EUCLID=9,b.config=b.set=function(u){var d,f;if(u!=null)if(typeof u=="object"){if(u.hasOwnProperty(d="DECIMAL_PLACES")&&(f=u[d],Le(f,0,Ie,d),s=f),u.hasOwnProperty(d="ROUNDING_MODE")&&(f=u[d],Le(f,0,8,d),o=f),u.hasOwnProperty(d="EXPONENTIAL_AT")&&(f=u[d],f&&f.pop?(Le(f[0],-Ie,0,d),Le(f[1],0,Ie,d),h=f[0],c=f[1]):(Le(f,-Ie,Ie,d),h=-(c=f<0?-f:f))),u.hasOwnProperty(d="RANGE"))if(f=u[d],f&&f.pop)Le(f[0],-Ie,-1,d),Le(f[1],1,Ie,d),x=f[0],_=f[1];else if(Le(f,-Ie,Ie,d),f)x=-(_=f<0?-f:f);else throw Error(Qe+d+" cannot be zero: "+f);if(u.hasOwnProperty(d="CRYPTO"))if(f=u[d],f===!!f)if(f)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))T=f;else throw T=!f,Error(Qe+"crypto unavailable");else T=f;else throw Error(Qe+d+" not true or false: "+f);if(u.hasOwnProperty(d="MODULO_MODE")&&(f=u[d],Le(f,0,9,d),j=f),u.hasOwnProperty(d="POW_PRECISION")&&(f=u[d],Le(f,0,Ie,d),z=f),u.hasOwnProperty(d="FORMAT"))if(f=u[d],typeof f=="object")q=f;else throw Error(Qe+d+" not an object: "+f);if(u.hasOwnProperty(d="ALPHABET"))if(f=u[d],typeof f=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(f))le=f.slice(0,10)=="0123456789",X=f;else throw Error(Qe+d+" invalid: "+f)}else throw Error(Qe+"Object expected: "+u);return{DECIMAL_PLACES:s,ROUNDING_MODE:o,EXPONENTIAL_AT:[h,c],RANGE:[x,_],CRYPTO:T,MODULO_MODE:j,POW_PRECISION:z,FORMAT:q,ALPHABET:X}},b.isBigNumber=function(u){if(!u||u._isBigNumber!==!0)return!1;if(!b.DEBUG)return!0;var d,f,p=u.c,g=u.e,m=u.s;e:if({}.toString.call(p)=="[object Array]"){if((m===1||m===-1)&&g>=-Ie&&g<=Ie&&g===mt(g)){if(p[0]===0){if(g===0&&p.length===1)return!0;break e}if(d=(g+1)%ie,d<1&&(d+=ie),String(p[0]).length==d){for(d=0;d<p.length;d++)if(f=p[d],f<0||f>=Lt||f!==mt(f))break e;if(f!==0)return!0}}}else if(p===null&&g===null&&(m===null||m===1||m===-1))return!0;throw Error(Qe+"Invalid BigNumber: "+u)},b.maximum=b.max=function(){return w(arguments,-1)},b.minimum=b.min=function(){return w(arguments,1)},b.random=function(){var u=9007199254740992,d=Math.random()*u&2097151?function(){return mt(Math.random()*u)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(f){var p,g,m,M,k,E=0,P=[],A=new b(a);if(f==null?f=s:Le(f,0,Ie),M=ha(f/ie),T)if(crypto.getRandomValues){for(p=crypto.getRandomValues(new Uint32Array(M*=2));E<M;)k=p[E]*131072+(p[E+1]>>>11),k>=9e15?(g=crypto.getRandomValues(new Uint32Array(2)),p[E]=g[0],p[E+1]=g[1]):(P.push(k%1e14),E+=2);E=M/2}else if(crypto.randomBytes){for(p=crypto.randomBytes(M*=7);E<M;)k=(p[E]&31)*281474976710656+p[E+1]*1099511627776+p[E+2]*4294967296+p[E+3]*16777216+(p[E+4]<<16)+(p[E+5]<<8)+p[E+6],k>=9e15?crypto.randomBytes(7).copy(p,E):(P.push(k%1e14),E+=7);E=M/7}else throw T=!1,Error(Qe+"crypto unavailable");if(!T)for(;E<M;)k=d(),k<9e15&&(P[E++]=k%1e14);for(M=P[--E],f%=ie,M&&f&&(k=da[ie-f],P[E]=mt(M/k)*k);P[E]===0;P.pop(),E--);if(E<0)P=[m=0];else{for(m=-1;P[0]===0;P.splice(0,1),m-=ie);for(E=1,k=P[0];k>=10;k/=10,E++);E<ie&&(m-=ie-E)}return A.e=m,A.c=P,A}}(),b.sum=function(){for(var u=1,d=arguments,f=new b(d[0]);u<d.length;)f=f.plus(d[u++]);return f},i=function(){var u="0123456789";function d(f,p,g,m){for(var M,k=[0],E,P=0,A=f.length;P<A;){for(E=k.length;E--;k[E]*=p);for(k[0]+=m.indexOf(f.charAt(P++)),M=0;M<k.length;M++)k[M]>g-1&&(k[M+1]==null&&(k[M+1]=0),k[M+1]+=k[M]/g|0,k[M]%=g)}return k.reverse()}return function(f,p,g,m,M){var k,E,P,A,G,$,Z,J,ge=f.indexOf("."),ye=s,ce=o;for(ge>=0&&(A=z,z=0,f=f.replace(".",""),J=new b(p),$=J.pow(f.length-ge),z=A,J.c=d(Yt(_t($.c),$.e,"0"),10,g,u),J.e=J.c.length),Z=d(f,p,g,M?(k=X,u):(k=u,X)),P=A=Z.length;Z[--A]==0;Z.pop());if(!Z[0])return k.charAt(0);if(ge<0?--P:($.c=Z,$.e=P,$.s=m,$=t($,J,ye,ce,g),Z=$.c,G=$.r,P=$.e),E=P+ye+1,ge=Z[E],A=g/2,G=G||E<0||Z[E+1]!=null,G=ce<4?(ge!=null||G)&&(ce==0||ce==($.s<0?3:2)):ge>A||ge==A&&(ce==4||G||ce==6&&Z[E-1]&1||ce==($.s<0?8:7)),E<1||!Z[0])f=G?Yt(k.charAt(1),-ye,k.charAt(0)):k.charAt(0);else{if(Z.length=E,G)for(--g;++Z[--E]>g;)Z[E]=0,E||(++P,Z=[1].concat(Z));for(A=Z.length;!Z[--A];);for(ge=0,f="";ge<=A;f+=k.charAt(Z[ge++]));f=Yt(f,P,k.charAt(0))}return f}}(),t=function(){function u(p,g,m){var M,k,E,P,A=0,G=p.length,$=g%si,Z=g/si|0;for(p=p.slice();G--;)E=p[G]%si,P=p[G]/si|0,M=Z*E+P*$,k=$*E+M%si*si+A,A=(k/m|0)+(M/si|0)+Z*P,p[G]=k%m;return A&&(p=[A].concat(p)),p}function d(p,g,m,M){var k,E;if(m!=M)E=m>M?1:-1;else for(k=E=0;k<m;k++)if(p[k]!=g[k]){E=p[k]>g[k]?1:-1;break}return E}function f(p,g,m,M){for(var k=0;m--;)p[m]-=k,k=p[m]<g[m]?1:0,p[m]=k*M+p[m]-g[m];for(;!p[0]&&p.length>1;p.splice(0,1));}return function(p,g,m,M,k){var E,P,A,G,$,Z,J,ge,ye,ce,_e,Ke,_n,ma,ya,It,wr,bt=p.s==g.s?1:-1,Ze=p.c,ke=g.c;if(!Ze||!Ze[0]||!ke||!ke[0])return new b(!p.s||!g.s||(Ze?ke&&Ze[0]==ke[0]:!ke)?NaN:Ze&&Ze[0]==0||!ke?bt*0:bt/0);for(ge=new b(bt),ye=ge.c=[],P=p.e-g.e,bt=m+P+1,k||(k=Lt,P=yt(p.e/ie)-yt(g.e/ie),bt=bt/ie|0),A=0;ke[A]==(Ze[A]||0);A++);if(ke[A]>(Ze[A]||0)&&P--,bt<0)ye.push(1),G=!0;else{for(ma=Ze.length,It=ke.length,A=0,bt+=2,$=mt(k/(ke[0]+1)),$>1&&(ke=u(ke,$,k),Ze=u(Ze,$,k),It=ke.length,ma=Ze.length),_n=It,ce=Ze.slice(0,It),_e=ce.length;_e<It;ce[_e++]=0);wr=ke.slice(),wr=[0].concat(wr),ya=ke[0],ke[1]>=k/2&&ya++;do{if($=0,E=d(ke,ce,It,_e),E<0){if(Ke=ce[0],It!=_e&&(Ke=Ke*k+(ce[1]||0)),$=mt(Ke/ya),$>1)for($>=k&&($=k-1),Z=u(ke,$,k),J=Z.length,_e=ce.length;d(Z,ce,J,_e)==1;)$--,f(Z,It<J?wr:ke,J,k),J=Z.length,E=1;else $==0&&(E=$=1),Z=ke.slice(),J=Z.length;if(J<_e&&(Z=[0].concat(Z)),f(ce,Z,_e,k),_e=ce.length,E==-1)for(;d(ke,ce,It,_e)<1;)$++,f(ce,It<_e?wr:ke,_e,k),_e=ce.length}else E===0&&($++,ce=[0]);ye[A++]=$,ce[0]?ce[_e++]=Ze[_n]||0:(ce=[Ze[_n]],_e=1)}while((_n++<ma||ce[0]!=null)&&bt--);G=ce[0]!=null,ye[0]||ye.splice(0,1)}if(k==Lt){for(A=1,bt=ye[0];bt>=10;bt/=10,A++);S(ge,m+(ge.e=A+P*ie-1)+1,M,G)}else ge.e=P,ge.r=+G;return ge}}();function C(u,d,f,p){var g,m,M,k,E;if(f==null?f=o:Le(f,0,8),!u.c)return u.toString();if(g=u.c[0],M=u.e,d==null)E=_t(u.c),E=p==1||p==2&&(M<=h||M>=c)?un(E,M):Yt(E,M,"0");else if(u=S(new b(u),d,f),m=u.e,E=_t(u.c),k=E.length,p==1||p==2&&(d<=m||m<=h)){for(;k<d;E+="0",k++);E=un(E,m)}else if(d-=M,E=Yt(E,m,"0"),m+1>k){if(--d>0)for(E+=".";d--;E+="0");}else if(d+=m-k,d>0)for(m+1==k&&(E+=".");d--;E+="0");return u.s<0&&g?"-"+E:E}function w(u,d){for(var f,p,g=1,m=new b(u[0]);g<u.length;g++)p=new b(u[g]),(!p.s||(f=Bi(m,p))===d||f===0&&m.s===d)&&(m=p);return m}function O(u,d,f){for(var p=1,g=d.length;!d[--g];d.pop());for(g=d[0];g>=10;g/=10,p++);return(f=p+f*ie-1)>_?u.c=u.e=null:f<x?u.c=[u.e=0]:(u.e=f,u.c=d),u}r=function(){var u=/^(-?)0([xbo])(?=\w[\w.]*$)/i,d=/^([^.]+)\.$/,f=/^\.([^.]+)$/,p=/^-?(Infinity|NaN)$/,g=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(m,M,k,E){var P,A=k?M:M.replace(g,"");if(p.test(A))m.s=isNaN(A)?null:A<0?-1:1;else{if(!k&&(A=A.replace(u,function(G,$,Z){return P=(Z=Z.toLowerCase())=="x"?16:Z=="b"?2:8,!E||E==P?$:G}),E&&(P=E,A=A.replace(d,"$1").replace(f,"0.$1")),M!=A))return new b(A,P);if(b.DEBUG)throw Error(Qe+"Not a"+(E?" base "+E:"")+" number: "+M);m.s=null}m.c=m.e=null}}();function S(u,d,f,p){var g,m,M,k,E,P,A,G=u.c,$=da;if(G){e:{for(g=1,k=G[0];k>=10;k/=10,g++);if(m=d-g,m<0)m+=ie,M=d,E=G[P=0],A=mt(E/$[g-M-1]%10);else if(P=ha((m+1)/ie),P>=G.length)if(p){for(;G.length<=P;G.push(0));E=A=0,g=1,m%=ie,M=m-ie+1}else break e;else{for(E=k=G[P],g=1;k>=10;k/=10,g++);m%=ie,M=m-ie+g,A=M<0?0:mt(E/$[g-M-1]%10)}if(p=p||d<0||G[P+1]!=null||(M<0?E:E%$[g-M-1]),p=f<4?(A||p)&&(f==0||f==(u.s<0?3:2)):A>5||A==5&&(f==4||p||f==6&&(m>0?M>0?E/$[g-M]:0:G[P-1])%10&1||f==(u.s<0?8:7)),d<1||!G[0])return G.length=0,p?(d-=u.e+1,G[0]=$[(ie-d%ie)%ie],u.e=-d||0):G[0]=u.e=0,u;if(m==0?(G.length=P,k=1,P--):(G.length=P+1,k=$[ie-m],G[P]=M>0?mt(E/$[g-M]%$[M])*k:0),p)for(;;)if(P==0){for(m=1,M=G[0];M>=10;M/=10,m++);for(M=G[0]+=k,k=1;M>=10;M/=10,k++);m!=k&&(u.e++,G[0]==Lt&&(G[0]=1));break}else{if(G[P]+=k,G[P]!=Lt)break;G[P--]=0,k=1}for(m=G.length;G[--m]===0;G.pop());}u.e>_?u.c=u.e=null:u.e<x&&(u.c=[u.e=0])}return u}function R(u){var d,f=u.e;return f===null?u.toString():(d=_t(u.c),d=f<=h||f>=c?un(d,f):Yt(d,f,"0"),u.s<0?"-"+d:d)}return n.absoluteValue=n.abs=function(){var u=new b(this);return u.s<0&&(u.s=1),u},n.comparedTo=function(u,d){return Bi(this,new b(u,d))},n.decimalPlaces=n.dp=function(u,d){var f,p,g,m=this;if(u!=null)return Le(u,0,Ie),d==null?d=o:Le(d,0,8),S(new b(m),u+m.e+1,d);if(!(f=m.c))return null;if(p=((g=f.length-1)-yt(this.e/ie))*ie,g=f[g])for(;g%10==0;g/=10,p--);return p<0&&(p=0),p},n.dividedBy=n.div=function(u,d){return t(this,new b(u,d),s,o)},n.dividedToIntegerBy=n.idiv=function(u,d){return t(this,new b(u,d),0,1)},n.exponentiatedBy=n.pow=function(u,d){var f,p,g,m,M,k,E,P,A,G=this;if(u=new b(u),u.c&&!u.isInteger())throw Error(Qe+"Exponent not an integer: "+R(u));if(d!=null&&(d=new b(d)),k=u.e>14,!G.c||!G.c[0]||G.c[0]==1&&!G.e&&G.c.length==1||!u.c||!u.c[0])return A=new b(Math.pow(+R(G),k?u.s*(2-ln(u)):+R(u))),d?A.mod(d):A;if(E=u.s<0,d){if(d.c?!d.c[0]:!d.s)return new b(NaN);p=!E&&G.isInteger()&&d.isInteger(),p&&(G=G.mod(d))}else{if(u.e>9&&(G.e>0||G.e<-1||(G.e==0?G.c[0]>1||k&&G.c[1]>=24e7:G.c[0]<8e13||k&&G.c[0]<=9999975e7)))return m=G.s<0&&ln(u)?-0:0,G.e>-1&&(m=1/m),new b(E?1/m:m);z&&(m=ha(z/ie+2))}for(k?(f=new b(.5),E&&(u.s=1),P=ln(u)):(g=Math.abs(+R(u)),P=g%2),A=new b(a);;){if(P){if(A=A.times(G),!A.c)break;m?A.c.length>m&&(A.c.length=m):p&&(A=A.mod(d))}if(g){if(g=mt(g/2),g===0)break;P=g%2}else if(u=u.times(f),S(u,u.e+1,1),u.e>14)P=ln(u);else{if(g=+R(u),g===0)break;P=g%2}G=G.times(G),m?G.c&&G.c.length>m&&(G.c.length=m):p&&(G=G.mod(d))}return p?A:(E&&(A=a.div(A)),d?A.mod(d):m?S(A,z,o,M):A)},n.integerValue=function(u){var d=new b(this);return u==null?u=o:Le(u,0,8),S(d,d.e+1,u)},n.isEqualTo=n.eq=function(u,d){return Bi(this,new b(u,d))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(u,d){return Bi(this,new b(u,d))>0},n.isGreaterThanOrEqualTo=n.gte=function(u,d){return(d=Bi(this,new b(u,d)))===1||d===0},n.isInteger=function(){return!!this.c&&yt(this.e/ie)>this.c.length-2},n.isLessThan=n.lt=function(u,d){return Bi(this,new b(u,d))<0},n.isLessThanOrEqualTo=n.lte=function(u,d){return(d=Bi(this,new b(u,d)))===-1||d===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(u,d){var f,p,g,m,M=this,k=M.s;if(u=new b(u,d),d=u.s,!k||!d)return new b(NaN);if(k!=d)return u.s=-d,M.plus(u);var E=M.e/ie,P=u.e/ie,A=M.c,G=u.c;if(!E||!P){if(!A||!G)return A?(u.s=-d,u):new b(G?M:NaN);if(!A[0]||!G[0])return G[0]?(u.s=-d,u):new b(A[0]?M:o==3?-0:0)}if(E=yt(E),P=yt(P),A=A.slice(),k=E-P){for((m=k<0)?(k=-k,g=A):(P=E,g=G),g.reverse(),d=k;d--;g.push(0));g.reverse()}else for(p=(m=(k=A.length)<(d=G.length))?k:d,k=d=0;d<p;d++)if(A[d]!=G[d]){m=A[d]<G[d];break}if(m&&(g=A,A=G,G=g,u.s=-u.s),d=(p=G.length)-(f=A.length),d>0)for(;d--;A[f++]=0);for(d=Lt-1;p>k;){if(A[--p]<G[p]){for(f=p;f&&!A[--f];A[f]=d);--A[f],A[p]+=Lt}A[p]-=G[p]}for(;A[0]==0;A.splice(0,1),--P);return A[0]?O(u,A,P):(u.s=o==3?-1:1,u.c=[u.e=0],u)},n.modulo=n.mod=function(u,d){var f,p,g=this;return u=new b(u,d),!g.c||!u.s||u.c&&!u.c[0]?new b(NaN):!u.c||g.c&&!g.c[0]?new b(g):(j==9?(p=u.s,u.s=1,f=t(g,u,0,3),u.s=p,f.s*=p):f=t(g,u,0,j),u=g.minus(f.times(u)),!u.c[0]&&j==1&&(u.s=g.s),u)},n.multipliedBy=n.times=function(u,d){var f,p,g,m,M,k,E,P,A,G,$,Z,J,ge,ye,ce=this,_e=ce.c,Ke=(u=new b(u,d)).c;if(!_e||!Ke||!_e[0]||!Ke[0])return!ce.s||!u.s||_e&&!_e[0]&&!Ke||Ke&&!Ke[0]&&!_e?u.c=u.e=u.s=null:(u.s*=ce.s,!_e||!Ke?u.c=u.e=null:(u.c=[0],u.e=0)),u;for(p=yt(ce.e/ie)+yt(u.e/ie),u.s*=ce.s,E=_e.length,G=Ke.length,E<G&&(J=_e,_e=Ke,Ke=J,g=E,E=G,G=g),g=E+G,J=[];g--;J.push(0));for(ge=Lt,ye=si,g=G;--g>=0;){for(f=0,$=Ke[g]%ye,Z=Ke[g]/ye|0,M=E,m=g+M;m>g;)P=_e[--M]%ye,A=_e[M]/ye|0,k=Z*P+A*$,P=$*P+k%ye*ye+J[m]+f,f=(P/ge|0)+(k/ye|0)+Z*A,J[m--]=P%ge;J[m]=f}return f?++p:J.splice(0,1),O(u,J,p)},n.negated=function(){var u=new b(this);return u.s=-u.s||null,u},n.plus=function(u,d){var f,p=this,g=p.s;if(u=new b(u,d),d=u.s,!g||!d)return new b(NaN);if(g!=d)return u.s=-d,p.minus(u);var m=p.e/ie,M=u.e/ie,k=p.c,E=u.c;if(!m||!M){if(!k||!E)return new b(g/0);if(!k[0]||!E[0])return E[0]?u:new b(k[0]?p:g*0)}if(m=yt(m),M=yt(M),k=k.slice(),g=m-M){for(g>0?(M=m,f=E):(g=-g,f=k),f.reverse();g--;f.push(0));f.reverse()}for(g=k.length,d=E.length,g-d<0&&(f=E,E=k,k=f,d=g),g=0;d;)g=(k[--d]=k[d]+E[d]+g)/Lt|0,k[d]=Lt===k[d]?0:k[d]%Lt;return g&&(k=[g].concat(k),++M),O(u,k,M)},n.precision=n.sd=function(u,d){var f,p,g,m=this;if(u!=null&&u!==!!u)return Le(u,1,Ie),d==null?d=o:Le(d,0,8),S(new b(m),u,d);if(!(f=m.c))return null;if(g=f.length-1,p=g*ie+1,g=f[g]){for(;g%10==0;g/=10,p--);for(g=f[0];g>=10;g/=10,p++);}return u&&m.e+1>p&&(p=m.e+1),p},n.shiftedBy=function(u){return Le(u,-ca,ca),this.times("1e"+u)},n.squareRoot=n.sqrt=function(){var u,d,f,p,g,m=this,M=m.c,k=m.s,E=m.e,P=s+4,A=new b("0.5");if(k!==1||!M||!M[0])return new b(!k||k<0&&(!M||M[0])?NaN:M?m:1/0);if(k=Math.sqrt(+R(m)),k==0||k==1/0?(d=_t(M),(d.length+E)%2==0&&(d+="0"),k=Math.sqrt(+d),E=yt((E+1)/2)-(E<0||E%2),k==1/0?d="5e"+E:(d=k.toExponential(),d=d.slice(0,d.indexOf("e")+1)+E),f=new b(d)):f=new b(k+""),f.c[0]){for(E=f.e,k=E+P,k<3&&(k=0);;)if(g=f,f=A.times(g.plus(t(m,g,P,1))),_t(g.c).slice(0,k)===(d=_t(f.c)).slice(0,k))if(f.e<E&&--k,d=d.slice(k-3,k+1),d=="9999"||!p&&d=="4999"){if(!p&&(S(g,g.e+s+2,0),g.times(g).eq(m))){f=g;break}P+=4,k+=4,p=1}else{(!+d||!+d.slice(1)&&d.charAt(0)=="5")&&(S(f,f.e+s+2,1),u=!f.times(f).eq(m));break}}return S(f,f.e+s+1,o,u)},n.toExponential=function(u,d){return u!=null&&(Le(u,0,Ie),u++),C(this,u,d,1)},n.toFixed=function(u,d){return u!=null&&(Le(u,0,Ie),u=u+this.e+1),C(this,u,d)},n.toFormat=function(u,d,f){var p,g=this;if(f==null)u!=null&&d&&typeof d=="object"?(f=d,d=null):u&&typeof u=="object"?(f=u,u=d=null):f=q;else if(typeof f!="object")throw Error(Qe+"Argument not an object: "+f);if(p=g.toFixed(u,d),g.c){var m,M=p.split("."),k=+f.groupSize,E=+f.secondaryGroupSize,P=f.groupSeparator||"",A=M[0],G=M[1],$=g.s<0,Z=$?A.slice(1):A,J=Z.length;if(E&&(m=k,k=E,E=m,J-=m),k>0&&J>0){for(m=J%k||k,A=Z.substr(0,m);m<J;m+=k)A+=P+Z.substr(m,k);E>0&&(A+=P+Z.slice(m)),$&&(A="-"+A)}p=G?A+(f.decimalSeparator||"")+((E=+f.fractionGroupSize)?G.replace(new RegExp("\\d{"+E+"}\\B","g"),"$&"+(f.fractionGroupSeparator||"")):G):A}return(f.prefix||"")+p+(f.suffix||"")},n.toFraction=function(u){var d,f,p,g,m,M,k,E,P,A,G,$,Z=this,J=Z.c;if(u!=null&&(k=new b(u),!k.isInteger()&&(k.c||k.s!==1)||k.lt(a)))throw Error(Qe+"Argument "+(k.isInteger()?"out of range: ":"not an integer: ")+R(k));if(!J)return new b(Z);for(d=new b(a),P=f=new b(a),p=E=new b(a),$=_t(J),m=d.e=$.length-Z.e-1,d.c[0]=da[(M=m%ie)<0?ie+M:M],u=!u||k.comparedTo(d)>0?m>0?d:P:k,M=_,_=1/0,k=new b($),E.c[0]=0;A=t(k,d,0,1),g=f.plus(A.times(p)),g.comparedTo(u)!=1;)f=p,p=g,P=E.plus(A.times(g=P)),E=g,d=k.minus(A.times(g=d)),k=g;return g=t(u.minus(f),p,0,1),E=E.plus(g.times(P)),f=f.plus(g.times(p)),E.s=P.s=Z.s,m=m*2,G=t(P,p,m,o).minus(Z).abs().comparedTo(t(E,f,m,o).minus(Z).abs())<1?[P,p]:[E,f],_=M,G},n.toNumber=function(){return+R(this)},n.toPrecision=function(u,d){return u!=null&&Le(u,1,Ie),C(this,u,d,2)},n.toString=function(u){var d,f=this,p=f.s,g=f.e;return g===null?p?(d="Infinity",p<0&&(d="-"+d)):d="NaN":(u==null?d=g<=h||g>=c?un(_t(f.c),g):Yt(_t(f.c),g,"0"):u===10&&le?(f=S(new b(f),s+g+1,o),d=Yt(_t(f.c),f.e,"0")):(Le(u,2,X.length,"Base"),d=i(Yt(_t(f.c),g,"0"),10,u,p,!0)),p<0&&f.c[0]&&(d="-"+d)),d},n.valueOf=n.toJSON=function(){return R(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,e!=null&&b.set(e),b}function yt(e){var t=e|0;return e>0||e===t?t:t-1}function _t(e){for(var t,i,r=1,n=e.length,a=e[0]+"";r<n;){for(t=e[r++]+"",i=ie-t.length;i--;t="0"+t);a+=t}for(n=a.length;a.charCodeAt(--n)===48;);return a.slice(0,n+1||1)}function Bi(e,t){var i,r,n=e.c,a=t.c,s=e.s,o=t.s,h=e.e,c=t.e;if(!s||!o)return null;if(i=n&&!n[0],r=a&&!a[0],i||r)return i?r?0:-o:s;if(s!=o)return s;if(i=s<0,r=h==c,!n||!a)return r?0:!n^i?1:-1;if(!r)return h>c^i?1:-1;for(o=(h=n.length)<(c=a.length)?h:c,s=0;s<o;s++)if(n[s]!=a[s])return n[s]>a[s]^i?1:-1;return h==c?0:h>c^i?1:-1}function Le(e,t,i,r){if(e<t||e>i||e!==mt(e))throw Error(Qe+(r||"Argument")+(typeof e=="number"?e<t||e>i?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function ln(e){var t=e.c.length-1;return yt(e.e/ie)==t&&e.c[t]%2!=0}function un(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function Yt(e,t,i){var r,n;if(t<0){for(n=i+".";++t;n+=i);e=n+e}else if(r=e.length,++t>r){for(n=i,t-=r;--t;n+=i);e+=n}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}var Ns=Oa(),jt=Ns,Gs=class{key;left=null;right=null;constructor(e){this.key=e}},Mr=class extends Gs{constructor(e){super(e)}},zs=class{size=0;modificationCount=0;splayCount=0;splay(e){let t=this.root;if(t==null)return this.compare(e,e),-1;let i=null,r=null,n=null,a=null,s=t,o=this.compare,h;for(;;)if(h=o(s.key,e),h>0){let c=s.left;if(c==null||(h=o(c.key,e),h>0&&(s.left=c.right,c.right=s,s=c,c=s.left,c==null)))break;i==null?r=s:i.left=s,i=s,s=c}else if(h<0){let c=s.right;if(c==null||(h=o(c.key,e),h<0&&(s.right=c.left,c.left=s,s=c,c=s.right,c==null)))break;n==null?a=s:n.right=s,n=s,s=c}else break;return n!=null&&(n.right=s.left,s.left=a),i!=null&&(i.left=s.right,s.right=r),this.root!==s&&(this.root=s,this.splayCount++),h}splayMin(e){let t=e,i=t.left;for(;i!=null;){let r=i;t.left=r.right,r.right=t,t=r,i=t.left}return t}splayMax(e){let t=e,i=t.right;for(;i!=null;){let r=i;t.right=r.left,r.left=t,t=r,i=t.right}return t}_delete(e){if(this.root==null||this.splay(e)!=0)return null;let t=this.root,i=t,r=t.left;if(this.size--,r==null)this.root=t.right;else{let n=t.right;t=this.splayMax(r),t.right=n,this.root=t}return this.modificationCount++,i}addNewRoot(e,t){this.size++,this.modificationCount++;let i=this.root;if(i==null){this.root=e;return}t<0?(e.left=i,e.right=i.right,i.right=null):(e.right=i,e.left=i.left,i.left=null),this.root=e}_first(){let e=this.root;return e==null?null:(this.root=this.splayMin(e),this.root)}_last(){let e=this.root;return e==null?null:(this.root=this.splayMax(e),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(e){return this.validKey(e)&&this.splay(e)==0}defaultCompare(){return(e,t)=>e<t?-1:e>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:e=>{this.root=e},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:e=>{this.splayCount=e},splay:e=>this.splay(e),has:e=>this.has(e)}}},hn=class Tr extends zs{root=null;compare;validKey;constructor(t,i){super(),this.compare=t??this.defaultCompare(),this.validKey=i??(r=>r!=null&&r!=null)}delete(t){return this.validKey(t)?this._delete(t)!=null:!1}deleteAll(t){for(let i of t)this.delete(i)}forEach(t){let i=this[Symbol.iterator](),r;for(;r=i.next(),!r.done;)t(r.value,r.value,this)}add(t){let i=this.splay(t);return i!=0&&this.addNewRoot(new Mr(t),i),this}addAndReturn(t){let i=this.splay(t);return i!=0&&this.addNewRoot(new Mr(t),i),this.root.key}addAll(t){for(let i of t)this.add(i)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let r=i.right;for(;r!=null;)i=r,r=i.right;return i.key}firstAfter(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let r=i.left;for(;r!=null;)i=r,r=i.left;return i.key}retainAll(t){let i=new Tr(this.compare,this.validKey),r=this.modificationCount;for(let n of t){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(n)&&this.splay(n)==0&&i.add(this.root.key)}i.size!=this.size&&(this.root=i.root,this.size=i.size,this.modificationCount++)}lookup(t){return!this.validKey(t)||this.splay(t)!=0?null:this.root.key}intersection(t){let i=new Tr(this.compare,this.validKey);for(let r of this)t.has(r)&&i.add(r);return i}difference(t){let i=new Tr(this.compare,this.validKey);for(let r of this)t.has(r)||i.add(r);return i}union(t){let i=this.clone();return i.addAll(t),i}clone(){let t=new Tr(this.compare,this.validKey);return t.size=this.size,t.root=this.copyNode(this.root),t}copyNode(t){if(t==null)return null;function i(n,a){let s,o;do{if(s=n.left,o=n.right,s!=null){let h=new Mr(s.key);a.left=h,i(s,h)}if(o!=null){let h=new Mr(o.key);a.right=h,n=o,a=h}}while(o!=null)}let r=new Mr(t.key);return i(t,r),r}toSet(){return this.clone()}entries(){return new Hs(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Us(this.wrap())}[Symbol.toStringTag]="[object Set]"},Ia=class{tree;path=new Array;modificationCount=null;splayCount;constructor(e){this.tree=e,this.splayCount=e.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let e=this.path[this.path.length-1];return this.getValue(e)}rebuildPath(e){this.path.splice(0,this.path.length),this.tree.splay(e),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(e){for(;e!=null;)this.path.push(e),e=e.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let i=this.tree.getRoot();for(;i!=null;)this.path.push(i),i=i.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let e=this.path[this.path.length-1],t=e.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===e;)e=this.path.pop();return this.path.length>0}},Us=class extends Ia{getValue(e){return e.key}},Hs=class extends Ia{getValue(e){return[e.key,e.key]}},Vs=e=>e,Ks=e=>{if(e){let t=new hn(ua(e)),i=new hn(ua(e)),r=(a,s)=>s.addAndReturn(a),n=a=>({x:r(a.x,t),y:r(a.y,i)});return n({x:new jt(0),y:new jt(0)}),n}return Vs},pa=e=>({set:t=>{Xt=pa(t)},reset:()=>pa(e),compare:ua(e),snap:Ks(e),orient:Os(e)}),Xt=pa(),Er=(e,t)=>e.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(e.ur.x)&&e.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(e.ur.y),fa=(e,t)=>{if(t.ur.x.isLessThan(e.ll.x)||e.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(e.ll.y)||e.ur.y.isLessThan(t.ll.y))return null;let i=e.ll.x.isLessThan(t.ll.x)?t.ll.x:e.ll.x,r=e.ur.x.isLessThan(t.ur.x)?e.ur.x:t.ur.x,n=e.ll.y.isLessThan(t.ll.y)?t.ll.y:e.ll.y,a=e.ur.y.isLessThan(t.ur.y)?e.ur.y:t.ur.y;return{ll:{x:i,y:n},ur:{x:r,y:a}}},cn=(e,t)=>e.x.times(t.y).minus(e.y.times(t.x)),Na=(e,t)=>e.x.times(t.x).plus(e.y.times(t.y)),dn=e=>Na(e,e).sqrt(),Ws=(e,t,i)=>{let r={x:t.x.minus(e.x),y:t.y.minus(e.y)},n={x:i.x.minus(e.x),y:i.y.minus(e.y)};return cn(n,r).div(dn(n)).div(dn(r))},qs=(e,t,i)=>{let r={x:t.x.minus(e.x),y:t.y.minus(e.y)},n={x:i.x.minus(e.x),y:i.y.minus(e.y)};return Na(n,r).div(dn(n)).div(dn(r))},Ga=(e,t,i)=>t.y.isZero()?null:{x:e.x.plus(t.x.div(t.y).times(i.minus(e.y))),y:i},za=(e,t,i)=>t.x.isZero()?null:{x:i,y:e.y.plus(t.y.div(t.x).times(i.minus(e.x)))},$s=(e,t,i,r)=>{if(t.x.isZero())return za(i,r,e.x);if(r.x.isZero())return za(e,t,i.x);if(t.y.isZero())return Ga(i,r,e.y);if(r.y.isZero())return Ga(e,t,i.y);let n=cn(t,r);if(n.isZero())return null;let a={x:i.x.minus(e.x),y:i.y.minus(e.y)},s=cn(a,t).div(n),o=cn(a,r).div(n),h=e.x.plus(o.times(t.x)),c=i.x.plus(s.times(r.x)),x=e.y.plus(o.times(t.y)),_=i.y.plus(s.times(r.y)),T=h.plus(c).div(2),j=x.plus(_).div(2);return{x:T,y:j}},Ot=class ls{point;isLeft;segment;otherSE;consumedBy;static compare(t,i){let r=ls.comparePoints(t.point,i.point);return r!==0?r:(t.point!==i.point&&t.link(i),t.isLeft!==i.isLeft?t.isLeft?1:-1:pn.compare(t.segment,i.segment))}static comparePoints(t,i){return t.x.isLessThan(i.x)?-1:t.x.isGreaterThan(i.x)?1:t.y.isLessThan(i.y)?-1:t.y.isGreaterThan(i.y)?1:0}constructor(t,i){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=i}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");let i=t.point.events;for(let r=0,n=i.length;r<n;r++){let a=i[r];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){let t=this.point.events.length;for(let i=0;i<t;i++){let r=this.point.events[i];if(r.segment.consumedBy===void 0)for(let n=i+1;n<t;n++){let a=this.point.events[n];a.consumedBy===void 0&&r.otherSE.point.events===a.otherSE.point.events&&r.segment.consume(a.segment)}}}getAvailableLinkedEvents(){let t=[];for(let i=0,r=this.point.events.length;i<r;i++){let n=this.point.events[i];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){let i=new Map,r=n=>{let a=n.otherSE;i.set(n,{sine:Ws(this.point,t.point,a.point),cosine:qs(this.point,t.point,a.point)})};return(n,a)=>{i.has(n)||r(n),i.has(a)||r(a);let{sine:s,cosine:o}=i.get(n),{sine:h,cosine:c}=i.get(a);return s.isGreaterThanOrEqualTo(0)&&h.isGreaterThanOrEqualTo(0)?o.isLessThan(c)?1:o.isGreaterThan(c)?-1:0:s.isLessThan(0)&&h.isLessThan(0)?o.isLessThan(c)?-1:o.isGreaterThan(c)?1:0:h.isLessThan(s)?-1:h.isGreaterThan(s)?1:0}}},Ys=0,pn=class Mn{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(t,i){let r=t.leftSE.point.x,n=i.leftSE.point.x,a=t.rightSE.point.x,s=i.rightSE.point.x;if(s.isLessThan(r))return 1;if(a.isLessThan(n))return-1;let o=t.leftSE.point.y,h=i.leftSE.point.y,c=t.rightSE.point.y,x=i.rightSE.point.y;if(r.isLessThan(n)){if(h.isLessThan(o)&&h.isLessThan(c))return 1;if(h.isGreaterThan(o)&&h.isGreaterThan(c))return-1;let _=t.comparePoint(i.leftSE.point);if(_<0)return 1;if(_>0)return-1;let T=i.comparePoint(t.rightSE.point);return T!==0?T:-1}if(r.isGreaterThan(n)){if(o.isLessThan(h)&&o.isLessThan(x))return-1;if(o.isGreaterThan(h)&&o.isGreaterThan(x))return 1;let _=i.comparePoint(t.leftSE.point);if(_!==0)return _;let T=t.comparePoint(i.rightSE.point);return T<0?1:T>0?-1:1}if(o.isLessThan(h))return-1;if(o.isGreaterThan(h))return 1;if(a.isLessThan(s)){let _=i.comparePoint(t.rightSE.point);if(_!==0)return _}if(a.isGreaterThan(s)){let _=t.comparePoint(i.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!a.eq(s)){let _=c.minus(o),T=a.minus(r),j=x.minus(h),z=s.minus(n);if(_.isGreaterThan(T)&&j.isLessThan(z))return 1;if(_.isLessThan(T)&&j.isGreaterThan(z))return-1}return a.isGreaterThan(s)?1:a.isLessThan(s)||c.isLessThan(x)?-1:c.isGreaterThan(x)?1:t.id<i.id?-1:t.id>i.id?1:0}constructor(t,i,r,n){this.id=++Ys,this.leftSE=t,t.segment=this,t.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=t,this.rings=r,this.windings=n}static fromRing(t,i,r){let n,a,s,o=Ot.comparePoints(t,i);if(o<0)n=t,a=i,s=1;else if(o>0)n=i,a=t,s=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);let h=new Ot(n,!0),c=new Ot(a,!1);return new Mn(h,c,[r],[s])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let t=this.leftSE.point.y,i=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(i)?t:i},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(i)?t:i}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return Xt.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){let i=this.bbox(),r=t.bbox(),n=fa(i,r);if(n===null)return null;let a=this.leftSE.point,s=this.rightSE.point,o=t.leftSE.point,h=t.rightSE.point,c=Er(i,o)&&this.comparePoint(o)===0,x=Er(r,a)&&t.comparePoint(a)===0,_=Er(i,h)&&this.comparePoint(h)===0,T=Er(r,s)&&t.comparePoint(s)===0;if(x&&c)return T&&!_?s:!T&&_?h:null;if(x)return _&&a.x.eq(h.x)&&a.y.eq(h.y)?null:a;if(c)return T&&s.x.eq(o.x)&&s.y.eq(o.y)?null:o;if(T&&_)return null;if(T)return s;if(_)return h;let j=$s(a,this.vector(),o,t.vector());return j===null||!Er(n,j)?null:Xt.snap(j)}split(t){let i=[],r=t.events!==void 0,n=new Ot(t,!0),a=new Ot(t,!1),s=this.rightSE;this.replaceRightSE(a),i.push(a),i.push(n);let o=new Mn(n,s,this.rings.slice(),this.windings.slice());return Ot.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),Ot.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(n.checkForConsuming(),a.checkForConsuming()),i}swapEvents(){let t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let i=0,r=this.windings.length;i<r;i++)this.windings[i]*=-1}consume(t){let i=this,r=t;for(;i.consumedBy;)i=i.consumedBy;for(;r.consumedBy;)r=r.consumedBy;let n=Mn.compare(i,r);if(n!==0){if(n>0){let a=i;i=r,r=a}if(i.prev===r){let a=i;i=r,r=a}for(let a=0,s=r.rings.length;a<s;a++){let o=r.rings[a],h=r.windings[a],c=i.rings.indexOf(o);c===-1?(i.rings.push(o),i.windings.push(h)):i.windings[c]+=h}r.rings=null,r.windings=null,r.consumedBy=i,r.leftSE.consumedBy=i.leftSE,r.rightSE.consumedBy=i.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};let i=this._afterState.rings,r=this._afterState.windings,n=this._afterState.multiPolys;for(let o=0,h=this.rings.length;o<h;o++){let c=this.rings[o],x=this.windings[o],_=i.indexOf(c);_===-1?(i.push(c),r.push(x)):r[_]+=x}let a=[],s=[];for(let o=0,h=i.length;o<h;o++){if(r[o]===0)continue;let c=i[o],x=c.poly;if(s.indexOf(x)===-1)if(c.isExterior)a.push(x);else{s.indexOf(x)===-1&&s.push(x);let _=a.indexOf(c.poly);_!==-1&&a.splice(_,1)}}for(let o=0,h=a.length;o<h;o++){let c=a[o].multiPoly;n.indexOf(c)===-1&&n.push(c)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let t=this.beforeState().multiPolys,i=this.afterState().multiPolys;switch(fn.type){case"union":{let r=t.length===0,n=i.length===0;this._isInResult=r!==n;break}case"intersection":{let r,n;t.length<i.length?(r=t.length,n=i.length):(r=i.length,n=t.length),this._isInResult=n===fn.numMultiPolys&&r<n;break}case"xor":{let r=Math.abs(t.length-i.length);this._isInResult=r%2===1;break}case"difference":{let r=n=>n.length===1&&n[0].isSubject;this._isInResult=r(t)!==r(i);break}}return this._isInResult}},Ua=class{poly;isExterior;segments;bbox;constructor(e,t,i){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=i,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=Xt.snap({x:new jt(e[0][0]),y:new jt(e[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let n=r;for(let a=1,s=e.length;a<s;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let o=Xt.snap({x:new jt(e[a][0]),y:new jt(e[a][1])});o.x.eq(n.x)&&o.y.eq(n.y)||(this.segments.push(pn.fromRing(n,o,this)),o.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=o.x),o.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=o.y),o.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=o.x),o.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=o.y),n=o)}(!r.x.eq(n.x)||!r.y.eq(n.y))&&this.segments.push(pn.fromRing(n,r,this))}getSweepEvents(){let e=[];for(let t=0,i=this.segments.length;t<i;t++){let r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}},Xs=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ua(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,r=e.length;i<r;i++){let n=new Ua(e[i],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){let e=this.exteriorRing.getSweepEvents();for(let t=0,i=this.interiorRings.length;t<i;t++){let r=this.interiorRings[t].getSweepEvents();for(let n=0,a=r.length;n<a;n++)e.push(r[n])}return e}},Ha=class{isSubject;polys;bbox;constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:new jt(Number.POSITIVE_INFINITY),y:new jt(Number.POSITIVE_INFINITY)},ur:{x:new jt(Number.NEGATIVE_INFINITY),y:new jt(Number.NEGATIVE_INFINITY)}};for(let i=0,r=e.length;i<r;i++){let n=new Xs(e[i],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){let e=[];for(let t=0,i=this.polys.length;t<i;t++){let r=this.polys[t].getSweepEvents();for(let n=0,a=r.length;n<a;n++)e.push(r[n])}return e}},Zs=class va{events;poly;_isExteriorRing;_enclosingRing;static factory(t){let i=[];for(let r=0,n=t.length;r<n;r++){let a=t[r];if(!a.isInResult()||a.ringOut)continue;let s=null,o=a.leftSE,h=a.rightSE,c=[o],x=o.point,_=[];for(;s=o,o=h,c.push(o),o.point!==x;)for(;;){let T=o.getAvailableLinkedEvents();if(T.length===0){let q=c[0].point,X=c[c.length-1].point;throw new Error(`Unable to complete output ring starting at [${q.x}, ${q.y}]. Last matching segment found ends at [${X.x}, ${X.y}].`)}if(T.length===1){h=T[0].otherSE;break}let j=null;for(let q=0,X=_.length;q<X;q++)if(_[q].point===o.point){j=q;break}if(j!==null){let q=_.splice(j)[0],X=c.splice(q.index);X.unshift(X[0].otherSE),i.push(new va(X.reverse()));continue}_.push({index:c.length,point:o.point});let z=o.getLeftmostComparator(s);h=T.sort(z)[0].otherSE;break}i.push(new va(c))}return i}constructor(t){this.events=t;for(let i=0,r=t.length;i<r;i++)t[i].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point,i=[t];for(let c=1,x=this.events.length-1;c<x;c++){let _=this.events[c].point,T=this.events[c+1].point;Xt.orient(_,t,T)!==0&&(i.push(_),t=_)}if(i.length===1)return null;let r=i[0],n=i[1];Xt.orient(r,t,n)===0&&i.shift(),i.push(i[0]);let a=this.isExteriorRing()?1:-1,s=this.isExteriorRing()?0:i.length-1,o=this.isExteriorRing()?i.length:-1,h=[];for(let c=s;c!=o;c+=a)h.push([i[c].x.toNumber(),i[c].y.toNumber()]);return h}isExteriorRing(){if(this._isExteriorRing===void 0){let t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let n=1,a=this.events.length;n<a;n++){let s=this.events[n];Ot.compare(t,s)>0&&(t=s)}let i=t.segment.prevInResult(),r=i?i.prevInResult():null;for(;;){if(!i)return null;if(!r)return i.ringOut;if(r.ringOut!==i.ringOut)return r.ringOut?.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut?.enclosingRing();i=r.prevInResult(),r=i?i.prevInResult():null}}},Va=class{exteriorRing;interiorRings;constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){let e=this.exteriorRing.getGeom();if(e===null)return null;let t=[e];for(let i=0,r=this.interiorRings.length;i<r;i++){let n=this.interiorRings[i].getGeom();n!==null&&t.push(n)}return t}},Js=class{rings;polys;constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){let e=[];for(let t=0,i=this.polys.length;t<i;t++){let r=this.polys[t].getGeom();r!==null&&e.push(r)}return e}_composePolys(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];if(!n.poly)if(n.isExteriorRing())t.push(new Va(n));else{let a=n.enclosingRing();a?.poly||t.push(new Va(a)),a?.poly?.addInterior(n)}}return t}},Qs=class{queue;tree;segments;constructor(e,t=pn.compare){this.queue=e,this.tree=new hn(t),this.segments=[]}process(e){let t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.delete(e.otherSE):this.tree.delete(t),i;e.isLeft&&this.tree.add(t);let r=t,n=t;do r=this.tree.lastBefore(r);while(r!=null&&r.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(e.isLeft){let a=null;if(r){let o=r.getIntersection(t);if(o!==null&&(t.isAnEndpoint(o)||(a=o),!r.isAnEndpoint(o))){let h=this._splitSafely(r,o);for(let c=0,x=h.length;c<x;c++)i.push(h[c])}}let s=null;if(n){let o=n.getIntersection(t);if(o!==null&&(t.isAnEndpoint(o)||(s=o),!n.isAnEndpoint(o))){let h=this._splitSafely(n,o);for(let c=0,x=h.length;c<x;c++)i.push(h[c])}}if(a!==null||s!==null){let o=null;a===null?o=s:s===null?o=a:o=Ot.comparePoints(a,s)<=0?a:s,this.queue.delete(t.rightSE),i.push(t.rightSE);let h=t.split(o);for(let c=0,x=h.length;c<x;c++)i.push(h[c])}i.length>0?(this.tree.delete(t),i.push(e)):(this.segments.push(t),t.prev=r)}else{if(r&&n){let a=r.getIntersection(n);if(a!==null){if(!r.isAnEndpoint(a)){let s=this._splitSafely(r,a);for(let o=0,h=s.length;o<h;o++)i.push(s[o])}if(!n.isAnEndpoint(a)){let s=this._splitSafely(n,a);for(let o=0,h=s.length;o<h;o++)i.push(s[o])}}}this.tree.delete(t)}return i}_splitSafely(e,t){this.tree.delete(e);let i=e.rightSE;this.queue.delete(i);let r=e.split(t);return r.push(i),e.consumedBy===void 0&&this.tree.add(e),r}},eo=class{type;numMultiPolys;run(e,t,i){Br.type=e;let r=[new Ha(t,!0)];for(let h=0,c=i.length;h<c;h++)r.push(new Ha(i[h],!1));if(Br.numMultiPolys=r.length,Br.type==="difference"){let h=r[0],c=1;for(;c<r.length;)fa(r[c].bbox,h.bbox)!==null?c++:r.splice(c,1)}if(Br.type==="intersection")for(let h=0,c=r.length;h<c;h++){let x=r[h];for(let _=h+1,T=r.length;_<T;_++)if(fa(x.bbox,r[_].bbox)===null)return[]}let n=new hn(Ot.compare);for(let h=0,c=r.length;h<c;h++){let x=r[h].getSweepEvents();for(let _=0,T=x.length;_<T;_++)n.add(x[_])}let a=new Qs(n),s=null;for(n.size!=0&&(s=n.first(),n.delete(s));s;){let h=a.process(s);for(let c=0,x=h.length;c<x;c++){let _=h[c];_.consumedBy===void 0&&n.add(_)}n.size!=0?(s=n.first(),n.delete(s)):s=null}Xt.reset();let o=Zs.factory(a.segments);return new Js(o).getGeom()}},Br=new eo,fn=Br,to=(e,...t)=>fn.run("intersection",e,t),io=(e,...t)=>fn.run("difference",e,t);Xt.set;function gn(e){let t={type:"Feature"};return t.geometry=e,t}function mn(e){return e.type==="Feature"?e.geometry:e}function Ka(e){return e&&e.geometry&&e.geometry.coordinates?e.geometry.coordinates:e}function ro(e){return gn({type:"LineString",coordinates:e})}function no(e){return gn({type:"MultiLineString",coordinates:e})}function Wa(e){return gn({type:"Polygon",coordinates:e})}function qa(e){return gn({type:"MultiPolygon",coordinates:e})}function ao(e,t){let i=mn(e),r=mn(t),n=to(i.coordinates,r.coordinates);return n.length===0?null:n.length===1?Wa(n[0]):qa(n)}function so(e,t){let i=mn(e),r=mn(t),n=io(i.coordinates,r.coordinates);return n.length===0?null:n.length===1?Wa(n[0]):qa(n)}function $a(e){return Array.isArray(e)?1+$a(e[0]):-1}function oo(e){e instanceof L.Polyline&&(e=e.toGeoJSON(15));let t=Ka(e),i=$a(t),r=[];return i>1?t.forEach(n=>{r.push(ro(n))}):r.push(e),r}function lo(e){let t=[];return e.eachLayer(i=>{t.push(Ka(i.toGeoJSON(15)))}),no(t)}Te.Cut=Te.Polygon.extend({initialize(e){this._map=e,this._shape="Cut",this.toolbarButtonName="cutPolygon"},_finishShape(){if(this._editedLayers=[],!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let e=this._layer.getLatLngs();if(e.length<=2)return;let t=L.polygon(e,this.options.pathOptions);t._latlngInfos=this._layer._latlngInfo,this.cut(t),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex,this._editedLayers.forEach(({layer:r,originalLayer:n})=>{this._fireCut(n,r,n),this._fireCut(this._map,r,n),n.pm._fireEdit()}),this._editedLayers=[];let i=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(i))},cut(e){let t=this._map._layers,i=e._latlngInfos||[];Object.keys(t).map(r=>t[r]).filter(r=>r.pm).filter(r=>!r._pmTempLayer).filter(r=>!L.PM.optIn&&!r.options.pmIgnore||L.PM.optIn&&r.options.pmIgnore===!1).filter(r=>r instanceof L.Polyline).filter(r=>r!==e).filter(r=>r.pm.options.allowCutting).filter(r=>this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0?this.options.layersToCut.indexOf(r)>-1:!0).filter(r=>!this._layerGroup.hasLayer(r)).filter(r=>{try{let n=!!Mi(e.toGeoJSON(15),r.toGeoJSON(15)).features.length>0;return n||r instanceof L.Polyline&&!(r instanceof L.Polygon)?n:!!ao(e.toGeoJSON(15),r.toGeoJSON(15))}catch{return r instanceof L.Polygon&&console.error("You can't cut polygons with self-intersections"),!1}}).forEach(r=>{let n;if(r instanceof L.Polygon){n=L.polygon(r.getLatLngs());let h=n.getLatLngs();i.forEach(c=>{if(c&&c.snapInfo){let{latlng:x}=c,_=this._calcClosestLayer(x,[n]);if(_&&_.segment&&_.distance<this.options.snapDistance){let{segment:T}=_;if(T&&T.length===2){let{indexPath:j,parentPath:z,newIndex:q}=L.PM.Utils._getIndexFromSegment(h,T);(j.length>1?(0,js.default)(h,z):h).splice(q,0,x)}}}})}else n=r;let a=this._cutLayer(e,n),s=L.geoJSON(a,r.options);s.getLayers().length===1&&([s]=s.getLayers()),this._setPane(s,"layerPane");let o=s.addTo(this._map.pm._getContainingLayer());if(o.pm.enable(r.pm.options),o.pm.disable(),r._pmTempLayer=!0,e._pmTempLayer=!0,r.remove(),r.removeFrom(this._map.pm._getContainingLayer()),e.remove(),e.removeFrom(this._map.pm._getContainingLayer()),o.getLayers&&o.getLayers().length===0&&this._map.pm.removeLayer({target:o}),o instanceof L.LayerGroup?(o.eachLayer(h=>{this._addDrawnLayerProp(h)}),this._addDrawnLayerProp(o)):this._addDrawnLayerProp(o),this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0){let h=this.options.layersToCut.indexOf(r);h>-1&&this.options.layersToCut.splice(h,1)}this._editedLayers.push({layer:o,originalLayer:r})})},_cutLayer(e,t){let i=L.geoJSON(),r;if(t instanceof L.Polygon)r=so(t.toGeoJSON(15),e.toGeoJSON(15));else{let n=oo(t);n.forEach(a=>{let s=Cs(a,e.toGeoJSON(15)),o;s&&s.features.length>0?o=L.geoJSON(s):o=L.geoJSON(a),o.getLayers().forEach(h=>{Bs(e.toGeoJSON(15),h.toGeoJSON(15))||h.addTo(i)})}),n.length>1?r=lo(i):r=i.toGeoJSON(15)}return r},_change:L.Util.falseFn}),Te.Text=Te.extend({initialize(e){this._map=e,this._shape="Text",this.toolbarButtonName="drawText"},enable(e){L.Util.setOptions(this,e),this._enabled=!0,this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(oe("tooltips.placeText"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this._map.getContainer().classList.add("geoman-draw-cursor"),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.off("click",this._createMarker,this),this._hintMarker?.remove(),this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("mousemove",this._syncHintMarker,this),this._map.off("mousemove",this._showHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(e){this.enabled()?this.disable():this.enable(e)},_syncHintMarker(e){if(this._hintMarker.setLatLng(e.latlng),this.options.snappable){let t=e;t.target=this._hintMarker,this._handleSnapping(t)}},_createMarker(e){if(!e.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(e.latlng);let t=this._hintMarker.getLatLng();if(this.textArea=this._createTextArea(),this.options.textOptions?.className){let n=this.options.textOptions.className.split(" ");this.textArea.classList.add(...n)}let i=this._createTextIcon(this.textArea),r=new L.Marker(t,{textMarker:!0,_textMarkerOverPM:!0,icon:i});if(this._setPane(r,"markerPane"),this._finishLayer(r),r.pm||(r.options.draggable=!1),r.addTo(this._map.pm._getContainingLayer()),r.pm){r.pm.textArea=this.textArea,L.setOptions(r.pm,{removeIfEmpty:this.options.textOptions?.removeIfEmpty??!0});let n=this.options.textOptions?.focusAfterDraw??!0;r.pm._createTextMarker(n),this.options.textOptions?.text&&r.pm.setText(this.options.textOptions.text)}this._fireCreate(r),this._cleanupSnapping(),this.disable(),this.options.continueDrawing&&this._map.once("mousemove",this._showHintMarkerAfterMoving,this)},_showHintMarkerAfterMoving(e){this.enable(),this._hintMarker.setLatLng(e.latlng)},_createTextArea(){let e=document.createElement("textarea");return e.readOnly=!0,e.classList.add("pm-textarea","pm-disabled"),e},_createTextIcon(e){return L.divIcon({className:"pm-text-marker",html:e})}});var uo={enableLayerDrag(){if(!this.options.draggable||!this._layer._map)return;this.disable(),this._layerDragEnabled=!0,this._map||(this._map=this._layer._map),(this._layer instanceof L.Marker||this._layer instanceof L.ImageOverlay)&&L.DomEvent.on(this._getDOMElem(),"dragstart",this._stopDOMImageDrag),this._layer.dragging&&this._layer.dragging.disable(),this._tempDragCoord=null,Rt(this._layer)instanceof L.Canvas?(this._layer.on("mouseout",this.removeDraggingClass,this),this._layer.on("mouseover",this.addDraggingClass,this)):this.addDraggingClass(),this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!0;let e=this._getDOMElem();e&&(Rt(this._layer)instanceof L.Canvas?(this._layer.on("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._addTouchEvents(e)):L.DomEvent.on(e,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._fireDragEnable()},disableLayerDrag(){this._layerDragEnabled=!1,Rt(this._layer)instanceof L.Canvas?(this._layer.off("mouseout",this.removeDraggingClass,this),this._layer.off("mouseover",this.addDraggingClass,this)):this.removeDraggingClass(),this._originalMapDragState&&this._dragging&&this._map.dragging.enable(),this._safeToCacheDragState=!1,this._layer.dragging&&this._layer.dragging.disable();let e=this._getDOMElem();e&&(Rt(this._layer)instanceof L.Canvas?(this._layer.off("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._removeTouchEvents(e)):L.DomEvent.off(e,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._layerDragged&&this._fireUpdate(),this._layerDragged=!1,this._fireDragDisable()},dragging(){return this._dragging},layerDragEnabled(){return!!this._layerDragEnabled},_simulateMouseDownEvent(e){let t=e.touches?e.touches[0]:e,i={originalEvent:t,target:this._layer};return i.containerPoint=this._map.mouseEventToContainerPoint(t),i.latlng=this._map.containerPointToLatLng(i.containerPoint),this._dragMixinOnMouseDown(i),!1},_simulateMouseMoveEvent(e){let t=e.touches?e.touches[0]:e,i={originalEvent:t,target:this._layer};return i.containerPoint=this._map.mouseEventToContainerPoint(t),i.latlng=this._map.containerPointToLatLng(i.containerPoint),this._dragMixinOnMouseMove(i),!1},_simulateMouseUpEvent(e){let t={originalEvent:e.touches?e.touches[0]:e,target:this._layer};return e.type.indexOf("touch")===-1&&(t.containerPoint=this._map.mouseEventToContainerPoint(e),t.latlng=this._map.containerPointToLatLng(t.containerPoint)),this._dragMixinOnMouseUp(t),!1},_dragMixinOnMouseDown(e){if(e.originalEvent.button>0)return;this._overwriteEventIfItComesFromMarker(e);let t=e._fromLayerSync,i=this._syncLayers("_dragMixinOnMouseDown",e);if(this._layer instanceof L.Marker&&(this.options.snappable&&!t&&!i?this._initSnappableMarkers():this._disableSnapping()),this._layer instanceof L.CircleMarker){let r="resizeableCircleMarker";this._layer instanceof L.Circle&&(r="resizeableCircle"),this.options.snappable&&!t&&!i?this._layer.pm.options[r]||this._initSnappableMarkersDrag():this._layer.pm.options[r]?this._layer.pm._disableSnapping():this._layer.pm._disableSnappingDrag()}this._safeToCacheDragState&&(this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!1),this._tempDragCoord=e.latlng,L.DomEvent.on(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),L.DomEvent.on(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this)},_dragMixinOnMouseMove(e){this._overwriteEventIfItComesFromMarker(e);let t=this._getDOMElem();this._syncLayers("_dragMixinOnMouseMove",e),this._dragging||(this._dragging=!0,L.DomUtil.addClass(t,"leaflet-pm-dragging"),this._layer instanceof L.Marker||this._layer.bringToFront(),this._originalMapDragState&&this._map.dragging.disable(),this._fireDragStart()),this._tempDragCoord||(this._tempDragCoord=e.latlng),this._onLayerDrag(e),this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle()},_dragMixinOnMouseUp(e){let t=this._getDOMElem();return this._syncLayers("_dragMixinOnMouseUp",e),this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0,L.DomEvent.off(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this),L.DomEvent.off(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),this._dragging?(this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle(),this._layerDragged=!0,window.setTimeout(()=>{this._dragging=!1,t&&L.DomUtil.removeClass(t,"leaflet-pm-dragging"),this._fireDragEnd(),this._fireEdit(),this._layerEdited=!0},10),!0):!1},_onLayerDrag(e){let{latlng:t}=e,i={lat:t.lat-this._tempDragCoord.lat,lng:t.lng-this._tempDragCoord.lng},r=n=>n.map(a=>{if(Array.isArray(a))return r(a);let s={lat:a.lat+i.lat,lng:a.lng+i.lng};return(a.alt||a.alt===0)&&(s.alt=a.alt),s});if(this._layer instanceof L.Circle&&this._layer.options.resizeableCircle||this._layer instanceof L.CircleMarker&&this._layer.options.resizeableCircleMarker){let n=r([this._layer.getLatLng()]);this._layer.setLatLng(n[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.CircleMarker||this._layer instanceof L.Marker){let n=this._layer.getLatLng();this._layer._snapped&&(n=this._layer._orgLatLng);let a=r([n]);this._layer.setLatLng(a[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.ImageOverlay){let n=r([this._layer.getBounds().getNorthWest(),this._layer.getBounds().getSouthEast()]);this._layer.setBounds(n),this._fireChange(this._layer.getBounds(),"Edit")}else{let n=r(this._layer.getLatLngs());this._layer.setLatLngs(n),this._fireChange(this._layer.getLatLngs(),"Edit")}this._tempDragCoord=t,e.layer=this._layer,this._fireDrag(e)},addDraggingClass(){let e=this._getDOMElem();e&&L.DomUtil.addClass(e,"leaflet-pm-draggable")},removeDraggingClass(){let e=this._getDOMElem();e&&L.DomUtil.removeClass(e,"leaflet-pm-draggable")},_getDOMElem(){let e=null;return this._layer._path?e=this._layer._path:this._layer._renderer&&this._layer._renderer._container?e=this._layer._renderer._container:this._layer._image?e=this._layer._image:this._layer._icon&&(e=this._layer._icon),e},_overwriteEventIfItComesFromMarker(e){e.target.getLatLng&&(!e.target._radius||e.target._radius<=10)&&(e.containerPoint=this._map.mouseEventToContainerPoint(e.originalEvent),e.latlng=this._map.containerPointToLatLng(e.containerPoint))},_syncLayers(e,t){if(this.enabled())return!1;if(!t._fromLayerSync&&this._layer===t.target&&this.options.syncLayersOnDrag){t._fromLayerSync=!0;let i=[];if(L.Util.isArray(this.options.syncLayersOnDrag))i=this.options.syncLayersOnDrag,this.options.syncLayersOnDrag.forEach(r=>{r instanceof L.LayerGroup&&(i=i.concat(r.pm.getLayers(!0)))});else if(this.options.syncLayersOnDrag===!0&&this._parentLayerGroup)for(let r in this._parentLayerGroup){let n=this._parentLayerGroup[r];n.pm&&(i=n.pm.getLayers(!0))}return L.Util.isArray(i)&&i.length>0&&(i=i.filter(r=>!!r.pm).filter(r=>!!r.pm.options.draggable),i.forEach(r=>{r!==this._layer&&r.pm[e]&&(r._snapped=!1,r.pm[e](t))})),i.length>0}return!1},_stopDOMImageDrag(e){return e.preventDefault(),!1}},ho=uo,co=Se(_i());function po(e,t,i,r){return i.unproject(t.transform(i.project(e,r)),r)}function Ya(e,t,i){let r=i.getMaxZoom();if(r===1/0&&(r=i.getZoom()),L.Util.isArray(e)){let n=[];return e.forEach(a=>{n.push(Ya(a,t,i))}),n}return e instanceof L.LatLng?po(e,t,i,r):null}function Qi(e,t){t instanceof L.Layer&&(t=t.getLatLng());let i=e.getMaxZoom();return i===1/0&&(i=e.getZoom()),e.project(t,i)}function yn(e,t){let i=e.getMaxZoom();return i===1/0&&(i=e.getZoom()),e.unproject(t,i)}var fo={_onRotateStart(e){this._preventRenderingMarkers(!0),this._rotationOriginLatLng=this._getRotationCenter().clone(),this._rotationOriginPoint=Qi(this._map,this._rotationOriginLatLng),this._rotationStartPoint=Qi(this._map,e.target.getLatLng()),this._initialRotateLatLng=Xe(this._layer),this._startAngle=this.getAngle();let t=Xe(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._fireRotationStart(this._rotationLayer,t),this._fireRotationStart(this._map,t)},_onRotate(e){let t=Qi(this._map,e.target.getLatLng()),i=this._rotationStartPoint,r=this._rotationOriginPoint,n=Math.atan2(t.y-r.y,t.x-r.x)-Math.atan2(i.y-r.y,i.x-r.x);this._layer.setLatLngs(this._rotateLayer(n,this._initialRotateLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let a=this;function s(x,_=[],T=-1){if(T>-1&&_.push(T),L.Util.isArray(x[0]))x.forEach((j,z)=>s(j,_.slice(),z));else{let j=_.length>0?(0,co.default)(a._markers,_):a._markers[0];x.forEach((z,q)=>{j[q].setLatLng(z)})}}s(this._layer.getLatLngs());let o=Xe(this._rotationLayer);this._rotationLayer.setLatLngs(this._rotateLayer(n,this._rotationLayer.pm._rotateOrgLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let h=n*180/Math.PI;h=h<0?h+360:h;let c=h+this._startAngle;this._setAngle(c),this._rotationLayer.pm._setAngle(c),this._fireRotation(this._rotationLayer,h,o),this._fireRotation(this._map,h,o),this._rotationLayer.pm._fireChange(this._rotationLayer.getLatLngs(),"Rotation")},_onRotateEnd(){let e=this._startAngle;delete this._rotationOriginLatLng,delete this._rotationOriginPoint,delete this._rotationStartPoint,delete this._initialRotateLatLng,delete this._startAngle;let t=Xe(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._rotationLayer.pm._rotateOrgLatLng=Xe(this._rotationLayer),this._fireRotationEnd(this._rotationLayer,e,t),this._fireRotationEnd(this._map,e,t),this._rotationLayer.pm._fireEdit(this._rotationLayer,"Rotation"),this._preventRenderingMarkers(!1),this._layerRotated=!0},_rotateLayer(e,t,i,r,n){let a=Qi(n,i);return this._matrix=r.clone().rotate(e,a).flip(),Ya(t,this._matrix,n)},_setAngle(e){e=e<0?e+360:e,this._angle=e%360},_getRotationCenter(){if(this._rotationCenter)return this._rotationCenter;let e=L.polygon(this._layer.getLatLngs(),{stroke:!1,fill:!1,pmIgnore:!0}).addTo(this._layer._map),t=e.getCenter();return e.removeFrom(this._layer._map),t},enableRotate(){if(!this.options.allowRotation){this.disableRotate();return}this.rotateEnabled()&&this.disableRotate(),this._layer instanceof L.Rectangle&&this._angle===void 0&&this.setInitAngle(Tt(this._layer._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let e={fill:!1,stroke:!1,pmIgnore:!1,snapIgnore:!0};this._rotatePoly=L.polygon(this._layer.getLatLngs(),e),this._rotatePoly._pmTempLayer=!0,this._rotatePoly.addTo(this._layer._map),this._rotatePoly.pm._setAngle(this.getAngle()),this._rotatePoly.pm.setRotationCenter(this.getRotationCenter()),this._rotatePoly.pm.setOptions(this._layer._map.pm.getGlobalOptions()),this._rotatePoly.pm.setOptions({rotate:!0,snappable:!1,hideMiddleMarkers:!0}),this._rotatePoly.pm._rotationLayer=this._layer,this._rotatePoly.pm.enable(),this._rotateOrgLatLng=Xe(this._layer),this._rotateEnabled=!0,this._layer.on("remove",this.disableRotate,this),this._fireRotationEnable(this._layer),this._fireRotationEnable(this._layer._map)},disableRotate(){this.rotateEnabled()&&(this._rotatePoly.pm._layerRotated&&this._fireUpdate(),this._rotatePoly.pm._layerRotated=!1,this._rotatePoly.pm.disable(),this._rotatePoly.remove(),this._rotatePoly.pm.setOptions({rotate:!1}),this._rotatePoly=void 0,this._rotateOrgLatLng=void 0,this._layer.off("remove",this.disableRotate,this),this._rotateEnabled=!1,this._fireRotationDisable(this._layer),this._fireRotationDisable(this._layer._map))},rotateEnabled(){return!!this._rotateEnabled},rotateLayer(e){let t=this.getAngle(),i=this._layer.getLatLngs(),r=e*(Math.PI/180);this._layer.setLatLngs(this._rotateLayer(r,this._layer.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._layer._map)),this._rotateOrgLatLng=L.polygon(this._layer.getLatLngs()).getLatLngs(),this._setAngle(this.getAngle()+e),this.rotateEnabled()&&this._rotatePoly&&this._rotatePoly.pm.enabled()&&(this._rotatePoly.setLatLngs(this._rotateLayer(r,this._rotatePoly.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._rotatePoly._map)),this._rotatePoly.pm._initMarkers());let n=this.getAngle()-t;n=n<0?n+360:n,this._startAngle=t,this._fireRotation(this._layer,n,i,this._layer),this._fireRotation(this._map||this._layer._map,n,i,this._layer),delete this._startAngle,this._fireChange(this._layer.getLatLngs(),"Rotation")},rotateLayerToAngle(e){let t=e-this.getAngle();this.rotateLayer(t)},getAngle(){return this._angle||0},setInitAngle(e){this._setAngle(e)},getRotationCenter(){return this._getRotationCenter()},setRotationCenter(e){this._rotationCenter=e,this._rotatePoly&&this._rotatePoly.pm.setRotationCenter(e)}},go=fo,mo=L.Class.extend({includes:[ho,Ci,go,ri],options:{snappable:!0,snapDistance:20,allowSelfIntersection:!0,allowSelfIntersectionEdit:!1,preventMarkerRemoval:!1,removeLayerBelowMinVertexCount:!0,limitMarkersToCount:-1,hideMiddleMarkers:!1,snapSegment:!0,syncLayersOnDrag:!1,draggable:!0,allowEditing:!0,allowRemoval:!0,allowCutting:!0,allowRotation:!0,addVertexOn:"click",removeVertexOn:"contextmenu",removeVertexValidation:void 0,addVertexValidation:void 0,moveVertexValidation:void 0,resizeableCircleMarker:!1,resizeableCircle:!0,snapMiddle:!1,snapVertex:!0},setOptions(e){L.Util.setOptions(this,e)},getOptions(){return this.options},applyOptions(){},isPolygon(){return this._layer instanceof L.Polygon},getShape(){return this._shape},_setPane(e,t){t==="layerPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":t==="vertexPane"?e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":t==="markerPane"&&(e.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},remove(){(this._map||this._layer._map).pm.removeLayer({target:this._layer})},_vertexValidation(e,t){let i=t.target,r={layer:this._layer,marker:i,event:t},n="";return e==="move"?n="moveVertexValidation":e==="add"?n="addVertexValidation":e==="remove"&&(n="removeVertexValidation"),this.options[n]&&typeof this.options[n]=="function"&&!this.options[n](r)?(e==="move"&&(i._cancelDragEventChain=i.getLatLng()),!1):(i._cancelDragEventChain=null,!0)},_vertexValidationDrag(e){return e._cancelDragEventChain?(e._latlng=e._cancelDragEventChain,e.update(),!1):!0},_vertexValidationDragEnd(e){return e._cancelDragEventChain?(e._cancelDragEventChain=null,!1):!0}}),Ne=mo;Ne.LayerGroup=L.Class.extend({initialize(e){this._layerGroup=e,this._layers=this.getLayers(),this._getMap(),this._layers.forEach(r=>this._initLayer(r));let t=r=>{if(r.layer._pmTempLayer)return;this._layers=this.getLayers();let n=this._layers.filter(a=>!a.pm._parentLayerGroup||!(this._layerGroup._leaflet_id in a.pm._parentLayerGroup));n.forEach(a=>{this._initLayer(a)}),n.length>0&&this._getMap()&&this._getMap().pm.globalEditModeEnabled()&&this.enabled()&&this.enable(this.getOptions())};this._layerGroup.on("layeradd",L.Util.throttle(t,100,this),this),this._layerGroup.on("layerremove",r=>{this._removeLayerFromGroup(r.target)},this);let i=r=>{r.target._pmTempLayer||(this._layers=this.getLayers())};this._layerGroup.on("layerremove",L.Util.throttle(i,100,this),this)},enable(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this._options=e,this._layers.forEach(i=>{i instanceof L.LayerGroup?t.indexOf(i._leaflet_id)===-1&&(t.push(i._leaflet_id),i.pm.enable(e,t)):i.pm.enable(e)})},disable(e=[]){e.length===0&&(this._layers=this.getLayers()),this._layers.forEach(t=>{t instanceof L.LayerGroup?e.indexOf(t._leaflet_id)===-1&&(e.push(t._leaflet_id),t.pm.disable(e)):t.pm.disable()})},enabled(e=[]){return e.length===0&&(this._layers=this.getLayers()),!!this._layers.find(t=>t instanceof L.LayerGroup?e.indexOf(t._leaflet_id)===-1?(e.push(t._leaflet_id),t.pm.enabled(e)):!1:t.pm.enabled())},toggleEdit(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this._options=e,this._layers.forEach(i=>{i instanceof L.LayerGroup?t.indexOf(i._leaflet_id)===-1&&(t.push(i._leaflet_id),i.pm.toggleEdit(e,t)):i.pm.toggleEdit(e)})},_initLayer(e){let t=L.Util.stamp(this._layerGroup);e.pm._parentLayerGroup||(e.pm._parentLayerGroup={}),e.pm._parentLayerGroup[t]=this._layerGroup},_removeLayerFromGroup(e){if(e.pm&&e.pm._layerGroup){let t=L.Util.stamp(this._layerGroup);delete e.pm._layerGroup[t]}},dragging(){return this._layers=this.getLayers(),this._layers?!!this._layers.find(e=>e.pm.dragging()):!1},getOptions(){return this.options},_getMap(){return this._map||this._layers.find(e=>!!e._map)?._map||null},getLayers(e=!1,t=!0,i=!0,r=[]){let n=[];return e?this._layerGroup.getLayers().forEach(a=>{n.push(a),a instanceof L.LayerGroup&&r.indexOf(a._leaflet_id)===-1&&(r.push(a._leaflet_id),n=n.concat(a.pm.getLayers(!0,!0,!0,r)))}):n=this._layerGroup.getLayers(),i&&(n=n.filter(a=>!(a instanceof L.LayerGroup))),t&&(n=n.filter(a=>!!a.pm),n=n.filter(a=>!a._pmTempLayer),n=n.filter(a=>!L.PM.optIn&&!a.options.pmIgnore||L.PM.optIn&&a.options.pmIgnore===!1)),n},setOptions(e,t=[]){t.length===0&&(this._layers=this.getLayers()),this.options=e,this._layers.forEach(i=>{i.pm&&(i instanceof L.LayerGroup?t.indexOf(i._leaflet_id)===-1&&(t.push(i._leaflet_id),i.pm.setOptions(e,t)):i.pm.setOptions(e))})}}),Ne.Marker=Ne.extend({_shape:"Marker",initialize(e){this._layer=e,this._enabled=!1,this._layer.on("dragend",this._onDragEnd,this)},enable(e={draggable:!0}){if(L.Util.setOptions(this,e),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._fireEnable()},disable(){this.enabled()&&(this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this._layer.off("contextmenu",this._removeMarker,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1)},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this.options.draggable?this.enableLayerDrag():this.disableLayerDrag(),this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_removeMarker(e){let t=e.target;t.remove(),this._fireRemove(t),this._fireRemove(this._map,t)},_onDragEnd(){this._fireEdit(),this._layerEdited=!0},_initSnappableMarkers(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)}});var oi=Se(_i()),yo={filterMarkerGroup(){this.markerCache=[],this.createCache(),this._layer.on("pm:edit",this.createCache,this),this.applyLimitFilters({}),this.throttledApplyLimitFilters||(this.throttledApplyLimitFilters=L.Util.throttle(this.applyLimitFilters,100,this)),this._layer.on("pm:disable",this._removeMarkerLimitEvents,this),this._layer.on("remove",this._removeMarkerLimitEvents,this),this.options.limitMarkersToCount>-1&&(this._layer.on("pm:vertexremoved",this._initMarkers,this),this._map.on("mousemove",this.throttledApplyLimitFilters,this))},_removeMarkerLimitEvents(){this._map.off("mousemove",this.throttledApplyLimitFilters,this),this._layer.off("pm:edit",this.createCache,this),this._layer.off("pm:disable",this._removeMarkerLimitEvents,this),this._layer.off("pm:vertexremoved",this._initMarkers,this)},createCache(){let e=[...this._markerGroup.getLayers(),...this.markerCache];this.markerCache=e.filter((t,i,r)=>r.indexOf(t)===i)},_removeFromCache(e){let t=this.markerCache.indexOf(e);t>-1&&this.markerCache.splice(t,1)},renderLimits(e){this.markerCache.forEach(t=>{e.includes(t)?this._markerGroup.addLayer(t):this._markerGroup.removeLayer(t)})},applyLimitFilters({latlng:e={lat:0,lng:0}}){if(this._preventRenderMarkers)return;let t=[...this._filterClosestMarkers(e)];this.renderLimits(t)},_filterClosestMarkers(e){let t=[...this.markerCache],i=this.options.limitMarkersToCount;return i===-1?t:(t.sort((r,n)=>{let a=r._latlng.distanceTo(e),s=n._latlng.distanceTo(e);return a-s}),t.filter((r,n)=>i>-1?n<i:!0))},_preventRenderMarkers:!1,_preventRenderingMarkers(e){this._preventRenderMarkers=!!e}},_o=yo;Ne.Line=Ne.extend({includes:[_o],_shape:"Line",initialize(e){this._layer=e,this._enabled=!1},enable(e){if(L.Util.setOptions(this,e),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()&&this.disable(),this._enabled=!0,this._initMarkers(),this.applyOptions(),this._layer.on("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.on("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this),this.options.allowSelfIntersection?this.cachedColor=void 0:(this._layer.options.color!=="#f00000ff"?(this.cachedColor=this._layer.options.color,this.isRed=!1):this.isRed=!0,this._handleLayerStyle()),this._fireEnable()}},disable(){if(!this.enabled()||this._dragging)return;this._enabled=!1,this._markerGroup.clearLayers(),this._markerGroup.removeFrom(this._map),this._layer.off("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.off("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this);let e=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(e,"leaflet-pm-draggable"),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()},enabled(){return this._enabled},toggleEdit(e){return this.enabled()?this.disable():this.enable(e),this.enabled()},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initMarkers(){let e=this._map,t=this._layer.getLatLngs();this._markerGroup&&(this._markerGroup.removeFrom(e),this._markerGroup.clearLayers()),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0;let i=r=>{if(Array.isArray(r[0]))return r.map(i,this);let n=r.map(this._createMarker,this);return this.options.hideMiddleMarkers!==!0&&r.map((a,s)=>{let o=this.isPolygon()?(s+1)%r.length:s+1;return this._createMiddleMarker(n[s],n[o])}),n};this._markers=i(t),this.filterMarkerGroup(),e.addLayer(this._markerGroup)},_createMarker(e){let t=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._pmTempLayer=!0,this.options.rotate?(t.on("dragstart",this._onRotateStart,this),t.on("drag",this._onRotate,this),t.on("dragend",this._onRotateEnd,this)):(t.on("click",this._onVertexClick,this),t.on("dragstart",this._onMarkerDragStart,this),t.on("move",this._onMarkerDrag,this),t.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||t.on(this.options.removeVertexOn,this._removeMarker,this)),this._markerGroup.addLayer(t),t},_createMiddleMarker(e,t){if(!e||!t)return!1;let i=L.PM.Utils.calcMiddleLatLng(this._map,e.getLatLng(),t.getLatLng()),r=this._createMarker(i),n=L.divIcon({className:"marker-icon marker-icon-middle"});return r.setIcon(n),r.leftM=e,r.rightM=t,e._middleMarkerNext=r,t._middleMarkerPrev=r,r.on(this.options.addVertexOn,this._onMiddleMarkerClick,this),r.on("movestart",this._onMiddleMarkerMoveStart,this),r},_onMiddleMarkerClick(e){let t=e.target;if(!this._vertexValidation("add",e))return;let i=L.divIcon({className:"marker-icon"});t.setIcon(i),this._addMarker(t,t.leftM,t.rightM)},_onMiddleMarkerMoveStart(e){let t=e.target;if(t.on("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidation("add",e)){t.on("move",this._onMiddleMarkerMovePrevent,this);return}t._dragging=!0,this._addMarker(t,t.leftM,t.rightM)},_onMiddleMarkerMovePrevent(e){let t=e.target;this._vertexValidationDrag(t)},_onMiddleMarkerMoveEnd(e){let t=e.target;if(t.off("move",this._onMiddleMarkerMovePrevent,this),t.off("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidationDragEnd(t))return;let i=L.divIcon({className:"marker-icon"});t.setIcon(i),setTimeout(()=>{delete t._dragging},100)},_addMarker(e,t,i){e.off("movestart",this._onMiddleMarkerMoveStart,this),e.off(this.options.addVertexOn,this._onMiddleMarkerClick,this);let r=e.getLatLng(),n=this._layer._latlngs;delete e.leftM,delete e.rightM;let{indexPath:a,index:s,parentPath:o}=L.PM.Utils.findDeepMarkerIndex(this._markers,t),h=a.length>1?(0,oi.default)(n,o):n,c=a.length>1?(0,oi.default)(this._markers,o):this._markers;h.splice(s+1,0,r),c.splice(s+1,0,e),this._layer.setLatLngs(n),this.options.hideMiddleMarkers!==!0&&(this._createMiddleMarker(t,e),this._createMiddleMarker(e,i)),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit"),this._fireVertexAdded(e,L.PM.Utils.findDeepMarkerIndex(this._markers,e).indexPath,r),this.options.snappable&&this._initSnappableMarkers()},hasSelfIntersection(){return ki(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersectionOnVertexRemoval(){this._handleLayerStyle(!0)&&(this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers())},_handleLayerStyle(e){let t=this._layer,i,r;if(this.options.allowSelfIntersection?i=!1:(r=ki(this._layer.toGeoJSON(15)),i=r.features.length>0),i){if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!0),this.isRed)return i;e?this._flashLayer():(t.setStyle({color:"#f00000ff"}),this.isRed=!0),this._fireIntersect(r)}else t.setStyle({color:this.cachedColor}),this.isRed=!1,!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!1);return i},_flashLayer(){this.cachedColor||(this.cachedColor=this._layer.options.color),this._layer.setStyle({color:"#f00000ff"}),this.isRed=!0,window.setTimeout(()=>{this._layer.setStyle({color:this.cachedColor}),this.isRed=!1},200)},_updateDisabledMarkerStyle(e,t){e.forEach(i=>{Array.isArray(i)?this._updateDisabledMarkerStyle(i,t):i._icon&&(t&&!this._checkMarkerAllowedToDrag(i)?L.DomUtil.addClass(i._icon,"vertexmarker-disabled"):L.DomUtil.removeClass(i._icon,"vertexmarker-disabled"))})},_removeMarker(e){let t=e.target;if(!this._vertexValidation("remove",e))return;this.options.allowSelfIntersection||(this._coordsBeforeEdit=Xe(this._layer,this._layer.getLatLngs()));let i=this._layer.getLatLngs(),{indexPath:r,index:n,parentPath:a}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);if(!r)return;let s=r.length>1?(0,oi.default)(i,a):i,o=r.length>1?(0,oi.default)(this._markers,a):this._markers,h=a[a.length-1]>0&&this._layer instanceof L.Polygon;if(!this.options.removeLayerBelowMinVertexCount&&!h&&(s.length<=2||this.isPolygon()&&s.length<=3)){this._flashLayer();return}s.splice(n,1),this._layer.setLatLngs(i),this.isPolygon()&&s.length<=2&&s.splice(0,s.length);let c=!1;if(s.length<=1&&(s.splice(0,s.length),a.length>1&&r.length>1&&(i=Zi(i)),this._layer.setLatLngs(i),this._initMarkers(),c=!0),Wt(i)||this._layer.remove(),i=Zi(i),this._layer.setLatLngs(i),this._markers=Zi(this._markers),!c&&(o=r.length>1?(0,oi.default)(this._markers,a):this._markers,t._middleMarkerPrev&&(this._markerGroup.removeLayer(t._middleMarkerPrev),this._removeFromCache(t._middleMarkerPrev)),t._middleMarkerNext&&(this._markerGroup.removeLayer(t._middleMarkerNext),this._removeFromCache(t._middleMarkerNext)),this._markerGroup.removeLayer(t),this._removeFromCache(t),o)){let x,_;if(this.isPolygon()?(x=(n+1)%o.length,_=(n+(o.length-1))%o.length):(_=n-1<0?void 0:n-1,x=n+1>=o.length?void 0:n+1),x!==_){let T=o[_],j=o[x];this.options.hideMiddleMarkers!==!0&&this._createMiddleMarker(T,j)}o.splice(n,1)}this._fireEdit(),this._layerEdited=!0,this._fireVertexRemoved(t,r),this._fireChange(this._layer.getLatLngs(),"Edit")},updatePolygonCoordsFromMarkerDrag(e){let t=this._layer.getLatLngs(),i=e.getLatLng(),{indexPath:r,index:n,parentPath:a}=L.PM.Utils.findDeepMarkerIndex(this._markers,e);(r.length>1?(0,oi.default)(t,a):t).splice(n,1,i),this._layer.setLatLngs(t)},_getNeighborMarkers(e){let{indexPath:t,index:i,parentPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,e),n=t.length>1?(0,oi.default)(this._markers,r):this._markers,a=(i+1)%n.length,s=(i+(n.length-1))%n.length,o=n[s],h=n[a];return{prevMarker:o,nextMarker:h}},_checkMarkerAllowedToDrag(e){let{prevMarker:t,nextMarker:i}=this._getNeighborMarkers(e),r=L.polyline([t.getLatLng(),e.getLatLng()]),n=L.polyline([e.getLatLng(),i.getLatLng()]),a=Mi(this._layer.toGeoJSON(15),r.toGeoJSON(15)).features.length,s=Mi(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length;return e.getLatLng()===this._markers[0][0].getLatLng()?s+=1:e.getLatLng()===this._markers[0][this._markers[0].length-1].getLatLng()&&(a+=1),!(a<=2&&s<=2)},_onMarkerDragStart(e){let t=e.target;if(this.cachedColor||(this.cachedColor=this._layer.options.color),!this._vertexValidation("move",e))return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragStart(e,i),this.options.allowSelfIntersection||(this._coordsBeforeEdit=Xe(this._layer,this._layer.getLatLngs())),!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()?this._markerAllowedToDrag=this._checkMarkerAllowedToDrag(t):this._markerAllowedToDrag=null},_onMarkerDrag(e){let t=e.target;if(!this._vertexValidationDrag(t))return;let{indexPath:i,index:r,parentPath:n}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);if(!i)return;if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()&&this._markerAllowedToDrag===!1){this._layer.setLatLngs(this._coordsBeforeEdit),this._initMarkers(),this._handleLayerStyle();return}this.updatePolygonCoordsFromMarkerDrag(t);let a=i.length>1?(0,oi.default)(this._markers,n):this._markers,s=(r+1)%a.length,o=(r+(a.length-1))%a.length,h=t.getLatLng(),c=a[o].getLatLng(),x=a[s].getLatLng();if(t._middleMarkerNext){let _=L.PM.Utils.calcMiddleLatLng(this._map,h,x);t._middleMarkerNext.setLatLng(_)}if(t._middleMarkerPrev){let _=L.PM.Utils.calcMiddleLatLng(this._map,h,c);t._middleMarkerPrev.setLatLng(_)}this.options.allowSelfIntersection||this._handleLayerStyle(),this._fireMarkerDrag(e,i),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(e){let t=e.target;if(!this._vertexValidationDragEnd(t))return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t),r=!this.options.allowSelfIntersection&&this.hasSelfIntersection();r&&this.options.allowSelfIntersectionEdit&&this._markerAllowedToDrag&&(r=!1);let n=!this.options.allowSelfIntersection&&r;if(this._fireMarkerDragEnd(e,i,n),n){this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers(),this.options.snappable&&this._initSnappableMarkers(),this._handleLayerStyle(),this._fireLayerReset(e,i);return}!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._handleLayerStyle(),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_onVertexClick(e){let t=e.target;if(t._dragging)return;let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireVertexClick(e,i)}}),Ne.Polygon=Ne.Line.extend({_shape:"Polygon",_checkMarkerAllowedToDrag(e){let{prevMarker:t,nextMarker:i}=this._getNeighborMarkers(e),r=L.polyline([t.getLatLng(),e.getLatLng()]),n=L.polyline([e.getLatLng(),i.getLatLng()]),a=Mi(this._layer.toGeoJSON(15),r.toGeoJSON(15)).features.length,s=Mi(this._layer.toGeoJSON(15),n.toGeoJSON(15)).features.length;return!(a<=2&&s<=2)}}),Ne.Rectangle=Ne.Polygon.extend({_shape:"Rectangle",_initMarkers(){let e=this._map,t=this._findCorners();this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0,e.addLayer(this._markerGroup),this._markers=[],this._markers[0]=t.map(this._createMarker,this),[this._cornerMarkers]=this._markers,this._layer.getLatLngs()[0].forEach((i,r)=>{let n=this._cornerMarkers.find(a=>a._index===r);n&&n.setLatLng(i)})},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this._addMarkerEvents()},_createMarker(e,t){let i=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(i,"vertexPane"),i._origLatLng=e,i._index=t,i._pmTempLayer=!0,i.on("click",this._onVertexClick,this),this._markerGroup.addLayer(i),i},_addMarkerEvents(){this._markers[0].forEach(e=>{e.on("dragstart",this._onMarkerDragStart,this),e.on("drag",this._onMarkerDrag,this),e.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||e.on("contextmenu",this._removeMarker,this)})},_removeMarker(){return null},_onMarkerDragStart(e){if(!this._vertexValidation("move",e))return;let t=e.target,i=this._cornerMarkers;t._oppositeCornerLatLng=i.find(n=>n._index===(t._index+2)%4).getLatLng(),t._snapped=!1;let{indexPath:r}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragStart(e,r)},_onMarkerDrag(e){let t=e.target;if(!this._vertexValidationDrag(t)||t._index===void 0)return;this._adjustRectangleForMarkerMove(t);let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDrag(e,i),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(e){let t=e.target;if(!this._vertexValidationDragEnd(t))return;this._cornerMarkers.forEach(r=>{delete r._oppositeCornerLatLng});let{indexPath:i}=L.PM.Utils.findDeepMarkerIndex(this._markers,t);this._fireMarkerDragEnd(e,i),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_adjustRectangleForMarkerMove(e){L.extend(e._origLatLng,e._latlng);let t=L.PM.Utils._getRotatedRectangle(e.getLatLng(),e._oppositeCornerLatLng,this.getAngle(),this._map);this._layer.setLatLngs(t),this._adjustAllMarkers(e),this._layer.redraw()},_adjustAllMarkers(e){let t=this._layer.getLatLngs()[0];if(t&&t.length!==4&&t.length>0)t.forEach((i,r)=>{this._cornerMarkers[r].setLatLng(i)}),this._cornerMarkers.slice(t.length).forEach(i=>{i.setLatLng(t[0])});else if(!t||!t.length)console.error("The layer has no LatLngs");else{let i=t.findIndex(r=>e.getLatLng().equals(r));i>-1?(this._cornerMarkers[(e._index+1)%4].setLatLng(t[(i+1)%4]),this._cornerMarkers[(e._index+2)%4].setLatLng(t[(i+2)%4]),this._cornerMarkers[(e._index+3)%4].setLatLng(t[(i+3)%4])):this._cornerMarkers.forEach(r=>{r.setLatLng(t[r._index])})}},_findCorners(){this._angle===void 0&&this.setInitAngle(Tt(this._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let e=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(e[0],e[2],this.getAngle(),this._map||this)}}),Ne.CircleMarker=Ne.extend({_shape:"CircleMarker",initialize(e){this._layer=e,this._enabled=!1,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._updateHiddenPolyCircle()},enable(e={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,e),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._extendingEnable(),this._updateHiddenPolyCircle(),this._fireEnable()},_extendingEnable(){this._layer.on("pm:dragstart",this._onDragStart,this),this._layer.on("pm:drag",this._onMarkerDrag,this),this._layer.on("pm:dragend",this._onMarkerDragEnd,this)},disable(){this.dragging()||(this._map||(this._map=this._layer._map),this._map&&this.enabled()&&(this.layerDragEnabled()&&this.disableLayerDrag(),this._helperLayers&&(this._helperLayers.clearLayers(),this._helperLayers.removeFrom(this._map)),this.options[this._editableOption]?(this._map.off("move",this._syncMarkers,this),this._outerMarker.off("drag",this._handleOuterMarkerSnapping,this)):this._map.off("move",this._updateHiddenPolyCircle,this),this._extendingDisable(),this._layer.off("remove",this.disable,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1))},_extendingDisable(){this._layer.off("contextmenu",this._removeMarker,this)},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options[this._editableOption]?(this._initMarkers(),this._map.on("move",this._syncMarkers,this),this.options.snappable?(this._initSnappableMarkers(),this._outerMarker.on("drag",this._handleOuterMarkerSnapping,this),this._outerMarker.on("move",this._syncHintLine,this),this._outerMarker.on("move",this._syncCircleRadius,this)):this._disableSnapping()):(this.options.draggable&&this.enableLayerDrag(),this._map.on("move",this._updateHiddenPolyCircle,this),this.options.snappable?this._initSnappableMarkersDrag():this._disableSnappingDrag()),this._extendingApplyOptions()},_extendingApplyOptions(){this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_initMarkers(){let e=this._map;this._helperLayers&&(this._helperLayers.removeFrom(e),this._helperLayers.clearLayers()),this._helperLayers=new L.FeatureGroup,this._helperLayers._pmTempLayer=!0,this._helperLayers.addTo(e);let t=this._layer.getLatLng(),i=this._layer._radius,r=this._getLatLngOnCircle(t,i);this._centerMarker=this._createCenterMarker(t),this._outerMarker=this._createOuterMarker(r),this._markers=[this._centerMarker,this._outerMarker],this._createHintLine(this._centerMarker,this._outerMarker)},_getLatLngOnCircle(e,t){let i=this._map.project(e),r=L.point(i.x+t,i.y);return this._map.unproject(r)},_createHintLine(e,t){let i=e.getLatLng(),r=t.getLatLng();this._hintline=L.polyline([i,r],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._helperLayers.addLayer(this._hintline)},_createCenterMarker(e){let t=this._createMarker(e);return this.options.draggable?(L.DomUtil.addClass(t._icon,"leaflet-pm-draggable"),t.on("move",this._moveCircle,this)):t.dragging.disable(),t},_createOuterMarker(e){let t=this._createMarker(e);return t.on("drag",this._resizeCircle,this),t},_createMarker(e){let t=new L.Marker(e,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(t,"vertexPane"),t._origLatLng=e,t._pmTempLayer=!0,t.on("dragstart",this._onMarkerDragStart,this),t.on("drag",this._onMarkerDrag,this),t.on("dragend",this._onMarkerDragEnd,this),t.on("click",this._onVertexClick,this),this._helperLayers.addLayer(t),t},_moveCircle(e){if(e.target._cancelDragEventChain)return;let t=this._centerMarker.getLatLng();this._layer.setLatLng(t);let i=this._layer._radius,r=this._getLatLngOnCircle(t,i);this._outerMarker._latlng=r,this._outerMarker.update(),this._syncHintLine(),this._updateHiddenPolyCircle(),this._fireCenterPlaced("Edit"),this._fireChange(this._layer.getLatLng(),"Edit")},_syncMarkers(){let e=this._layer.getLatLng(),t=this._layer._radius,i=this._getLatLngOnCircle(e,t);this._outerMarker.setLatLng(i),this._centerMarker.setLatLng(e),this._syncHintLine(),this._updateHiddenPolyCircle()},_resizeCircle(){this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker()),this._syncHintLine(),this._syncCircleRadius()},_syncCircleRadius(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),i=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(i),this._updateHiddenPolyCircle(),this._fireChange(this._layer.getLatLng(),"Edit")},_syncHintLine(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng();this._hintline.setLatLngs([e,t])},_removeMarker(){this.options[this._editableOption]&&this.disable(),this._layer.remove(),this._fireRemove(this._layer),this._fireRemove(this._map,this._layer)},_onDragStart(){this._map.pm.Draw.CircleMarker._layerIsDragging=!0},_onMarkerDragStart(e){this._vertexValidation("move",e)&&this._fireMarkerDragStart(e)},_onMarkerDrag(e){let t=e.target;t instanceof L.Marker&&!this._vertexValidationDrag(t)||this._fireMarkerDrag(e)},_onMarkerDragEnd(e){this._extedingMarkerDragEnd();let t=e.target;this._vertexValidationDragEnd(t)&&(this.options[this._editableOption]&&(this._fireEdit(),this._layerEdited=!0),this._fireMarkerDragEnd(e))},_extedingMarkerDragEnd(){this._map.pm.Draw.CircleMarker._layerIsDragging=!1},_initSnappableMarkersDrag(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnappingDrag(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)},_updateHiddenPolyCircle(){let e=this._layer._map||this._map;if(e){let t=L.PM.Utils.pxRadiusToMeterRadius(this._layer.getRadius(),e,this._layer.getLatLng()),i=L.circle(this._layer.getLatLng(),this._layer.options);i.setRadius(t);let r=e&&e.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(i,200,!r).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(i,200,!r),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)}},_getNewDestinationOfOuterMarker(){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),i=this._distanceCalculation(e,t);return this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?t=Li(this._map,e,t,this._getMinDistanceInMeter(e)):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&(t=Li(this._map,e,t,this._getMaxDistanceInMeter(e))),t},_handleOuterMarkerSnapping(){if(this._outerMarker._snapped){let e=this._centerMarker.getLatLng(),t=this._outerMarker.getLatLng(),i=this._distanceCalculation(e,t);this.options[this._minRadiusOption]&&i<this.options[this._minRadiusOption]?this._outerMarker.setLatLng(this._outerMarker._orgLatLng):this.options[this._maxRadiusOption]&&i>this.options[this._maxRadiusOption]&&this._outerMarker.setLatLng(this._outerMarker._orgLatLng)}this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker())},_distanceCalculation(e,t){return this._map.project(e).distanceTo(this._map.project(t))},_getMinDistanceInMeter(e){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,e)},_getMaxDistanceInMeter(e){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,e)},_onVertexClick(e){e.target._dragging||this._fireVertexClick(e,void 0)}}),Ne.Circle=Ne.CircleMarker.extend({_shape:"Circle",initialize(e){this._layer=e,this._enabled=!1,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizeableCircle",this._updateHiddenPolyCircle()},enable(e){L.PM.Edit.CircleMarker.prototype.enable.call(this,e||{})},_extendingEnable(){},_extendingDisable(){this._layer.off("remove",this.disable,this);let e=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(e,"leaflet-pm-draggable")},_extendingApplyOptions(){},_syncMarkers(){},_removeMarker(){},_onDragStart(){},_extedingMarkerDragEnd(){},_updateHiddenPolyCircle(){let e=this._map&&this._map.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(this._layer,200,!e).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(this._layer,200,!e),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)},_distanceCalculation(e,t){return this._map.distance(e,t)},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_onVertexClick(e){e.target._dragging||this._fireVertexClick(e,void 0)}}),Ne.ImageOverlay=Ne.extend({_shape:"ImageOverlay",initialize(e){this._layer=e,this._enabled=!1},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},enabled(){return this._enabled},enable(e={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,e),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()||this.disable(),this.enableLayerDrag(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._otherSnapLayers=this._findCorners(),this._fireEnable()}},disable(){this._dragging||(this._map||(this._map=this._layer._map),this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this.enabled()||(this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()),this._enabled=!1)},_findCorners(){let e=this._layer.getBounds(),t=e.getNorthWest(),i=e.getNorthEast(),r=e.getSouthEast(),n=e.getSouthWest();return[t,i,r,n]}}),Ne.Text=Ne.extend({_shape:"Text",initialize(e){this._layer=e,this._enabled=!1},enable(e){if(L.Util.setOptions(this,e),!!this.textArea){if(!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._safeToCacheDragState=!0,this._focusChange(),this.textArea.readOnly=!1,this.textArea.classList.remove("pm-disabled"),this._layer.on("remove",this.disable,this),L.DomEvent.on(this.textArea,"input",this._autoResize,this),L.DomEvent.on(this.textArea,"focus",this._focusChange,this),L.DomEvent.on(this.textArea,"blur",this._focusChange,this),this._layer.on("dblclick",L.DomEvent.stop),L.DomEvent.off(this.textArea,"mousedown",this._preventTextSelection),this._enabled=!0,this._fireEnable()}},disable(){if(!this.enabled())return;this._layer.off("remove",this.disable,this),L.DomEvent.off(this.textArea,"input",this._autoResize,this),L.DomEvent.off(this.textArea,"focus",this._focusChange,this),L.DomEvent.off(this.textArea,"blur",this._focusChange,this),L.DomEvent.off(document,"click",this._documentClick,this),this._focusChange(),this.textArea.readOnly=!0,this.textArea.classList.add("pm-disabled");let e=document.activeElement;this.textArea.focus(),this.textArea.selectionStart=0,this.textArea.selectionEnd=0,L.DomEvent.on(this.textArea,"mousedown",this._preventTextSelection),e.focus(),this._disableOnBlurActive=!1,this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1},enabled(){return this._enabled},toggleEdit(e){this.enabled()?this.disable():this.enable(e)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initSnappableMarkers(){let e=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,e.off("pm:drag",this._handleSnapping,this),e.on("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.on("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this),e.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let e=this._layer;e.off("pm:drag",this._handleSnapping,this),e.off("pm:dragend",this._cleanupSnapping,this),e.off("pm:dragstart",this._unsnap,this)},_autoResize(){this.textArea.style.height="1px",this.textArea.style.width="1px";let e=this.textArea.scrollHeight>21?this.textArea.scrollHeight:21,t=this.textArea.scrollWidth>16?this.textArea.scrollWidth:16;this.textArea.style.height=`${e}px`,this.textArea.style.width=`${t}px`,this._layer.options.text=this.getText(),this._fireTextChange(this.getText())},_disableOnBlur(){this._disableOnBlurActive=!0,setTimeout(()=>{this.enabled()&&L.DomEvent.on(document,"click",this._documentClick,this)},100)},_documentClick(e){e.target!==this.textArea&&(this.disable(),!this.getText()&&this.options.removeIfEmpty&&this.remove())},_focusChange(e={}){let t=this._hasFocus;this._hasFocus=e.type==="focus",!t!=!this._hasFocus&&(this._hasFocus?(this._applyFocus(),this._focusText=this.getText(),this._fireTextFocus()):(this._removeFocus(),this._fireTextBlur(),this._focusText!==this.getText()&&(this._fireEdit(),this._layerEdited=!0)))},_applyFocus(){this.textArea.classList.add("pm-hasfocus"),this._map.dragging&&(this._safeToCacheDragState&&(this._originalMapDragState=this._map.dragging._enabled,this._safeToCacheDragState=!1),this._map.dragging.disable())},_removeFocus(){this._map.dragging&&(this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0),this.textArea.classList.remove("pm-hasfocus")},focus(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.focus()},blur(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.blur(),this._disableOnBlurActive&&this.disable()},hasFocus(){return this._hasFocus},getElement(){return this.textArea},setText(e){e&&(this.textArea.value=e),this._autoResize()},getText(){return this.textArea.value},_initTextMarker(){if(this.textArea=L.PM.Draw.Text.prototype._createTextArea.call(this),this.options.className){let t=this.options.className.split(" ");this.textArea.classList.add(...t)}let e=L.PM.Draw.Text.prototype._createTextIcon.call(this,this.textArea);this._layer.setIcon(e),this._layer.once("add",this._createTextMarker,this)},_createTextMarker(e=!1){this._layer.off("add",this._createTextMarker,this),this._layer.getElement().tabIndex=-1,this.textArea.wrap="off",this.textArea.style.overflow="hidden",this.textArea.style.height=L.DomUtil.getStyle(this.textArea,"font-size"),this.textArea.style.width="1px",this._layer.options.text&&this.setText(this._layer.options.text),this._autoResize(),e===!0&&(this.enable(),this.focus(),this._disableOnBlur())},_preventTextSelection(e){e.preventDefault()}});var ga=function(e,t,i,r,n,a){this._matrix=[e,t,i,r,n,a]};ga.init=()=>new L.PM.Matrix(1,0,0,1,0,0),ga.prototype={transform(e){return this._transform(e.clone())},_transform(e){let t=this._matrix,{x:i,y:r}=e;return e.x=t[0]*i+t[1]*r+t[4],e.y=t[2]*i+t[3]*r+t[5],e},untransform(e){let t=this._matrix;return new L.Point((e.x/t[0]-t[4])/t[0],(e.y/t[2]-t[5])/t[2])},clone(){let e=this._matrix;return new L.PM.Matrix(e[0],e[1],e[2],e[3],e[4],e[5])},translate(e){if(e===void 0)return new L.Point(this._matrix[4],this._matrix[5]);let t,i;return typeof e=="number"?(t=e,i=e):(t=e.x,i=e.y),this._add(1,0,0,1,t,i)},scale(e,t){if(e===void 0)return new L.Point(this._matrix[0],this._matrix[3]);let i,r;return t=t||L.point(0,0),typeof e=="number"?(i=e,r=e):(i=e.x,r=e.y),this._add(i,0,0,r,t.x,t.y)._add(1,0,0,1,-t.x,-t.y)},rotate(e,t){let i=Math.cos(e),r=Math.sin(e);return t=t||new L.Point(0,0),this._add(i,r,-r,i,t.x,t.y)._add(1,0,0,1,-t.x,-t.y)},flip(){return this._matrix[1]*=-1,this._matrix[2]*=-1,this},_add(e,t,i,r,n,a){let s=[[],[],[]],o=this._matrix,h=[[o[0],o[2],o[4]],[o[1],o[3],o[5]],[0,0,1]],c=[[e,i,n],[t,r,a],[0,0,1]],x;e&&e instanceof L.PM.Matrix&&(o=e._matrix,c=[[o[0],o[2],o[4]],[o[1],o[3],o[5]],[0,0,1]]);for(let _=0;_<3;_+=1)for(let T=0;T<3;T+=1){x=0;for(let j=0;j<3;j+=1)x+=h[_][j]*c[j][T];s[_][T]=x}return this._matrix=[s[0][0],s[1][0],s[0][1],s[1][1],s[0][2],s[1][2]],this}};var bo=ga,xo={calcMiddleLatLng(e,t,i){let r=e.project(t),n=e.project(i);return e.unproject(r._add(n)._divideBy(2))},findLayers(e){let t=[];return e.eachLayer(i=>{(i instanceof L.Polyline||i instanceof L.Marker||i instanceof L.Circle||i instanceof L.CircleMarker||i instanceof L.ImageOverlay)&&t.push(i)}),t=t.filter(i=>!!i.pm),t=t.filter(i=>!i._pmTempLayer),t=t.filter(i=>!L.PM.optIn&&!i.options.pmIgnore||L.PM.optIn&&i.options.pmIgnore===!1),t},circleToPolygon(e,t=60,i=!0){let r=e.getLatLng(),n=e.getRadius(),a=rn(r,n,t,0,i),s=[];for(let o=0;o<a.length;o+=1){let h=[a[o].lat,a[o].lng];s.push(h)}return L.polygon(s,e.options)},disablePopup(e){e.getPopup()&&(e._tempPopupCopy=e.getPopup(),e.unbindPopup())},enablePopup(e){e._tempPopupCopy&&(e.bindPopup(e._tempPopupCopy),delete e._tempPopupCopy)},_fireEvent(e,t,i,r=!1){e.fire(t,i,r);let{groups:n}=this.getAllParentGroups(e);n.forEach(a=>{a.fire(t,i,r)})},getAllParentGroups(e){let t=[],i=[],r=n=>{for(let a in n._eventParents)if(t.indexOf(a)===-1){t.push(a);let s=n._eventParents[a];i.push(s),r(s)}};return!e._pmLastGroupFetch||!e._pmLastGroupFetch.time||new Date().getTime()-e._pmLastGroupFetch.time>1e3?(r(e),e._pmLastGroupFetch={time:new Date().getTime(),groups:i,groupIds:t},{groupIds:t,groups:i}):{groups:e._pmLastGroupFetch.groups,groupIds:e._pmLastGroupFetch.groupIds}},createGeodesicPolygon:rn,getTranslation:oe,findDeepCoordIndex(e,t,i=!0){let r,n=s=>(o,h)=>{let c=s.concat(h);if(i){if(o.lat&&o.lat===t.lat&&o.lng===t.lng)return r=c,!0}else if(o.lat&&L.latLng(o).equals(t))return r=c,!0;return Array.isArray(o)&&o.some(n(c))};e.some(n([]));let a={};return r&&(a={indexPath:r,index:r[r.length-1],parentPath:r.slice(0,r.length-1)}),a},findDeepMarkerIndex(e,t){let i,r=a=>(s,o)=>{let h=a.concat(o);return s._leaflet_id===t._leaflet_id?(i=h,!0):Array.isArray(s)&&s.some(r(h))};e.some(r([]));let n={};return i&&(n={indexPath:i,index:i[i.length-1],parentPath:i.slice(0,i.length-1)}),n},_getIndexFromSegment(e,t){if(t&&t.length===2){let i=this.findDeepCoordIndex(e,t[0]),r=this.findDeepCoordIndex(e,t[1]),n=Math.max(i.index,r.index);return(i.index===0||r.index===0)&&n!==1&&(n+=1),{indexA:i,indexB:r,newIndex:n,indexPath:i.indexPath,parentPath:i.parentPath}}return null},_getRotatedRectangle(e,t,i,r){let n=Qi(r,e),a=Qi(r,t),s=i*Math.PI/180,o=Math.cos(s),h=Math.sin(s),c=(a.x-n.x)*o+(a.y-n.y)*h,x=(a.y-n.y)*o-(a.x-n.x)*h,_=c*o+n.x,T=c*h+n.y,j=-x*h+n.x,z=x*o+n.y,q=yn(r,n),X=yn(r,{x:_,y:T}),le=yn(r,a),b=yn(r,{x:j,y:z});return[q,X,le,b]},pxRadiusToMeterRadius(e,t,i){let r=t.project(i),n=L.point(r.x+e,r.y);return t.distance(t.unproject(n),i)}},vo=xo;L.PM=L.PM||{version:fr.version,Map:Yn,Toolbar:Jn,Draw:Te,Edit:Ne,Utils:vo,Matrix:bo,activeLang:"en",optIn:!1,initialize(e){this.addInitHooks(e)},setOptIn(e){this.optIn=!!e},addInitHooks(){function e(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Map(this)):this.options.pmIgnore||(this.pm=new L.PM.Map(this)),this.pm&&this.pm.setGlobalOptions({})}L.Map.addInitHook(e);function t(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.LayerGroup(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.LayerGroup(this))}L.LayerGroup.addInitHook(t);function i(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this)):this.options.pmIgnore||(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this))}L.Marker.addInitHook(i);function r(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.CircleMarker(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.CircleMarker(this))}L.CircleMarker.addInitHook(r);function n(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Line(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Line(this))}L.Polyline.addInitHook(n);function a(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Polygon(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Polygon(this))}L.Polygon.addInitHook(a);function s(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Rectangle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Rectangle(this))}L.Rectangle.addInitHook(s);function o(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Circle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Circle(this))}L.Circle.addInitHook(o);function h(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.ImageOverlay(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.ImageOverlay(this))}L.ImageOverlay.addInitHook(h)},reInitLayer(e){e instanceof L.LayerGroup&&e.eachLayer(t=>{this.reInitLayer(t)}),e.pm||L.PM.optIn&&e.options.pmIgnore!==!1||e.options.pmIgnore||(e instanceof L.Map?e.pm=new L.PM.Map(e):e instanceof L.Marker?e.options.textMarker?(e.pm=new L.PM.Edit.Text(e),e.pm._initTextMarker(),e.pm._createTextMarker(!1)):e.pm=new L.PM.Edit.Marker(e):e instanceof L.Circle?e.pm=new L.PM.Edit.Circle(e):e instanceof L.CircleMarker?e.pm=new L.PM.Edit.CircleMarker(e):e instanceof L.Rectangle?e.pm=new L.PM.Edit.Rectangle(e):e instanceof L.Polygon?e.pm=new L.PM.Edit.Polygon(e):e instanceof L.Polyline?e.pm=new L.PM.Edit.Line(e):e instanceof L.LayerGroup?e.pm=new L.PM.Edit.LayerGroup(e):e instanceof L.ImageOverlay&&(e.pm=new L.PM.Edit.ImageOverlay(e)))}},L.version==="1.7.1"&&L.Canvas.include({_onClick(e){let t=this._map.mouseEventToLayerPoint(e),i,r;for(let n=this._drawFirst;n;n=n.next)i=n.layer,i.options.interactive&&i._containsPoint(t)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(i))&&(r=i);r&&(L.DomEvent.fakeStop(e),this._fireEvent([r],e))}}),L.PM.initialize()})()),es}Do();function is(F){const W=new Date(F),Y=H=>String(H).padStart(2,"0");return`${W.getFullYear()}-${Y(W.getMonth()+1)}-${Y(W.getDate())}T${Y(W.getHours())}:${Y(W.getMinutes())}`}function La(F){if(!F)return"";const W=typeof F.toDate=="function"?F.toDate().getTime():F instanceof Date?F.getTime():F?.seconds?F.seconds*1e3:typeof F=="number"?F:typeof F=="string"?Date.parse(F):null;return W==null||!Number.isFinite(W)?"":new Date(W).toLocaleString(void 0,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}function Cn(F){return String(F??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Ao(F,W){const Y=Number(F),H=Number(W);return!Number.isFinite(Y)||!Number.isFinite(H)?"":`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${Y.toFixed(6)},${H.toFixed(6)}`)}`}function rs({label:F,ts:W,lat:Y,lng:H}){const re=Ao(Y,H);if(!re)return"";const ae=La(W),N=Cn(F||"Tag point"),ve=Cn(ae),Se=`${Number(Y).toFixed(6)}, ${Number(H).toFixed(6)}`,ze=Cn(Se),$e=Cn(re);return`
    <div style="min-width:180px;display:grid;gap:6px;font-family:system-ui,-apple-system,sans-serif;">
      <div style="font-size:13px;font-weight:700;color:#1a1a1a;line-height:1.25;">${N}</div>
      ${ve?`<div style="font-size:12px;color:#6c757d;line-height:1.25;">${ve}</div>`:""}
      <div style="font-size:11px;color:#6c757d;line-height:1.25;">${ze}</div>
      <a href="${$e}" target="_blank" rel="noopener noreferrer" style="display:inline-flex;align-items:center;justify-content:center;min-height:30px;padding:5px 10px;border-radius:7px;background:#0066cc;color:#fff;text-decoration:none;font-size:12px;font-weight:700;">
        Open in Google Maps
      </a>
    </div>
  `}const Bn="#0066cc",us=80,Po=140,ns=220,To=.5;function En(F,W,Y){return Math.min(Y,Math.max(W,F))}function hs(F){const W=Number.isFinite(F)?F:800,Y=Math.max(0,W-us),H=Math.min(Po,Math.max(96,Y-ns)),re=Math.max(120,Y-H),ae=Math.min(ns,re);return{available:Y,minMapHeight:H,minPanelHeight:ae,maxPanelHeight:re}}function as(F){const{available:W,minPanelHeight:Y,maxPanelHeight:H}=hs(F),re=W*To;return Math.round(En(re,Y,H))}function ss(){return{center:null,radius:250,targetTagIds:["all"],name:"",color:Bn,emailEnabled:!1,emailAddress:"",alertOnEntry:!0,alertOnExit:!0}}function Ro(F){return!Array.isArray(F)||F.length===0?[]:F.includes("all")?["all"]:[...new Set(F.map(String))].sort()}function xa(F){const W=Number(F?.center?.lat),Y=Number(F?.center?.lng);return{center:Number.isFinite(W)&&Number.isFinite(Y)?{lat:Number(W.toFixed(6)),lng:Number(Y.toFixed(6))}:null,radius:Math.max(1,Number(F?.radius)||0),targetTagIds:Ro(F?.targetTagIds),name:F?.name??"",color:F?.color||Bn,emailEnabled:!!F?.emailEnabled,emailAddress:F?.emailAddress??"",alertOnEntry:!!F?.alertOnEntry,alertOnExit:!!F?.alertOnExit}}function Fo(F,W){return!F||!W?!1:JSON.stringify(F)===JSON.stringify(W)}function Ca(...F){for(const W of F){const Y=Number(W);if(Number.isFinite(Y))return Y}return null}function ka(F,W){const Y=Number(F),H=Number(W);return!Number.isFinite(Y)||!Number.isFinite(H)?null:Math.abs(Y)>90&&Math.abs(H)<=90?{lat:H,lng:Y}:{lat:Y,lng:H}}function ee(F){if(!F)return null;if(Array.isArray(F)&&F.length>=2)return ka(F[0],F[1]);if(F&&typeof F.lat=="function"&&typeof F.lng=="function"){const re=ka(F.lat(),F.lng());if(re)return re}const W=ee(F.coordinates);if(W)return W;const Y=Ca(F.lat,F.latitude,F._lat,F._latitude,F.centerLat,F.centerLatitude,F.y),H=Ca(F.lng,F.lon,F.long,F.longitude,F._long,F._lng,F._longitude,F.centerLng,F.centerLon,F.centerLong,F.centerLongitude,F.x);return Number.isFinite(Y)&&Number.isFinite(H)?{lat:Y,lng:H}:null}function wn(F,W=0,Y=new Set){if(!F||W>4||typeof F!="object"||Y.has(F))return null;Y.add(F);const H=ee(F);if(H)return H;if(Array.isArray(F)){for(const re of F){const ae=wn(re,W+1,Y);if(ae)return ae}return null}for(const re of Object.keys(F)){const ae=wn(F[re],W+1,Y);if(ae)return ae}return null}function Ma(F,W=0,Y=new Set){if(!F||W>4||typeof F!="object"||Y.has(F))return null;if(Y.add(F),!Array.isArray(F)){for(const[re,ae]of Object.entries(F))if(typeof re=="string"&&re.toLowerCase().includes("radius")){const N=Number(ae);if(Number.isFinite(N)&&N>0)return N}}const H=Array.isArray(F)?F:Object.values(F);for(const re of H){const ae=Ma(re,W+1,Y);if(Number.isFinite(ae)&&ae>0)return ae}return null}function hi(F){if(!Array.isArray(F))return[];const W=F.filter(H=>Array.isArray(H)&&H.length>=2).map(([H,re])=>ka(H,re)).filter(H=>H&&Number.isFinite(H.lat)&&Number.isFinite(H.lng)).map(H=>[H.lat,H.lng]);if(W.length>=3)return W;const Y=F.map(H=>ee(H)).filter(H=>H&&Number.isFinite(H.lat)&&Number.isFinite(H.lng)).map(H=>[H.lat,H.lng]);if(Y.length>=3)return Y;for(const H of F){const re=hi(H);if(re.length>=3)return re}return[]}function Sn(F,W=0,Y=new Set){if(!F||W>4)return[];if(Array.isArray(F)){const re=hi(F);if(re.length>=3)return re;for(const ae of F){const N=Sn(ae,W+1,Y);if(N.length>=3)return N}return[]}if(typeof F!="object")return[];if(Y.has(F))return[];Y.add(F);const H=Object.values(F);for(const re of H){const ae=Sn(re,W+1,Y);if(ae.length>=3)return ae}return[]}function cs(F){const W=F?.geometry||{};return ee(W.center)||ee(F?.center)||ee(W.location)||ee(F?.location)||ee(W.coordinates)||ee(F?.coordinates)||ee([W.centerLat,W.centerLng])||ee([F?.centerLat,F?.centerLng])||ee(W)||ee(F)||wn(W)||wn(F)}function os(F){try{if(!F)return null;const W=F.geometry||{},Y=cs(F),H=Ca(W.radiusMeters,W.radius,W.radiusInMeters,F.radiusMeters,F.radius,F.radiusInMeters)??Ma(W)??Ma(F)??100,re=Number.isFinite(Y?.lat)&&Number.isFinite(Y?.lng);if((F.type==="circle"||re)&&re&&Number.isFinite(H)&&H>0)return qe.circle([Y.lat,Y.lng],{radius:H}).getBounds();const ve=((...Se)=>{for(const ze of Se)if(Array.isArray(ze)&&ze.length>=3)return ze;return[]})(hi(W.coordinates),hi(W.points),hi(W.vertices),hi(F.coordinates),hi(F.points),hi(F.vertices),Sn(W),Sn(F));if(ve.length>=3)return qe.latLngBounds(ve)}catch{return null}return null}function kn(F,W,Y){const H=qe.circleMarker([W,Y],{radius:10,color:"#1a1a1a",weight:2,fillColor:"#0066cc",fillOpacity:.6,opacity:.9});H.addTo(F),setTimeout(()=>{try{H.remove()}catch{}},1200)}function Pr(){return y.jsxs("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[y.jsx("path",{d:"M12 22C12 22 19 15.5 19 10C19 6.13401 15.866 3 12 3C8.13401 3 5 6.13401 5 10C5 15.5 12 22 12 22Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),y.jsx("circle",{cx:"12",cy:"10",r:"2.5",fill:"currentColor"})]})}function jo(){return y.jsxs("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[y.jsx("path",{d:"M10.325 3.317C11.1 1.894 12.9 1.894 13.675 3.317L14.198 4.278C14.5 4.832 15.096 5.134 15.715 5.059L16.789 4.929C18.379 4.736 19.649 6.006 19.456 7.596L19.326 8.67C19.251 9.289 19.553 9.885 20.107 10.187L21.068 10.71C22.491 11.485 22.491 13.285 21.068 14.06L20.107 14.583C19.553 14.885 19.251 15.481 19.326 16.1L19.456 17.174C19.649 18.764 18.379 20.034 16.789 19.841L15.715 19.711C15.096 19.636 14.5 19.938 14.198 20.492L13.675 21.453C12.9 22.876 11.1 22.876 10.325 21.453L9.802 20.492C9.5 19.938 8.904 19.636 8.285 19.711L7.211 19.841C5.621 20.034 4.351 18.764 4.544 17.174L4.674 16.1C4.749 15.481 4.447 14.885 3.893 14.583L2.932 14.06C1.509 13.285 1.509 11.485 2.932 10.71L3.893 10.187C4.447 9.885 4.749 9.289 4.674 8.67L4.544 7.596C4.351 6.006 5.621 4.736 7.211 4.929L8.285 5.059C8.904 5.134 9.5 4.832 9.802 4.278L10.325 3.317Z",stroke:"currentColor",strokeWidth:"1.6"}),y.jsx("circle",{cx:"12",cy:"12.385",r:"3.2",stroke:"currentColor",strokeWidth:"1.6"})]})}function Oo({offsetX:F=0}){const W=er(),Y=I.useRef(null);return I.useEffect(()=>{const H=qe.control.scale({position:"bottomleft"});return H.addTo(W),Y.current=H,()=>{H.remove(),Y.current=null}},[W]),I.useEffect(()=>{const H=Y.current?.getContainer?.();H&&(H.style.marginLeft=`${Math.max(0,Math.round(F))}px`)},[F]),null}function Io(){const F=er();return I.useEffect(()=>{try{F.zoomControl&&F.removeControl(F.zoomControl)}catch{}const W=qe.control.zoom({position:"topright"});return W.addTo(F),()=>{try{F.removeControl(W)}catch{}}},[F]),null}function zo(){const W=Co(),Y=I.useMemo(()=>[37.7749,-122.4194],[]),[H,re]=I.useState("status"),[ae,N]=I.useState("12h"),[ve,Se]=I.useState(()=>is(Date.now()-720*60*1e3)),[ze,$e]=I.useState(()=>is(Date.now())),[Ue,Ge]=I.useState([]),[Re,Zt]=I.useState(""),[Fe,ot]=I.useState([]),[lt,Ct]=I.useState({}),[et,wi]=I.useState([]),[pe,de]=I.useState(!1),[se,me]=I.useState(null),[Ce,Me]=I.useState(null),[Ee,De]=I.useState(""),[Ye,xe]=I.useState("#0066cc"),[He,ci]=I.useState(new Set),[ut,Nt]=I.useState({}),[je,Gt]=I.useState({}),[kt,tr]=I.useState([]),[Dn,Si]=I.useState(!1),[Rr,ir]=I.useState(null),[Di,Fr]=I.useState(""),[ht,rr]=I.useState(""),[zt,nr]=I.useState(""),[Ai,jr]=I.useState(""),[Pi,An]=I.useState("name_az"),[fe,Ti]=I.useState(null),[ar,Pn]=I.useState(!1),[Ri,sr]=I.useState(null),[Or,or]=I.useState(null),Ir=I.useRef(null),Nr=I.useRef(null),Gr=I.useRef({}),[di,zr]=I.useState(!0),[tt,Tn]=I.useState(!1),[ct,pi]=I.useState(!1),[fi,Mt]=I.useState(null),[Fi,lr]=I.useState(1),[Et,ur]=I.useState(!1),[Bt,ji]=I.useState(null),[Jt,gi]=I.useState(250),[dt,wt]=I.useState(["all"]),[Ut,Oi]=I.useState(""),[xt,Ii]=I.useState(!1),[St,Ni]=I.useState(""),[Gi,zi]=I.useState(!0),[mi,Ui]=I.useState(!0),[Qt,Hi]=I.useState(Bn),[it,hr]=I.useState(null),[cr,dr]=I.useState(null),[te,Rn]=I.useState(!1),[Vi,Fn]=I.useState(()=>typeof window<"u"?window.innerHeight:800),[jn,Ur]=I.useState(()=>typeof window>"u"?360:as(window.innerHeight)),[yi,Ki]=I.useState(!1),Wi=I.useRef({active:!1,startY:0,startHeight:0}),[Dt,pr]=I.useState(()=>{try{const l=window.localStorage.getItem("mapPanelCollapsed");return l==="1"?!0:l!=="0"}catch{return!0}}),[Ve,Hr]=I.useState(!1),[be,qi]=I.useState(null),[On,Vr]=I.useState(!1),[In,_i]=I.useState("continue"),[Nn,bi]=I.useState(0),[rt,$i]=I.useState(!1),[pt,fr]=I.useState(null),[xi,Kr]=I.useState(null),ei=I.useRef(null),ti=I.useRef(null),Wr=["#0066cc","#0d47a1","#1565c0","#1976d2","#0288d1","#00695c","#00796b","#00897b","#26a69a","#c62828","#d84315","#455a64","#546e7a","#607d8b","#2e7d32","#388e3c"],Yi={success:{border:"#2e7d32",background:"rgba(46, 125, 50, 0.95)"},error:{border:"#c62828",background:"rgba(198, 40, 40, 0.95)"},warning:{border:"#ef6c00",background:"rgba(239, 108, 0, 0.95)"},info:{border:"#1565c0",background:"rgba(21, 101, 192, 0.95)"}},Gn=l=>l&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l),Ae=I.useCallback((l,v="info")=>{Kr({message:l,tone:v}),ti.current&&window.clearTimeout(ti.current),ti.current=window.setTimeout(()=>{Kr(null),ti.current=null},3200)},[]),gr=I.useMemo(()=>[{id:"status",label:"Current",shortLabel:"Current",icon:"📍"},{id:"history",label:"Location History",shortLabel:"History",icon:"🕒"},{id:"activity",label:"Recent Activity",shortLabel:"Activity",icon:"📝"},{id:"geofences",label:"Geofences",shortLabel:"Geofences",icon:"🛡️"},{id:"settings",label:"Settings",shortLabel:"Settings",icon:"⚙️"}],[]),qr=I.useMemo(()=>({status:{title:"Current",description:"View the last known location for linked tags and center the map quickly."},history:{title:"History",description:"Select one tag and a time range to review movement and timeline playback."},activity:{title:"Recent Activity",description:"Review latest geofence entry and exit events across your linked tags."},geofences:{title:"Geofences",description:"Create and manage geofence rules, then jump straight to each zone on the map."},settings:{title:"Settings",description:"Open your full settings page."}}),[]),$r=qr[H]||qr.status,mr=I.useCallback(l=>{if(!l)return"No data";const v=l instanceof Date?l:typeof l?.toDate=="function"?l.toDate():new Date(l?.seconds?l.seconds*1e3:l);if(!(v instanceof Date)||Number.isNaN(v.getTime()))return"No data";const D=Date.now()-v.getTime();return D<60*1e3?"Just now":D<3600*1e3?`${Math.floor(D/(60*1e3))}m ago`:D<1440*60*1e3?`${Math.floor(D/(3600*1e3))}h ago`:`${Math.floor(D/(1440*60*1e3))}d ago`},[]),Yr=I.useCallback(l=>{if(!l)return null;if(l instanceof Date)return Number.isNaN(l.getTime())?null:l;if(typeof l?.toDate=="function"){const D=l.toDate();return D instanceof Date&&!Number.isNaN(D.getTime())?D:null}if(typeof l?.seconds=="number"){const D=new Date(l.seconds*1e3);return Number.isNaN(D.getTime())?null:D}const v=Number(l);if(Number.isFinite(v)&&v>0){const D=new Date(v);return Number.isNaN(D.getTime())?null:D}const B=new Date(l);return Number.isNaN(B.getTime())?null:B},[]),yr=I.useCallback(l=>l==="entry"?"Entered":l==="exit"?"Exited":"Event",[]),Xr=I.useCallback(l=>l==="entry"?"#0d9488":l==="exit"?"#dc3545":"#6c757d",[]),{timeRangeStart:ii,timeRangeEnd:At,isCustomRangeValid:zn}=I.useMemo(()=>{const l=Date.now();if(ae==="12h")return{timeRangeStart:l-12*3600*1e3,timeRangeEnd:l,isCustomRangeValid:!0};if(ae==="24h")return{timeRangeStart:l-24*3600*1e3,timeRangeEnd:l,isCustomRangeValid:!0};if(ae==="7d")return{timeRangeStart:l-168*3600*1e3,timeRangeEnd:l,isCustomRangeValid:!0};if(ae==="30d")return{timeRangeStart:l-720*3600*1e3,timeRangeEnd:l,isCustomRangeValid:!0};if(ae==="custom"){const v=new Date(ve).getTime(),B=new Date(ze).getTime();if(Number.isFinite(v)&&Number.isFinite(B)&&B>v)return{timeRangeStart:v,timeRangeEnd:B,isCustomRangeValid:!0}}return{timeRangeStart:l-12*3600*1e3,timeRangeEnd:l,isCustomRangeValid:ae!=="custom"}},[ae,ve,ze]);I.useEffect(()=>{const l=()=>{Rn(window.innerWidth<=768),Fn(window.innerHeight)};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),I.useEffect(()=>{try{window.localStorage.setItem("mapPanelCollapsed",Dt?"1":"0")}catch{}},[Dt]),I.useEffect(()=>{if(!it)return;const l=Gr.current[it];l&&typeof l.scrollIntoView=="function"&&l.scrollIntoView({block:"nearest",behavior:"smooth"})},[it]);const Je=I.useMemo(()=>hs(Vi),[Vi]);I.useEffect(()=>{te&&Ur(l=>{const v=Number.isFinite(l)?l:as(Vi),B=En(v,Je.minPanelHeight,Je.maxPanelHeight);return Math.round(B)})},[te,Vi,Je.minPanelHeight,Je.maxPanelHeight]);const _r=En(jn,Je.minPanelHeight,Je.maxPanelHeight),br=Math.max(Je.minMapHeight,Je.available-_r),Un=us+br,Hn=I.useCallback(l=>{te&&(Wi.current={active:!0,startY:l,startHeight:_r},Ki(!0))},[te,_r]),Zr=I.useCallback(l=>{const v=Wi.current;if(!v.active)return;const B=v.startY-l,D=En(v.startHeight+B,Je.minPanelHeight,Je.maxPanelHeight);Ur(Math.round(D))},[Je.minPanelHeight,Je.maxPanelHeight]),Jr=I.useCallback(()=>{Wi.current.active&&(Wi.current.active=!1,Ki(!1))},[]);I.useEffect(()=>{if(!yi)return;const l=D=>{D.preventDefault(),Zr(D.clientY)},v=()=>{Jr()};window.addEventListener("pointermove",l,{passive:!1}),window.addEventListener("pointerup",v),window.addEventListener("pointercancel",v);const B=document.body.style.userSelect;return document.body.style.userSelect="none",()=>{window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",v),window.removeEventListener("pointercancel",v),document.body.style.userSelect=B}},[yi,Zr,Jr]);const vt=te?0:Dt?64:360,Vn=te?0:24,vi=!te&&Dt,xr=te||vt<=400,ft=Et||!!it,Qr=I.useMemo(()=>xa({center:Bt,radius:Jt,targetTagIds:dt,name:Ut,color:Qt,emailEnabled:xt,emailAddress:St,alertOnEntry:Gi,alertOnExit:mi}),[Bt,Jt,dt,Ut,Qt,xt,St,Gi,mi]),Be=I.useMemo(()=>{const l={};return fe||(l.auth="Please sign in to save geofences."),Bt||(l.center="Click the map to set a geofence center."),Ut.trim()||(l.name="Enter a geofence name."),dt.length===0&&(l.tags="Select at least one tag to monitor."),xt&&(!St.trim()||!Gn(St))&&(l.email="Enter a valid email address to enable email notifications."),l},[fe,Bt,Ut,dt,xt,St]),Xi=I.useMemo(()=>!ft||!cr?!1:!Fo(Qr,cr),[Qr,cr,ft]),Pt=Object.keys(Be).length===0;I.useEffect(()=>{if(!ft||!Xi)return;const l=v=>{v.preventDefault(),v.returnValue=""};return window.addEventListener("beforeunload",l),()=>{window.removeEventListener("beforeunload",l)}},[ft,Xi]),I.useEffect(()=>()=>{ti.current&&window.clearTimeout(ti.current)},[]);const Kn=I.useMemo(()=>({topLeft:[te?30:vt+24,96],bottomRight:[30,te?30:120]}),[te,vt]),Ht=()=>{const l=Nr.current;if(l&&typeof l.fitBounds=="function")return l;const v=Ir.current;return v&&typeof v.fitBounds=="function"?v:v?.leafletElement&&typeof v.leafletElement.fitBounds=="function"?v.leafletElement:null};I.useEffect(()=>{if(!ar)return;const l=Ht();if(!l)return;const v=()=>{try{l.invalidateSize({pan:!1,animate:!1})}catch{}};v();const B=window.requestAnimationFrame(v),D=window.setTimeout(v,120),U=window.setTimeout(v,260);return()=>{window.cancelAnimationFrame(B),window.clearTimeout(D),window.clearTimeout(U)}},[ar,vt,Dt,te,br]);const we=I.useMemo(()=>Fe.filter(l=>l.status==="linked"&&l.hardwareId),[Fe]),en=I.useMemo(()=>Fe.map(l=>{const v=l.status==="linked"&&!!l.hardwareId,B=l.isActive!==!1,D=/^#([0-9a-fA-F]{3}){1,2}$/.test(l.color||"")?l.color:"#adb5bd",U=l.customName||`Tag ${l.id.slice(0,8)}`;let V="Not linked";return v&&B?V="Linked":v&&!B?V="Linked (inactive)":l.status==="pending_hardware"&&(V="Pending hardware"),{id:l.id,name:U,color:D,isLinked:v,isActive:B,statusLabel:V}}).sort((l,v)=>l.isLinked!==v.isLinked?l.isLinked?-1:1:l.name.localeCompare(v.name)),[Fe]),Pe=I.useMemo(()=>we.find(l=>l.id===Re)||null,[we,Re]),Vt=I.useMemo(()=>{const l=new Map(Ue.map(D=>[D.id,D.name||"Unknown"])),v=new Map(Fe.map(D=>[D.id,D.customName||`Tag ${D.id.slice(-4)}`])),B=kt.map((D,U)=>{const V=D?.tagId||"",K=D?.geofenceId||"",Q=String(D?.eventType||"").toLowerCase(),ue=Q==="entry"?"entry":Q==="exit"?"exit":Q.includes("enter")?"entry":Q.includes("exit")?"exit":"unknown",he=Yr(D?.timestamp),at=ee(D?.location)||ee(D?.lastLocation)||ee(je[V])||null;return{id:D?.id||`${V||"tag"}-${K||"geofence"}-${he?.getTime?.()||0}-${U}`,tagId:V,geofenceId:K,eventType:ue,timestamp:he,timestampMs:he instanceof Date?he.getTime():0,location:at,tagName:D?.tagName||v.get(V)||`Tag ${String(V).slice(-4)}`,geofenceName:D?.geofenceName||l.get(K)||"Unknown"}});return B.sort((D,U)=>U.timestampMs-D.timestampMs),B},[kt,Ue,Fe,Yr,je]),ri=I.useMemo(()=>{const l=new Set;return Vt.filter(v=>!v.tagId||l.has(v.tagId)?!1:(l.add(v.tagId),!0)).map(v=>({id:v.tagId,name:v.tagName||`Tag ${String(v.tagId).slice(-4)}`})).sort((v,B)=>(v.name||"").localeCompare(B.name||""))},[Vt]),vr=I.useMemo(()=>{const l=new Set;return Vt.filter(v=>!v.geofenceId||l.has(v.geofenceId)?!1:(l.add(v.geofenceId),!0)).map(v=>({id:v.geofenceId,name:v.geofenceName||"Unknown"})).sort((v,B)=>(v.name||"").localeCompare(B.name||""))},[Vt]),Kt=I.useMemo(()=>Vt.filter(l=>!(Di&&l.eventType!==Di||ht&&l.tagId!==ht||zt&&l.geofenceId!==zt)),[Vt,Di,ht,zt]),tn=I.useMemo(()=>{const l=we.length,v=Ue.filter(D=>D.active!==!1).length,B=et.filter(D=>D.currentState==="inside").length;return[{label:"Linked tags",value:l,border:"#6ea8ff",tint:"rgba(13, 110, 253, 0.12)"},{label:"Inside geofence",value:B,border:"#52d8a5",tint:"rgba(25, 135, 84, 0.14)"},{label:"Geofences",value:v,border:"#b69cff",tint:"rgba(111, 66, 193, 0.14)"}]},[we,Ue,et]),oe=(l,v=null)=>{try{const B=Ht();if(!B)return!1;const D=v||os(l),U=!!(D&&D.isValid&&D.isValid()),V=cs(l);bi(Date.now()+2e4);let K=null;if(U){K=D.getCenter();try{B.fitBounds(D,{paddingTopLeft:[te?30:vt+24,96],paddingBottomRight:[30,te?30:120],animate:!0,duration:.8,maxZoom:14})}catch{if(K&&Number.isFinite(K.lat)&&Number.isFinite(K.lng)){const Q=Math.max(11,Math.min(13,Number(B.getZoom())||0));B.setView([K.lat,K.lng],Q,{animate:!0})}else if(V&&Number.isFinite(V.lat)&&Number.isFinite(V.lng))B.setView([V.lat,V.lng],12,{animate:!0}),K=V;else return!1}}else if(V&&Number.isFinite(V.lat)&&Number.isFinite(V.lng)){K=V;const Q=12;typeof B.flyTo=="function"?B.flyTo([V.lat,V.lng],Q,{animate:!0,duration:.8}):B.setView([V.lat,V.lng],Q,{animate:!0})}else return!1;return K&&Number.isFinite(K.lat)&&Number.isFinite(K.lng)&&kn(B,K.lat,K.lng),!0}catch{return!1}},Wt=(l,v=14)=>{const B=Ht();if(!B)return!1;const D=ee(l);if(!D||!Number.isFinite(D.lat)||!Number.isFinite(D.lng))return!1;bi(Date.now()+2e4);try{return typeof B.flyTo=="function"?B.flyTo([D.lat,D.lng],Math.max(v,B.getZoom()||0),{animate:!0,duration:.8}):B.setView([D.lat,D.lng],Math.max(v,B.getZoom()||0),{animate:!0}),kn(B,D.lat,D.lng),!0}catch{return!1}},Zi=l=>{const v=we.find(D=>D.id===l);return v?.hardwareId?v.hardwareId:Fe.find(D=>D.id===l)?.hardwareId||null},Wn=async l=>{const v=ee(je[l]);if(v)return v;const B=Zi(l);if(!B)return null;try{const D=await Ln(ui(We,"airtags",B));if(!D.exists())return null;const U=D.data()||{},V=Number(U.lastLocationTs);if(Number.isFinite(V)&&V>0){const at=await Ln(ui(We,"airtags",B,"locations",String(V)));if(at.exists()){const ne=at.data()||{},st=ee(ne.lastLocation)||ee({lat:ne.lat,lng:ne.lng,latitude:ne.latitude,longitude:ne.longitude})||ee(ne);if(st)return st}}const K=Sr(li(We,"airtags",B,"locations"),Dr("timestampMs","desc"),_a(1)),ue=(await Qa(K)).docs[0];if(!ue)return null;const he=ue.data()||{};return ee(he.lastLocation)||ee({lat:he.lat,lng:he.lng,latitude:he.latitude,longitude:he.longitude})||ee(he)}catch{return null}},rn=async(l,v=null)=>{if(!Ht())return!1;const D=Array.isArray(lt[l])?lt[l]:[],U=D.length?D[D.length-1]:null,V=[v,Tt.lastLocationByTag[l],je[l],U];for(const Q of V)if(Wt(Q,14))return!0;const K=await Wn(l);return K?Wt(K,14):!1},qn=l=>{const v=Ht();if(!v)return;const B=Array.isArray(lt[l])?lt[l]:[],D=B.length?B[B.length-1]:null,U=Tt.lastLocationByTag[l],V=ee(U)||ee(je[l]);if(!D||!Number.isFinite(D.lat)||!Number.isFinite(D.lng)){V&&Wt(V,14);return}const K=Math.max(14,v.getZoom()||0);try{bi(Date.now()+2e4),typeof v.flyTo=="function"?v.flyTo([D.lat,D.lng],K,{animate:!0,duration:.8}):v.setView([D.lat,D.lng],K,{animate:!0})}catch{return}try{kn(v,D.lat,D.lng)}catch{}};I.useEffect(()=>{if(!fe||H!=="history"){Ct({});return}const l=ii,v=At;try{if(!Pe||!Pe.hardwareId){Ct({});return}console.log(`📊 Loading single-tag history for ${Pe.id}`);const B=li(We,"airtags",Pe.hardwareId,"locations"),D=Sr(B,Xa("timestampMs",">=",l),Xa("timestampMs","<=",v),Dr("timestampMs","asc")),U=Ar(D,V=>{or(null);const K=V.docs.map(Q=>{const ue=Q.data(),he=Number(ue.timestampMs);return{lat:Number(ue.latitude),lng:Number(ue.longitude),ts:new Date(he),timestampMs:he}}).filter(Q=>Number.isFinite(Q.lat)&&Number.isFinite(Q.lng)&&Number.isFinite(Q.timestampMs));Ct({[Pe.id]:K})},V=>{console.error(`❌ locations subscribe error for hardware ${Pe.hardwareId}`,V),or(V)});return()=>U()}catch(B){console.error("airtags subscribe setup failed",B),or(B)}},[fe,H,Pe,ii,At]),I.useEffect(()=>{},[Or]),I.useEffect(()=>{const l=document.body.style.overflow,v=document.body.style.height,B=document.body.style.minHeight;return document.body.style.overflow="visible",document.body.style.height="100vh",document.body.style.minHeight="100vh",()=>{document.body.style.overflow=l,document.body.style.height=v,document.body.style.minHeight=B}},[]),I.useEffect(()=>{if(!fe){ot([]);return}try{const l=li(We,"users",fe,"tags"),v=Ar(l,B=>{const D=B.docs.map(U=>({id:U.id,...U.data()||{}}));ot(D)},()=>ot([]));return()=>v()}catch{ot([])}},[fe]),I.useEffect(()=>{const l=we.map(v=>v.id);if(!l.length){Re&&Zt("");return}l.includes(Re)||Zt(l[0])},[we,Re]),I.useEffect(()=>{const l=Za.currentUser;l&&Ti(l.uid);const v=ko(Za,B=>Ti(B?B.uid:null));return()=>v()},[]),I.useEffect(()=>{if(!fe){Ge([]);return}try{const l=li(We,"users",fe,"geofences"),v=Sr(l,Dr("createdAt","asc")),B=Ar(v,D=>{const U=D.docs.map(V=>({id:V.id,...V.data()}));Ge(U),sr(null)},D=>{console.error("Firebase error:",D),sr("Failed to load geofences. Please check your connection."),Ge([])});return()=>B()}catch(l){console.error("Firebase setup error:",l),sr("Failed to connect to database."),Ge([])}},[fe]),I.useEffect(()=>{if(!fe){wi([]),de(!1),me(null);return}de(!0);const l=li(We,"users",fe,"geofenceStates"),v=Ar(l,B=>{const D=B.docs.map(U=>({id:U.id,...U.data()||{}}));wi(D),de(!1),me(null)},B=>{console.error("Failed to load geofence status states",B),de(!1),me("Unable to load current location status."),wi([])});return()=>v()},[fe]),I.useEffect(()=>{if(!fe){tr([]),Si(!1),ir(null),Fr(""),rr(""),nr("");return}Si(!0);const l=Sr(li(We,"users",fe,"geofenceEvents"),Dr("timestamp","desc"),_a(30)),v=Ar(l,B=>{const D=B.docs.map(U=>({id:U.id,...U.data()||{}}));tr(D),Si(!1),ir(null)},B=>{console.error("Failed to load recent geofence activity",B),tr([]),Si(!1),ir("Unable to load recent activity right now.")});return()=>v()},[fe]),I.useEffect(()=>{ht&&!ri.some(l=>l.id===ht)&&rr(""),zt&&!vr.some(l=>l.id===zt)&&nr("")},[ht,zt,ri,vr]),I.useEffect(()=>{if(!fe||we.length===0){Nt({}),Gt({});return}let l=!1;return(async()=>{try{const B=await Promise.all(we.map(async D=>{if(!D.hardwareId)return[D.id,null];const U=await Ln(ui(We,"airtags",D.hardwareId));if(!U.exists())return[D.id,null,null];const V=U.data()||{},K=Number(V.lastLocationTs);let Q=ee(V.lastLocation)||ee(V.location)||ee({lat:V.lat,lng:V.lng,latitude:V.latitude,longitude:V.longitude});if(!Q&&Number.isFinite(K)&&K>0){const ue=await Ln(ui(We,"airtags",D.hardwareId,"locations",String(K)));if(ue.exists()){const he=ue.data()||{};Q=ee(he.lastLocation)||ee({lat:he.lat,lng:he.lng,latitude:he.latitude,longitude:he.longitude})||ee(he)}}if(!Q){const ue=Sr(li(We,"airtags",D.hardwareId,"locations"),Dr("timestampMs","desc"),_a(1)),at=(await Qa(ue)).docs[0];if(at){const ne=at.data()||{};Q=ee(ne.lastLocation)||ee({lat:ne.lat,lng:ne.lng,latitude:ne.latitude,longitude:ne.longitude})||ee(ne)}}return[D.id,Number.isFinite(K)?new Date(K):null,Q||null]}));if(l)return;Nt(Object.fromEntries(B.map(([D,U])=>[D,U]))),Gt(Object.fromEntries(B.map(([D,,U])=>[D,U])))}catch{}})(),()=>{l=!0}},[fe,we]);const Tt=I.useMemo(()=>{const l=we.filter(K=>K.isActive!==!1),v=Ue.filter(K=>K.active!==!1).map(K=>({id:K.id,name:K.name||"Unnamed geofence",color:K.color||"#0066cc",tags:[]})),B=new Map(v.map(K=>[K.id,K])),D=new Map,U={};et.forEach(K=>{K?.tagId&&(D.has(K.tagId)||D.set(K.tagId,[]),D.get(K.tagId).push(K))});const V=[];return l.forEach(K=>{const Q=ee(je[K.id]),ue=(D.get(K.id)||[]).map(ne=>{const st=ne.lastChecked?.toDate?ne.lastChecked.toDate():new Date(ne.lastChecked?.seconds?ne.lastChecked.seconds*1e3:ne.lastChecked),$t=ee(ne.lastLocation)||ee(ne.location)||ee(ne.lastKnownLocation)||ee(ne);return $t&&(U[K.id]=$t),{...ne,checked:st,location:$t}}).sort((ne,st)=>{const $t=ne.checked instanceof Date&&!Number.isNaN(ne.checked.getTime())?ne.checked.getTime():0;return(st.checked instanceof Date&&!Number.isNaN(st.checked.getTime())?st.checked.getTime():0)-$t});!U[K.id]&&Q&&(U[K.id]=Q);const he=ue.filter(ne=>ne.currentState==="inside"&&B.has(ne.geofenceId)),at={tagId:K.id,tagName:K.customName||`Tag ${K.id.slice(-4)}`,tagColor:/^#([0-9a-fA-F]{3}){1,2}$/.test(K.color||"")?K.color:"#0066cc",lastSeen:ut[K.id]||null};if(he.length>0)he.forEach(ne=>{const st=B.get(ne.geofenceId);st&&st.tags.push({...at,state:"inside",lastChecked:ne.checked||null,location:ne.location||Q||null})});else{const ne=ue[0]||null;V.push({...at,state:ne?.currentState||"unknown",lastChecked:ne?.checked||null,location:ne?.location||Q||null})}}),v.forEach(K=>{K.tags.sort((Q,ue)=>{const he=Q.lastSeen instanceof Date?Q.lastSeen.getTime():0;return(ue.lastSeen instanceof Date?ue.lastSeen.getTime():0)-he})}),V.sort((K,Q)=>{const ue=K.lastSeen instanceof Date?K.lastSeen.getTime():0;return(Q.lastSeen instanceof Date?Q.lastSeen.getTime():0)-ue}),{geofenceBuckets:v,outsideTags:V,lastLocationByTag:U}},[we,Ue,et,ut,je]),Li=I.useMemo(()=>{const l=new Map;return et.forEach(v=>{if(!v?.tagId)return;const B=v.lastChecked?.toDate?v.lastChecked.toDate():new Date(v.lastChecked?.seconds?v.lastChecked.seconds*1e3:v.lastChecked),D=B instanceof Date&&!Number.isNaN(B.getTime())?B.getTime():0,U=l.get(v.tagId);(!U||D>U.checkedMs)&&l.set(v.tagId,{state:v,checked:B,checkedMs:D})}),l},[et]),ni=I.useMemo(()=>we.map(v=>{const B=Li.get(v.id),D=ee(Tt.lastLocationByTag[v.id])||ee(je[v.id])||ee(B?.state?.lastLocation)||ee(B?.state?.location)||null,U=ut[v.id]||null,V=U instanceof Date?U.getTime():0,K=B?.checked instanceof Date&&!Number.isNaN(B.checked.getTime())?B.checked.getTime():0;return{tagId:v.id,tagName:v.customName||`Tag ${v.id.slice(-4)}`,tagColor:/^#([0-9a-fA-F]{3}){1,2}$/.test(v.color||"")?v.color:"#0066cc",isActive:v.isActive!==!1,location:D,lastSeen:U,lastChecked:B?.checked||null,sortTs:Math.max(V,K),lastSeenMs:V,lastCheckedMs:K}}),[we,Li,Tt.lastLocationByTag,je,ut]),Xe=I.useMemo(()=>{const l=Ai.trim().toLowerCase();let v=[...ni];return l&&(v=v.filter(B=>B.tagName.toLowerCase().includes(l))),v.sort((B,D)=>Pi==="name_az"?B.tagName.localeCompare(D.tagName):Pi==="name_za"?D.tagName.localeCompare(B.tagName):B.tagName.localeCompare(D.tagName)),v},[ni,Ai,Pi]);I.useEffect(()=>{Ce&&(ni.some(l=>l.tagId===Ce)||Me(null))},[Ce,ni]);const nn=I.useCallback(l=>{const v=Fe.find(D=>D.id===l),B=/^#([0-9a-fA-F]{3}){1,2}$/.test(v?.color||"")?v.color:"#0066cc";Me(l),De(v?.customName||""),xe(B)},[Fe]),Rt=I.useCallback(()=>{Me(null),De(""),xe("#0066cc")},[]),$n=I.useCallback(async l=>{if(!fe){Ae("Please sign in to update tag settings.","error");return}ci(v=>new Set(v).add(l));try{const v=ui(We,"users",fe,"tags",l);await Mo(v,{customName:Ee.trim()||null,color:Ye,updatedAt:new Date},{merge:!0}),xn("rename_tag",{}),vn("rename_tag"),Ae("Tag settings saved.","success"),Rt()}catch(v){console.error("Failed to save tag settings:",v),Ae("Failed to save tag settings. Please try again.","error")}finally{ci(v=>{const B=new Set(v);return B.delete(l),B})}},[fe,Ee,Ye,Rt,Ae]),Yn=I.useCallback(()=>{const l=Ht();if(!l)return!1;const v=Xe.map(B=>ee(B.location)).filter(B=>B&&Number.isFinite(B.lat)&&Number.isFinite(B.lng)).map(B=>[B.lat,B.lng]);if(v.length===0)return!1;bi(Date.now()+2e4);try{if(v.length===1){const[B,D]=v[0],U=Math.max(14,l.getZoom()||0);return typeof l.flyTo=="function"?l.flyTo([B,D],U,{animate:!0,duration:.8}):l.setView([B,D],U,{animate:!0}),kn(l,B,D),!0}return l.fitBounds(v,{paddingTopLeft:[te?30:vt+24,96],paddingBottomRight:[30,te?30:120],animate:!0,duration:.8,maxZoom:14}),!0}catch{return!1}},[Xe,vt,te]),an=I.useMemo(()=>{const l={};return we.forEach(v=>{const B=ee(Tt.lastLocationByTag[v.id])||ee(je[v.id]);if(!B)return;const D=ut[v.id],U=D instanceof Date?D.getTime():null;l[v.id]=[{lat:B.lat,lng:B.lng,ts:D||null,timestampMs:Number.isFinite(U)?U:null}]}),l},[we,Tt.lastLocationByTag,je,ut]),Xn=I.useMemo(()=>H==="status"?an:H==="history"?lt:{},[H,an,lt]);function Zn({enabled:l,onPickCenter:v}){const B=er();return I.useEffect(()=>{if(!l)return;const D=U=>v&&v(U.latlng);return B.getContainer().style.cursor="crosshair",B.on("click",D),()=>{B.off("click",D),B.getContainer().style.cursor=""}},[B,l,v]),null}function Jn({center:l,radius:v,color:B="#0066cc"}){const D=er(),U=I.useRef(null);return I.useEffect(()=>{const V=Number(l?.lat),K=Number(l?.lng),Q=Number(v);if(!l||!Number.isFinite(V)||!Number.isFinite(K)||!Number.isFinite(Q)||Q<=0){U.current&&(U.current.remove(),U.current=null);return}U.current?(U.current.setLatLng([V,K]),U.current.setRadius(Q)):U.current=qe.circle([V,K],{radius:Q,color:B,fillColor:B,fillOpacity:.1,weight:2,dashArray:"4,3"}).addTo(D)},[D,l,v,B]),I.useEffect(()=>()=>{U.current&&(U.current.remove(),U.current=null)},[D]),null}function Qn(){return I.useEffect(()=>{const l=document.querySelector(".global-header"),v=l?l.getBoundingClientRect().height:80,B=document.querySelectorAll(".leaflet-top");return B.forEach(D=>{D.style.marginTop=`${v+12}px`}),()=>{B.forEach(D=>{D.style.marginTop=""})}},[]),null}const ea=()=>{const l=ss();ji(l.center),gi(l.radius),wt(l.targetTagIds),Oi(l.name),Hi(l.color),Ii(l.emailEnabled),Ni(l.emailAddress),zi(l.alertOnEntry),Ui(l.alertOnExit),dr(null),$i(!1)},Ci=()=>{ur(!1),hr(null),ea()},ta=()=>{const l=ss();ur(!0),hr(null),ji(l.center),gi(l.radius),wt(l.targetTagIds),Oi(l.name),Hi(l.color),Ii(l.emailEnabled),Ni(l.emailAddress),zi(l.alertOnEntry),Ui(l.alertOnExit),dr(xa(l)),$i(!1)},Te=l=>{const v={center:l.geometry?.center?{lat:Number(l.geometry.center.lat),lng:Number(l.geometry.center.lng)}:null,radius:Number(l.geometry?.radiusMeters||250),targetTagIds:Array.isArray(l.targetTagIds)&&l.targetTagIds.length>0?l.targetTagIds:["all"],name:l.name||"",color:l.color||Bn,emailEnabled:!!l.alertPreferences?.emailEnabled,emailAddress:l.alertPreferences?.emailAddress||"",alertOnEntry:l.alertPreferences?.onEntry!==!1,alertOnExit:l.alertPreferences?.onExit!==!1};ur(!1),hr(l.id),ji(v.center),gi(v.radius),wt(v.targetTagIds),Oi(v.name),Hi(v.color),Ii(v.emailEnabled),Ni(v.emailAddress),zi(v.alertOnEntry),Ui(v.alertOnExit),dr(xa(v)),$i(!1)},Oe=()=>{Vr(!1),_i("continue")},sn=()=>{const l=ei.current;ei.current=null,typeof l=="function"&&l()},gt=(l,v="continue")=>{if(!Ve){if(ft&&Xi){ei.current=l,_i(v),Vr(!0);return}l()}},qt=()=>{gt(()=>{Ci()},"cancel editing")},ai=async()=>{if(Ve)return!1;try{if($i(!0),!Pt){const B=Object.values(Be)[0];return B&&Ae(B,"warning"),!1}Hr(!0);const l=!!it,v={name:Ut.trim(),color:Qt,updatedAt:ba(),geometry:{center:{lat:Bt.lat,lng:Bt.lng},radiusMeters:Jt},targetTagIds:dt,alertPreferences:{onEntry:Gi,onExit:mi,emailEnabled:xt,emailAddress:xt?St.trim():null}};if(l){const B=ui(We,"users",fe,"geofences",it);await Ja(B,v),xn("edit_geofence",{method:"circle"}),vn("edit_geofence"),Ae("Geofence updated.","success")}else{const B=li(We,"users",fe,"geofences");await wo(B,{active:!0,createdAt:ba(),type:"circle",...v}),xn("create_geofence",{method:"circle"}),vn("create_geofence"),Ae("Geofence created.","success")}return Ci(),!0}catch(l){return console.error("Failed to save geofence:",l),Ae("Failed to save geofence. Please try again.","error"),!1}finally{Hr(!1)}},Ft=()=>{ei.current=null,Oe()},ia=()=>{Oe(),Ci(),sn()},ra=async()=>{const l=ei.current;ei.current=null,Oe(),await ai()&&typeof l=="function"&&l()},Lr=()=>{be||fr(null)},nt=async()=>{if(!fe||!pt||be)return;const{id:l}=pt;qi(l);try{await So(ui(We,"users",fe,"geofences",l)),it===l&&Ci(),xn("delete_geofence",{}),vn("delete_geofence"),Ae("Geofence deleted.","success")}catch(v){console.error("Failed to delete geofence:",v),Ae("Failed to delete geofence. Please try again.","error")}finally{qi(null),fr(null)}},Ji=l=>{const v=!te&&Dt;if(H===l){v&&pr(!1);return}gt(()=>{v&&pr(!1),re(l)},"switch sections")},ki=y.jsxs("div",{style:{display:"grid",gap:10,width:"100%",minWidth:0,overflow:"hidden"},children:[rt&&Be.auth&&y.jsx("div",{style:{fontSize:12,color:"#b02a37",fontWeight:600},children:Be.auth}),y.jsxs("div",{style:{display:"grid",gap:6,minWidth:0},children:[y.jsx("input",{type:"text",placeholder:"Geofence name",value:Ut,onChange:l=>Oi(l.target.value),style:{width:"100%",maxWidth:"100%",boxSizing:"border-box",padding:8,borderRadius:8,border:rt&&Be.name?"1px solid #dc3545":"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a"}}),rt&&Be.name&&y.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Be.name}),y.jsx("span",{style:{color:"#6c757d",fontSize:12,lineHeight:1.35},children:"Click the map to set or adjust the geofence center."}),rt&&Be.center&&y.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Be.center})]}),y.jsxs("div",{style:{display:"grid",gap:6,minWidth:0},children:[y.jsx("span",{style:{color:"#495057",fontSize:13,fontWeight:600},children:"Radius (meters)"}),y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 90px",gap:8,alignItems:"center",minWidth:0},children:[y.jsx("input",{type:"range",min:25,max:5e3,step:25,value:Jt,onChange:l=>gi(Number(l.target.value)),style:{width:"100%"}}),y.jsx("input",{type:"number",min:1,value:Jt,onChange:l=>gi(Math.max(1,Number(l.target.value)||0)),style:{width:"100%",maxWidth:"100%",boxSizing:"border-box",padding:8,borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a"}})]})]}),y.jsxs("div",{style:{display:"grid",gap:6,minWidth:0},children:[y.jsx("span",{style:{color:"#495057",fontSize:13,fontWeight:600},children:"Monitor tags"}),y.jsxs("select",{value:dt.includes("all")?"all":"specific",onChange:l=>{l.target.value==="all"?wt(["all"]):wt([])},style:{width:"100%",maxWidth:"100%",boxSizing:"border-box",padding:8,borderRadius:8,border:rt&&Be.tags?"1px solid #dc3545":"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a"},children:[y.jsx("option",{value:"all",children:"All tags"}),y.jsx("option",{value:"specific",children:"Specific tags"})]}),rt&&Be.tags&&dt.includes("all")&&y.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Be.tags})]}),!dt.includes("all")&&y.jsx("div",{style:{border:rt&&Be.tags?"1px solid #dc3545":"1px solid #dee2e6",borderRadius:8,padding:8,maxHeight:120,overflowY:"auto",background:"#f8f9fa",minWidth:0},children:Fe.map(l=>y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 0",cursor:"pointer",fontSize:13,color:"#1a1a1a",minWidth:0},children:[y.jsx("input",{type:"checkbox",checked:dt.includes(l.id),onChange:v=>{v.target.checked?wt(B=>[...B,l.id]):wt(B=>B.filter(D=>D!==l.id))}}),y.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:l.color||"#0066cc",marginRight:"4px",flexShrink:0}}),y.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.customName||`Tag ${l.id.slice(0,8)}`})]},l.id))}),rt&&Be.tags&&!dt.includes("all")&&y.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Be.tags}),y.jsxs("div",{style:{display:"grid",gap:8,marginTop:2,minWidth:0},children:[y.jsx("span",{style:{color:"#495057",fontSize:13,fontWeight:600},children:"Geofence color"}),y.jsx("div",{role:"radiogroup","aria-label":"Geofence color",style:{display:"flex",gap:te?4:6,flexWrap:"wrap",minWidth:0},children:Wr.map(l=>y.jsx("button",{type:"button",onClick:()=>Hi(l),role:"radio","aria-checked":Qt===l,"aria-label":`Set geofence color ${l}`,style:{width:te?20:24,height:te?20:24,borderRadius:"50%",background:l,border:Qt===l?"2px solid #1a1a1a":"1px solid #adb5bd",cursor:"pointer",transform:Qt===l?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",flexShrink:0,padding:0},title:l},l))})]}),y.jsxs("div",{style:{display:"grid",gap:8,marginTop:2,minWidth:0},children:[y.jsx("span",{style:{color:"#495057",fontSize:13,fontWeight:600},children:"Email alerts"}),y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer",color:"#1a1a1a",minWidth:0},children:[y.jsx("input",{type:"checkbox",checked:xt,onChange:l=>Ii(l.target.checked),style:{width:16,height:16}}),y.jsx("span",{style:{fontSize:13,lineHeight:1.3},children:"Enable email notifications"})]})]}),xt&&y.jsxs(y.Fragment,{children:[y.jsx("input",{type:"email",placeholder:"Email address",value:St,onChange:l=>Ni(l.target.value),required:xt,style:{width:"100%",maxWidth:"100%",boxSizing:"border-box",padding:8,borderRadius:8,border:rt&&Be.email?"1px solid #dc3545":"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a"}}),rt&&Be.email&&y.jsx("div",{style:{fontSize:12,color:"#b02a37"},children:Be.email}),y.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center",flexWrap:"wrap"},children:[y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer"},children:[y.jsx("input",{type:"checkbox",checked:Gi,onChange:l=>zi(l.target.checked),style:{width:14,height:14}}),y.jsx("span",{style:{color:"#1a1a1a",fontSize:13},children:"Alert on entry"})]}),y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,cursor:"pointer",color:"#1a1a1a"},children:[y.jsx("input",{type:"checkbox",checked:mi,onChange:l=>Ui(l.target.checked),style:{width:14,height:14}}),y.jsx("span",{style:{fontSize:13},children:"Alert on exit"})]})]})]}),Xi&&y.jsx("div",{style:{fontSize:12,color:"#b02a37",fontWeight:600},children:"Unsaved changes"}),y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:6},children:[y.jsx("button",{onClick:ai,disabled:Ve,style:{width:"100%",padding:te?"8px 12px":"8px 14px",minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:Ve?"#666":Pt?"#0066cc":"#e9ecef",color:Ve||Pt?"#fff":"#6c757d",fontWeight:700,fontSize:15,cursor:Ve?"not-allowed":"pointer",opacity:Ve?.7:1,outline:"none"},children:Ve?"Saving...":it?"Update":"Save"}),y.jsx("button",{onClick:qt,style:{width:"100%",padding:te?"8px 12px":"8px 14px",minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:"#e9ecef",color:"#1a1a1a",fontSize:15,fontWeight:600,cursor:"pointer",outline:"none"},children:"Cancel"})]})]});function na({items:l}){const v=er(),B=I.useRef(null);return I.useEffect(()=>{B.current||(B.current=qe.layerGroup().addTo(v));const D=B.current;return D.clearLayers(),l.forEach(U=>{if(U.active!==!1){if(U.type==="circle"&&U.geometry?.center){const V=Number(U.geometry.center.lat),K=Number(U.geometry.center.lng),Q=Number(U.geometry.radiusMeters||100);if(!Number.isFinite(V)||!Number.isFinite(K)||!Number.isFinite(Q)||Q<=0)return;qe.circle([V,K],{radius:Q,color:U.color||"#0066cc",fillColor:U.color||"#0066cc",fillOpacity:.1,weight:2}).addTo(D)}else if(U.type==="polygon"&&U.geometry){const V=U.geometry;let K=[];try{V&&Array.isArray(V.coordinates)&&(V.type==="Polygon"?K=Array.isArray(V.coordinates[0])?V.coordinates[0]:[]:V.type==="MultiPolygon"&&(K=Array.isArray(V.coordinates[0])&&Array.isArray(V.coordinates[0][0])?V.coordinates[0][0]:[]))}catch{K=[]}const Q=Array.isArray(K)?K.filter(ue=>Array.isArray(ue)&&ue.length>=2).map(([ue,he])=>[Number(he),Number(ue)]).filter(([ue,he])=>Number.isFinite(ue)&&Number.isFinite(he)):[];Q.length>=3&&qe.polygon(Q,{color:U.color||"#0066cc",fillColor:U.color||"#0066cc",fillOpacity:.1,weight:2}).addTo(D)}}}),()=>{D.clearLayers()}},[v,l]),null}return I.useEffect(()=>{if(!ct||!tt)return;const l=setInterval(()=>{Mt(v=>{if(!v)return ii;const B=v+1e3*60*Fi;return B>=At?(pi(!1),At):B})},100);return()=>clearInterval(l)},[ct,tt,Fi,ii,At]),y.jsxs("div",{style:{height:"100vh",width:"100%",background:"#f0f0f0",position:"relative",overflow:"hidden"},children:[Ri&&y.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(255,165,0,0.9)",color:"white",padding:"12px 20px",borderRadius:"8px",zIndex:4e3,textAlign:"center",maxWidth:"400px"},children:[y.jsx("div",{style:{fontSize:"14px"},children:Ri}),y.jsx("div",{style:{fontSize:"12px",marginTop:"4px",opacity:.8},children:"Map will still work, but geofences may not load."})]}),y.jsx("div",{style:{height:te?`${br}px`:"100%",width:"100%",position:"absolute",top:te?"5rem":0,left:0,zIndex:1},children:y.jsxs(Eo,{ref:Ir,center:Y,zoom:5,minZoom:1,maxZoom:19,zoomSnap:1,zoomDelta:1,style:{height:"100%",width:"100%"},zoomControl:!1,scrollWheelZoom:!0,zoomAnimation:!1,fadeAnimation:!1,inertia:!1,whenReady:l=>{console.log("MapContainer ready"),l?.target&&typeof l.target.fitBounds=="function"&&(Nr.current=l.target),Pn(!0),window.__mapContainerReady=!0,setTimeout(()=>{Ht()?.invalidateSize()},100)},children:[y.jsx(Bo,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"© OpenStreetMap contributors & CartoDB",maxZoom:19,minZoom:1}),y.jsx(Io,{}),y.jsx(Oo,{offsetX:te?0:vt+24}),y.jsx(Qn,{}),y.jsx(na,{items:Ue}),y.jsx(Zn,{enabled:Et||!!it,onPickCenter:ji}),y.jsx(Jn,{center:Bt,radius:Jt}),y.jsx(No,{pathsByTag:Xn,myTags:Fe,showPathLines:H==="history"?di:!1,renderPointTrail:H==="history",maxTimestamp:H==="history"&&tt?fi:null,fitBoundsPadding:Kn,manualViewportUntil:Nn})]})}),!te&&y.jsx("div",{style:{position:"fixed",bottom:16,right:12,zIndex:3100,display:"grid",width:`min(560px, calc(100% - ${Vn+24}px))`,gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:12},children:tn.map(l=>y.jsxs("div",{style:{borderRadius:12,border:`1px solid ${l.border}`,background:l.tint,backdropFilter:"blur(6px)",padding:"10px 14px",display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:64,gap:10},children:[y.jsx("span",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a",lineHeight:1.2},children:l.label}),y.jsx("span",{style:{fontSize:30,lineHeight:1,fontWeight:700,color:"#1a1a1a"},children:l.value})]},l.label))}),y.jsxs("div",{id:"map-ui",style:{position:"fixed",...te?{top:`${Un}px`,left:0,right:0,bottom:0,width:"100%",borderRadius:0,display:"flex",flexDirection:"column",touchAction:"pan-y"}:{top:"calc(5rem + 12px)",left:12,bottom:12,width:`${vt}px`,borderRadius:14,display:"flex",flexDirection:"column"},background:"rgba(255,255,255,0.98)",border:"1px solid #dee2e6",color:"#1a1a1a",zIndex:3e3,backdropFilter:"blur(6px)",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",overflow:"hidden"},children:[te&&y.jsx("div",{role:"separator","aria-label":"Resize panel","aria-orientation":"horizontal",onPointerDown:l=>{l.pointerType==="mouse"&&l.button!==0||(l.preventDefault(),Hn(l.clientY))},style:{padding:"6px 0 4px",borderBottom:"1px solid #edf0f2",display:"grid",placeItems:"center",cursor:yi?"row-resize":"ns-resize",touchAction:"none",background:"#fff",flexShrink:0},children:y.jsx("span",{style:{width:54,height:5,borderRadius:9999,background:"#c7ced6"}})}),y.jsxs("div",{style:{padding:vi?"8px 6px":"10px 10px 8px 10px",borderBottom:"1px solid #edf0f2"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:vi?"center":"space-between",gap:8},children:[!vi&&y.jsx("div",{style:{fontSize:11,fontWeight:800,letterSpacing:"0.08em",color:"#6c757d"},children:"ASSETS & CONTROLS"}),!te&&y.jsx("button",{onClick:()=>pr(l=>!l),"aria-label":Dt?"Expand sidebar":"Collapse sidebar",title:Dt?"Expand sidebar":"Collapse sidebar",style:{width:38,height:38,borderRadius:10,border:"1px solid #d3d9df",background:"#f8f9fa",color:"#1a1a1a",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",flexShrink:0,padding:0,outline:"none"},children:y.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[y.jsx("path",{d:"M4 6H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),y.jsx("path",{d:"M4 12H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),y.jsx("path",{d:"M4 18H20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})})]}),!vi&&te&&y.jsx("div",{style:{display:"flex",gap:6,marginTop:8,overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",paddingBottom:2},children:gr.map(l=>y.jsx("button",{onClick:()=>Ji(l.id),style:{minHeight:34,padding:"6px 12px",borderRadius:9999,border:H===l.id?"1px solid #0066cc":"1px solid #dee2e6",background:H===l.id?"#0066cc":"#e9ecef",color:H===l.id?"#fff":"#1a1a1a",fontWeight:700,fontSize:12,lineHeight:1,cursor:"pointer",outline:"none",whiteSpace:"nowrap",flex:"0 0 auto"},children:l.shortLabel},l.id))})]}),vi?y.jsx("div",{style:{flex:1,display:"grid",alignContent:"start",justifyItems:"center",gap:8,padding:"10px 0"},children:gr.map(l=>y.jsx("button",{onClick:()=>Ji(l.id),title:l.label,"aria-label":l.label,style:{width:42,minHeight:42,height:42,borderRadius:10,border:"1px solid #d3d9df",background:H===l.id?"#0066cc":"#f8f9fa",color:H===l.id?"#fff":"#1a1a1a",fontSize:16,cursor:"pointer",outline:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:1,padding:0,overflow:"hidden"},children:l.icon},l.id))}):y.jsxs("div",{style:{...te?{flex:1,minHeight:0,overflow:"hidden",display:"flex",flexDirection:"column",padding:"0 12px 12px 12px",touchAction:"pan-y"}:{flex:1,minHeight:0,display:"grid",gridTemplateColumns:"46px minmax(0, 1fr)",gap:10,padding:"8px 10px 12px 10px",overflow:"hidden"}},children:[!te&&y.jsx("div",{style:{padding:"10px 0",display:"grid",alignContent:"start",justifyItems:"center",gap:8,overflowY:"auto"},children:gr.map(l=>y.jsx("button",{onClick:()=>Ji(l.id),title:l.label,"aria-label":l.label,style:{width:42,minHeight:42,height:42,borderRadius:10,border:"1px solid #d3d9df",background:H===l.id?"#0066cc":"#f8f9fa",color:H===l.id?"#fff":"#1a1a1a",fontSize:16,cursor:"pointer",outline:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:1,padding:0,overflow:"hidden"},children:l.icon},l.id))}),y.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"},children:[!te&&y.jsxs("div",{style:{padding:"2px 2px 8px 2px",flexShrink:0},children:[y.jsx("div",{style:{fontSize:18,fontWeight:800,color:"#1a1a1a",lineHeight:1.2},children:$r.title}),y.jsx("div",{style:{marginTop:2,fontSize:12,color:"#6c757d",lineHeight:1.35},children:$r.description})]}),H==="status"&&y.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",gap:8,...te?{overflowY:"auto",overflowX:"hidden",paddingRight:2,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}:{overflow:"hidden"}},children:[se&&y.jsx("div",{style:{fontSize:12,color:"#b02a37",fontWeight:600},children:se}),pe?y.jsx("div",{style:{flex:1,minHeight:140,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",display:"grid",placeItems:"center",color:"#6c757d",fontSize:13},children:"Loading current locations..."}):y.jsxs("div",{style:{...te?{border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",overflow:"hidden",display:"flex",flexDirection:"column",flexShrink:0}:{flex:1,minHeight:0,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",overflow:"hidden",display:"flex",flexDirection:"column"}},children:[y.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px solid #dee2e6",fontWeight:700,color:"#1a1a1a",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[y.jsx("span",{children:"Tags"}),y.jsxs("span",{style:{fontSize:12,color:"#6c757d"},children:[Xe.length,Ai.trim()?` / ${ni.length}`:""]})]}),y.jsxs("div",{style:{borderBottom:"1px solid #dee2e6",padding:10,display:"grid",gap:8},children:[y.jsx("input",{type:"text",value:Ai,onChange:l=>jr(l.target.value),placeholder:"Search tags",style:{width:"100%",minHeight:36,padding:"8px 10px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:13,boxSizing:"border-box"}}),y.jsxs("div",{style:{display:"grid",gap:8,alignItems:"center",...te?{gridTemplateColumns:"minmax(0, 1fr) auto"}:{gridTemplateColumns:"minmax(110px, 1fr) auto"}},children:[y.jsxs("select",{value:Pi,onChange:l=>An(l.target.value),style:{width:"100%",minWidth:110,minHeight:34,padding:"6px 8px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12},children:[y.jsx("option",{value:"name_az",children:"Name A-Z"}),y.jsx("option",{value:"name_za",children:"Name Z-A"})]}),y.jsx("button",{onClick:()=>{Yn()||Ae("No visible tag locations to fit on the map.","warning")},style:{minWidth:78,minHeight:34,padding:"6px 10px",borderRadius:8,border:"1px solid #0066cc",background:"#0066cc",color:"#fff",fontSize:12,fontWeight:700,cursor:"pointer",whiteSpace:"nowrap"},children:"Fit all"})]})]}),y.jsx("div",{style:{...te?{maxHeight:"42vh",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}:{flex:1,minHeight:0,overflowY:"auto"}},children:ni.length===0?y.jsx("div",{style:{padding:10,fontSize:12,color:"#6c757d"},children:"No linked tags are available yet."}):Xe.length===0?y.jsx("div",{style:{padding:10,fontSize:12,color:"#6c757d"},children:"No tags match the current filters."}):y.jsx("ul",{style:{listStyle:"none",margin:0,padding:0},children:Xe.map((l,v)=>{const B=Ce===l.tagId,D=He.has(l.tagId);return y.jsx("li",{style:{padding:"10px 10px",borderBottom:v<Xe.length-1?"1px solid #e8ecef":"none"},children:B?y.jsxs("div",{style:{display:"grid",gap:8},children:[y.jsx("input",{type:"text",value:Ee,onChange:U=>De(U.target.value),placeholder:"Tag name (e.g., Car Keys)",maxLength:50,style:{width:"100%",minHeight:34,padding:"7px 10px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12,boxSizing:"border-box"}}),y.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:Wr.map(U=>y.jsx("button",{onClick:()=>xe(U),"aria-label":`Set tag color ${U}`,style:{width:18,minHeight:18,borderRadius:9999,border:Ye===U?"2px solid #1a1a1a":"1px solid #adb5bd",background:U,cursor:"pointer",padding:0}},`status-edit-color-${l.tagId}-${U}`))}),y.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[y.jsx("button",{onClick:Rt,style:{padding:"6px 10px",border:"1px solid #dee2e6",borderRadius:6,background:"#e9ecef",color:"#1a1a1a",fontSize:11,cursor:"pointer"},children:"Cancel"}),y.jsx("button",{onClick:()=>$n(l.tagId),disabled:D,style:{padding:"6px 10px",border:"none",borderRadius:6,background:"#0d9488",color:"#fff",fontSize:11,fontWeight:600,cursor:D?"not-allowed":"pointer",opacity:D?.7:1},children:D?"Saving...":"Save"})]})]}):y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:8},children:[y.jsxs("div",{style:{minWidth:0},children:[y.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:7,maxWidth:"100%"},children:[y.jsx("span",{style:{width:8,height:8,borderRadius:9999,background:l.tagColor,flexShrink:0}}),y.jsx("span",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.tagName}),!l.isActive&&y.jsx("span",{style:{fontSize:10,fontWeight:700,color:"#6c757d",background:"#e9ecef",borderRadius:9999,padding:"2px 6px",flexShrink:0},children:"Inactive"})]}),y.jsxs("div",{style:{fontSize:12,color:"#6c757d",marginTop:2},children:["Last seen ",mr(l.lastSeen||l.lastChecked)]})]}),y.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[y.jsx("button",{onClick:()=>nn(l.tagId),style:{width:28,minHeight:28,borderRadius:8,border:"none",background:"transparent",color:"#6c757d",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:0,opacity:.85},title:"Open tag settings","aria-label":`Open settings for ${l.tagName}`,children:y.jsx(jo,{})}),y.jsx("button",{onClick:async()=>{await rn(l.tagId,l.location)||Ae("No location available for this tag yet.","warning")},style:{width:32,minHeight:32,borderRadius:8,border:"none",background:"transparent",color:"#0066cc",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",padding:0},title:"Center map on this tag","aria-label":`Center map on ${l.tagName}`,children:y.jsx(Pr,{})})]})]})},`location-list-${l.tagId}`)})})})]})]}),H==="history"&&y.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",overflowY:"auto",overflowX:"hidden",paddingRight:2,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:[y.jsxs("div",{style:{marginBottom:10,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",padding:10,display:"grid",gap:8,flexShrink:0},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[y.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a"},children:"Tag selector"}),Pe&&y.jsx("button",{onClick:()=>qn(Pe.id),style:{width:30,minHeight:30,borderRadius:8,border:"none",background:"transparent",color:"#0066cc",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:0},"aria-label":"Center map on selected history tag",title:`Center map on ${Pe.customName||`Tag ${Pe.id.slice(0,8)}`}`,children:y.jsx(Pr,{})})]}),y.jsxs("select",{value:Re,onChange:l=>{const v=l.target.value,B=en.find(D=>D.id===v);B&&!B.isLinked||(Zt(v),Mt(null),pi(!1))},style:{width:"100%",minHeight:44,padding:"8px 12px",borderRadius:10,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:14,lineHeight:1.2,minWidth:0},children:[y.jsx("option",{value:"",children:"Select a linked tag"}),en.map(l=>y.jsx("option",{value:l.id,disabled:!l.isLinked,children:l.name},l.id))]})]}),we.length===0&&y.jsx("div",{style:{marginBottom:10,padding:"10px 12px",borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",fontSize:12,color:"#6c757d",lineHeight:1.4},children:"No linked tags yet. Activate a tag in Settings to view location history."}),y.jsxs("div",{style:{marginBottom:10,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",padding:10,display:"grid",gap:8,flexShrink:0},children:[y.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a"},children:"Time Range"}),y.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[{value:"12h",label:"12h"},{value:"24h",label:"24h"},{value:"7d",label:"7d"},{value:"30d",label:"30d"},{value:"custom",label:"Custom"}].map(l=>{const v=ae===l.value;return y.jsx("button",{onClick:()=>N(l.value),disabled:!Pe,style:{minHeight:36,padding:"8px 10px",borderRadius:9999,border:v?"1px solid #0066cc":"1px solid #dee2e6",background:v?"#0066cc":"#f8f9fa",color:v?"#fff":Pe?"#1a1a1a":"#6c757d",fontSize:12,fontWeight:700,cursor:Pe?"pointer":"not-allowed",opacity:Pe?1:.72},children:l.label},`time-range-${l.value}`)})}),ae==="custom"&&Pe&&y.jsxs("div",{style:{marginTop:2,padding:10,border:"1px solid #d4dbe2",borderRadius:8,background:"#fff"},children:[y.jsxs("div",{style:{display:"grid",gap:8,gridTemplateColumns:te?"1fr":"repeat(2, minmax(0, 1fr))"},children:[y.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["Start",y.jsx("input",{type:"datetime-local",value:ve,max:ze||void 0,onChange:l=>Se(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",padding:8,borderRadius:6,border:"1px solid #dee2e6",background:"#fff",color:"#1a1a1a"}})]}),y.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["End",y.jsx("input",{type:"datetime-local",value:ze,min:ve||void 0,onChange:l=>$e(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",padding:8,borderRadius:6,border:"1px solid #dee2e6",background:"#fff",color:"#1a1a1a"}})]})]}),!zn&&y.jsx("div",{style:{marginTop:8,fontSize:12,color:"#dc3545"},children:"Choose a valid range where the end time is after the start time."})]})]}),y.jsx("div",{style:{marginBottom:10,padding:"10px 12px",borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",fontSize:12,color:"#6c757d",flexShrink:0},children:we.length===0?"Link and activate a tag to begin history playback.":Re?`${(lt[Re]||[]).length} points loaded for selected range.`:"Select a tag and time range to load history."}),Pe?y.jsxs(y.Fragment,{children:[y.jsxs("div",{style:{marginTop:10,marginBottom:10,padding:"10px 12px",borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,color:"#1a1a1a",flexShrink:0},children:[y.jsx("span",{style:{lineHeight:1.2,fontSize:13,fontWeight:600},children:"Show path lines"}),y.jsx("button",{type:"button","aria-pressed":di,onClick:()=>zr(l=>!l),style:{width:44,height:24,borderRadius:9999,border:"1px solid #adb5bd",background:di?"#0066cc":"#e9ecef",position:"relative",cursor:"pointer",padding:0},title:di?"Hide path lines":"Show path lines",children:y.jsx("span",{style:{position:"absolute",top:1,left:di?22:1,width:20,height:20,borderRadius:9999,background:"#fff",boxShadow:"0 1px 2px rgba(0,0,0,0.2)"}})})]}),y.jsxs("div",{style:{marginBottom:8,padding:"10px 12px",background:"#f8f9fa",borderRadius:8,border:"1px solid #dee2e6",flexShrink:0},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,minWidth:0},children:[y.jsx("span",{style:{color:"#1a1a1a",fontWeight:600,fontSize:13},children:"Timeline playback"}),y.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,flexShrink:0},children:[y.jsx("span",{style:{fontSize:12,color:tt?"#0f5132":"#6c757d",fontWeight:700},children:tt?"On":"Off"}),y.jsx("button",{type:"button","aria-pressed":tt,onClick:()=>Tn(!tt),style:{width:44,height:24,borderRadius:9999,border:"1px solid #adb5bd",background:tt?"#0066cc":"#e9ecef",position:"relative",cursor:"pointer",padding:0},children:y.jsx("span",{style:{position:"absolute",top:1,left:tt?22:1,width:20,height:20,borderRadius:9999,background:"#fff",boxShadow:"0 1px 2px rgba(0,0,0,0.2)",transition:"left 0.2s ease"}})})]})]}),y.jsx("div",{style:{marginTop:6,fontSize:12,color:"#6c757d",lineHeight:1.35},children:"Animate tag movement through the selected time range."})]}),tt&&y.jsxs("div",{style:{marginTop:8,marginBottom:12,padding:"12px",background:"#f8f9fa",borderRadius:8,border:"1px solid #dee2e6",flexShrink:0},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,flexWrap:"wrap"},children:[y.jsx("button",{onClick:()=>pi(!ct),style:{padding:"6px 12px",borderRadius:6,border:"1px solid #dee2e6",background:ct?"#dc3545":"#0066cc",color:"#fff",fontWeight:600,cursor:"pointer"},children:ct?"⏸ Pause":"▶ Play"}),y.jsx("button",{onClick:()=>{Mt(null),pi(!1)},style:{padding:"6px 12px",borderRadius:6,border:"1px solid #dee2e6",background:"#e9ecef",color:"#1a1a1a",fontWeight:600,cursor:"pointer"},children:"Reset"}),y.jsxs("select",{value:Fi,onChange:l=>lr(Number(l.target.value)),style:{padding:"6px 8px",borderRadius:6,border:"1px solid #dee2e6",background:"#fff",color:"#1a1a1a"},children:[y.jsx("option",{value:.5,children:"0.5x"}),y.jsx("option",{value:1,children:"1x"}),y.jsx("option",{value:2,children:"2x"}),y.jsx("option",{value:4,children:"4x"})]})]}),y.jsx("input",{type:"range",min:ii,max:At,value:fi||At,onChange:l=>{Mt(Number(l.target.value)),pi(!1)},style:{width:"100%",height:8,cursor:"pointer",accentColor:"#0066cc"}}),y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:"#6c757d",marginTop:4},children:[y.jsx("span",{children:new Date(ii).toLocaleString()}),y.jsx("span",{children:fi?new Date(fi).toLocaleString():ae==="custom"?new Date(At).toLocaleString():"Live"})]})]})]}):y.jsx("div",{style:{marginTop:8,fontSize:12,color:"#6c757d",flexShrink:0},children:"Select a tag to enable path lines and timeline playback."})]}),H==="activity"&&y.jsxs("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",gap:8,...te?{overflowY:"auto",overflowX:"hidden",paddingRight:2,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}:{overflow:"hidden"}},children:[Rr&&y.jsx("div",{style:{fontSize:12,color:"#b02a37",fontWeight:600},children:Rr}),y.jsxs("div",{style:{padding:"8px 10px",border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",fontSize:12,color:"#6c757d",lineHeight:1.35,flexShrink:0},children:["Latest geofence entry and exit events from your tags",kt.length>0?` (${Kt.length}${Kt.length!==kt.length?` of ${kt.length}`:""})`:""]}),y.jsxs("div",{style:{padding:10,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",display:"grid",gap:8,flexShrink:0},children:[y.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#1a1a1a"},children:"Filters"}),y.jsxs("div",{style:{display:"grid",gap:8,gridTemplateColumns:xr?"1fr":"repeat(3, minmax(0, 1fr))"},children:[y.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["Event",y.jsxs("select",{value:Di,onChange:l=>Fr(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",minHeight:34,padding:"6px 8px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12},children:[y.jsx("option",{value:"",children:"All"}),y.jsx("option",{value:"entry",children:"Entered"}),y.jsx("option",{value:"exit",children:"Exited"})]})]}),y.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["Tag",y.jsxs("select",{value:ht,onChange:l=>rr(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",minHeight:34,padding:"6px 8px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12},children:[y.jsx("option",{value:"",children:"All"}),ri.map(l=>y.jsx("option",{value:l.id,children:l.name},`activity-tag-${l.id}`))]})]}),y.jsxs("label",{style:{display:"grid",gap:4,fontSize:12,color:"#495057",minWidth:0},children:["Geofence",y.jsxs("select",{value:zt,onChange:l=>nr(l.target.value),style:{width:"100%",minWidth:0,boxSizing:"border-box",minHeight:34,padding:"6px 8px",borderRadius:8,border:"1px solid #d4dbe2",background:"#fff",color:"#1a1a1a",fontSize:12},children:[y.jsx("option",{value:"",children:"All"}),vr.map(l=>y.jsx("option",{value:l.id,children:l.name},`activity-geofence-${l.id}`))]})]})]})]}),Dn?y.jsx("div",{style:{flex:1,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",display:"grid",placeItems:"center",color:"#6c757d",fontSize:13},children:"Loading recent activity..."}):y.jsxs("div",{style:{...te?{border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",overflow:"hidden",display:"flex",flexDirection:"column",flexShrink:0}:{flex:1,minHeight:0,border:"1px solid #dee2e6",borderRadius:10,background:"#f8f9fa",overflow:"hidden",display:"flex",flexDirection:"column"}},children:[y.jsxs("div",{style:{padding:"8px 10px",borderBottom:"1px solid #dee2e6",fontWeight:700,color:"#1a1a1a",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[y.jsx("span",{children:"Events"}),y.jsx("span",{style:{fontSize:12,color:"#6c757d"},children:Kt.length})]}),y.jsx("div",{style:{...te?{overflowY:"visible",overflowX:"hidden"}:{flex:1,minHeight:0,overflowY:"auto",overflowX:xr?"hidden":"auto"}},children:Vt.length===0?y.jsx("div",{style:{padding:10,fontSize:12,color:"#6c757d"},children:"No recent geofence activity."}):Kt.length===0?y.jsx("div",{style:{padding:10,fontSize:12,color:"#6c757d"},children:"No events match the selected filters."}):xr?y.jsx("ul",{style:{listStyle:"none",margin:0,padding:0},children:Kt.map((l,v)=>{const B=!!ee(l.location);return y.jsxs("li",{style:{padding:"10px 10px",borderBottom:v<Kt.length-1?"1px solid #e8ecef":"none",display:"grid",gap:8},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[y.jsx("span",{style:{background:Xr(l.eventType),color:"#fff",padding:"3px 8px",borderRadius:6,fontSize:11,fontWeight:700},children:yr(l.eventType)}),y.jsx("span",{style:{fontSize:11,color:"#6c757d"},children:l.timestamp?mr(l.timestamp):"Unknown"})]}),y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:8},children:[y.jsxs("div",{style:{minWidth:0},children:[y.jsx("div",{style:{fontSize:13,color:"#1a1a1a",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.tagName}),y.jsx("div",{style:{marginTop:2,fontSize:12,color:"#6c757d",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.geofenceName})]}),y.jsx("button",{onClick:()=>{Wt(l.location,14)||Ae("No location available for this event.","warning")},disabled:!B,style:{width:30,minHeight:30,borderRadius:8,border:"none",background:"transparent",color:B?"#0066cc":"#9aa3ad",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:B?"pointer":"not-allowed",padding:0},title:B?"Center map on this event":"No event location available","aria-label":B?`Center map on ${l.tagName} event`:`No location for ${l.tagName} event`,children:y.jsx(Pr,{})})]})]},l.id)})}):y.jsxs("table",{style:{width:"100%",minWidth:560,borderCollapse:"collapse"},children:[y.jsx("thead",{children:y.jsxs("tr",{style:{background:"#f1f3f5",borderBottom:"1px solid #dee2e6"},children:[y.jsx("th",{style:{padding:"10px 12px",textAlign:"left",color:"#495057",fontSize:12,fontWeight:700},children:"Event"}),y.jsx("th",{style:{padding:"10px 12px",textAlign:"left",color:"#495057",fontSize:12,fontWeight:700},children:"Tag"}),y.jsx("th",{style:{padding:"10px 12px",textAlign:"left",color:"#495057",fontSize:12,fontWeight:700},children:"Geofence"}),y.jsx("th",{style:{padding:"10px 12px",textAlign:"right",color:"#495057",fontSize:12,fontWeight:700},children:"Time"}),y.jsx("th",{style:{padding:"10px 12px",textAlign:"right",color:"#495057",fontSize:12,fontWeight:700},children:"Map"})]})}),y.jsx("tbody",{children:Kt.map((l,v)=>{const B=!!ee(l.location);return y.jsxs("tr",{style:{borderBottom:"1px solid #e8ecef",background:v%2===0?"#fff":"#fafbfc"},children:[y.jsx("td",{style:{padding:"10px 12px"},children:y.jsx("span",{style:{background:Xr(l.eventType),color:"#fff",padding:"3px 8px",borderRadius:6,fontSize:11,fontWeight:700},children:yr(l.eventType)})}),y.jsx("td",{style:{padding:"10px 12px",fontSize:13,color:"#1a1a1a",fontWeight:600},children:l.tagName}),y.jsx("td",{style:{padding:"10px 12px",fontSize:13,color:"#1a1a1a"},children:l.geofenceName}),y.jsx("td",{style:{padding:"10px 12px",textAlign:"right",fontSize:12,color:"#6c757d"},children:l.timestamp?mr(l.timestamp):"Unknown"}),y.jsx("td",{style:{padding:"10px 12px",textAlign:"right"},children:y.jsx("button",{onClick:()=>{Wt(l.location,14)||Ae("No location available for this event.","warning")},disabled:!B,style:{width:30,minHeight:30,borderRadius:8,border:"none",background:"transparent",color:B?"#0066cc":"#9aa3ad",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:B?"pointer":"not-allowed",padding:0},title:B?"Center map on this event":"No event location available","aria-label":B?`Center map on ${l.tagName} event`:`No location for ${l.tagName} event`,children:y.jsx(Pr,{})})})]},l.id)})})]})})]})]}),H==="settings"&&y.jsx("div",{style:{flex:1,minHeight:0,display:"flex",flexDirection:"column",justifyContent:"flex-start"},children:y.jsx("button",{onClick:()=>W("/settings"),style:{minHeight:42,borderRadius:10,border:"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a",fontWeight:700,fontSize:14,cursor:"pointer",outline:"none"},children:"Open Full Settings"})}),H==="geofences"&&y.jsxs("div",{style:{...te?{flex:1,padding:"0 12px 12px 12px"}:{flex:1,minHeight:0,display:"flex",flexDirection:"column"},display:"flex",flexDirection:"column",gap:8,minHeight:0},children:[y.jsx("div",{style:{display:"flex",gap:8,alignItems:"center"},children:y.jsx("button",{onClick:()=>{Et?qt():gt(()=>{ta()},"start a new geofence")},style:{padding:"8px 14px",minHeight:40,borderRadius:10,border:"1px solid #0066cc",background:Et?"#e9ecef":"#0066cc",color:Et?"#1a1a1a":"#fff",fontWeight:700,fontSize:15,lineHeight:1,cursor:"pointer",outline:"none"},children:Et?"Cancel new geofence":"Add Circle"})}),Ri&&y.jsxs("div",{style:{marginBottom:8,fontSize:12,color:"#ff6b6b"},children:["⚠️ ",Ri]}),y.jsx("div",{style:{flex:1,minHeight:0,overflowY:"auto",paddingRight:2,WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:y.jsxs("ul",{style:{listStyle:"none",padding:0,margin:0,display:"grid",gap:8},children:[Et&&y.jsx("li",{style:{border:"1px solid #dee2e6",borderRadius:10,padding:10,background:"#f8f9fa"},children:ki}),Ue.length===0&&!Et&&y.jsx("li",{style:{color:"#6c757d"},children:"No geofences yet"}),Ue.map(l=>{const v=l.targetTagIds?.includes("all")?"All tags":l.targetTagIds?.map(V=>{const K=Fe.find(ue=>ue.id===V);return K?.customName||K?.name||`Tag ${V.slice(0,8)}`}).join(", ")||"No tags",B=it===l.id,D=os(l),U=!!(D&&D.isValid&&D.isValid());return y.jsxs("li",{ref:V=>{V&&(Gr.current[l.id]=V)},style:{border:"1px solid #dee2e6",borderRadius:10,padding:10,background:"#f8f9fa"},children:[y.jsx("div",{style:{display:"flex",alignItems:"flex-start",gap:8,marginBottom:8},children:y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0},children:[y.jsx("span",{style:{width:10,height:10,background:l.color||"#0066cc",borderRadius:2}}),y.jsxs("div",{style:{minWidth:0},children:[y.jsx("div",{style:{fontWeight:700,color:"#1a1a1a",lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l.name||l.type}),y.jsxs("div",{style:{fontSize:12,color:"#6c757d",marginTop:2,lineHeight:1.25},children:[l.geometry?.radiusMeters,"m radius • ",v]})]})]})}),y.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[y.jsx("button",{disabled:be===l.id,style:{padding:"8px 12px",minHeight:36,borderRadius:8,border:"1px solid #dee2e6",background:be===l.id?"#666":l.active?"#e9ecef":"#0066cc",color:be===l.id?"#fff":l.active?"#1a1a1a":"#fff",cursor:be===l.id?"not-allowed":"pointer",fontSize:15,fontWeight:600,lineHeight:1,opacity:be===l.id?.7:1,outline:"none"},onClick:async()=>{if(!(!fe||be===l.id)){qi(l.id);try{await Ja(ui(We,"users",fe,"geofences",l.id),{active:!l.active,updatedAt:ba()}),Ae(l.active?"Geofence deactivated.":"Geofence activated.","success")}catch(V){console.error("Failed to update geofence:",V),Ae("Failed to update geofence. Please try again.","error")}finally{qi(null)}}},children:be===l.id?"Updating...":l.active?"Deactivate":"Activate"}),y.jsx("button",{disabled:B,style:{padding:"8px 12px",minHeight:36,borderRadius:8,border:B?"1px solid #9cbce4":"1px solid #0066cc",background:B?"#dce9f8":"#0066cc",color:B?"#1f4f87":"#fff",cursor:B?"default":"pointer",fontSize:15,fontWeight:600,lineHeight:1,outline:"none",opacity:B?.9:1},onClick:()=>{B||gt(()=>{Te(l)},"edit a different geofence")},children:B?"Editing":"Edit"}),y.jsx("button",{disabled:be===l.id,style:{padding:"8px 12px",minHeight:36,borderRadius:8,border:"1px solid #dee2e6",background:be===l.id?"#666":"#e9ecef",color:be===l.id?"#fff":"#1a1a1a",cursor:be===l.id?"not-allowed":"pointer",fontSize:15,fontWeight:600,lineHeight:1,opacity:be===l.id?.7:1,outline:"none"},onClick:()=>{!fe||be===l.id||gt(()=>{fr({id:l.id,name:l.name||l.id})},"delete a geofence")},children:be===l.id?"Deleting...":"Delete"}),y.jsx("button",{onClick:()=>{oe(l,D)||Ae("Unable to locate this geofence on the map. Edit and save it to refresh coordinates.","warning")},style:{width:34,minHeight:34,marginLeft:"auto",borderRadius:8,border:"none",background:"transparent",color:U?"#0066cc":"#9aa3ad",cursor:"pointer",fontSize:14,lineHeight:1,outline:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:0,opacity:U?1:.75},"aria-label":`Center map on geofence ${l.name||l.id}`,title:U?"Center map on this geofence":"Geofence location may be missing. Click to retry.",children:y.jsx(Pr,{})})]}),B&&y.jsx("div",{style:{marginTop:10,paddingTop:10,borderTop:"1px solid #dee2e6"},children:ki})]},l.id)})]})})]})]})]})]}),On&&y.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(20, 24, 28, 0.45)",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:y.jsxs("div",{style:{width:"min(100%, 440px)",background:"#fff",borderRadius:14,border:"1px solid #dee2e6",boxShadow:"0 20px 50px rgba(0,0,0,0.22)",padding:16,display:"grid",gap:10},children:[y.jsx("div",{style:{fontWeight:800,fontSize:20,color:"#1a1a1a",lineHeight:1.2},children:"Unsaved geofence changes"}),y.jsxs("div",{style:{fontSize:14,color:"#495057",lineHeight:1.45},children:["You have unsaved edits. Save your changes before you ",In,"?"]}),!Pt&&y.jsx("div",{style:{fontSize:12,color:"#6c757d"},children:"Some required fields are incomplete. You can keep editing or discard changes."}),y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginTop:4},children:[y.jsx("button",{onClick:Ft,style:{minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a",fontSize:14,fontWeight:600,cursor:"pointer",outline:"none"},children:"Keep editing"}),y.jsx("button",{onClick:ia,style:{minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:"#e9ecef",color:"#1a1a1a",fontSize:14,fontWeight:700,cursor:"pointer",outline:"none"},children:"Discard changes"}),y.jsx("button",{onClick:ra,disabled:Ve||!Pt,style:{minHeight:38,borderRadius:8,border:"1px solid #0066cc",background:Ve?"#666":Pt?"#0066cc":"#dce3eb",color:Ve||Pt?"#fff":"#6c757d",fontSize:14,fontWeight:700,cursor:Ve?"not-allowed":Pt?"pointer":"not-allowed",opacity:Ve?.8:1,outline:"none"},children:Ve?"Saving...":"Save changes"})]})]})}),pt&&y.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(20, 24, 28, 0.45)",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:y.jsxs("div",{style:{width:"min(100%, 440px)",background:"#fff",borderRadius:14,border:"1px solid #dee2e6",boxShadow:"0 20px 50px rgba(0,0,0,0.22)",padding:16,display:"grid",gap:10},children:[y.jsx("div",{style:{fontWeight:800,fontSize:20,color:"#1a1a1a",lineHeight:1.2},children:"Delete geofence?"}),y.jsxs("div",{style:{fontSize:14,color:"#495057",lineHeight:1.45},children:["Delete ",y.jsx("strong",{children:pt.name}),"? This action cannot be undone."]}),y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:4},children:[y.jsx("button",{onClick:Lr,disabled:!!be,style:{minHeight:38,borderRadius:8,border:"1px solid #dee2e6",background:"#f8f9fa",color:"#1a1a1a",fontSize:14,fontWeight:600,cursor:be?"not-allowed":"pointer",outline:"none",opacity:be?.8:1},children:"Cancel"}),y.jsx("button",{onClick:nt,disabled:be===pt.id,style:{minHeight:38,borderRadius:8,border:"1px solid #c62828",background:be===pt.id?"#666":"#c62828",color:"#fff",fontSize:14,fontWeight:700,cursor:be===pt.id?"not-allowed":"pointer",outline:"none",opacity:be===pt.id?.85:1},children:be===pt.id?"Deleting...":"Delete"})]})]})}),xi&&y.jsx("div",{role:"status","aria-live":"polite",style:{position:"fixed",right:16,bottom:te?16:96,zIndex:5200,maxWidth:"min(92vw, 420px)",borderRadius:10,border:`1px solid ${(Yi[xi.tone]||Yi.info).border}`,background:(Yi[xi.tone]||Yi.info).background,color:"#fff",boxShadow:"0 10px 28px rgba(0,0,0,0.28)",padding:"10px 12px",fontSize:13,fontWeight:600,lineHeight:1.35},children:xi.message})]})}function No({pathsByTag:F,myTags:W,showPathLines:Y,renderPointTrail:H=!0,maxTimestamp:re=null,fitBoundsPadding:ae=null,manualViewportUntil:N=0}){const ve=er(),Se=I.useRef(null),ze=I.useRef(""),[$e,Ue]=I.useState(()=>Math.round(ve.getZoom()));return I.useEffect(()=>{const Ge=()=>{const Re=Number(ve.getZoom());Number.isFinite(Re)&&Ue(Math.round(Re))};return Ge(),ve.on("zoomend",Ge),()=>{ve.off("zoomend",Ge)}},[ve]),I.useEffect(()=>{Se.current||(Se.current=qe.layerGroup().addTo(ve));const Ge=Se.current;Ge.clearLayers();const Re=pe=>{const se=W.find(me=>me.id===pe)?.color;return/^#([0-9a-fA-F]{3}){1,2}$/.test(se||"")?se:"#0066cc"},Zt=pe=>W.find(de=>de.id===pe)?.customName||`Tag ${String(pe).slice(0,8)}`,Fe=pe=>{const de=qe.circleMarker([pe.lat,pe.lng],{radius:H?6:7,color:"#1a1a1a",weight:2,fillColor:pe.color,fillOpacity:1}),se=La(pe.ts),me=se?`${pe.label} · ${se}`:pe.label;de.bindTooltip(me);const Ce=rs(pe);Ce&&de.bindPopup(Ce,{maxWidth:260,autoPan:!0}),de.addTo(Ge)},ot=re?Object.fromEntries(Object.entries(F||{}).map(([pe,de])=>[pe,de.filter(se=>(se.ts&&typeof se.ts.toDate=="function"?se.ts.toDate().getTime():se.ts?.seconds?se.ts.seconds*1e3:se.ts)<=re)])):F||{},lt=Object.entries(ot).map(([pe,de])=>{const se=Array.isArray(de)?de:[],me=se[0],Ce=se[se.length-1],Me=Number(me?.lat),Ee=Number(me?.lng),De=Number(Ce?.lat),Ye=Number(Ce?.lng),xe=Number(Ce?.timestampMs),He=Number.isFinite(xe)?xe:0;return[pe,se.length,Number.isFinite(Me)?Me.toFixed(4):"na",Number.isFinite(Ee)?Ee.toFixed(4):"na",Number.isFinite(De)?De.toFixed(4):"na",Number.isFinite(Ye)?Ye.toFixed(4):"na",String(He)].join(":")}).sort().join("|"),Ct=[],et=[];if(Object.entries(ot).forEach(([pe,de])=>{if(!Array.isArray(de)||de.length===0)return;const se=de.map(xe=>[Number(xe.lat),Number(xe.lng),xe.ts]).filter(([xe,He])=>Number.isFinite(xe)&&Number.isFinite(He));if(se.length===0)return;const me=se.map(([xe,He])=>[xe,He]);Ct.push(...me),Y&&me.length>1&&qe.polyline(me,{color:Re(pe),weight:3,opacity:.9}).addTo(Ge);const Ce=se[se.length-1];if(!Ce)return;const[Me,Ee,De]=Ce,Ye={tagId:pe,lat:Me,lng:Ee,ts:De||null,label:Zt(pe),color:Re(pe)};et.push(Ye),H&&(Fe(Ye),se.slice(0,-1).forEach(([xe,He,ci])=>{const ut=qe.circleMarker([xe,He],{radius:3,color:Re(pe),weight:1,fillColor:Re(pe),fillOpacity:.9}),Nt=La(ci),je=Zt(pe),Gt=Nt?`${je} · ${Nt}`:je;ut.bindTooltip(Gt);const kt=rs({label:je,ts:ci,lat:xe,lng:He});kt&&ut.bindPopup(kt,{maxWidth:260,autoPan:!0}),ut.addTo(Ge)}))}),!H&&et.length>0)if(!($e<=11))et.forEach(de=>Fe(de));else{const de=$e<=5?110:$e<=7?90:$e<=9?74:58,se=new Map;et.forEach(me=>{const Ce=ve.project(qe.latLng(me.lat,me.lng),$e),Me=`${Math.floor(Ce.x/de)}:${Math.floor(Ce.y/de)}`;se.has(Me)||se.set(Me,[]),se.get(Me).push(me)}),se.forEach(me=>{if(me.length===1){Fe(me[0]);return}const Ce=me.reduce((xe,He)=>xe+He.lat,0)/me.length,Me=me.reduce((xe,He)=>xe+He.lng,0)/me.length,Ee=me.length,De=Ee>=20?38:Ee>=10?34:30,Ye=qe.marker([Ce,Me],{icon:qe.divIcon({className:"",html:`<div style="width:${De}px;height:${De}px;border-radius:9999px;background:#0066cc;border:2px solid #ffffff;color:#fff;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,0.25);">${Ee}</div>`,iconSize:[De,De],iconAnchor:[De/2,De/2]}),keyboard:!1});Ye.bindTooltip(`${Ee} tags in this area`),Ye.on("click",()=>{const xe=Math.min((ve.getZoom()||0)+2,19);ve.setView([Ce,Me],xe,{animate:!0})}),Ye.addTo(Ge)})}if(Ct.length>0&&re===null&&Date.now()>=N&&lt!==ze.current)try{ve.fitBounds(Ct,{paddingTopLeft:ae?.topLeft||[30,30],paddingBottomRight:ae?.bottomRight||[30,30]}),ze.current=lt}catch{}else Ct.length===0&&(ze.current="");return()=>{Ge.clearLayers()}},[ve,$e,F,W,Y,H,re,ae,N]),null}export{zo as default};
